{% extends "../base.html" %} {%block title%}我的业务{%end%} {% block body %}
 {%block head%}
 {%end%}
<!-- 发业源码开始 -->
<style>
.faye-ti {
padding: 0.5rem;
}
.faye-a a {
padding: 5px;
}
.faye-tdti {
text-align: center;
}
.faye-selsect td {
margin-right: 15px;
}
.faye-selsect td input {
font-size: 12px;
padding: 5px;
}
.faye-selsect td select {
font-size: 12px;
padding: 5px;
}
.faye-btn {padding: 0.1rem 0.2rem; background-color: #9ec6ef; margin-left: 20px; border-radius: 2px;}
select.form-control:not([size]):not([multiple]) {height: calc(2rem + 0px);}
.dropbtn {
    background-color: #4CAF50;
    color: white;
    padding: 16px;
    font-size: 10px;
    border: none;
    cursor: pointer;
}

.dropdown {
    position: relative;
    display: inline-block;
}

.dropdown-content {
    display: none;
    z-index:9999;
    position: absolute;
    background-color: #f9f9f9;
    width: 100%;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
}

.dropdown-content a {
    color: black;
    padding: 6px;
    text-align: center;
    text-decoration: none;
    display: block;
}

.dropdown-content a:hover {background-color: #f1f1f1}

.dropdown:hover .dropdown-content {
    display: block;
}

.dropdown:hover .dropbtn {
    background-color: #3e8e41;
}
</style>
<!-- 发业源码结束 -->

 <ol class="breadcrumb faye-ti">
   <li class="breadcrumb-item g1">
     主面板
   </li>
   <li class="breadcrumb-item g1">事项安排</li>
   <li class="g1 g1-left"><a  href="/statis?tag=todo_arrange_count{%if todo%}&todo={{todo}}{%end%}" {%if not params['gb'] %}class="btn btn-primary btn-sm" {%else%}class="btn btn-default btn-sm" style="background-color: #9ec6ef;" {%end%}>负责人统计</a></li>
   <li class="g1 g1-left"><a  href="/statis?tag=todo_arrange_count&gb=bs{%if todo=='-1000'%}{%elif todo%}&todo={{todo}}{%end%}" {%if params['gb']=="bs" %}class="btn btn-primary btn-sm" {%else%}class="btn btn-default btn-sm" style="background-color: #9ec6ef;" {%end%}>办事人统计</a></li>
   <li class="g1 g1-left">
     
        
    
        <div class="dropdown">
                <a href="javascript:void(0)" class="btn btn-primary btn-sm" style="font-size:10px;" id='project_btn'>
                        {%if params['way']=='day'%}按日统计{%elif params['way']=='month'%}按月统计{%elif params['way']=='week'%}按周统计{%end%}
                <span class="fa fa-caret-down"></span>  
                </a>
                
                <div class="dropdown-content">
                  <a href="/statis?tag=todo_arrange_count{%if todo%}&todo={{todo}}{%end%}{%if params['gb']%}&gb={{params['gb']}}{%end%}&way=day{%if params['person_name']%}&person_name={{params['person_name']}}{%end%}
                  {%if params['start_time']%}&start_time={{params['start_time']}}{%end%}
                  {%if params['end_time']%}&end_time={{params['end_time']}}{%end%}{%if params['department']%}&department={{params['department']}}{%end%}" >按日统计 </a>
                  <a href="/statis?tag=todo_arrange_count{%if todo%}&todo={{todo}}{%end%}{%if params['gb']%}&gb={{params['gb']}}{%end%}&way=month{%if params['person_name']%}&person_name={{params['person_name']}}{%end%}
                  {%if params['start_time']%}&start_time={{params['start_time']}}{%end%}
                  {%if params['end_time']%}&end_time={{params['end_time']}}{%end%}{%if params['department']%}&department={{params['department']}}{%end%}">按月统计 </a>
                  <a href="/statis?tag=todo_arrange_count{%if todo%}&todo={{todo}}{%end%}{%if params['gb']%}&gb={{params['gb']}}{%end%}&way=week{%if params['person_name']%}&person_name={{params['person_name']}}{%end%}
                  {%if params['start_time']%}&start_time={{params['start_time']}}{%end%}
                  {%if params['end_time']%}&end_time={{params['end_time']}}{%end%}{%if params['department']%}&department={{params['department']}}{%end%}">按周统计</a>
                </div>
              </div>
  
    </li>
 </ol>
 <nav>
    <div class="nav faye-a nav-tabs" id="nav-tab" role="tablist">

   
        <a class="nav-item nav-link {%if not todo%}active{%end%}" id="nav-home-tab"
        href="/statis?tag=todo_arrange_count{%if params['way']%}&way={{params['way']}}{%end%}{%if params['gb']%}&gb={{params['gb']}}{%end%}{%if params['person_name']%}&person_name={{params['person_name']}}{%end%}
        {%if params['start_time']%}&start_time={{params['start_time']}}{%end%}
        {%if params['end_time']%}&end_time={{params['end_time']}}{%end%}
        {%if params['department']%}&department={{params['department']}}{%end%}
        " >全 部
        </a>
        </a>
        {%if params['gb']!="bs" %}
        <a class="nav-item nav-link {%if todo=='-1000'%}active{%end%}"
         href="/statis?tag=todo_arrange_count&todo=-1000{%if params['way']%}&way={{params['way']}}{%end%}{%if params['person_name']%}&person_name={{params['person_name']}}{%end%}
         {%if params['start_time']%}&start_time={{params['start_time']}}{%end%}
         {%if params['end_time']%}&end_time={{params['end_time']}}{%end%}{%if params['department']%}&department={{params['department']}}{%end%}" style="font-size:13px;">
              待安排
            </a>{%end%}
      <a class="nav-item nav-link {%if todo=='1'%}active{%end%}"
        href="/statis?tag=todo_arrange_count&todo=1{%if params['way']%}&way={{params['way']}}{%end%}{%if params['gb']%}&gb={{params['gb']}}{%end%}{%if params['person_name']%}&person_name={{params['person_name']}}{%end%}
        {%if params['start_time']%}&start_time={{params['start_time']}}{%end%}
        {%if params['end_time']%}&end_time={{params['end_time']}}{%end%}{%if params['department']%}&department={{params['department']}}{%end%}" style="font-size:13px;"> 待接单
        </a>
        <a class="nav-item nav-link {%if todo=='2'%}active{%end%}"
        href="/statis?tag=todo_arrange_count&todo=2{%if params['way']%}&way={{params['way']}}{%end%}{%if params['gb']%}&gb={{params['gb']}}{%end%}{%if params['person_name']%}&person_name={{params['person_name']}}{%end%}
        {%if params['start_time']%}&start_time={{params['start_time']}}{%end%}
        {%if params['end_time']%}&end_time={{params['end_time']}}{%end%}{%if params['department']%}&department={{params['department']}}{%end%}" style="font-size:13px;"> 办理中
       </a>
        <a class="nav-item nav-link {%if todo=='3'%}active{%end%}"
        href="/statis?tag=todo_arrange_count&todo=3{%if params['way']%}&way={{params['way']}}{%end%}{%if params['gb']%}&gb={{params['gb']}}{%end%}{%if params['person_name']%}&person_name={{params['person_name']}}{%end%}
        {%if params['start_time']%}&start_time={{params['start_time']}}{%end%}
        {%if params['end_time']%}&end_time={{params['end_time']}}{%end%}{%if params['department']%}&department={{params['department']}}{%end%}" style="font-size:13px;"> 已办结
       </a>
       </div>
       <div class="nav faye-a nav-tabs" id="nav-tab" role="tablist" style="margin-top: 5px;">

        
   
        <a class="nav-item nav-link {%if not params['department']%}active{%end%}" id="nav-home-tab"
        href="/statis?tag=todo_arrange_count{%if params['way']%}&way={{params['way']}}{%end%}{%if params['gb']%}&gb={{params['gb']}}{%end%}{%if params['person_name']%}&person_name={{params['person_name']}}{%end%}
        {%if params['start_time']%}&start_time={{params['start_time']}}{%end%}
        {%if params['end_time']%}&end_time={{params['end_time']}}{%end%}{%if todo%}&todo={{todo}}{%end%}" >全 部
        </a>
        {%for item in departments%}
        <a class="nav-item nav-link {%if params['department']==item.department_name%}active{%end%}" id="nav-home-tab"
        href="/statis?tag=todo_arrange_count&department={{item.department_name}}{%if params['way']%}&way={{params['way']}}{%end%}{%if params['gb']%}&gb={{params['gb']}}{%end%}
        {%if params['start_time']%}&start_time={{params['start_time']}}{%end%}
        {%if params['end_time']%}&end_time={{params['end_time']}}{%end%}{%if todo%}&todo={{todo}}{%end%}" >{{item.department_name}}
        </a>
        {%end%}
       </div>
</nav>


<style>
  .faye-table {font-size: 12px;}
  .faye-table thead tr th {text-align: center;}
  .faye-table tbody tr td {text-align: center; padding: 0.3rem; height: 40px; box-sizing: border-box;}
.faye-tdti {
text-align: center;
}
.faye-selsect td {
margin-right: 15px;
}
.faye-selsect td input {
font-size: 12px;
padding: 5px;
}
.faye-selsect td select {
font-size: 12px;
padding: 5px;
}
</style>
<form style="margin-top: 5px;" class="pm2">
        <table>
            <tbody>
              <tr class="faye-selsect">
                <td>
                    <select name="person_name" class="form-control">
                  <option value="">{%if not params['gb'] %}选择负责人{%else%}选择办事人{%end%}</option>
                  {%for item in todo_arrange_name%}
                  <option value="{{item.name}}" {%if params['person_name']==item.name%}selected{%end%}>{{item.name}}</option>
                  {%end%}
  
                </select></td>
                <td>
                    <input type="text" name="start_time" id="start_time" placeholder="开始时间" class="form-control" value="{{params['start_time']}}">
                  </td>
                  <td>至</td>
                  <td><input type="text" name="end_time" id="end_time" placeholder="结束时间" class="form-control" value="{{params['end_time']}}"></td>
                <td>
                  <input name="tag" value="{{tag}}" hidden>
                  <input name="todo" value="{{todo}}" hidden>
                  {%if params['gb']%}
                  <input name="gb" value="{{params['gb']}}" hidden>{%end%}
                  {%if params['department']%}
                  <input name="department" value="{{params['department']}}" hidden>
                  {%end%}
                  <input name="way" value="{{params['way']}}" hidden>
                  <input type="submit" class="btn btn-primary btn-sm" value="检 索"></td>
              </tr>
            </tbody>
     
        </table>
      </form>
          
<div class="table-responsive">
  <table class="table faye-table table-bordered fayetable" id="dataTable" cellspacing="0" style="font-size:11px;{%if count.every_count%}{%if len(count.every_count.split(','))<4 %}width:400px;{%end%}{%end%}">
        {%if count.every_count%}
               <thead class="table_class">
                
                <tr>
                    <th width='120'>日期</th>
                    <th width='60'>合计</th>
                    {%for item in count.every_count.split(',')%}

                    <th>{{item.split('|')[0]}}</th>
                    {%end%}
                </tr>
               </thead>
               <tbody>
                   <tr>
                       <td>合计</td>
                       <td>{{count.ssc}}</td>
                       {%for item in count.every_count.split(',')%}

                       <td>{{item.split('|')[1]}}</td>
                       {%end%}
                   </tr>
                   {%for item in todo_arranges%}
                   <tr>
                       <td>{{item.df_created}}</td>
                       <td>{{item.sc}}</td>
                       {%for row in count.every_count.split(',')%}

                       <td>
                        {%for m in item.gcgc.split(',')%}
                        {%if row.split('|')[0]==m.split('|')[0]%}
                        {{m.split('|')[1]}}
                        {%end%}
                        {%end%}
                       </td>

                        {%end%}
                    </tr>
                   {%end%}
               </tbody>
{%else%}
        还没有哦~
{%end%}
           </table>
       </div>
           <ul class="pagination">
              {% if pagination.has_prev %}
                   <li class="paginate_button page-item previous " id="dataTable_previous">
                   <a 
                   href="/statis?tag=todo_arrange_count&page={{ pagination.page - 1}}{%if todo%}&todo={{todo}}{%end%}
                   {%if params['gb']%}&gb={{params['gb']}}{%end%}{%if params['way']%}&way={{params['way']}}{%end%}
                   {%if params['person_name']%}&person_name={{params['person_name']}}{%end%}
                   {%if params['start_time']%}&start_time={{params['start_time']}}{%end%}
                   {%if params['end_time']%}&end_time={{params['end_time']}}{%end%}
                   {%if params['department']%}&department={{params['department']}}{%end%}
                   " 
                    aria-controls="dataTable" data-dt-idx="0" tabindex="0" class="page-link">&laquo; 上页</a></li>
          
          
          
                  {% end %}
                  {%for page in pagination.iter_pages() %}
                   {% if page %}
                   {% if page != pagination.page %}
                   <li class="paginate_button page-item ">
                     <a 
              href="/statis?tag=todo_arrange_count&page={{page}}{%if todo%}&todo={{todo}}{%end%}
              {%if params['gb']%}&gb={{params['gb']}}{%end%}{%if params['way']%}&way={{params['way']}}{%end%}
              {%if params['person_name']%}&person_name={{params['person_name']}}{%end%}
              {%if params['start_time']%}&start_time={{params['start_time']}}{%end%}
              {%if params['end_time']%}&end_time={{params['end_time']}}{%end%}
              {%if params['department']%}&department={{params['department']}}{%end%}
              " 
                aria-controls="dataTable" data-dt-idx="3" tabindex="0" class="page-link">{{ page }}</a></li>
                   {% else %}
                    <li class="paginate_button page-item active">
                      <a href="#" aria-controls="dataTable" data-dt-idx="1" tabindex="0" class="page-link">{{ page }}</a></li>
                    {% end %}
                     {% else %}
                    <li class="paginate_button page-item "><span class="active"><a href="#" aria-controls="dataTable" data-dt-idx="1" tabindex="0" class="page-link">....</a></span></li>
                    {% end %}
                    {% end %} 
          
                   {% if pagination.has_next %}
                   <li class="paginate_button page-item next" id="dataTable_next"
                   ><a 
                   href="/statis?tag=todo_arrange_count&page={{pagination.page+1}}{%if todo%}&todo={{todo}}{%end%}
                   {%if params['gb']%}&gb={{params['gb']}}{%end%}{%if params['way']%}&way={{params['way']}}{%end%}
                   {%if params['person_name']%}&person_name={{params['person_name']}}{%end%}
                   {%if params['start_time']%}&start_time={{params['start_time']}}{%end%}
                   {%if params['end_time']%}&end_time={{params['end_time']}}{%end%}
                   {%if params['department']%}&department={{params['department']}}{%end%}
                   "
                   aria-controls="dataTable" data-dt-idx="7" tabindex="0" class="page-link">下页 &raquo;</a></li>
               {% end %} </ul>
               





 {% end %} 
 {%block js%}
<script>
$(function () { 
  $("#m_statis").click()
    $("#start_time").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 00:00:00',
    language: 'zh-CN',initialDate: new Date()});
    $("#end_time").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 23:59:59',
    language: 'zh-CN',initialDate: new Date()});

 })
</script>
{%end%}