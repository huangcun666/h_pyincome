{% extends "../base.html" %} {%block title%}客户管理{%end%} {% block body %}
<!--<a class="btn btn-danger btn-sm delete  " id="customer_delete" type="button" title="{{customer.customer_id}}">删除</a>-->
{%block head%}
<link href="/static/dropzone.css" rel="stylesheet">
{%end%}
<style>
modal-body{overflow-y: inherit;}
.faye-table {width: 100%; height: auto; /*background-color: purple;*/ margin: 0% auto; font-weight: bold;}
.faye-table ul {overflow: hidden; margin: 0; padding: 0;}
.faye-table ul li {width: 100%; list-style: none; box-sizing: border-box; border-bottom: 1px solid #dedede; width: 100%; height:40px; overflow: hidden;}
.faye-table ul li div {float: left; height: 40px; line-height: 40px; text-align: center; border-left: 1px solid #dedede;}
.faye-table ul li div.fayet {width:10%; background-color:#eee; border-bottom: 1px solid #dedede; }
.faye-table ul li div.fayet1 {width:13%;}
.faye-table ul li div.fayet3 {width:92%;}
.faye-table ul li div.fayet4 {width:10%;}
.faye-table ul li div.fayet5 {width:15%;}
.faye-table ul li div.fayet6 {width:33%; height: 180px; border-left: 1px solid #dedede; }
.faye-table ul li div.fayet7 {width:34%; height: 180px; border-left: 1px solid #dedede;}
.faye-table ul li.gaodu {height: 180px;}
.faye-table ul li div.direction {text-align: left; padding-left: 10px; box-sizing: border-box;}
.faye-table ul li div.fayet6 span {display: block; width: 100%; height: 40px; border-bottom: 1px solid #dedede; background-color:#eee; }
.faye-table ul li div.fayet7 span {display: block; width: 100%; height: 40px; border-bottom: 1px solid #dedede; background-color:#eee; }
.faye-table ul li div.fayet6 i {display: block; width: 100%; height: 140px; line-height: 22px; font-style: normal; padding-top:8px; box-sizing: border-box;}
.faye-table ul li div.fayet7 i {display: block; width: 100%; height: 140px; line-height: 22px; font-style: normal; padding-top:8px; box-sizing: border-box;}
.message-item {
margin-bottom: 5px;
margin-left: 40px;
position: relative;
}
.message-item .message-inner {
background: #fff;
border: 1px solid #ddd;
border-radius: 3px;
padding: 10px;
position: relative;
}
.message-item .message-inner:before {
border-right: 10px solid #ddd;
border-style: solid;
border-width: 10px;
color: rgba(0,0,0,0);
content: "";
display: block;
height: 0;
position: absolute;
left: -20px;
top: 6px;
width: 0;
}
.message-item .message-inner:after {
border-right: 10px solid #fff;
border-style: solid;
border-width: 10px;
color: rgba(0,0,0,0);
content: "";
display: block;
height: 0;
position: absolute;
left: -18px;
top: 6px;
width: 0;
}
.message-item:before {
background: #fff;
border-radius: 2px;
bottom: -30px;
box-shadow: 0 0 3px rgba(0,0,0,0.2);
content: "";
height: 100%;
left: -30px;
position: absolute;
width: 3px;
}
.message-item:after {
background: #fff;
border: 2px solid #ccc;
border-radius: 50%;
box-shadow: 0 0 5px rgba(0,0,0,0.1);
content: "";
height: 15px;
left: -36px;
position: absolute;
top: 10px;
width: 15px;
}
.clearfix:before, .clearfix:after {
content: " ";
display: table;
}
.message-item .message-head {
border-bottom: 1px solid #eee;
margin-bottom: 8px;
padding-bottom: 8px;
}
.message-item .message-head .avatar {
margin-right: 20px;
}
.message-item .message-head .user-detail {
overflow: hidden;
}
.message-item .message-head .user-detail h5 {
font-size: 16px;
font-weight: bold;
margin: 0;
}
.message-item .message-head .post-meta {
float: left;
padding: 0 15px 0 0;
}
.message-item .message-head .post-meta >div {
color: #333;
font-weight: bold;
text-align: right;
}
.post-meta > div {
color: #777;
font-size: 12px;
line-height: 22px;
}
.message-item .message-head .post-meta >div {
color: #333;
font-weight: bold;
text-align: right;
}
.post-meta > div {
color: #777;
font-size: 12px;
line-height: 22px;
}
.message-item img {
min-height: 25px;
max-height: 25px;
}
.modal-ku {
width: 1750px;
margin: auto;
}
.dropbtn {
    background-color: #4CAF50;
    color: white;
    padding: 16px;
    font-size: 10px;
    border: none;
    cursor: pointer;
}

.dropdown {
    position: relative;
    display: inline-block;
}

.dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 100px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
}

.dropdown-content a {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
}

.dropdown-content a:hover {background-color: #f1f1f1}

.dropdown:hover .dropdown-content {
    display: block;
}

.dropdown:hover .dropbtn {
    background-color: #3e8e41;
}
.file {
    position: relative;
    display: inline-block;
    background: #D0EEFF;
    border: 1px solid #99D3F5;
    border-radius: 4px;
    padding: 4px 12px;
    overflow: hidden;
    color: #1E88C7;
    text-decoration: none;
    text-indent: 0;
    line-height: 20px;
}
.file input {
    position: absolute;
    font-size: 100px;
    right: 0;
    top: 0;
    opacity: 0;
}
.file:hover {
    background: #AADFFD;
    border-color: #78C3F3;
    color: #004974;
    text-decoration: none;
}
.es-nva {width: 1170px; height: 130px; background: #fff; margin:0 auto 10px; border-left:1px solid #ddd; border-right:1px solid #ddd; border-bottom: 1px solid #ddd; box-sizing: border-box; padding: 20px;}
.es-portrait {width: 73px; height: 73px; border-radius: 3px; margin-right: 20px; float: left;}
.es-nva-left {float: left; width: 500px;}
.es-portrait-name {float: left; width: 560px;}
.es-portrait-name p { display:block;overflow: hidden; height: 24px; line-height: 30px;}
.es-portrait-name p span {margin-right: 15px;}
.gsname {font-size: 18px; color: #5d5d5d; font-weight: bold;}
.xindm {font-size: 14px;}
.es-name {font-size: 18px; color: #4aaacc; }
.es-portrait-name em {font-style:normal;}
.xxnr {overflow: hidden;}
.xxnr b {display: block;}
.xxnr b em {font-weight: 100;}
.xxnr-left {float: left; width: 225px;}
.xxnr-right {float: right; width: 225px;}
.es-nva-right {float: right; width: 500px;}
.es-nva-right b {display: block; margin-top: 7px;}
.es-nva-right b em {font-weight: 100; font-style: normal;}
.es-nva-right b a {display: inline-block; padding: 2px 4px; color: #fff; background-color: #1fa0e0; margin-left: 4px; font-weight: 100;}
.widget-header {height: 28px; line-height: 28px; font-size: 12px;}
.widget-content {padding: 15px;}

.es-fytable {width: 100%; height: auto; /*background-color: purple;*/ margin: 0% auto; font-weight: bold;}
.es-fytable ul {overflow: hidden; margin: 0; padding: 0; border-right: 1px solid #dedede;}
.es-fytable ul li {width: 100%; list-style: none; box-sizing: border-box; border-bottom: 1px solid #dedede; width: 100%; height:30px; overflow: hidden;}
.es-fytable ul li div {float: left; height: 30px; line-height: 30px;  border-left: 1px solid #dedede; box-sizing: border-box; color: #272727;}
.es-fytable ul li div.length1 {width: 12.7%; background-color: #eeeeee; text-align: center;}
.es-fytable ul li div.length2 {width: 20%; padding-left: 25px;font-weight: 100;}
.es-fytable ul li div.length3 {width: 87%; padding-left: 25px;font-weight: 100;}
.es-fytable ul li div.length4 {width: 12.2%; padding-left: 10px;font-weight: 100;}
.es-fytable ul li div.length5 {width: 52.7%; padding-left: 25px;font-weight: 100;}
.es-fytable ul li div.length6 {width: 62.1%; padding-left: 25px;font-weight: 100;}
.btn {padding: 2px 8px; line-height: 12px; font-size: 12px;}
.widget {margin-bottom: 20px; }
.widget-header h3 {font-size: 12px;}
.widget-header h3 a {margin-left: 10px;}
.table-bordered th {font-weight: 100;}
.table th {padding: 6px;}
.subnavbar{
  margin:0px;
}

.es-progress {width: 1130px; height: 66px;  margin: 0 auto;}
.esdt-box1 {width: 183px; height: 66px; background:url('/static/images/img/1.png') center center no-repeat; float: left; cursor:pointer; }
.esdt-box2 {width: 193px; height: 66px; background:url('/static/images/img/2.png') center center no-repeat; float: left; z-index: 2; margin-left: -25px; cursor:pointer;}
.esdt-box3 {width: 132px; height: 66px; background:url('/static/images/img/3.png') center center no-repeat; float: left; z-index: 2; margin-left: -25px; cursor:pointer;}
.esdtcur1 {background:url('/static/images/img/1a.png') center center no-repeat; cursor:pointer;}
.esdtcur2 {background:url('/static/images/img/2a.png') center center no-repeat; cursor:pointer;}
.esdtcur3 {background:url('/static/images/img/3a.png') center center no-repeat; cursor:pointer;}
.es-progress h3 {text-align: center;  margin-top: 10px; }
.es-progress span {text-align: center;  display: block; }
.es-progress .esdtcur1 h3 {color: #fff;}
.es-progress .esdtcur1 span {color: #fff;}
.es-progress .esdtcur2 h3 {color: #fff;}
.es-progress .esdtcur2 span {color: #fff;}
.es-progress .esdtcur3 h3 {color: #fff;}
.es-progress .esdtcur3 span {color: #fff;}
.eswenben {width: 1130px; height: 95px; margin: 20px auto 10px; border: 1px solid #dedede; box-sizing: border-box;}
.estu { height: 14px; position: relative; float: left; padding-left: 20px;}
.estu-f {float: left;color: #4bacce;}
.estu-r {float: right; color: #4bacce;}
.estu form {position: absolute; top: 0; left: 0;opacity:0; filter:alpha(opacity=0);}
.estu form input {width: 100%; cursor: pointer;}
.es-quren {float: right; width: 160px; height: 30px; padding-right: 15px;}
.es-quren select{width: 92px; height: 26px; line-height: 26px; float: left;}
.es-quren button {width: 52px; height: 26px; line-height: 26px; background-color: #4badce; color: #fff; float: right; border: none;}
.eslb-top {width: 1070px; height: 32px; margin: 20px auto 25px; overflow: hidden;}
.eslb-top ul {list-style: none;}
.eslb-top ul li{list-style: none; float: left; width: 113px; height: 29px; border: 1px solid #dedede; border-radius: 4px; margin-left: 15px; text-align: center; line-height: 29px;cursor: pointer;}
.eslbcur {color: #fff; background-color: #4aa8c9; border: 1px solid #0078a1;}
.eslao {overflow: hidden; width: 1130px; margin: 15px auto; height: 136px; position: relative; }
.toux-l {float: left; width: 76px;}
.toux-r {float: left; width: 1000px; height: 128px; border: 1px solid #dedede; margin-top: 3px; margin-left: 45px; box-shadow: 0px 0px 10px #ccc; padding: 15px; box-sizing: border-box; position: relative;}
.toux-r h3 {font-size: 14px; height: 30px; line-height: 30px; color: #4bacce;}
.toux-r .esneir {height: 42px; width: 900px; margin-bottom: 10px; line-height: 22px; overflow: hidden;}
.xsj {position: absolute; top: 16px; left: 108px;}
.esrname {position: absolute; right: 20px; top: 12px; font-weight: bold;}
.esrname p {color: #ce4b4b;}
.modal11 {width: 1240px; height: 340px; margin-left: -620px; margin-top: -145px;}
.modal-header {padding: 0; border-bottom: none;}
.modal22 {width: 1240px; height: 170px; margin-left: -620px; margin-top: -85px;}
.modal33 {width: 1240px; height: 140px; margin-left: -620px; margin-top: -70px;}
.modal44 {width: 1240px; height: 320px; margin-left: -620px; margin-top: -70px;}
.es-fytable input {width: 100%; height: 100%; display:inline-block; outline: none; border: none;margin:0;padding:0;}
.esnava {
  position: fixed; top:0;left: 50%; margin-left: -585px; z-index: 99; display: none;
}
.es-fytable ul li.lengthbox {height: 41px;}
.es-fytable ul li.lengthbox div {height: 41px; line-height: 41px;}
</style>
	<div class="es-nva">
      <div class="es-portrait">
        <img src="/static/images/avatar.jpeg" alt="" width="73" height="73px">
      </div>
      <div class="es-nva-left">
        <div class="es-portrait-name">
          <p>
            <span class="gsname">{{customer.company[:16]}}</span> <span class="xindm">{%if customer.company_reguid%}{{customer.company_reguid}}{%end%}</span> <span class="es-name">{{customer.reg_person}}</span>
          </p>
          <div class="xxnr">
            <div class="xxnr-left">
              <b>注册资金：<em>{%if customer.reg_money%}{{customer.reg_money}}{%else%}-{%end%}</em></b>
              <b>纳税类型：<em>{%if customer.is_general%}一般纳税人{%else%}小规模{%end%}</em> </b>
              <b style="width:500px;">合同约定：<em>{{customer.paytype_id_name}} 总费:{{int(customer.service_amount)}} 月费:{{int(customer.service_amount_month)}} 账册费:{{int(customer.book_amount)}}</em></b>
              <b style="width:500px;">其他约定：<em>{%if customer.other_appoint%}{{customer.other_appoint}}{%end%}</em></b>              
            </div>
            <div class="xxnr-right">
              <b>执照成立日期：<em>{%if customer.reg_date%}{{customer.reg_date.strftime("%Y-%m-%d")}}{%end%}</em></b>
              <b>地址类型：<em>{%if customer.addr_type%}{{customer.addr_type}}{%end%}</em></b>
              <b>账费到期：<em>{%if t_customer_payment%}{%if t_customer_payment.acc_end%}{{t_customer_payment.acc_end.strftime('%Y-%m-%d')}}{%end%}{%end%}</em></b>
            </div>
          </div>
        </div>
      </div>
      <div class="es-nva-right">
        <b>标签：
          {%if not old_tag%}
            {%if customer.tag_parent_id_name!=customer.tag_id_name%}
            <a href="#">{{customer.tag_parent_id_name}}</a> 
           {%end%}
            {%if customer.tag_id_name%}
           <a href="#">{{customer.tag_id_name}}</a> 
           {%end%}
           {%if customer.tag_id_name2%}
           <a href="#">{{customer.tag_id_name2}}</a> 
           {%end%}
             {%if customer.is_building%}
           <a href="#">楼盘</a> 
           {%end%}
             {%if customer.is_year%}
           <a href="#">工商年检</a> 
           {%end%}
             {%if customer.is_clearly%}
           <a href="#">汇算清缴</a> 
           {%end%}
        
           {%else%}
          {%if customer.customer_type_name%} {%for item in customer.customer_type_name.split(",")%}{%if item!=''%}<a href="#">{{item}}</a>{%end%}{%end%} {%end%}
          {%end%}
          <a  href="javascript:void(0);" class="customer_modify4" style="background-color:white"><img alt="[编辑]" width="25" src="/static/images/modify.png"></a>
        </b>
        <b>电话：<em>{%if t_linkman%}{{t_linkman[0].name}}-{{t_linkman[0].tel}}{%end%}</em></b>
        <b>注册地址：<em>{%if customer.city and customer.city!='0'%}{{customer.city}}{%end%}{%if customer.zone and customer.zone!='0'%}{{customer.zone}}{%end%}{%if customer.reg_addr%}{{customer.reg_addr}}{%end%}</em></b>
      </div>
  </div>
  <div class="es-nva esnava">
      <div class="es-portrait">
        <img src="/static/images/avatar.jpeg" alt="" width="73" height="73px">
      </div>
      <div class="es-nva-left">
        <div class="es-portrait-name">
          <p>
            <span class="gsname">{{customer.company[:16]}}</span> <span class="xindm">{%if customer.company_reguid%}{{customer.company_reguid}}{%end%}</span> <span class="es-name">{{customer.reg_person}}</span>
          </p>
          <div class="xxnr">
            <div class="xxnr-left">
              <b>注册资金：<em>{%if customer.reg_money%}{{customer.reg_money}}{%else%}-{%end%}</em></b>
              <b>纳税类型：<em>{%if customer.is_general%}一般纳税人{%else%}小规模{%end%}</em> </b>
              <b style="width:500px;">合同约定：<em>{{customer.paytype_id_name}} 总费:{{int(customer.service_amount)}} 月费:{{int(customer.service_amount_month)}} 账册费:{{int(customer.book_amount)}}</em></b>
              <b style="width:500px;">其他约定：<em>{%if customer.other_appoint%}{{customer.other_appoint}}{%end%}</em></b>                          
            </div>
            <div class="xxnr-right">
              <b>执照成立日期：<em>{%if customer.reg_date%}{{customer.reg_date.strftime("%Y-%m-%d")}}{%end%}</em></b>
              <b>地址类型：<em>{%if customer.addr_type%}{{customer.addr_type}}{%end%}</em></b>
              <b>账费到期：<em>{%if t_customer_payment%}{%if t_customer_payment.acc_end%}{{t_customer_payment.acc_end.strftime('%Y-%m-%d')}}{%end%}{%end%}</em></b>
            </div>
          </div>
        </div>
      </div>
      <div class="es-nva-right">
        <b>标签：
          {%if not old_tag%}
            {%if customer.tag_parent_id_name!=customer.tag_id_name%}
            <a href="#">{{customer.tag_parent_id_name}}</a> 
           {%end%}
            {%if customer.tag_id_name%}
           <a href="#">{{customer.tag_id_name}}</a> 
           {%end%}
           {%if customer.tag_id_name2%}
           <a href="#">{{customer.tag_id_name2}}</a> 
           {%end%}
             {%if customer.is_building%}
           <a href="#">楼盘</a> 
           {%end%}
             {%if customer.is_year%}
           <a href="#">工商年检</a> 
           {%end%}
             {%if customer.is_clearly%}
           <a href="#">汇算清缴</a> 
           {%end%}
        
           {%else%}
          {%if customer.customer_type_name%} {%for item in customer.customer_type_name.split(",")%}{%if item!=''%}<a href="#">{{item}}</a>{%end%}{%end%} {%end%}
          {%end%}
          <a  href="javascript:void(0);" class="customer_modify4" style="background-color:white"><img alt="[编辑]" width="25" src="/static/images/modify.png"></a>
        </b>
        <b>电话：<em>{%if t_linkman%}{{t_linkman[0].name}}-{{t_linkman[0].tel}}{%end%}</em></b>
        <b>注册地址：<em>{%if customer.city and customer.city!='0'%}{{customer.city}}{%end%}{%if customer.zone and customer.zone!='0'%}{{customer.zone}}{%end%}{%if customer.reg_addr%}{{customer.reg_addr}}{%end%}</em></b>
      </div>
  </div>
<div class="main">
<div class="main-inner">
<div class="container">
<div class="row">
<div class="span12">
<div class="widget">

<div class="widget-content">
		<div class="tabbable">
						<ul class="nav nav-tabs" id="myTab">
						  <li>
						    <a href="#customer_tab" id="a_customer_tab" data-toggle="tab">基础信息</a>
              </li>
              <li>
						    <a href="#payment_tab" id="a_payment_tab" data-toggle="tab">动态跟进</a>
						  </li>
              <li ><a href="#finance_tab" id="a_finance_tab" data-toggle="tab">财务信息</a></li>
              <!-- <li><a href="#exchange_tab" id="a_exchange_tab" data-toggle="tab">联系记录</a></li> -->
                <!-- <li><a href="/payment?tag=customer&customer_id={{customer.customer_id}}{%if old_tag%}&old_tag={{old_tag}}{%end%}&to_tag=payment_tab" id="a_payment_tab" >应收记录</a></li> -->
                <li><a href="#payment_record_tab" id="a_payment_record_tab" data-toggle="tab">应收记录</a></li>
                <li><a href="#file_tab" id="a_file_tab" data-toggle="tab" >相关附件</a></li>            
                <li ><a href="#etax" id="a_etax" data-toggle="tab">报税信息</a></li>
              </ul>


<div class="tab-content">
    <!-- <div class="tab-pane " id="exchange_tab">

        <div class="widget widget-table action-table">
                    <div class="widget-content">
                      <div style="width:80%; margin:10px 10px 10px 10%">
                        <textarea class="form-control" id="txt_msg" style="width:100%">
                          </textarea>

                          <button id="btn_save_msg">确定添加</button>&nbsp;&nbsp;&nbsp;
                          <input type="file" value="上传附件" style=margin-top:10px;" name="record_file" id="record_file" class="form-control"/>
                      
                          <hr class="my-0">
                       
                          {%for item in t_customer_exchange%}
                          <div class="message-item" id="msg_{{item.id}}">
                              <div class="message-inner">
                                  <div class="message-head clearfix">
                                      <div class="avatar pull-left">
                                          <img src="/static/images/avatar.jpeg">
                                      </div>
                                      <div class="user-detail">
                                          <h5 class="handle">{{item.uid_name}}
                                              <span style="font-size:13px;"> {{item.created_at}}
                                              </span>
                                              {%if item.file_path%}
                                              <a href="{{item.file_path}}" target="_blank"> 查看附件</a>
                                              {%end%}
                                          </h5>
                                      </div>
                                  </div>
                                  {{item.msg}}
                              </div>
                          </div>
                          {%end%}
                        </div>
                    </div>
                 



                  </div>
        </div> -->
<div class="tab-pane " id="finance_tab">


<div class="widget widget-table action-table">
  <div class="widget-header"> <i class="icon-th-list"></i>
    <h3>办理业务记录 </h3>
    {%if role=="3" or role=="8"%}
    <a id="merege_cw" href="javascript:void(0);" class="btn btn-info btn-sm">转移</a>
    {%end%}
  </div>




  <div class="widget-content">
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th width="10"></th>
          <th width="50">确认单编号</th> <th width="150">公司名称</th>
          <th>业务内容</th>
          <th width="80">客户名称</th>
          <th width="40">联系方式</th>
          <th width="40">总服务费</th>
          <th width="40">已收款</th>
          <th width="40">欠款</th>
        </tr>
      </thead>
      <tbody>

        {%if t_projects_query%}

        {%for item in t_projects_query%}
        {%if not item.sim%}
        {%set item.sim=0%}
        {%end%}
        {%if  not item.dd %}
        {%set item.dd=0%}
        {%end%}
        {%if not item.income_money3%}
        {%set item.income_money3=0%}
        {%end%}
        <tr>
          <td><input type="checkbox" name="merege_project" value="{{item.id}}"></td>
          <td>{{item.id}}</td>   <td>{{item.customer_company}}</td>
          <td><a href="/project?tag=show&guid={{item.guid}}&id={{item.id}}#daokuanjiesuan" target="_blank"
              style=" font-size:14px;">{{item.project_name}}</a>
            <br />
            <b style="color:#777; font-size:12px;">{{item.team_view}}</b>
          </td>
              
          <td>{{item.customer_name}}</td>

          <td>{{item.customer_tel}}</td>
          <td>{{item.all_income}}</td>
          <td>{{item.dd}}</td>
          <td {%if item.all_income-item.dd+item.sim-item.income_money3 > 0 %} style="background-color:red;" {%else%}
            style="background-color:green;" {%end%}>

            {{item.all_income -item.dd+item.sim-item.income_money3}}


          </td>

        </tr>





        {%end%}




        {%else%}
        <tr>
          <td colspan="7">还没有合同哦。</td>

        </tr>
        {%end%}

      </tbody>
    </table>
  </div>
  <!-- /widget-content -->



</div>
<div class="widget widget-table action-table">
  <div class="widget-header">
    <i class="icon-th-list"></i>
    <h3>到款信息
    </h3>
  </div>
  <!-- /widget-header -->
  <div class="widget-content">



    <table class="table table-striped table-bordered">
      <thead>
        <tr>
         <th style="width:50px;">确认单编号</th>
       <th width="150">公司名称</th>
          <th >业务内容</th>
          <th style="width:150px;">到款日期</th>
          <th style="width:50px;"> 到款人</th>
            <th >到款内容</th>
            <th style="width:60px;">收入公司</th>
            <th style="width:60px;">支付方式</th>
            <th style="width:100px;">合计</th>

        </tr>
      </thead>
      <tbody>
      {%if t_project_income_title%} {%for item in t_project_income_title%}
        <tr>
           <td> {{item.project_id}}</td><td> {{item.customer_company}}
          </td>
             <td>
             <a href="/project?tag=show&guid={{item.project_guid}}&id={{item.project_id}}#daokuanjiesuan"  target="_blank"
              style=" font-size:14px;">{{item.project_name}}</a>
          </td> 
          <td> {{item.income_at}}
          </td>
          <td> {{item.uid_name}}
          </td>
          <td>{{item.income_title}} </td>


          <td> {{item.company_id_name}}</td>
          <td>{{item.pay_type_name}}</td>
          <td>{{item.income_money_total}}</td>
        </tr>
        {%end%} {%else%}
        <tr>
          <td colspan="7">还没有哦。</td>

        </tr>
 {%end%}
      </tbody>
    </table>
  </div>
  <!-- /widget-content -->




</div>

<div class="widget widget-table action-table">
  <div class="widget-header"> <i class="icon-th-list"></i>
    <h3>历史挂靠地址纪录(经发业)</h3>
  </div>




  <div class="widget-content">
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th width='100'>企业名称</th>
          <th width="100">承租人</th>
            <th width="90">地址性质</th>
          <th width="70">开票与续期</th>

          <th width="200">挂靠地址</th>

          <th width="70">安排时间</th>
          <th width="70">租赁开始</th>
          <th width="70">租赁结束</th>

          <th width="60">物业安排</th>
           <th width="45">跟单人</th>
           <th width="45">客服</th>
           <th width="45">销售</th>
           <th width="60">备注</th>
        </tr>
      </thead>
      <tbody>

        {%if t_customer_address%}

        {%for item in t_customer_address%}

        <tr>
         <td>{{item.company}}</td>
         <td>{%if item.cz_name%}{{item.cz_name}}{%end%}</td>
         <td>{%if item.address_nature%}{{item.address_nature}}{%end%}</td>
         <td>{%if item.kp_and_xf%}{{item.kp_and_xf}}{%end%}</td>
         <td>{%if item.gk_address%}{{item.gk_address}}{%end%}</td>
         <td>{%if item.arrange_at%}{{item.arrange_at.strftime('%Y-%m-%d')}}{%end%}</td>
         <td>{%if item.zp_start_at%}{{item.zp_start_at.strftime('%Y-%m-%d')}}{%end%}</td>
         <td>{%if item.zp_end_at %}{{item.zp_end_at.strftime('%Y-%m-%d')}}{%end%}</td>
         <td>{%if item.wy_arrange%}{{item.wy_arrange}}{%end%}</td>
         <td>{%if item.gendan_name%}{{item.gendan_name}}{%end%}</td>
         <td>{%if item.kf_guwen_name%}{{item.kf_guwen_name}}{%end%}</td>
         <td>{%if item.sale_guwen_name%}{{item.sale_guwen_name}}{%end%}</td>
         <td>{%if item.remark%}{{item.remark}}{%end%}</td>
        </tr>
        {%end%}




        {%else%}
        <tr>
          <td colspan="20">还没有合同哦。</td>

        </tr>
        {%end%}

      </tbody>
    </table>
  </div>
  <!-- /widget-content -->



</div>
<div class="widget widget-table action-table">
  <div class="widget-header"> <i class="icon-th-list"></i>
    <h3>历史办理业务记录 </h3>
  </div>




  <div class="widget-content">
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th width=='20'></th>
          <th width="80">办理时间</th>
            <th>公司</th>
          <th>业务内容</th>
          <th width="80">销售</th>
          <th width="80">电商</th>
          <th width="80">跟单</th>
          <th width="80">收入汇总</th>
          <th width="70">收入分类</th>
           <th width="240">收款备注</th>

        </tr>
      </thead>
      <tbody>

        {%if t_customer_his_income%}

        {%for item in t_customer_his_income%}

        <tr>
          <td>
            <input type="checkbox" name="merege_his" value="{{item.id}}">
          </td>
          <td>{%if item.income_at%}{{item.income_at.strftime("%Y-%m-%d")}} {%end%}</td>
          <td>{{item.company}}
          <td>{{item.project_name}}

          </td>
          <td>{{item.sale}}</td>

          <td>{{item.dx}}</td>
          <td>{{item.gd}}</td>
          <td>{{item.income}}</td>
                  <td>{{item.income_type}}</td>
                  <td>{{item.income_remark}}</td>


        </tr>





        {%end%}




        {%else%}
        <tr>
          <td colspan="7">还没有合同哦。</td>

        </tr>
        {%end%}

      </tbody>
    </table>
  </div>
  <!-- /widget-content -->



</div>


</div>

<div class="tab-pane " id="customer_tab">
    <div class="widget-header">
        <i class="icon-th-list"></i>
        <h3>公司信息<a href="javascript:void(0);" id="customer_modify1"><img alt="[编辑]" width="25" src="/static/images/modify.png"></a></h3>
      </div>
    <div class="es-fytable">
        <ul>
          <li>
            <div class="length1">公司名称</div>
            <div class="length5">{%if customer.company%}{{customer.company}}{%end%} 
            {%if role=="3"%}
            {%if not visible_other and not visible_other_relation %}
          <a class="btn btn-primary btn-sm modify  " href="customer?tag=edit&id={{customer.customer_id}}&guid={{customer.guid}}"
            id="customer_modify" type="button" title="{{customer.customer_id}}">修改</a>
            {%end%}
          {%end%}
          &nbsp;<a  style="text-decoration:none;" href="javascript:void(0);" id='feedback'> 问题反馈</a>
          </div>
            <div class="length1">客服会计</div>
            <div class="length2"> {%if customer.acc_uid_name%}{{customer.acc_uid_name}}{%end%}</div>
          </li>
          <!-- <li>
            <div class="length1">优惠套餐</div>
            <div class="length3"></div>
          </li> -->
          <li>
            <div class="length1">客户编号</div>
            <div class="length2">{{customer.customer_id}}</div>
            <div class="length1">所属行业</div>
            <div class="length2">{%if customer.hangye%}{{customer.hangye}}{%end%}</div>
            <div class="length1">开户行</div>
            <div class="length2">{%if customer.reg_bank%}{{customer.reg_bank}}{%end%}</div>
          </li>
          <li>
            <div class="length1">工商分局</div>
            <div class="length2">{%if customer.saic%}{{customer.saic}}{%end%}</div>
            <div class="length1">地址类型</div>
            <div class="length2">{%if customer.addr_type%}{{customer.addr_type}}{%end%}</div>
            <div class="length1">银行账号</div>
            <div class="length2">{%if customer.reg_bank_account%}{{customer.reg_bank_account}}{%end%}</div>
          </li>
          <li>
            <div class="length1">国/地所属分局</div>
            <div class="length2">{%if customer.national_tax%}{{customer.national_tax}}/{%end%}</div>
            <div class="length1">专管员姓名</div>
            <div class="length2">{%if customer.zg_name%}{{customer.zg_name}}{%end%}</div>
            <div class="length1">专管员联系方式</div>
            <div class="length2">{%if customer.zg_tel%}{{customer.zg_tel}}{%end%}</div>
          </li>
          <li class="lengthbox">
            <div class="length1">经营范围</div>
            <div class="length3" title="{{customer.business_scope}}" 
            {%if customer.business_scope%}{%if len(customer.business_scope)>80%}style="line-height: 20px;"{%end%}{%end%}>
          {%if customer.business_scope%}
          {{customer.business_scope}}
          {%end%}</div>
          </li>
          <li class="lengthbox">
            <div class="length1">情况和注意事项</div>
            <div class="length3" title="{{customer.attention}}"
            {%if customer.attention%}{%if len(customer.attention)>80%}style="line-height: 20px;"{%end%}{%end%}
            >
              {%if customer.attention%}{{customer.attention}}{%end%}</div>
          </li>
          <li class="lengthbox">
              <div class="length1">待调整事项</div>
              <div class="length3" title="{{customer.adjusted_option}}"
              {%if customer.adjusted_option%}{%if len(customer.adjusted_option)>80%}style="line-height: 20px;"{%end%}{%end%}
              >
                {%if customer.adjusted_option%}{{customer.adjusted_option}}{%end%}</div>
            </li>
          <li class="lengthbox">
            <div class="length1">主管意见</div>
            <div class="length3" title="{{customer.zg_option}}"
            {%if customer.zg_option%}{%if len(customer.zg_option)>80%}style="line-height: 20px;"{%end%}{%end%}
            >{%if customer.zg_option%}{{customer.zg_option}}{%end%}</div>
          </li>
          <li class="lengthbox">
              <div class="length1">会计标记</div>
              <div class="length3"
              >{%if customer.kj_label_names%}{{customer.kj_label_names}}{%end%}</div>
            </li>
          
        </ul>
      </div>

<br/>
<div class="widget widget-table action-table">
    <div class="widget-header">
      <i class="icon-th-list"></i>
      <h3>税务信息<a id="customer_modify2"  href="javascript:void(0);"><img alt="[编辑]" width="25" src="/static/images/modify.png"></a></h3>
    </div>
    
    <div class="es-fytable">
      <ul style="border-top:none;">
        <li>
          <div class="length1">纳税类型</div>
          <div class="length4">{%if customer.is_general%}一般纳税人{%else%}小规模{%end%}</div>
          <div class="length1">税务概况</div>
          <div class="length6">{%if customer.survey%}{{customer.survey}}{%end%}</div>
        </li>
        <li>
          <div class="length1">有无税种</div>
          <div class="length4"> {%if customer.is_check%}是    ({%if customer.btype_id%}<font color='blue'>核定</font> {%else%}<font color='red'>查账</font> {%end%}){%else%}否 {%end%} 
          </div>
          <div class="length1">税种明细</div>
          <div class="length6">{%if customer.shuizhong_detail%}{{customer.shuizhong_detail}}{%end%}</div>
        </li>
        <li>
          <div class="length1">征收方式</div>
          <div class="length4">{%if customer.zhengshou_way%}{{customer.zhengshou_way}}{%end%}</div>
          <div class="length1">税控盘类别</div>
          <div class="length4">{%if customer.shuikong_type%}{{customer.shuikong_type}}{%end%}</div>
          <div class="length1">参保人数</div>
          <div class="length4">{%if customer.ss_num%}{{customer.ss_num}}{%else%}0{%end%}</div>
          <div class="length1">固定资产</div>
          <div class="length4">{%if customer.fixed_assets%}{{customer.fixed_assets}}{%end%}</div>
        </li>
      </ul>
    </div>
    
  </div>
  {%if role=='8' or customer.acc_uid==int(uid) or kj_manage=='1' or t_user_relation_manage or '330' in role_list%}
  <div class="widget widget-table action-table">
    <div class="widget-header">
      <i class="icon-th-list"></i>
      <h3>账号密码管理<a id="customer_modify3"  href="javascript:void(0);"><img alt="[编辑]" width="25" src="/static/images/modify.png"></a>
      
      {%if customer.rel_name_collect_account and customer.rel_name_collect_password%}{%if user64%}
      <a href="https://www.etax-gd.gov.cn/xxmh/html/index_login.html?tt={{user64}}" class="btn btn-primary " target="_blank">登录广东省电子税务局</a>

      {%end%}

      {%else%}
      还没设置密码哦.

      {%end%}


      <a href="/static/chrome/chrome_faye.crx" target="_blank">辅助插件</a>
      </h3>
    </div>
    
    <div class="es-fytable">
      <ul style="border-top:none;">
        <li>
          <div class="length1">法人身份证号</div>
          <div class="length4">{%if customer.legal_id_card%}{{customer.legal_id_card}}{%end%}</div>
          <div class="length1">实名采集账号</div>
          <div class="length4">{%if customer.rel_name_collect_account%}{{customer.rel_name_collect_account}}{%end%}</div>
          <div class="length1">实名采集密码</div>
          <div class="length4">{%if customer.rel_name_collect_password%}{{customer.rel_name_collect_password}}{%end%}</div>
          <div class="length1">税控盘密码</div>
          <div class="length4">{%if customer.shuipan_password%}{{customer.shuipan_password}}{%end%}</div>
        </li>
  
        <li>
          <div class="length1">税控盘口令</div>
          <div class="length4">{%if customer.shuipan_command%}{{customer.shuipan_command}}{%end%}</div>
          <div class="length1">个税申报密码</div>
          <div class="length4">{%if customer.per_income_apply_password%}{{customer.per_income_apply_password}}{%end%}</div>
          <div class="length1">回单卡密码</div>
          <div class="length4">{%if customer.receipt_card_password%}{{customer.receipt_card_password}}{%end%}</div>
          <div class="length1">公积金证书密码</div>
          <div class="length4">{%if customer.accumulation_fund_password%}{{customer.accumulation_fund_password}}{%end%}</div>
        </li>
      </ul>
    </div>
  </div>
  {%end%}
  <!-- 相关联系人 -->
  <div class="widget widget-table action-table">
    <div class="widget-header"> <i class="icon-th-list"></i>
      <h3>相关联系人
          {%if not from_tag%}<a class="btn btn-info btn-sm" type="button" title="{{customer.customer_id}}" id="a_add_linkman">增加</a> {%end%}
      </h3>
    </div>
    <div class="widget-content">
      <table class="table table-striped table-bordered">
        <thead>
          <tr>
            <th style="width:80px;">名字/称呼</th>
            <th style="width:120px;">电话</th>
            <th>备注</th>
            <th style="width:60px;">创建人</th>
            <th style="width:100px;">创建时间</th>
            {%if not from_tag%} <th  width="40"></th>{%end%}
          </tr>
        </thead>
        <tbody>
            {%if t_linkman%}
            {%for item in t_linkman%}
                <tr>
                            <td>{{item.name}}
                            </td>
                            <!-- <td> {%if item.gender==1%}男{%else%}女{%end%}
                            </td> -->
                            <td >{{item.tel}} </td>


                            <td>{{item.remark}}</td>
                               <td>{{item.acc_uid_name}}</td>
                            <td>{{item.created_at.strftime("%Y-%m-%d")}}</td>


                {%if not from_tag%}    <td>
                                          <a href="javascript:void(0)"
                                           class="btn modify_linkman"
                                            tel="{{item.tel}}"
                                            remark="{{item.remark}}"
                                            title="{{item.name}}"
                                            gender="{{item.gender}}"
                                            linkman_guid="{{item.guid}}"
                                            is_first="{{item.is_first}}"
                                            linkman_id="{{item.id}}">改</a>

                      </td>{%end%}



            </tr>
                {%end%}
            {%else%}
            <tr>
            <td colspan="7">还没有哦。</td>

            </tr>
            {%end%}

            </tbody>
      </table>
    </div>
  </div>
  <!-- 快递 -->
  <div class="widget widget-table action-table">
    <div class="widget-header">
      <i class="icon-th-list"></i>
      <h3>快递
          <div class="dropdown">
              <a class="btn btn-info btn-sm" type="button" title="{{customer.customer_id}}" id="apply_express">增加</a>
              <div class="dropdown-content">
                <a href="javascript:void(0)"  id="btn_add_express" >新建寄件 </a>
                <a href="javascript:void(0)"  id="btn_add_express_rec" >新建收件 </a>
              </div>
            </div>
      </h3>
    </div>
  
    <div class="widget-content">
      <table class="table table-striped table-bordered">
        <thead>
          <tr>
            <th width="50">附件</th>
            <th width="100">申请时间</th>
            <th width="100">发件时间</th>
            <th style="width:100px;">快递单号</th>
            <th style="width:60px;">客户名称</th>
            <th style="width:200px;">资料明细</th>
            <th width="100">其他资料</th>
            <th width="100">寄件人/收件人</th>
            <th width="50">创建人</th>
            <th width="100">状态</th>
            <th width="50">类型</th>
            <th width="60"></th>
          </tr>
        </thead>
        <tbody>

            {%if t_express%} {%for item in t_express%}
            <tr>
                <td><a href="javascript:void(0);" class="filepath_detail" id="{{item.id}}"
                  file_path="{{item.file_path}}" uid_name="{{item.uid_name}}" send_at_name="{{item.send_at_name}}">附件</a></td>
                <td>{{item.created_at.strftime("%Y-%m-%d")}}</td>
                <td>{%if item.created_send_at %}{{item.created_send_at.strftime("%Y-%m-%d")}}{%end%}</td>
                <td>{%if item.express_number%}{{item.express_number}}{%end%}</td>
                <td>{{item.rec_name}}</td>
                <td>{{item.rec_file}}</td>
                <td>{{item.other_rec_file}}</td>
                <td>{%if item.send_or_rec==0 %}{{item.send_at_name}}/{{item.rec_name}}{%else%}{{item.rec_name}}/{{item.send_at_name}}{%end%}</td>
                <td>{{item.uid_name}}</td>
                <td>
                    {%if item.send_at%}
                    {{item.send_at.strftime("%Y-%m-%d")}} {{item.accept_uid_name}}确认发件
                    {%elif not item.accept_at%}待审核
                    {%elif item.accept_state==1%}
                    {{item.accept_at.strftime("%Y-%m-%d")}} {{item.accept_uid_name}}审核通过
                    {%elif item.accept_state==2%}
                    {{item.accept_at.strftime("%Y-%m-%d")}} {{item.accept_uid_name}}审核不通过 备注:{{item.accept_uid_remark}}
                    {%end%}</td>
                    <td>{%if item.send_or_rec==1%}收件{%else%}寄件{%end%}</td>
                    <td>
                        {%if item.accept_state==1 and express_manage=='1' and not item.send_at %}
                        <a class="btn btn-info confirm_send_express" id="{{item.id}}" href="javascript:void(0);">确认发件</a>
                        {%elif not item.accept_at and express_manage=='1'%}
                        <a class="btn btn-info check_express" id="{{item.id}}" href="javascript:void(0);">审核</a>
                        {%else%}
                        <a class="btn btn-info edit_express" href="javascript:void(0);"
                        id="{{item.id}}" rec_name="{{item.rec_name}}" rec_tel="{{item.rec_tel}}" created_send_at="{%if item.created_send_at%}{{item.created_send_at.strftime("%Y-%m-%d")}}{%end%}"
                        rec_addr="{{item.rec_addr}}"  rec_file="{{item.rec_file}}" rec_company="{{item.rec_company}}"
                        express_type_id="{{item.express_type_id}}" created_at="{{item.created_at}}" other_rec_file="{{item.other_rec_file}}"
                        payment_type_id="{{item.payment_type_id}}" send_at_name="{{item.send_at_name}}" remark="{{item.remark}}" accept_at="{{item.accept_at}}"
                        rec_file_ids="{{item.rec_file_ids}}" express_number="{{item.express_number}}" uid_name="{{item.uid_name}}" send_or_rec="{{item.send_or_rec}}"
                      >查看</a>
                        {%end%}
                      </td>
            </tr>
            {%end%} {%else%}
            <tr>
              <td colspan="7">还没有曾用名哦。</td>
  
            </tr>
            {%end%}
  
          </tbody>
      </table>
    </div>
  </div>
  <!-- 资料交接 -->
  <div class="widget widget-table action-table">
      <div class="widget-header">
        <i class="icon-th-list"></i>
        <h3>资料交接
            {%if not from_tag%}
          <a class="btn btn-primary btn-sm" type="button" title="{{customer.customer_id}}" id="a_add_trans">增加</a>
          {%end%}
        </h3>
      </div>
      <!-- /widget-header -->
      <div class="widget-content">
        <table class="table table-striped table-bordered">
          <thead>
            <tr>
              <th width="80">交接时间
              </th>
    
              <th  width="60"> 移交方
              </th>
    
              <th width="60"> 签收方
              </th>
         <th > 备注
              </th>
           <th style="width:60px;"> 附件
              </th>
              <th style="width:60px;">创建人</th>
              <th style="width:80px;">创建时间</th>
              <th width="10"></th>
            </tr>
          </thead>
          <tbody>
            {%if t_transition%} {%for item in t_transition%}
            <tr>
              <td>{{item.tran_at.strftime("%Y-%m-%d")}}
    
    
              </td>
               <td> {{item.tran_by}}
              </td>
               <td> {{item.rec_by}}
              </td>
              <td> {{item.remark}}
              </td>
    
          <td>         {%if item.file_name%}
                    <a href="{{item.file_name}}" class="btn" target="_blank">查看</a>
              {%end%}</td>
    
              <td>{{item.uid_name}}</td>
    
              <td>{{item.created_at.strftime("%Y-%m-%d")}}</td>
    {%if not from_tag%}
              <td>
            <a href="javascript:void(0)" rec_by ="{{item.rec_by}}" class="btn modify_transition" transition_id="{{item.id}}"
                                               tran_at="{{item.tran_at}}"
                                               tran_by ="{{item.tran_by}}"
                                               remark="{{item.remark}}">改</a>
           <a href="javascript:void(0)" rec_by ="{{item.rec_by}}" class="btn modify_transition_mobile" transition_id="{{item.id}}"
                                               tran_at="{{item.tran_at}}"
                                               tran_by ="{{item.tran_by}}"
                                               remark="{{item.remark}}">手机上传</a>
              </td>
              {%end%}
            </tr>
            {%end%} {%else%}
            <tr>
              <td colspan="8">还没有哦。</td>
    
            </tr>
            {%end%}
    
          </tbody>
        </table>
      </div>
      <!-- /widget-content -->
    
    
    
    </div>
  <!-- 公司曾用名 -->
  <div class="widget widget-table action-table">
      <div class="widget-header">
        <i class="icon-th-list"></i>
        <h3>公司曾用名
            {%if not from_tag%}   <a class="btn btn-info btn-sm" type="button" title="{{customer.customer_id}}" id="a_add_company_name">增加</a>
            {%end%}
        </h3>
      </div>
      <!-- /widget-header -->
      <div class="widget-content">
        <table class="table table-striped table-bordered">
          <thead>
            <tr>
              <th >曾用名</th>
              <th style="width:280px;">备注</th>
              <th style="width:60px;">记录人</th>
              <th style="width:100px;">记录时间</th>
              {%if not from_tag%}<th width="40"></th>{%end%}
            </tr>
          </thead>
          <tbody>
    
            {%if t_company_name%} {%for item in t_company_name%}
            <tr>
              <td> {{item.name}}
              </td>
    
    
              <td>{{item.remark}}</td>
              <td>{{item.uid_name}}</td>
              <td>{{item.created_at.strftime("%Y-%m-%d")}}</td>
    
    
           {%if not from_tag%}   <td>
                <a href="javascript:void(0)" class="btn company_modify"
                company_name="{{item.name}}"
                  company_remark="{{item.remark}}" company_id="{{item.id}}">改</a>
    
              </td>{%end%}
    
    
    
            </tr>
            {%end%} {%else%}
            <tr>
              <td colspan="7">还没有曾用名哦。</td>
    
            </tr>
            {%end%}
    
          </tbody>
        </table>
      </div>
      <!-- /widget-content -->
    </div>
    
  <!-- 历史客服会计负责人 -->
  <div class="widget widget-table action-table">
      <div class="widget-header">
        <i class="icon-th-list"></i>
        <h3>历史客服会计负责人
        {%if not from_tag%}  <a class="btn btn-info btn-sm" type="button" title="{{customer.customer_id}}" id="a_add_acc">增加</a>{%end%}
        </h3>
      </div>
      <!-- /widget-header -->
      <div class="widget-content">
        <table class="table table-striped table-bordered">
          <thead>
            <tr>
              <th >姓名</th>
              <th style="width:280px;">备注</th>
              <th style="width:60px;">记录人</th>
              <th style="width:100px;">记录时间</th>
             {%if not from_tag%} <th width="40"></th> {%end%}
            </tr>
          </thead>
          <tbody>
    
            {%if t_acc%} {%for item in t_acc%}
            <tr>
              <td> {{item.name}}
              </td>
    
    
              <td>{{item.remark}}</td>
              <td>{{item.uid_name}}</td>
              <td>{{item.created_at.strftime("%Y-%m-%d")}}</td>
    
    {%if not from_tag%}
              <td>
                <a href="javascript:void(0)" class="btn acc_modify"
                acc_name="{{item.name}}"
                  acc_remark="{{item.remark}}" acc_id="{{item.id}}">改</a>
    
              </td>
              {%end%}
    
    
    
            </tr>
            {%end%} {%else%}
            <tr>
              <td colspan="7">还没有数据哦。</td>
    
            </tr>
            {%end%}
    
          </tbody>
        </table>
      </div>
      <!-- /widget-content -->
    </div>
  <!-- 业务到期管理 -->
  <div class="widget widget-table action-table">
      <div class="widget-header"> <i class="icon-th-list"></i>
        <h3>业务到期管理     {%if not from_tag%}<a class="btn btn-info btn-sm "  id="a_add_contract"


        type="button" title="{{customer.customer_id}}" data-toggle="modal"
          >增加</a>{%end%}</h3>
      </div>
      <!-- /widget-header -->
      <div class="widget-content">
        <table class="table table-striped table-bordered">
          <thead>
          <tr>
                  <th>合同内容
</th>

                  <th style="width:120px;">合同开始时间
</th>
                  <th style="width:120px;">合同结束时间</th>


                  <th>最后更新时间</th>
                  <th>创建人</th>
                  <th>当前状态</th>
<th>合同期限状态</th>
{%if not from_tag%}<th style="width:50px;"></th>{%end%}


          </tr>
          </thead>
          <tbody>
          {%if t_contract%}
          {%for item in t_contract%}
              <tr>
                          <td>{{item.title}}
                          </td>
                          <td style="width:100px;">{%if item.start_time%}{{item.start_time.strftime("%Y-%m-%d")}}{%end%}
                          </td>
                          <td style="width:100px;" >{%if item.end_time%}{{item.end_time.strftime("%Y-%m-%d")}}{%end%}
                          </td>


                          <td style="width:100px;">{{item.updated_at.strftime("%Y-%m-%d")}}</td>
                             <td style="width:60px;">



                             {%if item.uid_name%}
      {{item.uid_name}}
      {%else%}系统导入
                             {%end%}
                             </td>
                          <td style="width:60px;">

                          {%if item.state_id==1%}
                          <font color='green'>正常</font>
                          {%end%}

                              {%if item.state_id==0%}
                                <font color='red'>关闭</font>
                             {%end%}
                          </td>
                              <td style="width:140px;">
                               {%if item.state_id==0%}
                                {%if  item.expire_day >= 0 %}

                                   <span style='color:blue'>还有 {{item.expire_day}} 天就到期了。</span>

                                {%else%}
                                    {%if item.expire_day%} <span style='color:red'>已经过期{{abs(item.expire_day)}} 天</span>
{%else%}
合同日期异常/无合同
                                    {%end %}
                                {%end %}


{%else%}
该合同已经结束或新签
{%end %}

                              </td>
                          {%if not from_tag%}    <td>
                                    <a href="javascript:void(0)"
                                     start_time="{%if item.start_time%}{{item.start_time.strftime("%Y-%m-%d")}}{%end%}"
                                     end_time ="{%if item.end_time%}{{item.end_time.strftime("%Y-%m-%d")}}{%end%}"
                                     title="{{item.title}}"
                                     state_id="{{item.state_id}}"
                                     contract_remark = "{{item.contract_remark}}"
                                     class="btn modify_contract" contract_id="{{item.id}}">改</a>

                              </td>{%end%}

          </tr>
          {%end%}
               {%else%}
              <tr>
                <td colspan="7">还没有哦。</td>

              </tr>
              {%end%}
          </tbody>
        </table>
      </div>
      <!-- /widget-content -->




</div>
  <!-- 公司附件 -->
  <div class="widget widget-table action-table">
      <div class="widget-header">
        <i class="icon-th-list"></i>
        <h3>公司附件
           {%if not from_tag%}  <a class="btn btn-info btn-sm" type="button" title="{{customer.customer_id}}" id="a_add_file">增加</a> {%end%}
        </h3>
      </div>
      <!-- /widget-header -->
      <div class="widget-content">
        <table class="table table-striped table-bordered">
          <thead>
            <tr>
              <th >文件内容
              </th>
    
              <th > 文件备注</th>
    
              <th style="width:80px;">创建人</th>
              <th style="width:80px;">创建时间</th>
              {%if not from_tag%}<th width="10"></th>{%end%}
            </tr>
          </thead>
          <tbody>
            {%if t_file%} {%for item in t_file%}
            <tr>
              <td>{{item.title}}
    
              {%if item.file_name%}
                    <a href="{{item.file_name}}" class="btn" target="_blank">下载</a>
              {%end%}
              </td>
              <td> {{item.file_remark}}
              </td>
    
    
    
              <td>{{item.uid_name}}</td>
    
              <td>{{item.created_at.strftime("%Y-%m-%d")}}</td>
    {%if not from_tag%}
              <td>
                {%if '249' in role_list %}
                <a href="javascript:;" class="btn btn-danger btn-small delete_file" title="{{item.id}}" guid="{{item.guid}}">
                  <i class="btn-icon-only icon-remove"></i>
                  </i>
                </a>
                {%end%}
              </td>
              {%end%}
            </tr>
            {%end%} {%else%}
            <tr>
              <td colspan="7">还没有哦。</td>
    
            </tr>
            {%end%}
    
          </tbody>
        </table>
      </div>
      <!-- /widget-content -->
    
    
    
    
    
    </div>
  
    {%if name==u"吴蔚亮" or name==u"陈太智" or name==u"庄华影"  %}

    <a class="btn btn-dangger btn-sm" type="button" title="{{customer.customer_id}}" id="delete_customer_btn">删除</a>
      <a href="javascript:void(0);" class="btn btn-info btn-primary" id="merge_customer" >合并客户</a>

  
    {%end%}

  </div>

<div class="tab-pane" id="payment_tab">
  <div class="card mb-3">
    <div class="es-progress">
    
        {%if t_customer_genjin_state%}
        {%for idx,item in enumerate(t_customer_genjin_state)%}
     
        <div class="esdt-box{%if idx==0%}1{%elif idx==t_customer_genjin_state.index(t_customer_genjin_state[-1])%}3{%else%}2{%end%}
         {%if customer.gc%}
        {%for row in customer.gc.split(',')%}
        {%if row.split('|')[0]==str(item.id)%}
         esdtcur{%if idx==0%}1{%elif idx==t_customer_genjin_state.index(t_customer_genjin_state[-1])%}3{%else%}2{%end%}
         {%end%}{%end%}{%end%}" state_id="{{item.id}}">
      
        <h3>{{item.state_name}}</h3>
        <span class="estime"  {%if idx==t_customer_genjin_state.index(t_customer_genjin_state[-1]) %}style="margin-left:20px;"{%end%}>
            {%if customer.gc%}
            {%if idx>=len(customer.gc.split(','))%}
            {%if idx==t_customer_genjin_state.index(t_customer_genjin_state[-1]) %}
            已办结{%else%}未完成{%end%}
            {%else%}
            {%for idx1,row in enumerate(customer.gc.split(','))%}
            {%if row.split('|')[0]==str(item.id)%}
            {{row.split('|')[1]}}
            {%end%}
            {%end%}
          {%end%}
          {%elif idx==t_customer_genjin_state.index(t_customer_genjin_state[-1]) %}已办结{%else%}未完成{%end%}
          
        </span>
     
     </div>
      {%end%}
     
      {%end%}
    </div>
    <div style="overflow: hidden;">
        <textarea class="eswenben" name="" id="dongtai_msg">

        </textarea>
    
      <div>
          <!-- <div class="col-md-12">

              <div id="dropzone_upload" class="dropzone" >

              </div>

              <div>
                  

              </div>
          </div> -->


        <div class="estu" id="upload_file" style="cursor: pointer;">
          <div class="estu-f">
            <img src="static/images/img/photo_03.jpg" alt="" width="20" height="14"></div>
          <p class="estu-r">上传文件 </p>
   
        </div>




        <div class="estu">
            <div class="estu-f" id="uploaderFiles1">
              
              </div>
        </div>
        <div class="es-quren">
          <select name="" id="genjin_type">
            <option value="">选择类别</option>
            <option value="1">日常跟进</option>
            <option value="2">定期总结登记</option>
            <option value="7">风险登记</option>
            {%if customer.acc_uid!=int(uid)%}
            <option value="5">催款登记</option>
            {%else%}
            <option value="6">会计建议</option>
            {%end%}
            <option value="4">其他登记</option>

          </select>
          <button class="submit_msg" id="btn_submit_msg">保存</button>
        </div>
      </div>
    </div>
    <div>
     
         
        <div class="tabbable">
            <div class="eslb-top">
            <ul>
                <li class="eslbcur" href="#all_msg" id="a_all_msg" data-toggle="tab">全部动态</li>
                <li href="#genjin_msg" id="a_genjin_msg" data-toggle="tab">日常跟进</li>
                <li href="#dingqi_msg" id="a_dingqi_msg" data-toggle="tab">定期总结登记</li>
                <li href="#fengxian_msg" id="a_fengxian_msg" data-toggle="tab">风险登记</li>
                <li href="#cuikuan_msg" id="a_cuikuan_msg" data-toggle="tab">催款登记</li>
                <li href="#other_msg" id="a_other_msg" data-toggle="tab">其他登记</li>
                <li href="#kj_msg" id="a_kj_msg" data-toggle="tab">会计建议</li>
                <li href="#c_msg" id="a_c_msg" data-toggle="tab">操作记录</li>
            </ul>
            </div>
            <div class="tab-content">
              <div class="tab-pane " id="all_msg">
                {%if t_customer_genjin_msg%}
                {%for item in  t_customer_genjin_msg%}
              <ul class="messages_layout" style="width:100%;overflow: hidden;
              box-sizing: border-box;">
                  <li class="from_user left" style="width: 100%;overflow: hidden;box-sizing: border-box;"> <a href="#" class="avatar"><img src="static/images/img/message_avatar1.png"></a>
                        <div class="message_wrap" style="width: 100%;
                        box-sizing: border-box;"> <span class="arrow"></span>
                          <div class="info"> <a class="name">{{item.uid_name}}</a> <span class="time">{{item.created_at}}</span>
                            <div class="options_arrow">
                                {%if (dt_today==str(item.created_at.strftime("%Y-%m-%d")) or item.file_path) and not item.etype %}
                                <div  class="dropdown pull-right"> <a class="dropdown-toggle " id="dLabel" role="button" data-toggle="dropdown" data-target="#" href="https://www.egrappler.com/bootstrap-responsive-admin-template/index.html#"> <i class=" icon-caret-down"></i> 操作</a>
 
                                  <ul  class="dropdown-menu " role="menu" aria-labelledby="dLabel">
                                        {%if dt_today==str(item.created_at.strftime("%Y-%m-%d"))%}
                                        <li>
                                        <a href="javascript:void(0)" genjin_type="{{item.genjin_type}}" msg="{{item.msg}}"  customer_id ="{{item.customer_id}}"  class="btn btn-mini gj_msg" msg_id="{{item.id}}" ><i class=" icon-share-alt icon-large"></i>修改</a></li>
                                        <li><a href="javascript:void(0)" genjin_type="{{item.genjin_type}}" msg="{{item.msg}}"  customer_id ="{{item.customer_id}}"  class="btn btn-mini btn-danger gj_msg_delete" msg_id="{{item.id}}" ><i class=" icon-share-alt icon-large"></i>删除</a></li>{%end%}
                                       
                                   
                                  </ul>
                            
                                </div>
                                {%end%}
                             </div>
                          </div>
                         
                          <pre style="min-height:100px;background-color:white;border:0;font-family:'微软雅黑';" title="{{item.msg}}"  class="esneir"  id="p_msg_{{item.id}}">{{item.msg}}</pre>
                          <p class="esneir" style="min-height:100px; display:none;" id="p_msg_edit_{{item.id}}">
                             <textarea class="eswenben" name=""  style="min-height:100px;width:100%" id="genjin_msg_{{item.id}}">
                         {{item.msg}}
                                 </textarea>
                          
                          </p>
                          
                          {%if item.file_path%}{%for idx,row in enumerate(item.file_path.split('|'))%}{%if row%}
                          <a href="{{row}}" class="btn btn-mini" target="_blank"><i class=" icon-share icon-large"></i>附件{{idx+1}}</a>
                          {%if dt_today==str(item.created_at.strftime("%Y-%m-%d"))%}
                          <a href="javascript:;" class="alert-danger delete_msg_file" title='删除{{row.split('/')[-1].split('.')[0]}}' file_name="{{row.split('/')[-1].split('.')[0]}}" file_path="{{row}}" delete_msg_id="{{item.id}}">x</a>
                          {%end%}
                          {%end%}{%end%}{%end%}
                          {%if item.uid_name==name and not item.etype%}
                          <div class="es-quren" style="padding-right:0;width:60px;">
                            <button class="submit_files" msg_id="{{item.id}}" >上传</button>
                            </div>
                          <div class="estu" style="float:right;">
                            <div class="estu-f">
                              <img src="static/images/img/photo_03.jpg" alt="" width="20" height="14"></div>
                            <p class="estu-r">添加文件 </p>
                            <form>
                                      <input type="file" class="uploaderInput2" msg_id="{{item.id}}"  multiple  />
                                      
                                  </form>
                          </div>
                          <div class="estu" style="float:right;">
                              <div class="estu-f uploaderFiles2" msg_id="{{item.id}}">
                                
                                </div>
                          </div>

                        
                          {%end%}
                        </div>
                      </li>
                    </ul>
              
              {%end%}
              {%else%}
              还没有哦~
              {%end%}
              </div>
              <div class="tab-pane " id="genjin_msg">
                  {%if t_customer_genjin_msg1%}
                  {%for item in  t_customer_genjin_msg1%}
            
                <ul class="messages_layout" style="width:100%;overflow: hidden;box-sizing: border-box;">
                    <li class="from_user left" style="width: 100%;overflow: hidden;box-sizing: border-box;"> <a href="#" class="avatar"><img src="static/images/img/message_avatar1.png"></a>
                          <div class="message_wrap" style="width: 100%;
                          box-sizing: border-box;"> <span class="arrow"></span>
                            <div class="info"> <a class="name">{{item.uid_name}}</a> <span class="time">{{item.created_at}}</span>
                              <div class="options_arrow">
                                  {%if dt_today==str(item.created_at.strftime("%Y-%m-%d")) or item.file_path%}
                                  <div class="dropdown pull-right"> <a class="dropdown-toggle " id="dLabel" role="button" data-toggle="dropdown" data-target="#" href="https://www.egrappler.com/bootstrap-responsive-admin-template/index.html#"> <i class=" icon-caret-down"></i>操作</a>
                                    <ul class="dropdown-menu " role="menu" aria-labelledby="dLabel">
                                     
                                          {%if dt_today==str(item.created_at.strftime("%Y-%m-%d"))%}
                                          <li>
                                          <a href="javascript:void(0)" genjin_type="{{item.genjin_type}}" msg="{{item.msg}}"  customer_id ="{{item.customer_id}}"  class="btn btn-mini gj_msg" msg_id="{{item.id}}" ><i class=" icon-share-alt icon-large"></i>修改</a></li>
                                          <li><a href="javascript:void(0)" genjin_type="{{item.genjin_type}}" msg="{{item.msg}}"  customer_id ="{{item.customer_id}}"  class="btn btn-mini btn-danger gj_msg_delete" msg_id="{{item.id}}" ><i class=" icon-share-alt icon-large"></i>删除</a></li>{%end%}
                                          {%if item.file_path%}{%for idx,row in enumerate(item.file_path.split('|'))%}{%if row%}
                                          <li><a href="{{row}}" class="btn btn-mini" target="_blank"><i class=" icon-share icon-large"></i>附件{{idx+1}}</a></li>
                                          {%end%}{%end%}{%end%}
                                     
                                    </ul>
                                  </div>
                                  {%end%}
                               </div>
                            </div>
                            <p title="{{item.msg}}" style="min-height:100px;" class="esneir"  id="p_msg_{{item.id}}">{{item.msg}}</p>
  
                            <p class="esneir" style="min-height:100px; display:none;" id="p_msg_edit_{{item.id}}">
                               <textarea class="eswenben" name=""  style="min-height:100px;width:100%" id="genjin_msg_{{item.id}}">
                           {{item.msg}}
                                   </textarea>
                            
                            </p>
                             
                          </div>
                        </li>
                      </ul>
                {%end%}
                {%else%}
                还没有哦~
                {%end%}
                    </div>
              <div class="tab-pane " id="dingqi_msg">
                  {%if t_customer_genjin_msg2%}
                  {%for item in  t_customer_genjin_msg2%}
              <!-- <div class="eslao">
                  <div class="toux-l">
                    <img src="static/images/img/dta.png" alt="" width="76" height="76">
                  </div>
                  <div class="toux-r">
                    <h3>{{item.uid_name}}</h3>
                    <p class="esneir">{{item.msg}}</p>
                    <span>{{item.created_at}}</span>
                    <div class="esrname">
                      <p>{%if item.file_path%}<a href="{{item.file_path}}"  target="blank">查看附件</a>{%end%}</p>
                    </div>
                  </div>
                  <div class="xsj">
                    <img src="static/images/img/xsj_07.jpg" alt="" width="14" height="16">
                  </div>
                </div> -->
                <ul class="messages_layout" style="width:100%;overflow: hidden;box-sizing: border-box;">
                    <li class="from_user left" style="width: 100%;overflow: hidden;box-sizing: border-box;"> <a href="#" class="avatar"><img src="static/images/img/message_avatar1.png"></a>
                          <div class="message_wrap" style="width: 100%;
                          box-sizing: border-box;"> <span class="arrow"></span>
                            <div class="info"> <a class="name">{{item.uid_name}}</a> <span class="time">{{item.created_at}}</span>
                              <div class="options_arrow">
                                  {%if dt_today==str(item.created_at.strftime("%Y-%m-%d")) or item.file_path%}
                                  <div class="dropdown pull-right"> <a class="dropdown-toggle " id="dLabel" role="button" data-toggle="dropdown" data-target="#" href="https://www.egrappler.com/bootstrap-responsive-admin-template/index.html#"> <i class=" icon-caret-down"></i>操作</a>
                                    <ul class="dropdown-menu " role="menu" aria-labelledby="dLabel">
                                     
                                          {%if dt_today==str(item.created_at.strftime("%Y-%m-%d"))%}
                                          <li>
                                          <a href="javascript:void(0)" genjin_type="{{item.genjin_type}}" msg="{{item.msg}}"  customer_id ="{{item.customer_id}}"  class="btn btn-mini gj_msg" msg_id="{{item.id}}" ><i class=" icon-share-alt icon-large"></i>修改</a></li>
                                          <li><a href="javascript:void(0)" genjin_type="{{item.genjin_type}}" msg="{{item.msg}}"  customer_id ="{{item.customer_id}}"  class="btn btn-mini btn-danger gj_msg_delete" msg_id="{{item.id}}" ><i class=" icon-share-alt icon-large"></i>删除</a></li>{%end%}
                                          {%if item.file_path%}{%for idx,row in enumerate(item.file_path.split('|'))%}{%if row%}
                                          <li><a href="{{row}}" class="btn btn-mini" target="_blank"><i class=" icon-share icon-large"></i>附件{{idx+1}}</a></li>
                                          {%end%}{%end%}{%end%}
                                     
                                    </ul>
                                  </div>
                                  {%end%}
                               </div>
                            </div>
                            <p title="{{item.msg}}" style="min-height:100px;" class="esneir"  id="p_msg_{{item.id}}">{{item.msg}}</p>
  
                            <p class="esneir" style="min-height:100px; display:none;" id="p_msg_edit_{{item.id}}">
                               <textarea class="eswenben" name=""  style="min-height:100px;width:100%" id="genjin_msg_{{item.id}}">
                           {{item.msg}}
                                   </textarea>
                            
                            </p>
                             
                          </div>
                        </li>
                      </ul>
               
                {%end%}
                {%else%}
                还没有哦~
                {%end%}

              </div>
              <div class="tab-pane " id="c_msg">
                  {%if t_projects_events%}
                  <table class="table" style="margin:5px;">
                         <thead>
                                    <tr style="background-color:#989898; color:#fff;">
                                    <th style="min-width:60px;">操作类型</th>
                                    <th></th>
                                    <th style="min-width:60px;">时间</th>
                                    <th style="min-width:60px;">操作人</th>
                                    </tr>
                                </thead>
                    <tbody>
              
              {%for item in t_projects_events%}
                            <tr>
              
                                <td>{{item.event_type}}</td>
                                <td>{{item.txt}}</td>
                                <td>{{item.created_at.strftime('%Y-%m-%d')}}</td>
                                <td>{{item.uid_name}}</td>
                            </tr>
                        {%end%}
              
                  
                    
                    </tbody>
                  </table>
              
                        {%else%}
                            还没有客户哦。
                                   
                        {%end%}    

              </div>
              <div class="tab-pane " id="fengxian_msg">
                  {%if t_customer_genjin_msg5%}
                  {%for item in  t_customer_genjin_msg5%}
              <!-- <div class="eslao">
                  <div class="toux-l">
                    <img src="static/images/img/dta.png" alt="" width="76" height="76">
                  </div>
                  <div class="toux-r">
                    <h3>{{item.uid_name}}</h3>
                    <p class="esneir">{{item.msg}}</p>
                    <span>{{item.created_at}}</span>
                    <div class="esrname">
                      <p>{%if item.file_path%}<a href="{{item.file_path}}"  target="blank">查看附件</a>{%end%}</p>
                    </div>
                  </div>
                  <div class="xsj">
                    <img src="static/images/img/xsj_07.jpg" alt="" width="14" height="16">
                  </div>
                </div> -->
                <ul class="messages_layout" style="width:100%;overflow: hidden;box-sizing: border-box;">
                    <li class="from_user left" style="width: 100%;overflow: hidden;box-sizing: border-box;"> <a href="#" class="avatar"><img src="static/images/img/message_avatar1.png"></a>
                          <div class="message_wrap" style="width: 100%;
                          box-sizing: border-box;"> <span class="arrow"></span>
                            <div class="info"> <a class="name">{{item.uid_name}}</a> <span class="time">{{item.created_at}}</span>
                              <div class="options_arrow">
                                  {%if dt_today==str(item.created_at.strftime("%Y-%m-%d")) or item.file_path%}
                                  <div class="dropdown pull-right"> <a class="dropdown-toggle " id="dLabel" role="button" data-toggle="dropdown" data-target="#" href="https://www.egrappler.com/bootstrap-responsive-admin-template/index.html#"> <i class=" icon-caret-down"></i>操作</a>
                                    <ul class="dropdown-menu " role="menu" aria-labelledby="dLabel">
                                     
                                          {%if dt_today==str(item.created_at.strftime("%Y-%m-%d"))%}
                                          <li>
                                          <a href="javascript:void(0)" genjin_type="{{item.genjin_type}}" msg="{{item.msg}}"  customer_id ="{{item.customer_id}}"  class="btn btn-mini gj_msg" msg_id="{{item.id}}" ><i class=" icon-share-alt icon-large"></i>修改</a></li>
                                          <li><a href="javascript:void(0)" genjin_type="{{item.genjin_type}}" msg="{{item.msg}}"  customer_id ="{{item.customer_id}}"  class="btn btn-mini btn-danger gj_msg_delete" msg_id="{{item.id}}" ><i class=" icon-share-alt icon-large"></i>删除</a></li>{%end%}
                                          {%if item.file_path%}{%for idx,row in enumerate(item.file_path.split('|'))%}{%if row%}
                                          <li><a href="{{row}}" class="btn btn-mini" target="_blank"><i class=" icon-share icon-large"></i>附件{{idx+1}}</a></li>
                                          {%end%}{%end%}{%end%}
                                     
                                    </ul>
                                  </div>
                                  {%end%}
                               </div>
                            </div>
                            <p title="{{item.msg}}" style="min-height:100px;" class="esneir"  id="p_msg_{{item.id}}">{{item.msg}}</p>
  
                            <p class="esneir" style="min-height:100px; display:none;" id="p_msg_edit_{{item.id}}">
                               <textarea class="eswenben" name=""  style="min-height:100px;width:100%" id="genjin_msg_{{item.id}}">
                           {{item.msg}}
                                   </textarea>
                            
                            </p>
                             
                          </div>
                        </li>
                      </ul>
               
                {%end%}
                {%else%}
                还没有哦~
                {%end%}

              </div>
              <div class="tab-pane " id="cuikuan_msg">
                  {% set has_exchange=0%}
                  {%if t_customer_exchange1%}
                  {%for item in  t_customer_exchange1%}
                  {%if item.etype==2%}
                  {% set has_exchange=1%}
                <ul class="messages_layout" style="width:100%;overflow: hidden;box-sizing: border-box;">
                    <li class="from_user left" style="width: 100%;overflow: hidden;box-sizing: border-box;"> <a href="#" class="avatar"><img src="static/images/img/message_avatar1.png"></a>
                          <div class="message_wrap" style="width: 100%;
                          box-sizing: border-box;"> <span class="arrow"></span>
                            <div class="info"> <a class="name">{{item.uid_name}}</a> <span class="time">{{item.created_at}}</span>
                              <div class="options_arrow">

                                
                               </div>
                            </div>
                            <p title="{{item.msg}}" style="min-height:100px;" class="esneir"  id="p_msg_{{item.id}}">{{item.msg}}</p>
  
                            <p class="esneir" style="min-height:100px; display:none;" id="p_msg_edit_{{item.id}}">
                               <textarea class="eswenben" name=""  style="min-height:100px;width:100%" id="genjin_msg_{{item.id}}">
                           {{item.msg}}
                                   </textarea>
                            
                            </p>
                            {%if item.file_path%}{%for idx,row in enumerate(item.file_path.split('|'))%}{%if row%}
                            <a href="{{row}}" class="btn btn-mini" target="_blank"><i class=" icon-share icon-large"></i>附件{{idx+1}}</a>
   
                            {%end%}{%end%}{%end%}
                          </div>
                        </li>
                      </ul>
                  {%end%}
                {%end%}
                {%end%}
                {%if not t_customer_exchange1 or has_exchange!=1%}
                还没有哦~
                {%end%}
              </div>  
              <div class="tab-pane " id="kj_msg">
                  {%if t_customer_exchange1%}
                  {%for item in  t_customer_exchange1%}
                  {%if item.etype==4%}
                  {%set has_exchange=2%}
                <ul class="messages_layout" style="width:100%;overflow: hidden;box-sizing: border-box;">
                    <li class="from_user left" style="width: 100%;overflow: hidden;box-sizing: border-box;"> <a href="#" class="avatar"><img src="static/images/img/message_avatar1.png"></a>
                          <div class="message_wrap" style="width: 100%;
                          box-sizing: border-box;"> <span class="arrow"></span>
                            <div class="info"> <a class="name">{{item.uid_name}}</a> <span class="time">{{item.created_at}}</span>
                              <div class="options_arrow">

                                
                               </div>
                            </div>
                            <p title="{{item.msg}}" style="min-height:100px;" class="esneir"  id="p_msg_{{item.id}}">{{item.msg}}</p>
  
                            <p class="esneir" style="min-height:100px; display:none;" id="p_msg_edit_{{item.id}}">
                               <textarea class="eswenben" name=""  style="min-height:100px;width:100%" id="genjin_msg_{{item.id}}">
                           {{item.msg}}
                                   </textarea>
                            
                            </p>
                            {%if item.file_path%}{%for idx,row in enumerate(item.file_path.split('|'))%}{%if row%}
                            <a href="{{row}}" class="btn btn-mini" target="_blank"><i class=" icon-share icon-large"></i>附件{{idx+1}}</a>
   
                            {%end%}{%end%}{%end%}
                          </div>
                        </li>
                      </ul>
                  {%end%}
                {%end%}
                {%end%}
                {%if not t_customer_exchange1 or has_exchange!=2%}
                还没有哦~
                {%end%}
              </div>  
              <div class="tab-pane " id="other_msg">
                  {%if t_customer_genjin_msg4%}
                  {%for item in  t_customer_genjin_msg4%}
                <ul class="messages_layout" style="width:100%;overflow: hidden;box-sizing: border-box;">
                    <li class="from_user left" style="width: 100%;overflow: hidden;box-sizing: border-box;"> <a href="#" class="avatar"><img src="static/images/img/message_avatar1.png"></a>
                          <div class="message_wrap" style="width: 100%;
                          box-sizing: border-box;"> <span class="arrow"></span>
                            <div class="info"> <a class="name">{{item.uid_name}}</a> <span class="time">{{item.created_at}}</span>
                              <div class="options_arrow">
                                  {%if dt_today==str(item.created_at.strftime("%Y-%m-%d")) or item.file_path%}
                                  <div class="dropdown pull-right"> <a class="dropdown-toggle " id="dLabel" role="button" data-toggle="dropdown" data-target="#" href="https://www.egrappler.com/bootstrap-responsive-admin-template/index.html#"> <i class=" icon-caret-down"></i>操作</a>
                                    <ul class="dropdown-menu " role="menu" aria-labelledby="dLabel">
                                     
                                          {%if dt_today==str(item.created_at.strftime("%Y-%m-%d"))%}
                                          <li>
                                          <a href="javascript:void(0)" genjin_type="{{item.genjin_type}}" msg="{{item.msg}}"  customer_id ="{{item.customer_id}}"  class="btn btn-mini gj_msg" msg_id="{{item.id}}" ><i class=" icon-share-alt icon-large"></i>修改</a></li>
                                          <li><a href="javascript:void(0)" genjin_type="{{item.genjin_type}}" msg="{{item.msg}}"  customer_id ="{{item.customer_id}}"  class="btn btn-mini btn-danger gj_msg_delete" msg_id="{{item.id}}" ><i class=" icon-share-alt icon-large"></i>删除</a></li>{%end%}
                                          {%if item.file_path%}{%for idx,row in enumerate(item.file_path.split('|'))%}{%if row%}
                                          <li><a href="{{row}}" class="btn btn-mini" target="_blank"><i class=" icon-share icon-large"></i>附件{{idx+1}}</a></li>
                                          {%end%}{%end%}{%end%}
                                     
                                    </ul>
                                  </div>
                                  {%end%}
                               </div>
                            </div>
                            <p title="{{item.msg}}" style="min-height:100px;" class="esneir"  id="p_msg_{{item.id}}">{{item.msg}}</p>
  
                            <p class="esneir" style="min-height:100px; display:none;" id="p_msg_edit_{{item.id}}">
                               <textarea class="eswenben" name=""  style="min-height:100px;width:100%" id="genjin_msg_{{item.id}}">
                           {{item.msg}}
                                   </textarea>
                            
                            </p>
                             
                          </div>
                        </li>
                      </ul>
                {%end%}
                {%else%}
                还没有哦~
                {%end%}
              </div>
              </div>

        </div>
     


      <div>
      
       
      </div>
    </div>
  </div>
</div>
<div class="tab-pane" id="payment_record_tab">

</div>
<div class="tab-pane" id="handle_tab">

    {%if t_projects_events%}
    <table class="table" style="margin:5px;">
           <thead>
                      <tr style="background-color: black; color:#fff;">
                      <th style="min-width:60px;">操作类型</th>
                      <th></th>
                      <th style="min-width:60px;">时间</th>
                      <th style="min-width:60px;">操作人</th>
                      </tr>
                  </thead>
      <tbody>

{%for item in t_projects_events%}
              <tr>

                  <td>{{item.event_type}}</td>
                  <td>{{item.txt}}</td>
                  <td>{{item.created_at.strftime('%Y-%m-%d')}}</td>
                  <td>{{item.uid_name}}</td>
              </tr>
          {%end%}

    
      
      </tbody>
    </table>

          {%else%}
              还没有客户哦。
                     
          {%end%}    
</div>

<div class="tab-pane" id="etax">

<a  class="btn btn-info " href="#etax_anqi_tab" id="btn_etax_anqi" data-toggle="tab">按期应申报</a>

<a class="btn btn-info " href="#etax_history_tab" id="btn_etax_history" data-toggle="tab" >申报记录</a>
<br/>
<br/>
<div class="tab-content">
<div class="tab-pane" id="etax_anqi_tab">
    <div class="widget widget-table action-table " id="zone_anqi">
      <form class="form-search">
        <input type="text" value="{{params['get_date_start']}}" name="get_date_start" id="get_date_start" placeholder="开始时间">
        <input type="text" value="{{params['get_date_end']}}"  name="get_date_end" id="get_date_end" placeholder="结束时间">
        <input type="hidden" name="tag" value="{{tag}}">
        <input type="hidden" name="id" value="{{customer.customer_id}}">
        <input type="hidden" name="guid" value="{{customer.guid}}">
        <input type="hidden" name="to_tag" value="etax">
        <button type="submit" class="btn">检 索</button>
      </form>

      <div class="alert alert-danger">
        {{customer.err_msg}}
        </div>
        
        <div class="widget-header"> <i class="icon-th-list"></i>
          <h3>按期应申报  
              
月份:{%if t_etax_wfm%} <span style="color:red; font-size:25px;">{{t_etax_wfm[0].qdate}}</span>{%end%}

            
            
          
            
            {%if customer.rel_name_collect_account and customer.rel_name_collect_password%}{%if user64%}
            <a href="https://www.etax-gd.gov.cn/xxmh/html/index_login.html?tt={{user64}}" class="btn btn-primary " target="_blank">登录广东省电子税务局</a>
      
            {%end%}
      
            {%else%}
            还没设置密码哦.
      
            {%end%}
      
      
            <a href="/static/chrome/chrome_faye.crx" target="_blank">辅助插件</a>
            <a href="/customer?tag=show&id={{customer.customer_id}}&guid={{customer.guid}}&to_tag=etax"  style="font-size:20px; color:red;">刷新本页面</a>
  
            
            最后更新:{%if t_etax_wfm%} <span style="color:blue; font-size:15px;">{{t_etax_wfm[0].up_at}}</span>{%end%}
          
          
          </h3>
        </div>
        
          <div class="widget-content">
              {%if t_etax_wfm%}
              <table class="table table-striped table-bordered ">
                  <thead>
                    <tr>
                   <th  width='30'>序号</th>
                   <th width="60">征收项目</th>
                   <th width='80'>征收品目</th>
                   <th width='80'>税款所属期起</th>
                   <th width='80'>税款所属期止</th>
                   <th width='80'>申报期限	</th>
                 
                   <th width='50'>申报日期	</th>
                    </tr>
                  </thead>
                  <tbody>
                    {%for idx,item in enumerate(t_etax_wfm)%}
                    <tr>
                      <td>{{idx+1}}</td>
                      <td>{{item.zsxmMc}}</td>
                      <td>{{item.zspmMc}}</td>
                      <td>{{item.skssqQ}}</td>
                      <td>{{item.skssqZ}}</td>
                      <td>{{item.sbqx}}</td>
                      <td>{{item.sbrq}}</td>
                    </tr>
                    {%end%}
                  </tbody>
                </table> 
  
                {%else%}
                   还没有数据哦.
                {%end%}
            </div>
        </div>
      </div>


      <div class="tab-pane" id="etax_history_tab">
        <div class="widget widget-table action-table"  id="zone_history">
            <div class="widget-header"> <i class="icon-th-list"></i>
              <h3>申报记录  最后更新:{%if t_etax%} <span style="color:blue; font-size:15px;">{{t_etax[0].up_at}}</span>{%end%}
              
              
                
              </h3>
            </div>
            
              <div class="widget-content">
                  {%if t_etax%}
                  <table class="table table-striped table-bordered ">
                      <thead>
                        <tr>
                       <th  width='30'>序号</th>
                       <th width="60">征收项目</th>
                       <th >申报表名称</th>
                       <th width='80'>征收品目</th>
                       <th width='60'>申报状态</th>
                       <th width='80'>税款所属期起</th>
                       <th width='80'>税款所属期止</th>
                       <th width='80'>申报日期</th>
                     
                       <th width='50'>营业收入</th>
                       <th width='50'>应纳税额	</th>
                       <th width='50'>减免税额	</th>
                       <th width='60'>已预缴税额		</th>
                       <th width='60'>应补退税额</th>
                        </tr>
                      </thead>
                      <tbody>
                        {%for idx,item in enumerate(t_etax)%}
                        <tr>
                          <td>{{idx+1}}</td>
                          <td>{{item.zsxmmc}}</td>
                          <td>{{item.dzbzdszlmc}}</td>
                          <td>{{item.zspmmc}}</td>
                          <td>{{item.sbzt}}</td>
                          <td>{{item.skssqq}}</td>
                          <td>{{item.skssqz}}</td>
                          <td>{{item.sbrq_1}}</td>
                   
                          <td>{{item.ysx}}</td>
                          <td>{{item.ynse}}</td>
                          <td>{{item.jmse}}</td>
                          <td>{{item.yjse}}</td>
                          <td>{{item.ybtse}}</td>
                        </tr>
                        {%end%}
                      </tbody>
                    </table> 
                    <div class="pagination">
                        <ul>
                            {% if pagination.has_prev %}
                            <li><a href="?tag={{tag}}&id={{customer.customer_id}}&guid={{customer.guid}}&to_tag=etax&etax_tag=etax_history&page={{ pagination.page - 1}}
                                ">&laquo; 上页</a></li> {% end %} {%for page in pagination.iter_pages() %} {% if page %} {% if page != pagination.page %}
                            <li>
                                <a href="?tag={{tag}}&id={{customer.customer_id}}&guid={{customer.guid}}&to_tag=etax&etax_tag=etax_history&page={{ page }}
                        ">{{ page }}</a></li>
                            {% else %}
                            <li><span class="active"><a href="#">{{ page }}</a></span></li>
                            {% end %} {% else %}
                            <li><span class="active"><a href="#">....</a></span></li>
                            {% end %} {%end %} {% if pagination.has_next %}
                            <li><a href="?tag={{tag}}&id={{customer.customer_id}}&guid={{customer.guid}}&to_tag=etax&etax_tag=etax_history&page={{pagination.page+1}}
                                ">下页 &raquo;</a></li>
                            {% end %}
                        </ul>
                    </div>
                    {%else%}
                       还没有数据哦.
                    {%end%}
                </div>
            </div>
        </div>
      </div>
  </div>
  
  
  
  </div> <!-- /widget -->



</div>



</div> <!-- /widget -->

</div> <!-- /span8 -->


</div> <!-- /row -->


</div> <!-- /container -->
</div>
</div>
</div>
</div>
</div>

<div id="add_test_modal1" class="modal hide fade modal11" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    </div>
    <div class="modal-body">
      <div class="es-fytable">
        <ul style="border-top: 1px solid #dedede;">
          <li>
            <div class="length1">{%if role!='3' and role!='8' and role!='5'%}<i style="color:red;">*</i>{%end%} 公司名称</div>
            <div class="length5">
           <input  {%if role!='3' and role!='8' and role!='5'%}disabled{%end%} style="background-color:white;width:70%;" type="text" name="" id="company" value="{%if customer.company%}{{customer.company}}{%end%}">
              <span id="exist_customer1"></span>
            </div>
            <div class="length1">客服会计</div>
            
            <div class="length2">

            
                        
              <input type="text" id="acc_uid_name" data-provide="typeahead" data-items="6" data-source="[{%for idx,item in enumerate(t_user)%}&quot;{{item.name}}&quot;{%if idx==len(t_user)-1%}{%break%}{%else%},{%end%}{%end%}]" value="{%if customer.acc_uid_name%}{{customer.acc_uid_name}}{%end%}">

            
            </div>
          </li>
          <li>
            <div class="length1">客户编号</div>
            <div class="length2">{{customer.customer_id}}</div>
            <div class="length1">所属行业</div>
            <div class="length2"><input type="text" name="" id="hangye"  value="{%if customer.hangye%}{{customer.hangye}}{%end%}"></div>
            <div class="length1">开户行</div>
            <div class="length2"><input type="text" name="" id="reg_bank" value="{%if customer.reg_bank%}{{customer.reg_bank}}{%end%}" ></div>
          </li>
          <li>
            <div class="length1">工商分局</div>
            <div class="length2"><input type="text" name="" id="saic" value="{%if customer.saic%}{{customer.saic}}{%end%}" ></div>
            <div class="length1">地址类型</div>
            <div class="length2"><input type="text" name="" id="addr_type" value="{%if customer.addr_type%}{{customer.addr_type}}{%end%}" ></div>
            <div class="length1">银行账号</div>
            <div class="length2"><input type="text" name="" id="reg_bank_account" value="{%if customer.reg_bank_account%}{{customer.reg_bank_account}}{%end%}"  ></div>
          </li>
          <li>
            <div class="length1">国/地所属分局</div>
            <div class="length2">
              <input type="text" name=""  id="national_tax"   value="{%if customer.national_tax%}{{customer.national_tax}}{%end%}"> <span style="font-size:20px;"></span> <input type="hidden" id="land_tax" style="width:40%;"  value="{%if customer.land_tax%}{{customer.land_tax}}{%end%}"></div>
            <div class="length1">专管员姓名</div>
            <div class="length2"><input type="text" name="" id="zg_name"   value="{%if customer.zg_name%}{{customer.zg_name}}{%end%}"></div>
            <div class="length1">专管员联系方式</div>
            <div class="length2"><input type="text" name="" id="zg_tel"   value="{%if customer.zg_tel%}{{customer.zg_tel}}{%end%}"></div>
          </li>
          <li>
            <div class="length1">经营范围</div>
            <div class="length3"><input type="text" name="" id="business_scope"   value="{%if customer.business_scope%}{{customer.business_scope}}{%end%}"></div>
          </li>
          <li>
            <div class="length1">情况和注意事项</div>
            <div class="length3"><input type="text" name="" id="attention"   value="{%if customer.attention%}{{customer.attention}}{%end%}"></div>
          </li>
          
          <li>
              <div class="length1">待调整事项</div>
              <div class="length3"><input type="text" name="" id="adjusted_option"   value="{%if customer.adjusted_option%}{{customer.adjusted_option}}{%end%}"></div>
            </li>
          <li>
            <div class="length1">主管意见</div>
            <div class="length3"><input type="text" name="" id="zg_option"   value="{%if customer.zg_option%}{{customer.zg_option}}{%end%}"></div>
          </li>
          <li>
              <div class="length1">会计标记</div>
              <div class="length3">
                {%for item in t_kj_labels%}
                <input {%if customer.acc_uid!=int(uid)%}disabled{%end%} {%if customer.kj_label_ids%}{%if str(item.id) in customer.kj_label_ids.split(',') %}checked{%end%}{%end%} type="checkbox" name="kj_label" value="{{item.id}}" kj_label_name="{{item.name}}"  id="kj_label" style="width: auto;" >{{item.name}}&nbsp;
                {%end%}
              </div>
            </li>
        </ul>
      </div>
    </div>
    <div class="modal-footer">
        {%if role!='3' and role!='8' and role!='5'%}
        <div style="float: left;">
            <i style="color:red;">*</i>：只允许财务修改
         
          </div>
       {%end%}
      <button class="btn" data-dismiss="modal" aria-hidden="true" >关闭</button>
      <button class="btn btn-primary" id="btn_test_save1">保存</button>
    </div>
  </div>
  
  <div id="add_test_modal2" class="modal hide fade modal22" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    </div>
    <div class="modal-body">
      <div class="es-fytable">
        <ul style="border-top: 1px solid #dedede;">
          <li>
            <div class="length1">纳税类型</div>
            <div class="length4">
                一般纳税人:
                <input type="radio" name="is_general" value="1" style="width:auto;height:auto;" {%if customer.is_general%}checked{%end%}>是
                <input type="radio" name="is_general" value="0" style="width:auto;height:auto;" {%if not customer.is_general%}checked{%end%}>否
              </div>
            <div class="length1">税务概况</div>
            <div class="length6"><input type="text" name="survey" id="survey"  value="{%if customer.survey%}{{customer.survey}}{%end%}"></div>
          </li>
          <li>
            <div class="length1">有无税种</div>
            <div class="length4">
                <input style="width:auto; height:auto;" type="radio" value="1" class="is_check" name="is_check"id="is_check" {%if customer.is_check%}checked{%end%}>是
                <input style="width:auto; height:auto;" type="radio" value="0" class="is_check" name="is_check" id="is_check" {%if not customer.is_check%}checked{%end%}>否
                <span style="background-color: rgb(217, 238, 249);" id="btype_name_box" hidden>
                  <input style="width:auto; height:auto;" type="radio" name="btype_id" id="btype_id" btype_id_name="核定" value="1" {%if customer.btype_id%}checked{%end%}>核定 
                  <input style="width:auto; height:auto;"  type="radio" name="btype_id" id="btype_id" btype_id_name="查账" value="0" {%if not customer.btype_id%}checked{%end%}>查账
                </span>
              
            </div>
            <div class="length1">税种明细</div>
            <div class="length6"><input type="text" name="" id="shuizhong_detail"  value="{%if customer.shuizhong_detail%}{{customer.shuizhong_detail}}{%end%}"></div>
          </li>
          <li>
            <div class="length1">征收方式</div>
            <div class="length4"><input type="text" name="" id="zhengshou_way" value="{%if customer.zhengshou_way%}{{customer.zhengshou_way}}{%end%}"></div>
            <div class="length1">税控盘类别</div>
            <div class="length4"><input type="text" name="" id="shuikong_type" value="{%if customer.shuikong_type%}{{customer.shuikong_type}}{%end%}"></div>
            <div class="length1">参保人数</div>
            <div class="length4"><input type="text" name="" id="ss_num"  value="{%if customer.ss_num%}{{customer.ss_num}}{%else%}0{%end%}"></div>
            <div class="length1">固定资产</div>
            <div class="length4"><input type="text" name="" id="fixed_assets" value="{%if customer.fixed_assets%}{{customer.fixed_assets}}{%end%}"></div>
          </li>
        </ul>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn" data-dismiss="modal" aria-hidden="true" >关闭</button>
      <button class="btn btn-primary" id="btn_test_save2">保存</button>
    </div>
  </div>
  
  <div id="add_test_modal3" class="modal hide fade modal33" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    </div>
    <div class="modal-body">
      <div class="es-fytable">
        <ul style="border-top:1px solid #dedede;">
          <li>
            <div class="length1">法人身份证号</div>
            <div class="length4"><input type="text" name="" id="legal_id_card" value="{%if customer.legal_id_card%}{{customer.legal_id_card}}{%end%}"></div>
            <div class="length1">实名采集账号</div>
            <div class="length4"><input type="text" name="rel_name_collect_account" id="rel_name_collect_account"  value="{%if customer.rel_name_collect_account%}{{customer.rel_name_collect_account}}{%end%}"></div>
            <div class="length1">实名采集密码</div>
            <div class="length4"><input type="text" name="" id="rel_name_collect_password" value="{%if customer.rel_name_collect_password%}{{customer.rel_name_collect_password}}{%end%}"></div>
            <div class="length1">税控盘密码</div>
            <div class="length4"><input type="text" name="" id="shuipan_password"  value="{%if customer.shuipan_password%}{{customer.shuipan_password}}{%end%}"></div>
          </li>
  
          <li>
            <div class="length1">税控盘口令</div>
            <div class="length4"><input type="text" name="" id="shuipan_command"  value="{%if customer.shuipan_command%}{{customer.shuipan_command}}{%end%}"></div>
            <div class="length1">个税申报密码</div>
            <div class="length4"><input type="text" name="" id="per_income_apply_password" value="{%if customer.per_income_apply_password%}{{customer.per_income_apply_password}}{%end%}"></div>
            <div class="length1">回单卡密码</div>
            <div class="length4"><input type="text" name="" id="receipt_card_password"  value="{%if customer.receipt_card_password%}{{customer.receipt_card_password}}{%end%}"></div>
            <div class="length1">公积金证书密码</div>
            <div class="length4"><input type="text" name="" id="accumulation_fund_password"  value="{%if customer.accumulation_fund_password%}{{customer.accumulation_fund_password}}{%end%}"></div>
          </li>
        </ul>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn" data-dismiss="modal" aria-hidden="true" >关闭</button>
      <button class="btn btn-primary" id="btn_test_save3">保存</button>
    </div>
  </div>
  <div id="add_test_modal4" class="modal hide fade modal44" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    </div>
    <div class="modal-body">
      <div class="es-fytable">
        <ul style="border-top: 1px solid #dedede;">
          <li>
            <div class="length1">{%if role!='3' and role!='8' and role!='5'%}<i style="color:red;">*</i>{%end%} 公司名称 </div>
            <div class="length5"><input {%if role!='3' and role!='8' and role!='5'%}disabled{%end%} style="background-color:white;width:70%;"  type="text" name="" id="company1" value="{%if customer.company%}{{customer.company}}{%end%}">
              <span id="exit_customer"></span>
            </div>
            <div class="length1">法人</div>
            
            <div class="length2">
                <input type="text" id="reg_person" value="{{customer.reg_person}}">
            </div>
          </li>
          <li>
            <div class="length1">{%if role!='3' and role!='8' and role!='5'%}<i style="color:red;">*</i>{%end%} 信用代码</div>
            <div class="length2">  <input {%if role!='3' and role!='8' and role!='5'%}disabled{%end%} style="background-color:white;text-transform:uppercase;" type="text" name=""　   id="company_reguid" value="{%if customer.company_reguid%}{{customer.company_reguid}}{%end%}"></div>
            <div class="length1">执照成立日期</div>
            <div class="length2"><input type="text" name="" id="reg_date" value="{%if customer.reg_date%}{{customer.reg_date.strftime("%Y-%m-%d")}}{%end%}"></div>
            <div class="length1">联系电话</div>
            <div class="length2">
                {%if t_linkman%}
                <input type="hidden" id="link_id" value="{{t_linkman[0].id}}" >
              <input style="width:30%" type="text" name="" id="link_name" {%if t_linkman%}value="{{t_linkman[0].name}}"{%end%}>-

              <input style="width: 45%;" type="text" name="" id="link_tel" {%if t_linkman%}value="{{t_linkman[0].tel}}"{%end%}>
              <span id="msg_link_tag" style="color:red" ></span>
              
              
              {%else%}
              无
              {%end%}
            </div>
          </li>
          <li>
            <div class="length1">纳税类型</div>
            <div class="length2">
              一般纳税人:
              <input type="radio" name="is_general1" value="1" style="width:auto;height:auto;" {%if customer.is_general%}checked{%end%}>是
              <input type="radio" name="is_general1" value="0" style="width:auto;height:auto;" {%if not customer.is_general%}checked{%end%}>否
            </div>
            <div class="length1">地址类型</div>
            <div class="length2">
              <input type="text" id="addr_type1" value="{%if customer.addr_type%}{{customer.addr_type}}{%end%}">
            </div>
            <div class="length1">注册资金</div>
            <div class="length2">
              <input type="text" id="reg_money" value="{%if customer.reg_money%}{{customer.reg_money}}{%end%}">

            </div>
          </li>
          <li>
            <div class="length1">合同约定</div>
            <div class="length3">
        
           付款方式：{%for idx,item in enumerate(t_payment_type)%}
                    <input style="width:auto;height:auto;" type="radio"
                    {%if item.id==customer.paytype_id %} checked="true" {%end%} {%if role not in ['2','3','5','8'] or uid==161%}disabled="disabled"{%end%}
                    name="pay_type_id" fee="{{item.fee}}" value="{{item.id}}" pay_typeid_name="{{item.name}}"/> {{item.name}} {%end%}
                    &nbsp;&nbsp;总服务费：<input style="width:50px;" type="text"  id="service_amount" name="service_amount" value="{{int(customer.service_amount)}}">
                    月服务费：<input style="width:50px;background-color:white;" type="text" disabled="true" id="service_amount_month" name="service_amount_month" value="{{int(customer.service_amount_month)}}">
                    帐册费：<input style="width:50px;" type="text" id="book_amount" name="book_amount" value="{{int(customer.book_amount)}}">
                    其他约定：<input style="width:250px;" type="text" id="other_appoint" name="other_appoint" value="{%if customer.other_appoint%}{{customer.other_appoint}}{%end%}">
           
          
            </div>
          
          </li>
          <li>
            <div class="length1">账费到期</div>
            <div class="length3">
                {%if t_customer_payment%}
                <input type="hidden" id="payment_id" value="{{t_customer_payment.id}}"> 
              <input type="text" id="acc_end" value="{%if t_customer_payment%}{%if t_customer_payment.acc_end%}{{t_customer_payment.acc_end.strftime('%Y-%m-%d')}}{%end%}{%end%}">
              {%else%}
              无
              {%end%}
            </div>
          </li>
          <li>
            <div class="length1">注册地址</div>
            <div class="length3">
              <select name="city" id="city">
                <option value="">选择城市</option>
{%for item in t_city%}
<option value="{{item.name}}" {%if customer.city==item.name%}selected{%end%}>{{item.name}}</option>
{%end%}
</select>
<select name="zone" id="zone">
                    <option value="">选择区域</option>
{%for item in t_zone%}
<option value="{{item.name}}" {%if customer.zone==item.name%}selected{%end%}>{{item.name}}</option>
{%end%}
</select>
<input type="text" style="width:50%;" id="reg_addr" name="reg_addr" value="{{customer.reg_addr}}">
            </div>
          </li>
          <li>
            <div class="length1">{%if role!='3' and role!='8' and role!='5'%}<i style="color:red;">*</i>{%end%} 标签类型</div>
            <div class="length3">
              {%if not old_tag%}
                <div style="border:none;">
                {%for item in t_type_new_parents%}
                <input  {%if role!='3' and role!='8' and role!='5'%}disabled{%end%} style="width:auto;height:auto;" type="radio" name="tag_parent_id" value="{{item.order}}" title="{{item.name}}" {%if customer.tag_parent_id==item.order%}checked{%end%}/>{{item.name}} 
                {%end%}
              </div>
            
                <div class='tag_box' style="border:none;" {%if customer.tag_parent_id!=1%}hidden{%end%}>
                    &nbsp;&nbsp;(
                {%for item in t_type_new%}
                {%if item.parent_id==1%}
                <input {%if role!='3' and role!='8' and role!='5'%}disabled{%end%} style="width:auto;height:auto;" type="radio" name="tag_id" value="{{item.order_int}}" title="{{item.name}}" {%if customer.tag_id==item.order_int %}checked{%end%}/>{{item.name}}
                {%end%}
                {%end%}
                  )
                  <span id="msg_tag" style="color:red"></span>
            </div>
            <div id='tag_box1' style="border:none;" {%if customer.tag_parent_id!=2 %}hidden{%end%}>
                &nbsp;&nbsp;(
            {%for item in t_type_new%}
            {%if item.parent_id==2 and item.order_int!=11%}
            <input parent_id="{{item.parent_id}}" {%if role!='3' and role!='8' and role!='5'%}disabled{%end%} style="width:auto;height:auto;" type="radio" name="tag_id" value="{{item.order_int}}" title="{{item.name}}" {%if customer.tag_id==item.order_int %}checked{%end%}/>{{item.name}}
            {%end%}
            {%end%}
              )
              <span id="msg_tag1" style="color:red"></span>
        </div>
           
            &nbsp;&nbsp;
              <input {%if role!='3' and role!='8' and role!='5'%}disabled{%end%} style="width:auto;height:auto;" type="checkbox" name='is_building' value="1" {%if customer.is_building%}checked{%end%}>楼盘
              <input {%if role!='3' and role!='8' and role!='5'%}disabled{%end%} style="width:auto;height:auto;" type="checkbox" name='is_clearly' value="1" {%if customer.is_clearly%}checked{%end%}>汇算清缴
              <input {%if role!='3' and role!='8' and role!='5'%}disabled{%end%} style="width:auto;height:auto;" type="checkbox" name='is_year' value="1" {%if customer.is_year%}checked{%end%}>工商年检
              {%else%}
              {%for item in t_customer_type%}
              <input {%if role!='3' and role!='8' and role!='5'%}disabled{%end%} style="width:auto;height:auto;" type="checkbox" name="customer_type" {%if role not in ['2','3','5','8'] or uid==161%}disabled="disabled"{%end%}
              {%if customer.customer_type%}
              {%for s in customer.customer_type.split(",")%}
                  {%if s==str(item.id)%}
                  checked="true"
                  {%break%}
                  {%end%}
              {%end%}
               {%end%}
              value="{{item.id}}" title="{{item.name}}"/> {{item.name}}
          {%end%}
              <p id="msg_t_customer_type" class="help-block" style="color:red"></p>
              {%end%}
            </div>


          </li>
          <li>
            <div class="length1"></div>
            <div class="length3">
                <div class='tag_box' style="border:none;" {%if customer.tag_parent_id!=1%}hidden{%end%}>
              {%for item in t_type_new2%}
             
              <input {%if role!='3' and role!='8' and role!='5'%}disabled{%end%} style="width:auto;height:auto;" type="radio" name="tag_id2" value="{{item.order_int}}" title="{{item.name}}" {%if customer.tag_id2==item.order_int %}checked{%end%}/>{{item.name}}
    
              {%end%}
            </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
    <div class="modal-footer">
       
        <div style="float: left;">
            {%if role!='3' and role!='8' and role!='5'%}
            <i style="color:red;">*</i>：只允许财务修改
            {%end%}
         
        </div>
      <button class="btn" data-dismiss="modal" aria-hidden="true" >关闭</button>
      <button class="btn btn-primary" id="btn_test_save4">保存</button>
    </div>
  </div>
<div id="a_add_account_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel_account">增加客户帐号



    </h3>
  </div>
  <div class="modal-body">
    <div class="control-group">


                                            <div class="control-group">
                                                <label class="control-label" for="type_id">类 型</label>
                                                <div class="controls">
                                                {%for item in t_account_type%}
                                                    <input type="radio" name="type_id" value="{{item.id}}" title="{{item.name}}"/> {{item.name}}
                                                  {%end%}
                                                     <p id="msg_type_id" class="help-block" style="color:red"></p>
                                                </div>
                                                <!-- /controls -->
                                            </div>

                                                <label class="control-label" for="account">帐号</label>
                                                <div class="controls">
                                                    <input type="text" class="span4 " id="account" name="account" value="">
                                                    <p id="msg_account" class="help-block" style="color:red"></p>
                                                </div>
                                                <!-- /controls -->
                                            </div>
                                            <!-- /control-group -->



                                            <div class="control-group">
                                                <label class="control-label" for="psw">密码</label>
                                                <div class="controls">
                                                    <input type="text" class="span4 " id="psw" name="psw" value="">
                                                    <p id="msg_psw" class="help-block" style="color:red"></p>
                                                </div>
                                                <!-- /controls -->
                                            </div>
                                            <!-- /control-group -->



                                      <div class="control-group">
                                          <label class="control-label" for="lastname">备注</label>
                                          <div class="controls">
                                              <textarea type="text" class="span4" id="account_remark" name="account_remark" value="" style="height: 50px;"></textarea>
                                          </div>
                                          <!-- /controls -->
                                      </div>



  </div>
  <div class="modal-footer">
   <a href="javascript:;" class="btn btn-danger btn-small " id="delete_account">
         删除本条数据
        </a>
    <button class="btn" data-dismiss="modal" aria-hidden="true" >关闭</button>
    <button class="btn btn-primary" id="btn_save_account">保存</button>
  </div>
</div>


<div id="add_linkman_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel_linkman">增加客户联系人

        <a href="javascript:;" class="btn btn-danger btn-small " id="delete_linkman">
          <i class="btn-icon-only icon-remove"></i>
          </i>
        </a>

    </h3>
  </div>
  <div class="modal-body">
    <div class="control-group">
                                                <label class="control-label" for="username">名字/称呼</label>
                                                <div class="controls">
                                                    <input type="text" class="span4 " id="name" name="name" value="">
                                                    <p id="msg_name" class="help-block" style="color:red"></p>
                                                </div>
                                                <!-- /controls -->
                                            </div>
                                            <!-- /control-group -->


                                            <div class="control-group">
                                                <label class="control-label" for="firstname">性别</label>
                                                <div class="controls">
                                                    <input type="radio" name="gender" value="1" /> 先生
                                                    <input type="radio" name="gender" value="0" /> 女士
                                                     <p id="msg_gender" class="help-block" style="color:red"></p>
                                                </div>
                                                <!-- /controls -->
                                            </div>

                                            <div class="control-group">
                                                <label class="control-label" for="username">电话</label>
                                                <div class="controls">
                                                    <input type="text" class="span4 " id="tel" name="tel" value="">
                                                    <p id="msg_company" class="help-block" style="color:red"></p>
                                                </div>
                                                <!-- /controls -->
                                            </div>
                                            <!-- /control-group -->



                                      <div class="control-group">
                                          <label class="control-label" for="lastname">备注</label>
                                          <div class="controls">
                                              <textarea type="text" class="span4" id="linkman_remark" name="linkman_remark" value="" style="height: 50px;"></textarea>
                                          </div>
                                          <!-- /controls -->
                                      </div>
                                      <div class="control-group">
                                          
                                          <div class="controls">
                                              <label for="is_first"><input type="checkbox" id="is_first" style="display: inline;" value="1">添加为首要联系人</label>
                                              
                                          </div>
                                          <!-- /controls -->
                                      </div>



  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true" >关闭</button>
    <button class="btn btn-primary" id="btn_save_linkman">保存</button>
  </div>
</div>
<div id="feedback_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3 id="myModalLabel_linkman">反馈
      </h3>
    </div>
    <div class="modal-body">
      <div class="control-group">
    <div class="control-group">
        <label class="control-label" for="lastname">反馈意见</label>
        <div class="controls">
            <textarea type="text" class="span4" id="feedback_msg" name="feedback_msg" value="" style="height: 50px;"></textarea>
    </div>

  
  
    </div>
    </div>
    </div>
    <div class="modal-footer">
      <button class="btn" data-dismiss="modal" aria-hidden="true" >关闭</button>
      <button class="btn btn-primary" id="btn_save_feedback">确定</button>
    </div>
  </div>

<div id="add_tag_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3 id="myModalLabel_linkman">修改标签</h3>
    </div>
    <div class="modal-body">


  
                            
    </div>
    <div class="modal-footer">
      <button class="btn" data-dismiss="modal" aria-hidden="true" >关闭</button>
      <button class="btn btn-primary" id="btn_save_tag">保存</button>
    </div>
  </div>
<div id="add_project_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel">增加办理业务记录


    </h3>
  </div>
  <div class="modal-body">


<div class="control-group">
        <label class="control-label" for="username">关键词</label>
        <div class="controls">
                <input type="text" class="span4 " id="key" value="" > <a class="btn btn-primary" href="javascript:void(0)" id="query_project">查询</a>
                <p class="help-block">您可以输入确认单系统的业务编号/办理人的名字，电话，公司名称.</p>


        </div>


        <!-- /controls -->
</div>

<div id="show_projects">


</div>



  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true" >关闭</button>
    <button class="btn btn-primary" id="btn_save_project">选择</button>
  </div>
</div>



<div id="add_contract_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel_contract">增加合同 <a href="javascript:void(0)" class="btn-danger btn" id="delete_contract">删除该合同</a></h3>
  </div>
  <div class="modal-body">

                       <div class="control-group">
                            <label class="control-label" for="username">合同摘要</label>
                            <div class="controls">
                                <input type="text" class="span4 " id="contract_title" name="contract_title" value="">
                                <p id="msg_contract_title" class="help-block" style="color:red"></p>
                            </div>
                            <!-- /controls -->
                        </div>
                        <!-- /control-group -->

                       <div class="control-group">
                            <label class="control-label" for="username">开始时间</label>
                            <div class="controls">
                                <input type="text" class="span4 " id="contract_start_time" name="contract_start_time" >
                                <p id="msg_contract_start_time" class="help-block" style="color:red"></p>
                            </div>
                            <!-- /controls -->
                        </div>
                        <!-- /control-group -->

                       <div class="control-group">
                            <label class="control-label" for="username">到期时间</label>
                            <div class="controls">
                                <input type="text" class="span4 " id="contract_end_time" name="contract_end_time"  >
                                <p id="msg_contract_end_time" class="help-block" style="color:red"></p>
                            </div>
                            <!-- /controls -->
                        </div>
                        <!-- /control-group -->

                       <div class="control-group">
                            <label class="control-label" for="username">状态</label>
                            <div class="controls">
                            <input type="radio" value="1"  name="state_id" checked/> 正常
                              <input type="radio" value="0" name="state_id" /> 关闭
                            </div>
                            <p id="msg_state_id" class="help-block" style="color:red"></p>
                            <!-- /controls -->
                        </div>

                <div class="control-group">
                    <label class="control-label" for="lastname">备注</label>
                    <div class="controls">
                        <textarea type="text" class="span4" id="contract_remark" name="contract_remark" value="" style="height: 50px;"></textarea>
                    </div>
                    <!-- /controls -->
                </div>
                <!-- /control-group -->

  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true" >关闭</button>
    <button class="btn btn-primary" id="btn_save_contract">保存</button>
  </div>
</div>

<div id="a_add_file_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel">增加附件


    </h3>
  </div>
  <div class="modal-body">
    <div class="control-group">
      <label class="control-label" for="username">文件内容</label>
      <div class="controls">
        <input type="text" class="span4 " id="file_title" name="file_title" value="">
        <p id="msg_file_title" class="help-block" style="color:red"></p>
      </div>
      <!-- /controls -->
    </div>
    <!-- /control-group -->


    <div class="control-group">
      <label class="control-label" for="lastname">文件备注</label>
      <div class="controls">
        <textarea type="text" class="span4" id="file_remark" name="file_remark" value="" style="height: 50px;"></textarea>
      </div>
      <!-- /controls -->
    </div>


    <div class="control-group">
      <label class="control-label" for="lastname">文件</label>
      <div class="controls">
              <form 
      
              class="dropzone"
              enctype="multipart/form-data"
              id="my-dropzone"
              method="post" >
              <!--上传图片时，需要同时提交的数据，这里做个演示-->
           {% raw xsrf_form_html() %}
          </form>
        <!-- <input type="file" value="1" id="file" name="file" class="form-control" /> -->
    
      <!-- /controls -->
    </div>
  </div>

  </div>



  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
    <button class="btn btn-primary" id="btn_save_file">保存</button>
  </div>
</div>

<div id="a_add_trans_modal_upload" class="modal hide fade"
 tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel_trans">手机上传交接资料 </h3>
  </div>
  <div class="modal-body">

    <div id="show_qrcode">

    </div>
  </div>





  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>

  </div>
</div>



<div id="a_add_trans_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel_trans">增加交接资料记录 </h3>
  </div>
  <div class="modal-body">

    <div class="control-group">
      <label class="control-label" for="tran_by">移交方</label>
      <div class="controls">
        <input type="text" class="span4 " id="tran_by" name="tran_by" value="">
        <p id="msg_tran_by" class="help-block" style="color:red"></p>
      </div>
      <!-- /controls -->
    </div>
    <!-- /control-group -->
        <div class="control-group">
      <label class="control-label" for="rec_by">签收方</label>
      <div class="controls">
        <input type="text" class="span4 " id="rec_by" name="rec_by" value="">
        <p id="msg_rec_by" class="help-block" style="color:red"></p>
      </div>
      <!-- /controls -->
    </div>
    <!-- /control-group -->
        <div class="control-group">
      <label class="control-label" for="tran_at">交接时间</label>
      <div class="controls">
        <input type="text" class="span4 " id="tran_at" name="tran_at" value="">
        <p id="msg_tran_at" class="help-block" style="color:red"></p>
      </div>
      <!-- /controls -->
    </div>
    <!-- /control-group -->


    <div class="control-group">
      <label class="control-label" for="lastname">备注</label>
      <div class="controls">
        <textarea type="text" class="span4" id="trans_remark" name="trans_remark" value="" style="height: 50px;"></textarea>
      </div>
      <!-- /controls -->
    </div>


    <div class="control-group">
      <label class="control-label" for="lastname">附件</label>
      <div class="controls">
        <input type="file" id="tran_file" name="tran_file" class="form-control" />
      </div>
      <!-- /controls -->
    </div>

    <div id="show_qrcode">

    </div>
  </div>





  <div class="modal-footer">
  <a href="javascript:void(0)" id="delete_transition" class="btn-danger btn">删除本条数据</a>
    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
    <button class="btn btn-primary" id="btn_save_trans">保存</button>
  </div>
</div>



<div id="a_add_company_name_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel_linkman">增加公司曾用名



    </h3>
  </div>
  <div class="modal-body">
    <div class="control-group">
                          <label class="control-label" for="username">名称</label>
                          <div class="controls">
                              <input type="text" class="span4 " id="company_name" name="company_name" value="">
                              <p id="msg_name" class="help-block" style="color:red"></p>
                          </div>
                          <!-- /controls -->
                      </div>
                      <!-- /control-group -->




                <div class="control-group">
                    <label class="control-label" for="lastname">备注</label>
                    <div class="controls">
                        <textarea type="text" class="span4" id="company_remark" name="company_remark" value="" style="height: 50px;"></textarea>
                    </div>
                    <!-- /controls -->
                </div>



  </div>
  <div class="modal-footer">
  <a href="javascript:void(0)" id="btn_delete_company" class="btn-danger btn">删除本条数据</a>
    <button class="btn" data-dismiss="modal" aria-hidden="true" >关闭</button>
    <button class="btn btn-primary" id="btn_save_company">保存</button>
  </div>
</div>

<div id="a_delete__customer_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel_linkman">删除客户



    </h3>
  </div>
  <div class="modal-body">
                <div class="control-group">
                    <h3>确定要删除编号为{{customer.customer_id}}的客户？</h3>
                    <!-- /controls -->
                </div>



  </div>
  <div class="modal-footer">
  <a href="javascript:void(0)" id="customer_delete" class="btn-danger btn">删除客户</a>
    <button class="btn" data-dismiss="modal" aria-hidden="true" >关闭</button>
  </div>
</div>


<div id="a_add_acc_name_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel_linkman">增加历史会计客服
    </h3>
  </div>
  <div class="modal-body">
    <div class="control-group">
                          <label class="control-label" for="username">名称</label>
                          <div class="controls">
                              <input type="text" class="span4 " id="acc_name" name="acc_name" value="">
                              <p id="msg_name" class="help-block" style="color:red"></p>
                          </div>
                          <!-- /controls -->
                      </div>
                      <!-- /control-group -->




                <div class="control-group">
                    <label class="control-label" for="lastname">备注</label>
                    <div class="controls">
                        <textarea type="text" class="span4" id="acc_remark" name="acc_remark" value="" style="height: 50px;"></textarea>
                    </div>
                    <!-- /controls -->
                </div>



  </div>
  <div class="modal-footer">
  <a href="javascript:void(0)" id="btn_delete_acc" class="btn-danger btn">删除本条数据</a>
    <button class="btn" data-dismiss="modal" aria-hidden="true" >关闭</button>
    <button class="btn btn-primary" id="btn_save_acc">保存</button>
  </div>
</div>

<div class="modal hide fade" id="modal_note" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-header" >
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3 id="projects_note">增加交代事项
      </h3>
        </div>


        <div class="modal-body" id="site_mod">
          <div class="control-group" id='projects_note_confirm_content'>
            {%if role!='6'%}
            {%for item in project_note_unread%}

            <span class="clearfix  z-1">
<input type="checkbox" value={{item.id}} name="check_note" checked>
 <b>{{item.uid_name}} ({{item.creatd_at}} )</b> :<span style="font-size:20px; color:red;"> <b>{{item.msg}}</b>


            </span>

            {%end%}
            {%end%}
            <span id="not_project_note" style="display: none;">还没有哦</span>
             </div>

      <div class="control-group" id='projects_note_content'>
      <label for="inputEmail3" class="col-sm-5 control-label">交代内容</label>
      <div class="controls">
        <textarea id='note_content' class="span4" class="form-control" type="text" name="note_content" rows="3"></textarea>
      </div>
    </div>
        </div>
        <div class="modal-footer">

          <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                   <button class="btn btn-primary modal_note_btn" target="_blank" id="btn_save_modal_note">保 存</button>

        </div>
      </div>

<div class="modal hide fade" id="add_express_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
          <div class="modal-header" >
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3 id="projects_note">发起快递申请
                <a class="btn btn-info btn-sm" id="choose_cutomer_addr_msg" href="javascript:void(0);">选择收件人信息</a>
                <a class=" btn btn-danger btn-sm" id="delete_express" href="javascript:void(0);">删除</a>           
              </h3>
              </div>


              <div class="modal-body" id="site_mod">
                <div class="control-group">
                  <label for="inputEmail3" class="col-sm-5 control-label" id="l_rec_name">收件人</label>
            <div class="controls">
                <input class="form-control" name="rec_name" id="rec_name" type="text"  value="{%if  customer.reg_person%}
                      {{customer.reg_person}}{%end%}">
                      <div class="alert alert-danger" role="alert" style="display:none;" id="er_rec_name">
            </div>
                   </div>
            </div>
            <div class="control-group" >
            <label for="inputEmail3" class="col-sm-5 control-label" id="l_rec_tel">收件人电话</label>
            <div class="controls">
                <input class="form-control" name="rec_tel" id="rec_tel" type="text"  value="{%if  customer.reg_number%}
                {{customer.reg_number}}{%else%}无{%end%}">
                <div class="alert alert-danger" role="alert" style="display:none;" id="er_rec_tel">
                  </div>
            </div>
          </div>
          <div class="control-group" >
              <label for="inputEmail3" class="col-sm-5 control-label" id="l_rec_addr">收件人地址</label>
              <div class="controls">
                  <input class="form-control" style="width:100%;" name="rec_addr" id="rec_addr" type="text" value="{%if  customer.reg_addr%}
                  {{customer.reg_addr}}{%end%}">
                  <input type="checkbox" name="save_customer_add_msg" value="1" checked style="display:none;">
                  <span hidden>收件人信息存入系统</span>
                  <div class="alert alert-danger" role="alert" style="display:none;" id="er_rec_addr">
                    </div>
              </div>
            </div>
            <div class="control-group" >
                <label for="inputEmail3" class="col-sm-5 control-label">交接明细</label>
                <input type="checkbox" name="allcheck_express" id="allcheck_express"/>全选
                <div class="controls">
                    {% for item in t_projects_type%}
                    <input type="checkbox" style="margin:0 0 0 10px;" name="rec_file" id="rec_file_{{item.id}}"
                    income_name="{{item.income_name}}" value="{{item.id}}"
                     >{{item.income_name}}
                     {%if item.id==176 or item.id==209 %}
                     <br><hr>
                     {%end%}
                    {%end%}
                </div>
              </div>
              <div class="control-group" >
                  <label for="inputEmail3" class="col-sm-5 control-label">其他资料</label>

                  <div class="controls">
                      <textarea type="text" style="width:100%;"  class="form-control" id="other_rec_file" name="other_rec_file" value="" style="height: 60px;"></textarea>
                      <div class="alert alert-danger" role="alert" style="display:none;" id="er_other_rec_file">
                      </div>
                    </div>
                </div>
                <div class="control-group" >
                    <label for="inputEmail3" class="col-sm-5 control-label">公司名称</label>

                    <div class="controls">
                        <input class="form-control" name="rec_company" id="rec_company" type="text" value="{%if customer.company%}
                        {{customer.company}}{%else%}无{%end%}">
                        <div class="alert alert-danger" role="alert" style="display:none;" id="er_rec_company">
                          </div>
                    </div>
                  </div>
                  <div class="control-group" >
                      <label for="inputEmail3" class="col-sm-5 control-label">快递单号</label>

                      <div class="controls">
                          <input class="form-control" id="express_number" >
                          <div class="alert alert-danger" role="alert" style="display:none;" id="er_express_number">
                          </div>
                      </div>
                    </div>
                    <div class="control-group" >
                        <label for="inputEmail3" class="col-sm-5 control-label">快递类型</label>

                        <div class="controls">
                            <select  name="express_type" class="form-control" id="express_type">
                                {% for item in express_type%}
                                <option value="{{item.id}}">{{item.income_name}}</option>
                                {%end%}
                              </select>
                        </div>
                      </div>
                      <div class="control-group" >
                          <label for="inputEmail3" class="col-sm-5 control-label">快递付费</label>

                          <div class="controls">
                              <select  name="payment_type" class="form-control" id="payment_type">
                                  {% for item in payment_type%}
                                  <option value="{{item.id}}">{{item.income_name}}</option>
                                  {%end%}
                                </select>
                          </div>
                        </div>
                        <div class="form-group" id="created_send_div">
                            <div class="col-sm-10">
                                <label for="recode" id='l_created_send_at'>发件时间</label>
                                <input class="form-control" name="created_send_at" id="created_send_at" type="text">
                                <div class="alert alert-danger" role="alert" style="display:none;" id="er_created_send_at">
                                  </div>
                              </div>
                            </div>
                        <div class="control-group" >
                            <label for="inputEmail3" class="col-sm-5 control-label" id="l_send_name">发件人</label>

                            <div class="controls">
                                <input class="form-control" name="send_name" id="send_name" type="text"  value="{{name}}" data-provide="typeahead"  data-provide="typeahead" data-items="6" data-source="[{%for idx,item in enumerate(t_user)%}&quot;{{item.name}}&quot;{%if idx==len(t_user)-1%}{%break%}{%else%},{%end%}{%end%}]">
                                <div class="alert alert-danger" role="alert" style="display:none;" id="er_send_name">
                                  </div>
                            </div>
                          </div>
                          <div class="control-group" >
                              <label for="inputEmail3" class="col-sm-5 control-label">备注</label>

                              <div class="controls">
                                  <textarea class="form-control" name="express_remark" id="express_remark" type="text" ></textarea>
                              </div>
                            </div>
              </div>
              <div class="modal-footer">
                  <div class="alert alert-danger" role="alert" style="display:none;" id="er_express">
                      已审核不能修改
                    </div>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                         <button class="btn btn-primary modal_note_btn" target="_blank" id="btn_save_express">保 存</button>

              </div>
            </div>

                  <div class="modal hide fade" id="choose_customer_addr_msg_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                      <div class="modal-header" >
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h3 id="projects_note">选择 寄/收 件人信息
                        </h3>
                          </div>

                  <div class="modal-body" id="site_mod">
                    {% for item in t_cutomer_addr_msg%}
                    <div class="control-group">

                        <input type="radio" name="choose_customer_addr" c_name="{{item.name}}" addr="{{item.addr}}" tel="{{item.tel}}">{{item.name}}<br>
                        {{item.addr}} {{item.tel}}

                  </div>
                  {%end%}
                </div>
                <div class="modal-footer">

                    <button class="btn btn-primary" target="_blank" id="btn__save_customer_addr_msg">填入</button>

         </div>
                  </div>


<div class="modal hide fade" id="check_express_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                <div class="modal-header" >
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                  <h3 id="projects_note">审核快递
                  </h3>
                    </div>


                    <div class="modal-body" id="site_mod">
                      <div class="control-group">

                  <div class="controls">
                      <input type="radio" id="accept_state" name="accept_state" value="1">通过
                  <input type="radio" id="accept_state" name="accept_state" value="2">不通过
                  <div class="alert alert-danger" role="alert" style="display:none;" id="er_accept_state">
                         </div>
                  </div>
                  </div>
                  <div class="control-group" >
                  <label for="inputEmail3" class="col-sm-5 control-label">备注</label>
                  <div class="controls">
                      <textarea class="form-control" id="accept_uid_remark" ></textarea>
                      <div class="alert alert-danger" role="alert" style="display:none;" id="er_accept_uid_remark">
                  </div>
                </div>
                </div>
                  </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                               <button class="btn btn-primary modal_note_btn" target="_blank" id="btn_check_express">保 存</button>

                    </div>

  </div>
  <div class="modal hide fade" id="express_filepath_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
      <div class="modal-header" >
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="projects_note">附件
        </h3>
          </div>


          <div class="modal-body" id="site_mod">
            <div class="control-group">

                <label class="control-label file_label" for="lastname" >上传附件</label>
                <div class="controls">
                    <a href="javascript:;" class="file">选择文件
                  <input type="file" accept="image/*" multiple=""  id="uploaderInput">
                  </a>
                  <div class="alert alert-danger" id='er_uploaderInput' style="display:none;">请选择上传附件</div>
                  <ul id="uploaderFiles"></ul>
                  <hr class="my-0 file_label">
                  <label class="control-label" for="lastname">已上传附件</label>
                  <ul id="showFiles"></ul>
        </div>

        </div>
        </div>
          <div class="modal-footer">
              <input type="hidden" value="0" id="is_other" name="is_other" />
              <button class="btn btn-primary" target="_blank" id="btn_express_filepath">上传</button>

          </div>

</div>
<div class="modal hide fade" id="merge_customer_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-header" >
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3 id="projects_note">合并客户
      </h3>
        </div>


        <div class="modal-body" id="site_mod">
          <div class="control-group">

              <label class="control-label file_label" for="lastname" >需要合并的客户编号</label>
              <div class="controls">
                <input type="text" placeholder="客户编号" id="merege_id" class="form-control">
                <a href="javascript:void(0);" class="btn btn-info" style="margin-top: -7px;" id="search_merge_id">查询</a>
      </div>
      </div>
      <div class="control-group">
          <div class="controls">
            <div id="show_search_customer"></div>
          </div>
      </div>
       
</div>
<div class="modal-footer">
    <input type="hidden" value="0" id="is_other" name="is_other" />
    <button class="btn btn-primary" target="_blank" id="btn_merge_customer">合并</button>

</div>
</div>
<div class="modal hide fade" id="merge_customer_modal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-header" >
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3 id="projects_note">转移财务信息
      </h3>
        </div>


        <div class="modal-body" id="site_mod">
          <div class="control-group">

              <label class="control-label file_label" for="lastname" >客户编号</label>
              <div class="controls">
                <input type="text" placeholder="客户编号" id="merege_id1" class="form-control">
                <a href="javascript:void(0);" class="btn btn-info" style="margin-top: -7px;" id="search_merge_id1">查询</a>
      </div>
      </div>
      <div class="control-group">
          <div class="controls">
            <div id="show_search_customer1"></div>
          </div>
      </div>
       
</div>
<div class="modal-footer">
    <input type="hidden" value="0" id="is_other" name="is_other" />
    <button class="btn btn-primary" target="_blank" id="btn_merge_customer1">转移</button>

</div>
</div>

<div class="modal hide fade" id="genjin_type_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-header" >
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3 id="projects_note">选择类别
      </h3>
        </div>


        <div class="modal-body" id="site_mod">
          <div class="control-group">
              <select name="" id="genjin_type1" class="form-control">
                  <option value="">选择类别</option>
                  <option value="1">日常跟进</option>
                  <option value="2">定期总结登记</option>
                  <option value="7">风险登记</option>
                  {%if customer.acc_uid!=int(uid)%}
                  <option value="5">催款登记</option>
                  {%else%}
                  <option value="6">会计建议</option>
                  {%end%}
                  <option value="4">其他登记</option>
                </select>
            
      </div>
      </div>

<div class="modal-footer">
    <button class="btn btn-primary" id="btn_submit_msg1" msg_modal='1' target="_blank" >确认</button>

</div>
</div>
<div id="upload_file_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3 id="myModalLabel">上传附件
  
  
      </h3>
    </div>
    <div class="modal-body">
      <div class="control-group">
      
        <div class="controls">
            <div id="dropzone_upload" class="dropzone" >

              </div>
        </div>
        <!-- /controls -->
      </div>
      <!-- /control-group -->
  
  

  
  

  
    </div>
  
  
  
    <div class="modal-footer">
      <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
      <button class="btn btn-primary" aria-hidden="true" data-dismiss="modal">保存</button>
    </div>
  </div>
    {%end%}

    {% block  js %}

    <script src="/static/dropzone.js"></script>
    <script src="/static/dropzone-amd-module.js"></script>

    <script>

    Dropzone.autoDiscover = false;
    
var myDropzone =new Dropzone("#my-dropzone",{
//指定上传图片的路径
url: "/customer?tag=upload",
dictDefaultMessage:"请点击选择文件或拖动文件到本区域",
//添加上传取消和删除预览图片的链接，默认不添加
addRemoveLinks: true,

//关闭自动上传功能，默认会true会自动上传
//也就是添加一张图片向服务器发送一次请求
autoProcessQueue: false,

//允许上传多个照片
uploadMultiple: true,

//每次上传的最多文件数，经测试默认为2，坑啊
//记得修改web.config 限制上传文件大小的节
parallelUploads: 100,
paramName:'file',
init: function () {
    var submitButton = document.querySelector("#btn_save_file")
    myDropzone = this; // closure

    //为上传按钮添加点击事件
    submitButton.addEventListener("click", function () {
        var file_title = $("#file_title").val()
        if(file_title==""){
                  $("#msg_file_title").text('文件内容说明不能为空哦。')

              }else{
        //手动上传所有图片
                myDropzone.processQueue();  
              }
      
    });

    //当添加图片后的事件，上传按钮恢复可用
    this.on("addedfile", function (file) {
      $("#file_title").val(file.name)
        $("#btn_save_file").removeAttr("disabled");
    });
    this.on("sending", function(file, xhr, formData) {
            var file_title = $("#file_title").val()
            var file_remark = $("#file_remark").val()
            formData.append("customer_id","{{ customer.customer_id }}")
            formData.append("file_title", file_title)
            formData.append("file_remark", file_remark)
            formData.append('_xsrf', _xsrf);

            console.log(formData)
            });
    //当上传完成后的事件，接受的数据为JSON格式
    this.on("complete", function (data) {

                   location.reload()

        // if (this.getUploadingFiles().length === 0 && this.getQueuedFiles().length === 0) {
          
        //     location.reload()
         
           
        // }
    });

    //删除图片的事件，当上传的图片为空时，使上传按钮不可用状态
    this.on("removedfile", function () {
        if (this.getAcceptedFiles().length === 0) {
            $("#btn_save_file").attr("disabled", true);
        }
    });
}
}) ;
        
        
        $(function(){

            $('#a_{{to_tag}}').tab('show');
            $('#a_{{gen_tag}}').tab('show');
            $("#btn_{{etax_tag}}").tab('show');
           _xsrf = getCookie("_xsrf")
           var tmpl = '<br><li style=" width:100%;height:20px;background-image:url(#url#); background-size:15px 10px;display:block;">#url1#</li>',
    all_files=[]
    $gallery = $("#gallery"),
    $galleryImg = $("#galleryImg"),
    $uploaderInput = $("#uploaderInput"),
    $uploaderFiles = $("#uploaderFiles");
    $uploaderInput.on("change", function(e) {
                var src, url = window.URL || window.webkitURL || window.mozURL,
                files = e.target.files;
                for(var i = 0, len = files.length; i < len; ++i) {
                    var file = files[i];
                    if(url) {
                        // src = url.createObjectURL(file);
                        src=file.name;
                    } else {
                        src = e.target.result;
                    }

                    $uploaderFiles.append($(tmpl.replace('#url1#', src)));
                    all_files.push(file)
                }

            });

laydate.render({
                    elem: '#acc_end' //指定元素
                   
                  
           });
           laydate.render({
                    elem: '#reg_date' //指定元素
                   
                  
           });
            
           laydate.render({
                    elem: '#get_date_start'    
                    ,type: 'month' 
           });
                       
           laydate.render({
                    elem: '#get_date_end'  
                    ,type: 'month'   
           });
           var customer_id = "{{ customer.customer_id }}"
           var customer_guid = "{{customer.guid}}"
           $("#customer_delete").on("click",function(){


                if(confirm("确认删除客户的所有信息么？数据")){

                  if (confirm("请再确认删除？")) {
                    $.post("/customer?tag=delete_customer", { "_xsrf": _xsrf, "customer_id": customer_id, "guid": customer_guid }, function (result) {

                        alert("删除成功！")
                        location.href="/customer";
                    })
                  }
                }


           })


      laydate.render({
                    elem: '#tran_at' //指定元素
           }); laydate.render({
                    elem: '#created_send_at' //指定元素
           });

      $(".modify_transition_mobile").on("click",function(){
          transition_id = $(this).attr("transition_id")
          $.get("customer?tag=qrcode",{"id":customer_id,"guid":customer_guid,"trans_id":transition_id,"qtag":"trans"},function(result){
              $("#show_qrcode").html(result)
          })
            $("#a_add_trans_modal_upload").modal('show')
      })
      $(".modify_transition").on("click",function(){
          $("#delete_transition").show()
          var tran_by = $(this).attr("tran_by")
          var rec_by = $(this).attr("rec_by")
          var tran_at = $(this).attr("tran_at")
          var trans_remark =$(this).attr("remark")
          var transition_id = $(this).attr("transition_id")
          $("#tran_by").val(tran_by)
          $("#rec_by").val(rec_by)
          $("#tran_at").val(tran_at)
          $("#trans_remark").val(trans_remark)
          $("#myModalLabel_trans").text("修改交接信息")
          $("#btn_save_trans").attr("transition_id",transition_id)

          $("#a_add_trans_modal").modal('show')

      })
      // $("#zone_anqi").show()
      // $("#zone_history").hide()
      // $("#btn_etax_anqi").on("click",function(){
      //     $("#zone_anqi").show()
      //     $("#zone_history").hide()
      //     $("#btn_etax_anqi").removeAttr("class","btn btn-primary")
      //     $("#btn_etax_anqi").addClass("btn btn-primary")
      //     $("#btn_etax_history").removeAttr("class","btn btn-primary")
      //     $("#btn_etax_history").addClass("btn btn-info")
      // })

      // $("#btn_etax_history").on("click",function(){

      //     $("#zone_history").show()
      //     $("#zone_anqi").hide()
      //     $("#btn_etax_history").removeAttr("class","btn btn-primary")
      //     $("#btn_etax_history").addClass("btn btn-primary")
      //     $("#btn_etax_anqi").removeAttr("class","btn btn-primary")
      //     $("#btn_etax_anqi").addClass("btn btn-info")

      // })


      $("#delete_transition").on("click",function(){
          if(confirm("确认删除吗？")){
            transition_id = $("#btn_save_trans").attr("transition_id")
            $.post("transition?tag=delete",{"transition_id":transition_id,"_xsrf":_xsrf,"customer_id":customer_id},function(result){
                alert("删除成功")
                location.reload()


            })

            }
      })
      $("#a_add_trans").on("click", function () {
        $("#delete_transition").hide()
        $("#btn_save_trans").attr("transition_id","0")
          $("#tran_by").val("")
          $("#rec_by").val("")
           $("#tran_at").val("")
           $("#trans_remark").val("")
          $("#a_add_trans_modal").modal('show')
        })


         $(".acc_modify").on("click",function(){
            var acc_name = $(this).attr("acc_name")

            var acc_remark =  $(this).attr("acc_remark")
            var acc_id = $(this).attr("acc_id")
            $("#btn_save_acc").attr("acc_id",acc_id)
            $("#btn_delete_acc").attr("acc_id",acc_id)
            $("#btn_delete_acc").show()
            $("#acc_name").val(acc_name)
            $("#acc_remark").val(acc_remark)

            $("#a_add_acc_name_modal").modal('show')

        })


        $("#a_add_acc").on("click",function(){
            $("#acc_name").val("")
            $("#acc_remark").val("")
            $("#btn_save_acc").attr("acc_id","0")
            $("#btn_delete_acc").hide()
            $("#btn_delete_acc").attr("acc_id",0)
            $("#a_add_acc_name_modal").modal('show')
        })
      $("#btn_delete_acc").on("click",function(){
          if(confirm("确认删除吗？")){
                acc_id = $(this).attr("acc_id")
                $.post("customer?tag=delete_acc",{"acc_id":acc_id,"_xsrf":_xsrf,"customer_id":customer_id},function(result){
                    alert("删除成功")
                    location.reload()

                })

            }
        })

      $("#btn_save_acc").on("click",function(result){
          acc_id = $("#btn_save_acc").attr("acc_id")
          acc_name = $("#acc_name").val()
          acc_remark = $("#acc_remark").val()
          $.post("/customer?tag=add_acc",{"_xsrf":_xsrf,"acc_id":acc_id,customer_id:customer_id,
          "acc_name":acc_name,"acc_remark":acc_remark},function(result){

             location.reload()
          })
      })




        $("#a_add_company_name").on("click",function(){
            $("#company_name").val("")
            $("#company_remark").val("")
            $("#btn_save_company").attr("company_id","0")
            $("#btn_delete_company").hide()
            $("#btn_delete_company").attr("company_id",0)
            $("#a_add_company_name_modal").modal('show')
        })

      $("#btn_delete_company").on("click",function(){
          if(confirm("确认删除吗？")){
                company_id = $(this).attr("company_id")
                $.post("customer?tag=delete_company",{"company_id":company_id,"_xsrf":_xsrf,"customer_id":customer_id},function(result){
                    alert("删除成功")
                    location.reload()

                })

            }
        })
         $(".company_modify").on("click",function(){
            var company_name = $(this).attr("company_name")

            var company_remark =  $(this).attr("company_remark")
            var company_id = $(this).attr("company_id")
            $("#btn_save_company").attr("company_id",company_id)
            $("#btn_delete_company").attr("company_id",company_id)
            $("#btn_delete_company").show()
            $("#company_name").val(company_name)
            $("#company_remark").val(company_remark)

            $("#a_add_company_name_modal").modal('show')

        })

      $("#btn_save_company").on("click",function(result){
          company_id = $("#btn_save_company").attr("company_id")
          company_name = $("#company_name").val()
          company_remark = $("#company_remark").val()
          $.post("/customer?tag=add_company",{"_xsrf":_xsrf,"company_id":company_id,customer_id:customer_id,
          "company_name":company_name,"company_remark":company_remark},function(result){

            location.reload()
          })
      })


      $("#btn_save_trans").on("click",function(result){
          var tran_by = $("#tran_by").val()
          var rec_by = $("#rec_by").val()
          var tran_at = $("#tran_at").val()
          var trans_remark =$("#trans_remark").val()
          var transition_id =  $("#btn_save_trans").attr("transition_id")

          var formData = new FormData();
          formData.append('file', $('#tran_file')[0].files[0]);
          formData.append('_xsrf', _xsrf)
          formData.append("remark", trans_remark)
          formData.append("tran_at", tran_at)
          formData.append("tran_by", tran_by)
          formData.append("rec_by", rec_by)
          formData.append("customer_id", customer_id)
          formData.append("transition_id", transition_id)

          //$(this).text("保存中..")
          // $(this).attr("disabled", "disabled")

          $.ajax({
                url: '/transition?tag=add',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (data) {

                    location.reload()

                }
              });

      })
         
         $(".gj_msg").on("click",function(){
              genjin_type = $(this).attr("genjin_type")
              msg = $(this).attr("msg")
              msg_id = $(this).attr("msg_id")
              customer_id= $(this).attr("customer_id")
             
              if ($(this).text()=="保存"){
                $("#p_msg_"+msg_id).show()
                $("#p_msg_edit_"+msg_id).hide()
                msg = $("#genjin_msg_"+msg_id).val()
                $("#p_msg_"+msg_id).text(msg)
               
                $.post("/customer?tag=modify_genjin_msg",{"msg":msg,"msg_id":msg_id,"customer_id":customer_id,"_xsrf":_xsrf},function(result){
                    if(result=="0"){
                        self.write("0")
                    }else{
                        alert("更新失败, 请重新再试.")
                        location.reload()
                    }
                })
                 $(this).text("修改")
                // $(this).attr("class","btn btn-mini  gj_msg")
              }else{
                $("#p_msg_"+msg_id).hide()
                $("#p_msg_edit_"+msg_id).show()
                $(this).text("保存")
                // $(this).attr("class","btn btn-mini gj_msg")
              }

         })


   $(".gj_msg_delete").on("click",function(result){
              msg_id = $(this).attr("msg_id")
              customer_id= $(this).attr("customer_id")
            if(confirm("确认删除吗?")){

           
            $.post("/customer?tag=modify_genjin_delete",{"msg_id":msg_id,"customer_id":customer_id,"_xsrf":_xsrf},function(result){
                    if(result=="0"){
                    $("#show_msg_gj_"+msg_id).hide()
                    location.reload()
                    }else{
                        alert("更新失败, 请重新再试.")
                        location.reload()
                    }
                })

                 }
      })



           $("#a_add_project").on("click",function(){
                $("#add_project_modal").modal('show')
           })

          $("#a_add_account").on("click",function(){
            $("#btn_save_account").attr("account_id","0")
            $("#account").val("")
            $("#psw").val("")
            $("#delete_account").hide()
            $("#a_add_account_modal").modal('show')
          })

          $("#delete_account").on("click",function(){
            var account_id = $("#btn_save_account").attr("account_id")

            if(confirm("确认删除吗？")){
              $.post("/customer?tag=delete_account",{"account_id":account_id,"customer_id":customer_id,"_xsrf":_xsrf},function(result){
                  alert("删除成功！")
                  location.reload()
              })
            }
          })

          $(".modify_account").on("click",function(){
              var account_id = $(this).attr("account_id")
              var account = $(this).attr("account")
              var psw = $(this).attr("psw")
              var remark = $(this).attr("remark")
              var type_id = $(this).attr("type_id")
            $("#delete_account").show()
              $("#psw").val(psw)
              $("#remark").val(remark)
              $("#account").val(account)

              $('input[name=type_id]').each(function() {
                if($(this).val()==type_id) {
                    $(this).attr("checked","true")
                }
              });

               $("#btn_save_account").attr("account_id",account_id)
$("#a_add_account_modal").modal('show')


          })


          $("#btn_save_account").on("click",function(){
              var type_id = $("input[name=type_id]:checked").val()
              var type_id_name = $("input[name=type_id]:checked").attr("title")
              var account = $("#account").val()
              var psw = $("#psw").val()
              var account_id = $(this).attr("account_id")
              var account_remark = $("#account_remark").val()
              if(type_id==undefined){
                  $("input[name=type_id]:first").focus()
                  $("#msg_type_id").text("类型要选择哦。")
              }
              else if(account==""){
                  $("#account").focus()
                  $("#msg_account").text("帐号要填写哦。")
              }
              else if(psw==""){
                  $("#psw").focus()
                  $("#msg_psw").text("密码要填写哦。")
              }else{
                  $.post("/customer?tag=add_customer_account",{"_xsrf":_xsrf,"customer_id":customer_id,
                  "type_id":type_id,"type_id_name":type_id_name,
                  "remark":account_remark,
                  "account":account,"psw":psw},function(result){


                      location.reload()
                  })

              }
          })


           $("#a_add_file").on("click", function () {
            $("#a_add_file_modal").modal('show')
          })

           $("#btn_save_file").on("click",function(){

              var file_title = $("#file_title").val()
              var file_remark = $("#file_remark").val()
              if(file_title==""){
                  $("#msg_file_title").text('文件内容说明不能为空哦。')

              }
              else{
                var formData = new FormData();
                formData.append('file', $('#file')[0].files[0]);
                formData.append('_xsrf', _xsrf);
                formData.append("customer_id", customer_id)
                formData.append("file_title", file_title)
                formData.append("file_remark", file_remark)
                $(this).text("保存中..")
                $(this).attr("disabled", "disabled")

                $.ajax({
                      url: '/customer?tag=upload',
                      type: 'POST',
                      data: formData,
                      processData: false,  // tell jQuery not to process the data
                      contentType: false,  // tell jQuery not to set contentType
                      success: function (data) {
                        if (data > 0) {
                          location.reload()
                        }
                      }
                    });


              }

           })



           $("#query_project").on("click",function(){
                        var key = $("#key").val()
                   $.get("customer?tag=query_project",{"key":key},function(result){
                           $("#show_projects").html(result)
                   })


           })

           $("#btn_save_contract").on("click", function () {
            var contract_id= $("#btn_save_contract").attr("contract_id")
            var contract_title = $("#contract_title").val()
            var contract_start_time = $("#contract_start_time").val()
            var contract_end_time = $("#contract_end_time").val()
            var state_id = $("input[name=state_id]:checked").val()
            var contract_remark = $("#contract_remark").val()
            if (state_id == undefined) {
              $("#msg_state_id").text("要选择合同的状态哦。")
            } else if (contract_title == "") {
              $("#contract_title").text("要写合同摘要哦。")
            } else if (contract_start_time == "") {
              $("#msg_contract_start_time").text("要写合同开始时间哦。")
            } else if (contract_end_time == "") {
              $("#msg_contract_end_time").text("要写到期时间哦。")
            } else {
              $.post("/contract?tag=add", {
                "_xsrf": _xsrf,
                "customer_id": customer_id,
                "contract_start_time": contract_start_time,
                "contract_remark": contract_remark,
                "contract_title": contract_title,
                "contract_end_time": contract_end_time,
                "state_id": state_id,
                "contract_id": contract_id
              }, function (result) {
              location.reload()
              })
            }

          })

        $("#a_add_contract").on("click",function(){
          $("#myModalLabel_contract").text("增加合同")
          $("#contract_title").val("")
         $("#contract_start_time").val("")
         $("#contract_end_time").val("")
      $("#btn_save_contract").attr("contract_id", 0)
      $("#delete_contract").attr("contract_id", "0")
          var contract_remark = $("#contract_remark").val("")
            $("#add_contract_modal").modal("show")
           $("#delete_contract").hide()
        })

        laydate.render({
          elem: '#contract_end_time' //指定元素
        });
         laydate.render({
                    elem: '#contract_start_time' //指定元素
           });


        $(".modify_contract").on("click", function () {
          $("#myModalLabel_contract").text("修改合同")
          var contract_id = $(this).attr("contract_id")
          var contract_title = $(this).attr("title")
          var contract_start_time =  $(this).attr("start_time")
          var contract_end_time =  $(this).attr("end_time")
          /* var state_id = $("input[name=state_id]:checked").val() */
          var contract_remark =  $(this).attr("contract_remark")
          $("#contract_title").val(contract_title)
           $("#contract_end_time").val(contract_end_time)
          $("#contract_start_time").val(contract_start_time)
          $("input[name=state_id][value='"+$(this).attr('state_id')+"']").prop('checked',true)
          $("#btn_save_contract").attr("contract_id", contract_id)
          $("#delete_contract").show()
            $("#delete_contract").attr("contract_id",contract_id)



          $("#add_contract_modal").modal("show")

        })


        $("#delete_contract").on("click",function(){
           var contract_id = $(this).attr('contract_id')
            if(confirm("确认删除吗？")){
                $.post("contract?tag=delete",{"_xsrf": _xsrf,"contract_id": contract_id,customer_id:customer_id},function(result){
                    alert("删除成功！")
                    location.reload()
                })

            }
        })


        $("#delete_linkman").on("click",function(){
           var linkman_id = $(this).attr('linkman_id')
           var linkman_guid = $(this).attr('linkman_guid')

            if(confirm("确认删除吗？")){
                $.post("linkman?tag=delete",{"_xsrf": _xsrf,"id": linkman_id,"guid":linkman_guid},function(result){
                    alert("删除成功！")
                    location.reload()
                })

            }
        })


            $("#a_add_linkman").on("click", function () {
              $("#delete_linkman").attr("id", 0)
              $("#delete_linkman").attr("guid", "")
              $("#delete_linkman").hide()
              $("#btn_save_linkman").removeAttr('linkman_id')
              $("#tel").val("")
              $("input[type=radio]").filter('[value="1"]').attr("checked",true)
              $("#is_first").prop('checked',false)
              $("#name").val(name)
              $("#add_linkman_modal").modal('show')
            })


        $(".modify_linkman").on("click",function(){
          var linkman_guid  = $(this).attr("linkman_guid")

          var linkman_id = $(this).attr("linkman_id")

          var linkman_remark = $(this).attr("remark")
          var tel = $(this).attr('tel')
          var name = $(this).attr("title")
          var gender = $(this).attr('gender')
          var is_first=$(this).attr('is_first')
          $("#delete_linkman").attr("linkman_id",linkman_id)
          $("#delete_linkman").attr("linkman_guid",linkman_guid)
          $("#delete_linkman").show()
          $("#btn_save_linkman").attr("linkman_id",linkman_id)
          $("#tel").val(tel)
          $("input[type=radio]").filter('[value="'+gender+'"]').attr("checked",true)
          $("#name").val(name)
          $("#linkman_remark").val(linkman_remark)
          $("#is_first").prop('checked',false)
          if(is_first=='1'){
            $("#is_first").prop('checked',true)
          }


          $("#add_linkman_modal").modal('show')



        })
        $("#btn_save_linkman").on("click",function(){
            var gender = $("input[name=gender]:checked").val()
            var name = $("#name").val()
            var tel = $("#tel").val()
            var remark = $("#linkman_remark").val()
            var is_first=$('#is_first:checked').val()
            var linkman_id=$(this).attr('linkman_id')
            if (name==""){
              $("#msg_name").text("客户的名字必须要填写哦。")
               $("#name").focus()
              return false

            }else if(gender==undefined){
              $("#msg_gender").text("请选择客户的性别")
               $("input[name=gender]").focus()
              return false
            }

            else{
                $.post("/linkman?tag=add",{"_xsrf":_xsrf,"customer_id":{{customer.customer_id}},"tel":tel,"name":name,"remark":remark,"gender":gender,"is_first":is_first,"linkman_id":linkman_id},function(result){

                  location.reload()

                })

            }


        })
          //  document.getElementById("file").addEventListener("change", function (evt) {

          //    $("#file_title").val(evt.target.files[0].name)
          //   });


     /*     $(".modify_linkman").on("click",function(){


          id = $("#delete_linkman").attr("id")
          guid = $("#delete_linkman").attr("guid")



        })


              $.post("/linkman?tag=delete",{"_xsrf":_xsrf,"id":id,"guid":guid},function(result){
              alert(result)
          })*/
           $(".delete_relation_project").on("click",function(){
             if(confirm("确认删除业务关系吗？")){
                  project_id = $(this).attr("title")
                  $.post("/customer?tag=del_relation_project",{"_xsrf":_xsrf,"project_id": project_id,"customer_id":customer_id},function(result){
                      location.reload()
                  })

                }
           })
            $(".delete_file").on("click", function () {
              if (confirm("确认删除相关文件吗？")) {
                file_id = $(this).attr("title")
                $.post("/customer?tag=delete_file", { "_xsrf": _xsrf, "file_id": file_id, "customer_id": customer_id }, function (result) {
                  location.reload()
                })

              }
            })



           $(".delete_relation_linkman").on("click",function(){
             if(confirm("确认删除客户联系人吗？")){
                  id  = $(this).attr("title")
                  guid =$(this).attr("guid")
                  $.post("/linkman?tag=delete",{"_xsrf":_xsrf,"id": id,"guid":guid},function(result){
                      location.reload()
                  })

                }
           })



           $("#btn_save_project").on("click",function(){

                var choice_pid = $("input[name=project_choice]:checked").val()

                if(choice_pid==undefined){
                        alert("请选择业务")
                        return false
                }else{
                    $.post("customer?tag=relation_project",{"customer_id":customer_id,"project_id":choice_pid,"_xsrf":_xsrf},function(result){

                            console.log(result)
                            location.reload()
                    })


                }
           })
        $('#delete_customer_btn').on('click',function(){
          $('#btn_delete_customer').attr('title',$(this).attr('title'));
          $('#a_delete__customer_modal').modal('show');
        })

        $("#a_add_note").on("click",function(){
          $("#projects_note").text('交代事项')
          $('.modal_note_btn').text('保存')
          $('.modal_note_btn').attr('id','btn_save_modal_note')
          $('.modal_note_btn').removeAttr('note_id')
          $('#note_content').val('');
          $('#projects_note_confirm_content').hide();
          $('#projects_note_content').show();
          $("#modal_note").modal("show")
})
        $("#a_read_note").on("click",function () {
          $("#projects_note").text('选择未读事项')
          $('.modal_note_btn').text('确定已读')
          $('.modal_note_btn').attr('id','btn_save_modal_note_confirm')
          $('#projects_note_content').hide();
          $('#projects_note_confirm_content').show();
          $("#modal_note").modal("show")
        })

      $('#btn_save_modal_note').on("click",function(){
        var note_content=$('#note_content').val();
        var note_id=$(this).attr('note_id');
        if(note_content!=''){
          $.post("customer?tag=customer_note",{"customer_id":customer_id,"note_id":note_id,"note_content":note_content,"_xsrf":_xsrf},function(result){
console.log(result)
location.reload()
})
        }
    })

      $('.a_change_note').on('click',function () {
        $('.checkdiv').hide();
        $("#projects_note").text('交代事项')
        $("#note_content").val($(this).attr('note'))
        $('.modal_note_btn').text('保存')
        $('.modal_note_btn').attr({'id':'btn_save_modal_note','note_id':$(this).attr('id')});
        $('#projects_note_confirm_content').hide();
        $('#projects_note_content').show();
        $("#modal_note").modal("show");
       })

       $(".a_delete_note").on("click",function () {
      id =  $(this).attr('id')
      if(confirm("确认删除吗？")){
        $.post(
          '/customer?tag=delete_note',
          {
            "_xsrf":_xsrf,
            'id':id
          },function (result) {
            alert('删除成功')
            location.reload()
           }
        )
      }
    })
    $('body').on('click','#btn_save_modal_note_confirm',function () {
        check_val=[]
        var obj=$('input[name=check_note]');
        for (k in obj){
          if(obj[k].checked){
            check_val.push(obj[k].value);
          }
        }
        check_val=check_val.join(',')

        $.post(
          '/customer?tag=customer_note_confirm',
          {
            'check_val':check_val,
            '_xsrf':_xsrf
          },function (result) {
            location.reload()
           }
        )
       })

      $('.cancel_note').on('click',function () {
         var note_id=$(this).attr('note_id')
         var is_cancel=$(this).attr('is_cancel')
         if(is_cancel==0){
          $.post(
            'customer?tag=customer_note',
            {
              'note_id':note_id,
              'is_cancel':1,
              "_xsrf":_xsrf
            },function (result) {
              location.reload()
             }
          )
        }else{
          $.post(
            'customer?tag=customer_note',
            {
              'note_id':note_id,
              'is_cancel':0,
              "_xsrf":_xsrf
            },function (result) {
              location.reload()
             }
          )
        }
        })

    if('{{customer.acc_uid_name}}'=='{{name}}'){
    obj=$('input[name=check_note]')
       if(obj.length<1){
        $('#not_project_note').show();
       }else{
        $("#a_read_note").click();
       }

    }
    $("#btn_save_msg").on("click",function(){
            msg = $("#txt_msg").val()
            if(msg==""){
                alert("交流记录不能为空哦.")
                return false
            }else{
              $(this).attr("disabled","disabled")
              var formData = new FormData();
              formData.append('file', $('#record_file')[0].files[0])
              formData.append('_xsrf', _xsrf)
              formData.append('msg',msg)
              formData.append('customer_id',customer_id)
                $.ajax({
                url: '/customer?tag=customer_exchange',
                type: 'POST',
                data: formData,
                processData: false,  // tell jQuery not to process the data
                contentType: false,  // tell jQuery not to set contentType
                success: function (data) {
                  location.href="/customer?tag=show&id="+customer_id+"&guid="+customer_guid+"&to_tag=exchange_tab"
                }
              })
            }


        })
$("#allcheck_express").on("change",function(){

$('input[name=rec_file]').not(this).prop('checked', this.checked);

})
$("#btn_add_express").on("click",function () {
  $('#l_rec_name').text('收件人')
  $('#l_rec_tel').text('收件人电话')
  $('#l_rec_addr').text('收件人地址')
  $('#l_send_name').text('发件人')
  $("#express_title").text('发起快递寄件申请')
  $('#choose_cutomer_addr_msg').text('选择收件人信息')
  $('#save_customer_add_msg').text('收件人信息存入系统')
  $("#customer_message_title").text("选择收件人信息")
  $("#l_created_send_at").text('发件时间')
    $("#created_send_at").val('')
  $('#btn_save_express').attr('send_or_rec','0')

  $("#er_express").hide()
  $('#btn_save_express').show()
  $('#btn_save_express').removeAttr('express_id')
  $('input[name=rec_file]').prop('checked', false)
  $('#other_rec_file').val('')
  $('#express_number').val('')
  $('#express_remark').val('')
  $("#er_rec_name").hide()
  $("#er_rec_tel").hide()
  $("#er_rec_addr").hide()
  $("#er_rec_company").hide()
  $('#er_express_number').hide()
  $("#er_send_name").hide()
  $("#delete_express").hide()
  $("#delete_express").removeAttr('express_id')
  $("#add_express_modal").modal("show")
 })

$("#btn_add_express_rec").on('click',function () {
      $('#l_rec_name').text('寄件人')
      $('#l_rec_tel').text('寄件人电话')
      $('#l_rec_addr').text('寄件人地址')
      $('#l_send_name').text('收件人')
      $("#express_title").text('发起快递收件申请')
      $('#choose_cutomer_addr_msg').text('选择寄件人信息')
      $("#customer_message_title").text("选择寄件人信息")
      $('#save_customer_add_msg').text('寄件人信息存入系统')
      $("#l_created_send_at").text('收件时间')
      $("#created_send_at").val('')
       $('#btn_save_express').attr('send_or_rec','1')
       $("#er_express").hide()
      $('#btn_save_express').show()
      $('#btn_save_express').removeAttr('express_id')
      $('input[name=rec_file]').prop('checked', false)
      $('#other_rec_file').val('')
      $('#express_number').val('')
      $('#express_remark').val('')
      $("#er_rec_name").hide()
      $("#er_rec_tel").hide()
      $("#er_rec_addr").hide()
      $("#er_rec_company").hide()
      $('#er_express_number').hide()
      $("#er_send_name").hide()
      $("#delete_express").hide()
      $("#delete_express").removeAttr('express_id')
      $("#add_express_modal").modal("show")
      })
 $("#btn_save_express").on("click",function(){
    var this_btn=$(this)
    var rec_name=$("#rec_name").val()
    var rec_tel=$("#rec_tel").val()
    var rec_addr=$("#rec_addr").val()
    var rec_company=$("#rec_company").val()
    var express_type_id=$("#express_type").val()
    var express_type_name=$("#express_type").find("option:selected").text()
    var send_name=$("#send_name").val()
    var payment_type_id=$("#payment_type").val()
    var payment_type_name=$("#payment_type").find("option:selected").text()
    var express_remark=$("#express_remark").val()
    var express_id=$(this).attr('express_id')
    var other_rec_file=$("#other_rec_file").val()
    var express_number=$("#express_number").val()
    var save_customer_add_msg=$('input[name=save_customer_add_msg]:checked').val()
    var send_or_rec=$(this).attr('send_or_rec')
    var created_send_at=$('#created_send_at').val()
    var type_names=[]
    var type_ids=[]
    $('input[name=rec_file]:checked').each(function () {
                type_ids.push($(this).val());
                type_names.push($(this).attr('income_name'))
           })
    type_ids=type_ids.join(',')
    type_names=type_names.join(',')
    if(rec_name==''){
      $('#rec_name').focus()
      $('#er_rec_name').text('收件人不能为空')
      $("#er_rec_name").show()
    }else if(rec_tel==''){
      $('#rec_tel').focus()
      $('#er_rec_tel').text('收件人电话不能为空')
      $("#er_rec_tel").show()
    }
    else if(rec_addr==''){
      $('#rec_addr').focus()
      $('#er_rec_addr').text('收件人地址不能为空')
      $("#er_rec_addr").show()
    }
    else if(type_ids=='' && other_rec_file.replace(/\r\n|\n|\s/g,'')==''){
      $('#er_other_rec_file').text('交接明细和其他资料需填其一')
      $("#er_other_rec_file").show()
    }
    else if(rec_company==''){
      $('#er_rec_company').text('公司名不能为空')
      $("#er_rec_company").show()
    }
    else if(express_number==''){
      $('#er_express_number').text('快递单号不能为空')
      $('#er_express_number').show()
    } else if(created_send_at=='' && send_or_rec=='0'){
      $('#er_created_send_at').text('发件时间不能为空')
      $('#er_created_send_at').show()
    }
    else if(send_name==''){
      $('#er_send_name').text('申请人不能为空')
      $("#er_send_name").show()
    }else{
      $(this).text('保存中...')
      $(this).attr('disabled','disabled')
    $.post("/project?tag=express",{
      'source':1,
      'rec_name':rec_name,
      'rec_tel':rec_tel,
      'rec_addr':rec_addr,
      'rec_company':rec_company,
      'express_type_id':express_type_id,
      'express_type_name':express_type_name,
      'send_name':send_name,
      'project_id':"{{customer.customer_id}}",
      'company':'{{customer.company}}',
      'payment_type_id':payment_type_id,
      'payment_type_name':payment_type_name,
      'express_remark':express_remark,
      'express_id':express_id,
      'other_rec_file':other_rec_file,
      'express_number':express_number,
      'rec_file_ids':type_ids,
      'rec_file':type_names,
      'guid':customer_guid,
      'save_customer_add_msg':save_customer_add_msg,
      '_xsrf':_xsrf,
      'send_or_rec':send_or_rec,
      'created_send_at':created_send_at
      },function (result) {
      if(result=='-3'){
          alert('寄/收 件人不存在系统中')
          this_btn.text('保存')
          this_btn.removeAttr('disabled')
        }else{
          location.reload()
        }

       })
          }
 })
 $(".edit_express").on("click",function () {
  $('input[name=rec_file]').prop('checked', false)
  type_ids_arr =$(this).attr('rec_file_ids').split(',')

  for (var i = 0; i < type_ids_arr.length; i++) {
    $('#rec_file_'+type_ids_arr[i]).prop('checked', true);

    }
    $('#created_send_at').val($(this).attr('created_send_at'))
    if($(this).attr('send_or_rec')=='1'){
      $('#l_rec_name').text('寄件人')
      $('#l_rec_tel').text('寄件人电话')
      $('#l_rec_addr').text('寄件人地址')
      $('#l_send_name').text('收件人')
      $('#save_customer_add_msg').text('寄件人信息存入系统')
      $('#choose_cutomer_addr_msg').text('选择寄件人信息')
      $("#l_created_send_at").text('收件时间')
    }
    else if($(this).attr('send_or_rec')=='0'){
      $('#l_rec_name').text('收件人')
      $('#l_rec_tel').text('收件人电话')
      $('#l_rec_addr').text('收件人地址')
      $('#l_send_name').text('发件人')
      $('#save_customer_add_msg').text('寄件人信息存入系统')
      $('#choose_cutomer_addr_msg').text('选择收件人信息')
      $("#l_created_send_at").text('发件时间')

    }
  $("#other_rec_file").val($(this).attr('other_rec_file'))
  $("#express_number").val($(this).attr('express_number'))
  $("#rec_name").val($(this).attr('rec_name'))
  $("#rec_tel").val($(this).attr('rec_tel'))
  $("#rec_addr").val($(this).attr('rec_addr'))
  $("#rec_file").val($(this).attr('rec_file'))

  $("#rec_company").val($(this).attr('rec_company'))

  $("#express_type").val($(this).attr('express_type_id'))
  $("#payment_type").val($(this).attr('payment_type_id'))

  $("#express_created_at").val($(this).attr('created_at'))
  $("#send_name").val($(this).attr('send_at_name'))
  $("#express_remark").val($(this).attr('remark'))
  $("#btn_save_express").attr('express_id',$(this).attr('id'))
  $("#btn_save_express").attr('send_or_rec',$(this).attr('send_or_rec'))
  if($(this).attr('uid_name')=="{{name}}" && $(this).attr('accept_at')!='None'){
    $("#er_express").text('已审核不能修改')
    $("#er_express").show()
    $('#btn_save_express').hide()
  }
  else if($(this).attr('uid_name')!="{{name}}" ){
    $("#er_express").text('你不是创建人不能修改')
    $("#er_express").show()
    $('#btn_save_express').hide()
  }
  else{
    $("#er_express").hide()
    $('#btn_save_express').show()
  }
  $("#delete_express").attr("express_id",$(this).attr('id'))
  if($(this).attr('accept_at')=='None' && $(this).attr('uid_name')=='{{name}}'){
    $("#delete_express").show()
  }else{
    $("#delete_express").hide()
  }
  $("#add_express_modal").modal("show")
 })
 $("#delete_express").on('click',function () {
   var express_id=$(this).attr('express_id')
   if(confirm('确定删除？')){
    $.post('/project?tag=express',
   {
     '_xsrf':_xsrf,
     'delete_id':express_id
   },function (res) {
     if(res=='-1'){
       alert('已审核不能删除')
     } 
     location.reload()
    })
   } 
  })
 $(".check_express").on('click',function () {
        $("#btn_check_express").attr('express_id',$(this).attr('id'))
        $("#check_express_modal").modal("show")
     })

$('#btn_check_express').on('click',function () {
   var accept_state=$('#accept_state:checked').val()
   var accept_uid_remark=$('#accept_uid_remark').val()
   var express_id=$(this).attr('express_id')
  if(accept_state==undefined){
      $("#er_accept_state").text('请先选择')
      $("#er_accept_state").show()
  }else if(accept_state=='2' && accept_uid_remark==''){
    $("#er_accept_uid_remark").text('不通过需要填写备注')
      $("#er_accept_uid_remark").show()
  }else{
    $.post('/project?tag=check_express',
    {
      '_xsrf':_xsrf,
      'accept_state':accept_state,
      'accept_uid_remark':accept_uid_remark,
      'express_id':express_id
    },function (result) {
      location.reload()
     })
  }

  })
  $(".confirm_send_express").on('click',function(){
  $.post('/project?tag=confirm_send_express',
    { '_xsrf':_xsrf,
      'express_id':$(this).attr('id')
    },function (result) {
      location.reload()
     })
 })
 $("#choose_cutomer_addr_msg").on('click',function(){
   $('#choose_customer_addr_msg_modal').modal('show')
 })
 $('#btn__save_customer_addr_msg').on('click',function(){
   var customer_name=$('input[name=choose_customer_addr]:checked').attr('c_name')
   var customer_addr=$('input[name=choose_customer_addr]:checked').attr('addr')
   var customer_tel=$('input[name=choose_customer_addr]:checked').attr('tel')
   $('#rec_name').val(customer_name)
   $('#rec_tel').val(customer_tel)
   $('#rec_addr').val(customer_addr)
   $('#choose_customer_addr_msg_modal').modal('hide')
   })
   $('#choose_customer_addr_msg_modal').on('hidden.bs.modal', function () {
      document.getElementsByTagName('body')[0].className = 'modal-open';
});
var tmpl = ' <li style=" width:100%;height:20px;background-image:url(#url#); background-size:15px 10px;display:block;">#url1#</li>',
    all_files1=[]
    all_files2=[]
    $gallery = $("#gallery"),
    $galleryImg = $("#galleryImg"),
    $uploaderInput = $("#uploaderInput1"),
    $uploaderFiles = $("#uploaderFiles1");
    $uploaderInput2 = $(".uploaderInput2"),
    $uploaderInput.on("change", function(e) {
                var src, url = window.URL || window.webkitURL || window.mozURL,
                files = e.target.files;
                for(var i =0, len = files.length; i < len; ++i) {
                  
                    var file = files[i];
                    console.log(file);
                    

                  
                    if(url) {
                        // src = url.createObjectURL(file);
                        src=file.name;
                    } else {
                        src = e.target.result;
                    }

                    $uploaderFiles.append(src+' ');
                    all_files1.push(file)
                    
                    
                }
              

            });

            $uploaderInput2.on("change", function(e) {
              if(eval('typeof(window.all_file'+$(this).attr('msg_id')+')')=='undefined'){
                eval(' window.all_file'+$(this).attr('msg_id')+'=[]')
              }
                var src, url = window.URL || window.webkitURL || window.mozURL,
                files = e.target.files;
                for(var i =0, len = files.length; i < len; ++i) {
                  
                    var file = files[i];  
                    if(url) {
                        // src = url.createObjectURL(file);
                        src=file.name;
                    } else {
                        src = e.target.result;
                    }

                    $(".uploaderFiles2[msg_id="+$(this).attr('msg_id')+"]").append(src+' ');
                    eval('all_file'+$(this).attr('msg_id')).push(file)
                   
                    
                }
              

            });

$('.filepath_detail').on('click',function () {
  uid_name=$(this).attr('uid_name')
  send_at_name=$(this).attr('send_at_name')
  if(uid_name=="{{name}}" || send_at_name=="{{name}}"){
    $('.file_label').show()
    $('.file').show()
    $('#btn_express_filepath').show()
  }else{
    $('.file_label').hide()
    $('.file').hide()
    $('#btn_express_filepath').hide()
  }
  $("#er_uploaderInput").hide()
    file_path=$(this).attr('file_path')
    file_path=file_path.split('|')
    showFiles=$('#showFiles')
    showFiles.children().remove()
    if(file_path!=''){
    for(var i=0;i<file_path.length-1;i++){
      f=file_path[i].split('/')

      showFiles.append('<br><li><a href="'+file_path[i]+'" download="'+f[f.length-1]+'">'+f[f.length-1].split('.')[0]+
      '</a><a href="'+file_path[i]+'" class="btn" target="_blank">查看</a></li>')
    }
    }
    else(
      showFiles.append('<p>还没有上传附件哦~</p>')
    )
    $("#btn_express_filepath").attr('express_id',$(this).attr('id'))
    $("#express_filepath_modal").modal("show")
 })
 $("#btn_express_filepath").on('click',function () {
    var formData = new FormData();
    for(var i=0,len=all_files.length;i<len;i++){
      formData.append('file'+i,all_files[i])
    }
    formData.append('len',all_files.length)
    formData.append('express_id',$(this).attr('express_id'))
    formData.append('_xsrf',_xsrf)
    if(all_files!=''){
      $(this).text('保存中')
      $(this).attr('disabled','disabled')
      $.ajax({
                url: '/project?tag=express',
                type: 'POST',
                data: formData,
                processData: false,  // tell jQuery not to process the data
                contentType: false,  // tell jQuery not to set contentType
                success: function (data) {
                  location.reload()

                }
              });
    }
    else{
      $("#er_uploaderInput").show()
    }

 })
//  $(window).scroll(function(){
// 	if ($(window).scrollTop()>=60) {
// 		$(".es-nva").css({
// 			"position":"fixed",
// 			"top":"0px",
// 			"left":"50%",
// 			"margin-left":"-585px",
// 			"z-index":"99"
			
// 		})
// 	} else{
// 		$(".es-nva").removeAttr("style")
// 	}
// })

$(window).scroll(
  function () { 
    var scrollValue = $(window).scrollTop();
  
    scrollValue > 60 ? $(".esnava").show(): $(".esnava").hide();
   }
)
$(".esdt-box1").click(function(){
  t_this=$(this)
  if($(this).hasClass('esdtcur1')==false){
  if(confirm('确认完成?')){
    state_id=$(this).attr('state_id')
   
    $.post('customer?tag=add_customer_state',{
      '_xsrf':_xsrf,
      'state_id':state_id,
      'customer_id':"{{customer.customer_id}}"
    },function (data) { 
      location.href="/customer?tag=show&id={{customer.customer_id}}&guid={{customer.guid}}&to_tag=payment_tab"
     })
  }
}

	});
	$(".esdt-box2").click(function(){
    t_this=$(this)
    state_id=$(this).attr('state_id')
    state_ids=[0]
    update_state_ids=[]
    {%if customer.gc%}
    for(var i=0;i<'{{customer.gc}}'.split(',').length;i++){
        state_ids.push('{{customer.gc}}'.split(',')[i][0])
    }
    {%end%}
    genjin_state_ids=[]
    if($(this).hasClass('esdtcur2')==false){
      if(parseInt(state_ids[state_ids.length-1])+1!=parseInt(state_id) ){
        
        if(confirm('暂未完成之前的阶段，是否确认完成?')){
          l=parseInt(state_id)-parseInt(state_ids[state_ids.length-1])
          
         for(var i=0;i<l;i++){
          update_state_ids.push(parseInt(state_ids[state_ids.length-1])+1+i)
         }
        
         update_state_ids=update_state_ids.join(',')
         $.post('customer?tag=add_customer_state',{
      '_xsrf':_xsrf,
      'update_state_ids':update_state_ids,
      'customer_id':"{{customer.customer_id}}"
    },function (data) { 
      location.href="/customer?tag=show&id={{customer.customer_id}}&guid={{customer.guid}}&to_tag=payment_tab"
     })
        }
    }else{

  if(confirm('确认完成?')){
    $.post('customer?tag=add_customer_state',{
      '_xsrf':_xsrf,
      'state_id':state_id,
      'customer_id':"{{customer.customer_id}}"
    },function (data) { 
      location.href="/customer?tag=show&id={{customer.customer_id}}&guid={{customer.guid}}&to_tag=payment_tab"
     })
  }
}
}
	});

	$(".esdt-box3").click(function(){
    state_id=$(this).attr('state_id')
    state_ids=[0]
    update_state_ids=[]
    {%if customer.gc%}
    for(var i=0;i<'{{customer.gc}}'.split(',').length;i++){
        state_ids.push('{{customer.gc}}'.split(',')[i][0])
    }
    {%end%}
    genjin_state_ids=[]
    if($(this).hasClass('esdtcur3')==false){
      if(parseInt(state_ids[state_ids.length-1])+1!=parseInt(state_id) ){
        
        if(confirm('暂未完成之前的阶段，是否确认完成?')){
          l=parseInt(state_id)-parseInt(state_ids[state_ids.length-1])
          
         for(var i=0;i<l;i++){
          update_state_ids.push(parseInt(state_ids[state_ids.length-1])+1+i)
         }
        
         update_state_ids=update_state_ids.join(',')
         $.post('customer?tag=add_customer_state',{
      '_xsrf':_xsrf,
      'update_state_ids':update_state_ids,
      'customer_id':"{{customer.customer_id}}"
    },function (data) { 
      location.href="/customer?tag=show&id={{customer.customer_id}}&guid={{customer.guid}}&to_tag=payment_tab"
     })
        }
    }else{

  if(confirm('确认完成?')){
    $.post('customer?tag=add_customer_state',{
      '_xsrf':_xsrf,
      'state_id':state_id,
      'customer_id':"{{customer.customer_id}}"
    },function (data) { 
      location.href="/customer?tag=show&id={{customer.customer_id}}&guid={{customer.guid}}&to_tag=payment_tab"
     })
  }
}
}
	});
  $(".eslb-top ul li").click(function(){
		$(this).addClass("eslbcur").siblings().removeClass("eslbcur")
	});

  $("#customer_modify1").click(function () { 
	$('#add_test_modal1').modal('show')
 })
$("#customer_modify2").click(function () { 
	$('#add_test_modal2').modal('show')
 })
 $("#customer_modify3").click(function () { 
	$('#add_test_modal3').modal('show')
 })
 $(document).on("click", ".is_check",function(){
    is_check = $(this).val()
    customer_id=$(this).attr("customer_id")

    if(is_check==1){
        $(this).parent().css('padding-left','1px')
        $("#btype_name_box").show()

    }else{
      $(this).parent().css('padding-left','10px')
        $("#btype_name_box").hide()
    }
})
{%if customer.is_check%}
$('.is_check').parent().css('padding-left','1px')
  $("#btype_name_box").show()
{%end%}

$("#btn_test_save1").click(function () { 
  company=$("#company").val()
  acc_uid_name=$("#acc_uid_name").val()
  hangye=$("#hangye").val()
  reg_bank=$("#reg_bank").val()
  reg_bank_account=$("#reg_bank_account").val()
  saic=$("#saic").val()
  addr_type=$("#addr_type").val()
  national_tax=$("#national_tax").val()
  land_tax=$("#land_tax").val()
  zg_name=$('#zg_name').val()
  zg_tel=$("#zg_tel").val()
  business_scope=$("#business_scope").val()
  attention=$("#attention").val()
  zg_option=$("#zg_option").val()
  adjusted_option=$("#adjusted_option").val()
  kj_label_names=[]
  kj_label_ids=[]
  $('input[name=kj_label]:checked').each(function () { 
   
      kj_label_ids.push($(this).val())
      kj_label_names.push($(this).attr('kj_label_name'))
    
   })
  if (company==""){
    $("#company").focus()
  }
  else{
  $.post('customer?tag=edit_customer_other',{
    '_xsrf':_xsrf,
    'kj_label_ids':kj_label_ids.join(),
    'kj_label_names':kj_label_names.join(),
    'company':company,
    'reg_bank_account':reg_bank_account,
    'acc_uid_name':acc_uid_name,
    'current_acc_uid_name':"{{customer.acc_uid_name}}",
    'hangye':hangye,
    'reg_bank':reg_bank,
    'saic':saic,
    'addr_type':addr_type,
    'national_tax':national_tax,
    'land_tax':land_tax,
    'zg_name':zg_name,
    'zg_tel':zg_tel,
    'business_scope':business_scope,
    'attention':attention,
    'zg_option':zg_option,
    'adjusted_option':adjusted_option,
    'customer_id':"{{customer.customer_id}}",
    'customer_other_id':"{%if customer.customer_other_id%}{{customer.customer_other_id}}{%else%}{%end%}",
    'step':'1'
  },function (data) {
    if(data['error_acc']!='' && data['error_acc']!=undefined){
      alert(data['error_acc'])
    }else if(data['status']=='-100'){
      $("#exist_customer1").html('<a target="_blank" style="color:red" href="?tag=show&id='+data['id']+'&guid='+data['guid']+'">公司名已存在(点击查看)</a>')
    }
    else{
        location.reload()
    }
   })
  }
 })

 var myDrop_upload = new Dropzone("#dropzone_upload", {
        url: "/customer?tag=dongtai_genjin_upload",
        addRemoveLinks: true,
        uploadMultiple: true,
        dictRemoveFile: "移除",
        dictDefaultMessage:  "请点击选择文件或拖动文件到本区域<br/><font color='red'>上传截图可以直接Ctrl+V,粘帖即可</font>",
        paramName: 'file',
        autoProcessQueue:false,
        parallelUploads:100,
        init: function () {
            var thisDropzone = this;
            submitButton = document.querySelector("#btn_submit_msg");
            submitButton1 = document.querySelector("#btn_submit_msg1");

            this.on("complete", function (data) {

                if (this.getUploadingFiles().length === 0 && this.getQueuedFiles().length === 0) {

                 

                }
            });
            this.on('success', function (files, response) {
              location.href="/customer?tag=show&id={{customer.customer_id}}&guid={{customer.guid}}&to_tag=payment_tab"

            });
            submitButton.addEventListener('click', function () {
              dongtai_msg=$("#dongtai_msg").val()
              genjin_type=$("#genjin_type").val()
              genjin_type1=$("#genjin_type1").val()
              msg_modal=$(this).attr('msg_modal')   
              formData=new FormData()
              formData.append('_xsrf', _xsrf)
              formData.append("dongtai_msg", dongtai_msg)
              formData.append("customer_id","{{customer.customer_id}}")
              if (dongtai_msg=='' && msg_modal==undefined){
                alert('跟进内容不为空')
                return false
              }
              else if(genjin_type=='' && msg_modal==undefined){
                $("#genjin_type_modal").modal('show')
                return false
              }else if(genjin_type=='' && genjin_type1=='' && msg_modal=='1'){
                alert('请选择类别')
                return false
              }
              else if(genjin_type==''){
                  formData.append('genjin_type',genjin_type1)
                }else{
                  formData.append('genjin_type',genjin_type)
                }
             
              if(thisDropzone.getQueuedFiles().length==0){
                $.ajax({
                url: '/customer?tag=dongtai_genjin_upload',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (data) {
                  location.href="/customer?tag=show&id={{customer.customer_id}}&guid={{customer.guid}}&to_tag=payment_tab"

                }
              });
              
              }else if(dongtai_msg!='' && (genjin_type!='' || genjin_type1!='' )){

              thisDropzone.processQueue();
            }
            });
            submitButton1.addEventListener('click', function () {
              dongtai_msg=$("#dongtai_msg").val()
              genjin_type=$("#genjin_type").val()
              genjin_type1=$("#genjin_type1").val()
              msg_modal=$(this).attr('msg_modal')   
              formData=new FormData()
              formData.append('_xsrf', _xsrf)
              formData.append("dongtai_msg", dongtai_msg)
              formData.append("customer_id","{{customer.customer_id}}")
              if (dongtai_msg=='' && msg_modal==undefined){
                alert('跟进内容不为空')
                return false
              }
              else if(genjin_type=='' && genjin_type1=='' && msg_modal=='1'){
                alert('请选择类别')
                return false
              }
              else if(genjin_type==''){
                  formData.append('genjin_type',genjin_type1)
                }
              else{
                  formData.append('genjin_type',genjin_type)
                
              }
              if(thisDropzone.getQueuedFiles().length==0){
                $.ajax({
                url: '/customer?tag=dongtai_genjin_upload',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (data) {
                  location.href="/customer?tag=show&id={{customer.customer_id}}&guid={{customer.guid}}&to_tag=payment_tab"

                }
                });
              }else if(dongtai_msg!='' && (genjin_type!='' || genjin_type1!='' )){

              thisDropzone.processQueue();
            }
            });
            this.on("sending", function (file, xhr, formData) {
              dongtai_msg=$("#dongtai_msg").val()
              genjin_type=$("#genjin_type").val()
              genjin_type1=$("#genjin_type1").val()
              msg_modal=$(this).attr('msg_modal')   
      
              formData.append('_xsrf', _xsrf)
              formData.append("dongtai_msg", dongtai_msg)
              formData.append("customer_id","{{customer.customer_id}}")
        
              if(genjin_type==''){
                  formData.append('genjin_type',genjin_type1)
                }else{
                  formData.append('genjin_type',genjin_type)
                }
              
              


          

            
        });

}

});
document.onpaste = function (event) {
        add_file_modal_check = $("#a_payment_tab").parent('li')
        if (add_file_modal_check.hasClass('active')) {


            var items = (event.clipboardData || event.originalEvent.clipboardData).items;
            for (index in items) {
                var item = items[index];
                if (item.kind === 'file') {
                    // adds the file to your dropzone instance
                    myDrop_upload.addFile(item.getAsFile());
                }
            }
        }
}
 $("#btn_test_save2").click(function () { 
    is_general=$("input[name=is_general]:checked").val()
    survey=$('#survey').val()
    is_check=$('input[name=is_check]:checked').val()
    btype_id=$('input[name=btype_id]:checked').val()
    btype_id_name=$("input[name=btype_id]:checked").attr('btype_id_name')
    shuizhong_detail=$("#shuizhong_detail").val()
    zhengshou_way=$("#zhengshou_way").val()
    shuikong_type=$("#shuikong_type").val()
    ss_num=$("#ss_num").val()
    fixed_assets=$("#fixed_assets").val()
    if(ss_num==''){
      ss_num=0
    }
    $.post('customer?tag=edit_customer_other',{
    '_xsrf':_xsrf,
    'is_general':is_general,
    'survey':survey,
    'is_check':is_check,
    'btype_id':btype_id,
    'btype_id_name':btype_id_name,
    'shuizhong_detail':shuizhong_detail,
    'zhengshou_way':zhengshou_way,
    'shuikong_type':shuikong_type,
    'ss_num':ss_num,
    'fixed_assets':fixed_assets,
    'customer_id':"{{customer.customer_id}}",
    'customer_other_id':"{%if customer.customer_other_id%}{{customer.customer_other_id}}{%else%}{%end%}",
    'step':'2'
  },function (data) {
        location.reload()
   })
  })
  $('#btn_test_save3').click(function () { 
    legal_id_card=$("#legal_id_card").val()
    rel_name_collect_account=$("#rel_name_collect_account").val()
    rel_name_collect_password=$("#rel_name_collect_password").val()
    shuipan_password=$("#shuipan_password").val()
    shuipan_command=$("#shuipan_command").val()
    per_income_apply_password=$("#per_income_apply_password").val()
    receipt_card_password=$("#receipt_card_password").val()
    accumulation_fund_password=$("#accumulation_fund_password").val()

    $.post('customer?tag=edit_customer_other',{
    '_xsrf':_xsrf,
    'legal_id_card':legal_id_card,
    'rel_name_collect_account':rel_name_collect_account,
    'rel_name_collect_password':rel_name_collect_password,
    'shuipan_password':shuipan_password,
    'shuipan_command':shuipan_command,
    'per_income_apply_password':per_income_apply_password,
    'receipt_card_password':receipt_card_password,
    'accumulation_fund_password':accumulation_fund_password,
    'customer_id':"{{customer.customer_id}}",
    'customer_other_id':"{%if customer.customer_other_id%}{{customer.customer_other_id}}{%else%}{%end%}",
    'step':'3'
  },function (data) {
        location.reload()
   })
   })
   $("#btn_test_save4").click(function () { 
    company=$("#company1").val()
    reg_person=$("#reg_person").val()
    company_reguid=$("#company_reguid").val().replace(/\s+/g,"").toUpperCase()
    reg_date=$("#reg_date").val()
    link_name=$("#link_name").val()
    link_tel=$("#link_tel").val()
    link_id=$('#link_id').val()
    is_general=$("input[name=is_general1]:checked").val()
    addr_type=$("#addr_type1").val()
    payment_id=$("#payment_id").val()
    pay_type_id=$("input[name=pay_type_id]:checked").val()
    fee=$("input[name=pay_type_id]:checked").attr('fee')
    pay_typeid_name=$("input[name=pay_type_id]:checked").attr('pay_typeid_name')
    service_amount=$("#service_amount").val()
    service_amount_month=$("#service_amount_month").val()
    book_amount=$("#book_amount").val()
    acc_end=$("#acc_end").val()
    city=$("#city").val()
    zone=$("#zone").val()
    reg_addr=$("#reg_addr").val()
    tag_parent_id=$('input[name=tag_parent_id]:checked').val()
    tag_parent_name=$('input[name=tag_parent_id]:checked').attr('title')
    tag_id=$("input[name=tag_id]:checked").val()
    tag_id_parent=$("input[name=tag_id]:checked").attr('parent_id')
    tag_name=$("input[name=tag_id]:checked").attr('title')
    is_building=$('input[name=is_building]:checked').val()
    is_clearly=$('input[name=is_clearly]:checked').val()
    is_year=$('input[name=is_year]:checked').val()
    reg_money=$("#reg_money").val()
    other_appoint=$("#other_appoint").val()
    tag_id2=$("input[name=tag_id2]:checked").val()
    tag_name2=$("input[name=tag_id2]:checked").attr('title')
    customer_type_name=''
    customer_type=''
    
   if("{{old_tag}}"!=''){
    $("input[name=customer_type]").each(function(){
                 if (this.checked) {
                            customer_type_name= customer_type_name +$(this).attr("title")+","
                            customer_type = customer_type+$(this).val()+","
                    }

            })
           customer_type_name = customer_type_name.slice(0, -1);
            customer_type = customer_type.slice(0, -1);
          }
    if(tag_parent_id=='2'){
      if(tag_id!='12' && tag_id_parent!='2'){
        tag_id='11'
      tag_name='非记账'
      }
      
    }
    if(company==''){
      alert('公司名称不能为空')
    }
    if(((tag_id==undefined && tag_parent_id=='1')  || tag_parent_id==undefined)&& "{{old_tag}}"=='') {

      $("#msg_tag").text('未选择标签')
    }
    // else if((link_name=='' || link_tel=='') && link_id!=''){
    //     $("#msg_link_tag").text('未填')
    // } 
    else if(company_reguid==''){
      alert('信用代码不能为空')
      
    }else if(company_reguid!='' && company_reguid.length!=18){
      alert('信用代码长度需要为18位')
    }
    else{
      $.post('customer?tag=edit_customer_head',{
        '_xsrf':_xsrf,
        'company':company,
        'reg_person':reg_person,
        'company_reguid':company_reguid,
        'reg_date':reg_date,
        'link_name':link_name,
        'link_tel':link_tel,
        'link_id':link_id,
        'is_general':is_general,
        'addr_type':addr_type,
        'payment_id':payment_id,
        'pay_type_id':pay_type_id,
        'fee':fee,
        'pay_typeid_name':pay_typeid_name,
        'service_amount':service_amount,
        'service_amount_month':service_amount_month,
        'book_amount':book_amount,
        'acc_end':acc_end,
        'city':city,
        'zone':zone,
        'reg_addr':reg_addr,
        'customer_type_name':customer_type_name,
        'customer_type':customer_type,
        'old_tag':"{{old_tag}}",
        'tag_parent_id':tag_parent_id,
        'tag_parent_name':tag_parent_name,
        'tag_id':tag_id,
        'tag_name':tag_name,
        'is_building':is_building,
        'is_clearly':is_clearly,
        'is_year':is_year,
        'customer_id':"{{customer.customer_id}}",
        'reg_money':reg_money,
        'other_appoint':other_appoint,
        'tag_id2':tag_id2,
        'tag_name2':tag_name2
        
      },function (data) {
        if(data['status']=='-100'){
            $("#exit_customer").html('<a target="_blank" style="color:red" href="?tag=show&id='+data['id']+'&guid='+data['guid']+'">公司名已存在(点击查看)</a>')
        }else if(data['status']=='-200'){
          $("#exit_customer").html('<a target="_blank" style="color:red" href="?tag=show&id='+data['id']+'&guid='+data['guid']+'">信用代码已存在(点击查看)</a>')
        }else{
          location.reload()
        } 
       
       })
    }
    })

   $("#tag_modify").click(function () { 
    $("#add_tag_modal").modal('show')
    })

  $('input[name=tag_parent_id]').on('change',function () { 
    if($(this).val()=='1'){
      $(".tag_box").show()
      $("#tag_box1").hide()
      if($('input[name=tag_id]:checked').val()=='12' || $('input[name=tag_id]:checked').val()=='13'){
        $('input[name=tag_id]').prop('checked',false)
      }
    }else if($(this).val()=='2'){
      $(".tag_box").hide()
      $("#tag_box1").show()
    }
   })
   $("#btn_save_tag").click(function () { 
    tag_parent_id=$('input[name=tag_parent_id]:checked').val()
    tag_parent_name=$('input[name=tag_parent_id]:checked').attr('title')
    tag_id=$("input[name=tag_id]:checked").val()
    tag_name=$("input[name=tag_id]:checked").attr('title')
    is_building=$('input[name=is_building]:checked').val()
    is_clearly=$('input[name=is_clearly]:checked').val()
    is_year=$('input[name=is_year]:checked').val()
    if(tag_parent_id=='2'){
      tag_id=$("input[name=tag_id][value=11]").val()
      tag_name=$("input[name=tag_id][value=11]").attr('title')
    }
    if((tag_id==undefined && tag_parent_id=='1')  || tag_parent_id==undefined){
      $("#msg_tag").text('未选择标签')
    }
    else{
      $.post('customer?tag=edit_customer_tag',{
        '_xsrf':_xsrf,
        'tag_parent_id':tag_parent_id,
        'tag_parent_name':tag_parent_name,
        'tag_id':tag_id,
        'tag_name':tag_name,
        'is_building':is_building,
        'is_clearly':is_clearly,
        'is_year':is_year,
        'customer_id':"{{customer.customer_id}}",
        
      },function (data) { 
        location.reload()
       })
    }
    })

    $(".customer_modify4").click(function () { 
	$('#add_test_modal4').modal('show')
 })
 $('input[type="radio"][name="pay_type_id"]').click(function(){
                   
                   service_amount = $("#service_amount").val()
                   if ($(this).is(':checked'))
                   {
                      if($(this).attr("fee")>0){
                            $("#service_amount").removeAttr("readOnly")
                          
                       }else{
                            $("#service_amount").val("0")
                           all_total = 0
                       }
   
   
                       all_total =  service_amount / $(this).attr("fee");
                       console.log(all_total)
                       if (all_total==Infinity){
                           all_total = 0
   
                       }
                       $("#service_amount_month").val(intToFloat(all_total))
                   }
       });
       $('#service_amount').keyup(function() {

                           all_total = $(this).val() / $("input[name='pay_type_id']:checked").attr("fee");
                             if (all_total==Infinity || all_total==NaN){
                           all_total = 0
                           
                       }

                           $("#service_amount_month").val(intToFloat(all_total))
   
   
           })
        function intToFloat(val){
          return new Number(val).toFixed(2);
   }
  //  $(".submit_msg").click(function () { 
  //   dongtai_msg=$("#dongtai_msg").val()
  //   genjin_type=$("#genjin_type").val()
  //   genjin_type=$("#genjin_type").val()
  //   genjin_type1=$("#genjin_type1").val()
  //   msg_modal=$(this).attr('msg_modal')    
  //   var formData = new FormData();
  //   formData.append('len1',all_files1.length)
  //   for(var i=0;i<all_files1.length;i++){
  //     formData.append('file'+i.toString(), all_files1[i]);
  //   }
  //   formData.append('_xsrf', _xsrf)
  //   formData.append("dongtai_msg", dongtai_msg)
  //   formData.append("customer_id","{{customer.customer_id}}")
  //    if (dongtai_msg=='' && msg_modal==undefined){
  //     alert('跟进内容不为空')
  //   }
  //   else if(genjin_type=='' && msg_modal==undefined){
  //     $("#genjin_type_modal").modal('show')
  //   }else if(genjin_type=='' && genjin_type1=='' && msg_modal=='1'){
  //     alert('请选择类别')
  //   }
  //   else{
  //     if(genjin_type==''){
  //       formData.append('genjin_type',genjin_type1)
  //     }else{
  //       formData.append('genjin_type',genjin_type)
  //     }
  //     $.ajax({
  //               url: '/customer?tag=dongtai_genjin',
  //               type: 'POST',
  //               data: formData,
  //               processData: false,
  //               contentType: false,
  //               success: function (data) {

  //                 location.href="/customer?tag=show&id={{customer.customer_id}}&guid={{customer.guid}}&to_tag=payment_tab"

  //               }
  //             });
  //   }

  //   })
    $('.submit_files').click(function () { 
 
      if(eval('typeof(window.all_file'+$(this).attr('msg_id')+')')=='undefined'){
        alert('未选择附件')
        return false

      }
    var formData = new FormData();
    
    formData.append('len1',eval('all_file'+$(this).attr('msg_id')).length)
    for(var i=0;i<eval('all_file'+$(this).attr('msg_id')).length;i++){
      formData.append('file'+i.toString(), eval('all_file'+$(this).attr('msg_id'))[i]);
    }
    formData.append('_xsrf', _xsrf)
    formData.append('msg_id',$(this).attr('msg_id'))
    formData.append("customer_id","{{customer.customer_id}}")
    $.ajax({
                url: '/customer?tag=dongtai_genjin',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (data) {

                  location.href="/customer?tag=show&id={{customer.customer_id}}&guid={{customer.guid}}&to_tag=payment_tab"

                }
              });
     })
    $("#feedback").click(function () { 
      $("#feedback_modal").modal('show')
     })
    $("#btn_save_feedback").click(function () { 
      feedback_msg=$("#feedback_msg").val()
      if(feedback_msg==''){
        alert('反馈不能为空')
      }else{
        $.post('/customer?tag=customer_feedback',{
          '_xsrf':_xsrf,
          'feedback_msg':feedback_msg,
          'customer_id':'{{customer.customer_id}}',
          'guid':'{{customer.guid}}',
          'company':'{{customer.company}}'

        },function (data) { 
          location.reload()
         })
      }
     })
     $("#merge_customer").click(function () { 
      $("#merge_customer_modal").modal('show')
      })
      $("#search_merge_id1").click(function () {
        merege_id=$("#merege_id1").val()
        if(merege_id==''){
          alert('编号不能为空')
        } 
        else if(isNaN(merege_id)){
          alert('编号需要为数字')
        }
        else if(merege_id=="{{customer.customer_id}}"){
          alert('不能合并本客户')
        }
        else{
          $.post('?tag=search_merege_customer',{
            '_xsrf':_xsrf,
            'merege_id':merege_id
          },function (data) { 
            if(data=='-1'){
              $('#show_search_customer1').html('没找到~')
            }else{
              $('#show_search_customer1').html('查询到 公司名:'+data['company']+' 信用代码:'+data['company_reguid'])
              $('#show_search_customer1').append('<br><br><input company_reguid="'+data['company_reguid']+'" company="'+data['company']+'" type="radio" name="merge_with1" value="1" title="'+
              data['merege_id']+'" guid="'+data['guid']+'" >转移到编号为'+data['merege_id']+'的客户'
             
              )
            }
            
           })
        }
       })
       $("#btn_merge_customer").click(function () { 
        merge_with=$("input[name=merge_with]:checked").val()
        merege_id=$("input[name=merge_with]:checked").attr('title')
        merege_guid=$("input[name=merge_with]:checked").attr('guid')
        merege_company=$("input[name=merge_with]:checked").attr('company')
        merege_reguid=$("input[name=merge_with]:checked").attr('company_reguid')
        if(merge_with==undefined){
          alert('请选择需要的合并')
        }else{
          $.post('?tag=merege_customer',{
            '_xsrf':_xsrf,
            'merege_with':merge_with,
            'merege_id':merege_id,
            'customer_id':'{{customer.customer_id}}',
            'merege_guid':merege_guid,
            'customer_company':"{{customer.company}}",
            'merege_company':merege_company,
            'customer_guid':'{{customer.guid}}',
            'company_reguid':"{{customer.company_reguid}}",
            'merege_reguid':merege_reguid
          },function (data) {
            if(data=='-1'){
              alert('两个客户有合并过的，暂无此合并公能')
            }else{
              location.reload()
            } 
            
           })
        }
        })
    $("#merege_cw").click(function () {
      if($('input[name=merege_project]:checked').val()==undefined && $('input[name=merege_his]:checked').val()==undefined ){
        alert('未选择')
        $('input[name=merege_project]').focus()
      }else{
        $("#merge_customer_modal1").modal('show')
      }
     })

     $("#btn_merge_customer1").click(function () { 
      merege_project_ids=[]
      merege_his_ids=[]
      $('input[name=merege_project]:checked').each(function () { 
    
              merege_project_ids.push($(this).val())
    
       })
       $('input[name=merege_his]:checked').each(function () { 
              merege_his_ids.push($(this).val())
          
       })

        merege_project_ids=merege_project_ids.join('')
        merege_his_ids=merege_his_ids.join(',')
        merge_with=$("input[name=merge_with1]:checked").val()
        merege_id=$("input[name=merge_with1]:checked").attr('title')
        merege_guid=$("input[name=merge_with1]:checked").attr('guid')
        merege_company=$("input[name=merge_with1]:checked").attr('company')
        merege_reguid=$("input[name=merge_with1]:checked").attr('company_reguid')
        if(merge_with==undefined){
          alert('请选择需要的转移')
        }
        else{
          $.post('?tag=merege_customer1',{
            '_xsrf':_xsrf,
            'merege_id':merege_id,
            'merege_guid':merege_guid,
            'merege_company':merege_company,
            'merege_reguid':merege_reguid,
            'merege_project_ids':merege_project_ids,
            'customer_id':customer_id,
            'merege_his_ids':merege_his_ids
          },function (data) {
            alert('转移成功') 
            location.href='?tag=show&id='+customer_id+'&guid='+customer_guid+'&to_tag=finance_tab'
           })
        }
        })



     $("#search_merge_id").click(function () {
        merege_id=$("#merege_id").val()
        if(merege_id==''){
          alert('编号不能为空')
        } 
        else if(isNaN(merege_id)){
          alert('编号需要为数字')
        }
        else if(merege_id=="{{customer.customer_id}}"){
          alert('不能合并本客户')
        }
        else{
          $.post('?tag=search_merege_customer',{
            '_xsrf':_xsrf,
            'merege_id':merege_id
          },function (data) { 
            if(data=='-1'){
              $('#show_search_customer').html('没找到~')
            }else{
              $('#show_search_customer').html('查询到 公司名:'+data['company']+' 信用代码:'+data['company_reguid'])
              $('#show_search_customer').append('<br><br><input company_reguid="'+data['company_reguid']+'" company="'+data['company']+'" type="radio" name="merge_with" value="1" title="'+data['merege_id']+'" guid="'+data['guid']+'" > 将编号为'+data['merege_id']+'的客户合并到当前客户'+
              '<br><br><input company_reguid="'+data['company_reguid']+'" company="'+data['company']+'" type="radio" name="merge_with" value="2" title="'+data['merege_id']+'" guid="'+data['guid']+'" > 将当前客户合并到编号为'+data['merege_id']+'的客户'
              )
            }
            
           })
        }
       })
    
    $(".add_file").click(function () { 
        $("#add_file_modal").modal('show')
        $("#add_file_save").attr('msg_id',$(this).attr('msg_id'))
     })
     $('.delete_msg_file').click(function () { 
       if(confirm('确认删除'+$(this).attr('file_name'))){
         delete_msg_id=$(this).attr('delete_msg_id')
         file_path=$(this).attr('file_path')
         formData=new FormData()
         formData.append('_xsrf', _xsrf)
         formData.append('delete_file_path',file_path)
         formData.append('delete_msg_id',delete_msg_id)
         formData.append("customer_id","{{customer.customer_id}}")
         $.ajax({
                url: '/customer?tag=dongtai_genjin',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (data) {

                  location.href="/customer?tag=show&id={{customer.customer_id}}&guid={{customer.guid}}&to_tag=payment_tab"

                }
              });
       }
      })
        $.get('/payment?tag=customer',{
        "customer_id":"{{customer.customer_id}}",
        "customer_guid":"{{customer.guid}}",
        "old_tag":"{%if old_tag%}{{old_tag}}{%end%}"
      
      },function (data) { 
        $("#payment_record_tab").html(data)
       })
      //  payment_tab
      $("#upload_file").click(function () { 
      $("#upload_file_modal").modal('show')
     })
    });
    
    </script>
    {% end %}