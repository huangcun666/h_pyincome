{% extends "../base.html" %} {%block title%}{%if t_project.customer_company%}{{t_project.customer_company}}{%end%}-业务明细{%end%}

 {% block body %}


<style>
.faye-table {width: 100%; height: auto; /*background-color: purple;*/ margin: 0% auto; font-weight: bold;}
.faye-table ul {overflow: hidden; margin: 0; padding: 0;}
.faye-table ul li {width: 100%; list-style: none; box-sizing: border-box; border-bottom: 1px solid #dedede; width: 100%; height:40px; overflow: hidden;}
.faye-table ul li div {float: left; height: 40px; line-height: 40px; text-align: center; border-left: 1px solid #dedede;}
.faye-table ul li div.fayet {width:8%; background-color:#eee; border-bottom: 1px solid #dedede; }
.faye-table ul li div.fayet1 {width:12%;}
.faye-table ul li div.fayet11 {width:22%;}
.faye-table ul li div.fayet3 {width:92%;}
.faye-table ul li div.fayet4 {width:10%;}
.faye-table ul li div.fayet5 {width:15%;}
.faye-table ul li div.fayet60 { height: 180px; border-left: 1px solid #dedede; }
.faye-table ul li div.fayet70 {width:34%;  height: 180px; border-left: 1px solid #dedede;}
.faye-table ul li div.fayet6 {width:33%; height: 180px; border-left: 1px solid #dedede; }
.faye-table ul li div.fayet7 {width:34%; height: 180px; border-left: 1px solid #dedede;}
.faye-table ul li.gaodu {height: 180px;}
.faye-table ul li div.direction {text-align: left; padding-left: 10px; box-sizing: border-box;}
.faye-table ul li div.fayet6 span {display: block; width: 100%; height: 40px; border-bottom: 1px solid #dedede;  background-color:#eee; }
.faye-table ul li div.fayet7 span {display: block; width: 100%; height: 40px; border-bottom: 1px solid #dedede;  background-color:#eee; }
.faye-table ul li div.fayet6 i {display: block; width: 100%; height: 140px; line-height: 22px; font-style: normal; padding-top:8px; box-sizing: border-box;}
.faye-table ul li div.fayet7 i {display: block; width: 100%; height: 140px; line-height: 22px; font-style: normal; padding-top:8px; box-sizing: border-box;}
#box{ margin:10px auto; width:100%; min-height:0; background:#FF9}
#demo{ margin:10px auto; width:100%; min-height:0; background:#CF9}

.message-item {
margin-bottom: 5px;
margin-left: 40px;
position: relative;
}
.message-item .message-inner {
background: #fff;
border: 1px solid #ddd;
border-radius: 3px;
padding: 10px;
position: relative;
}
.message-item .message-inner:before {
border-right: 10px solid #ddd;
border-style: solid;
border-width: 10px;
color: rgba(0,0,0,0);
content: "";
display: block;
height: 0;
position: absolute;
left: -20px;
top: 6px;
width: 0;
}
.message-item .message-inner:after {
border-right: 10px solid #fff;
border-style: solid;
border-width: 10px;
color: rgba(0,0,0,0);
content: "";
display: block;
height: 0;
position: absolute;
left: -18px;
top: 6px;
width: 0;
}
.message-item:before {
background: #fff;
border-radius: 2px;
bottom: -30px;
box-shadow: 0 0 3px rgba(0,0,0,0.2);
content: "";
height: 100%;
left: -30px;
position: absolute;
width: 3px;
}
.message-item:after {
background: #fff;
border: 2px solid #ccc;
border-radius: 50%;
box-shadow: 0 0 5px rgba(0,0,0,0.1);
content: "";
height: 15px;
left: -36px;
position: absolute;
top: 10px;
width: 15px;
}
.clearfix:before, .clearfix:after {
content: " ";
display: table;
}
.message-item .message-head {
border-bottom: 1px solid #eee;
margin-bottom: 8px;
padding-bottom: 8px;
}
.message-item .message-head .avatar {
margin-right: 20px;
}
.message-item .message-head .user-detail {
overflow: hidden;
}
.message-item .message-head .user-detail h5 {
font-size: 16px;
font-weight: bold;
margin: 0;
}
.message-item .message-head .post-meta {
float: left;
padding: 0 15px 0 0;
}
.message-item .message-head .post-meta >div {
color: #333;
font-weight: bold;
text-align: right;
}
.post-meta > div {
color: #777;
font-size: 12px;
line-height: 22px;
}
.message-item .message-head .post-meta >div {
color: #333;
font-weight: bold;
text-align: right;
}
.post-meta > div {
color: #777;
font-size: 12px;
line-height: 22px;
}
.message-item img {
 min-height: 25px;
 max-height: 25px;
}
.modal-ku {
  width: 1750px;
  margin: auto;
}
#nav {
height: 30px;
width: 100%;
background-color: #007bff;
}
#nav ul {
margin: 0 0 0 30px;
padding: 0px;
font-size: 12px;
color: #FFF;
line-height: 30px;
white-space: nowrap;
}
#nav li {
list-style-type: none;
display: inline;
}
#nav li a {
cursor: pointer;
text-decoration: none;
font-family: Arial, Helvetica, sans-serif;
padding: 7px 10px;
color: #FFF;
}
#nav li a:hover {
color: #ff0;
background-color: #007bff;
}

.dropbtn {
    background-color: #4CAF50;
    color: white;
    padding: 16px;
    font-size: 10px;
    border: none;
    cursor: pointer;
}

.dropdown {
    position: relative;
    display: inline-block;
}

.dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 100px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
}

.dropdown-content a {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
}

.dropdown-content a:hover {background-color: #f1f1f1}

.dropdown:hover .dropdown-content {
    display: block;
}

.dropdown:hover .dropbtn {
    background-color: #3e8e41;
}
.file {
    position: relative;
    display: inline-block;
    background: #D0EEFF;
    border: 1px solid #99D3F5;
    border-radius: 4px;
    padding: 4px 12px;
    overflow: hidden;
    color: #1E88C7;
    text-decoration: none;
    text-indent: 0;
    line-height: 20px;
}
.file input {
    position: absolute;
    font-size: 100px;
    right: 0;
    top: 0;
    opacity: 0;
}
.file:hover {
    background: #AADFFD;
    border-color: #78C3F3;
    color: #004974;
    text-decoration: none;
}
.diao-top {background-color: #fff; margin-top: 60px; margin-bottom: 20px;}
.g1 {font-size: 10px; color: #414141; font-weight: 600; line-height: 42px;}
.topxian {border-top: 3px solid #007aff;}
</style>

                    <div class="ddlz-top">
                        <a href="#yewushouru">收入明细</a>
                        <a href="#daokuanjiesuan">到款信息</a>
                        <a href="#jiaodaishixiang">交代事项</span></a>
                        <a href="#banlijindu">办理进度</span></a>
                        <a href="#addr_list">安排地址</a>
                        <a href="#xiezhu_list">业务协助</a>
                        <a href="#yewuxiangguan">业务人员</a>
                        <a href="#dingdanliuzhuan">流转动态</a>
                        <a href="#xiangguanlianxiren">相关联系人</a>
                        <a href="#ziliaojiaojie">资料交接</a>
                        <a href="#shangchuanfujian">上传附件</a>
                        <a href="#kuaidi">快递</a>
                      </div>



      <ol class="breadcrumb diao-top">
          <li class="breadcrumb-item g1">主面板</li>
          <li class="breadcrumb-item g1">收入管理</li>
          <li class="breadcrumb-item g1">{{t_project.project_name}}</li>
          <li class="g1 g1-left">
            {%if visible_project%}
              {%if role=='9'%}

              <a href='javascript:void(0)' id="btn_modify1" > <img alt="[编辑]" width="25" src="/static/images/modify.png"></a>

              {%else%}
              <a href='javascript:void(0)' id="btn_modify" > <img alt="[编辑]" width="25" src="/static/images/modify.png"></a>
              {%end%}
              {%end%}
          </li>

          <li class="g1 g1-left">
            <a href="/project?tag=project_recode&id={{t_project.id}}" id="btn_recode" class="btn btn-primary btn-sm" style="font-size:0.6rem;">业务记录</a>
          </li>
          <li class="g1 g1-left"><a href="/project?tag=manage_addr&id={{t_project.id}}" id="btn_recode" class="btn btn-primary btn-sm" style="font-size:0.6rem;">
            
            办理地址管理</a>
          </li>
          {%if '292' in role_list%}
        <li class="g1 g1-left">
          <a href="javascript:void(0)" id="add_to_economic" 
          class="btn btn-primary btn-sm" style="font-size:0.6rem;">
          <i class="fa fa-plus" aria-hidden="true"></i>添加到经济普查</a>
        </li>
        {%end%}
          <!-- <li class="breadcrumb-item actve" style="float:right;">
            <a href="javascript:void(0)" id="btn_modify">
              <img alt="[编辑]" src="%E6%94%B6%E5%85%A5%E7%AE%A1%E7%90%86_files/modify.png" width="25">
            </a>
            <a href="http://127.0.0.1:9999/project?tag=project_recode&amp;id=2462" id="btn_recode">业务记录</a>
            <a href="http://127.0.0.1:9999/project?tag=manage_addr&amp;id=2462" id="btn_recode">办理地址管理</a>
          </li> -->
        </ol>

<div class="row" >

<div class="col-lg-12">
{%if is_cancel==2%}
	<div style="width: 153px; height: 149px; position: absolute; top: 24px; left: 132px; z-index: 9;">
		<img src="/static/images/chapter2.png" alt="">
	</div>

{%elif is_end==2%}
	<div style="width: 153px; height: 149px; position: absolute; top: 24px; left: 132px; z-index: 9;">
		<img src="/static/images/chapter1.png" alt="">
	</div>
  {%end%}

<!-- .. -->
<div class="card mb-3">
<div class="faye-table" style="font-size:12px;">
	<ul>

		<li>
			<div class="fayet" style="border-left: none;">订单编号</div>
			<div class="fayet1">{{t_project.id}}
        <a href="/project?tag=relation_show&guid={{t_project.guid}}&id={{t_project.id}}">关联订单</a>
      </div>

			<div class="fayet">公司名称</div>
			<div class="fayet11">

                    {%if  t_project.customer_company%}
                      {%if t_customer%}
                      <a href="/customer?tag=show&id={{t_customer.id}}&guid={{t_customer.guid}}&from_tag=1" target="_blank">{{t_project.customer_company}}</a>
                      {%else%}
                      {{t_project.customer_company}}

                    {%end%}
                    {%else%}
                    {%end%}
                    {%if visible_project%}
                    <a href="javascript:void(0)" id="relation_other_project" {%if t_projects_relation%}
                    project_relation_id={{t_projects_relation.id}} {%end%}>关联</a>
                    {%end%}
                    <!-- {%if t_project.contract_confirm_id ==57 and role=='13'%}
                    <a href='javascript:void(0)' id="btn_modify1" id> <img alt="[编辑]" width="25" src="/static/images/modify.png"></a>
                    {%end%} -->
                  </div>
			<div class="fayet">客户联系人</div>
			<div class="fayet1">{%if  t_project.customer_name%}
                    {{t_project.customer_name}}
                    {%else%}
                    {%end%}
                    <!-- {%if t_project.contract_confirm_id ==57 and role=='13'%}
                    <a href='javascript:void(0)' id="btn_edit_kehu"> <img alt="[编辑]" width="25" src="/static/images/modify.png"></a>
                    {%end%} -->
                  </div>
			<div class="fayet">电话</div>
			<div class="fayet1">           {%if  t_project.customer_tel%}
                    {{t_project.customer_tel}}
                    {%else%}
                      无
                    {%end%}</div>

    </li>
    {%if t_project.promo_id_name%}
    <li>
      <div class="fayet" style="border-left: none;">优惠活动</div>
      <div class="fayet3">
        <code>{{t_project.promo_id_name}}</code>
      </div>
    </li>
    {%end%}
    <li><div class="fayet" style="border-left: none;">变动纪录</div>
    <div class="fayet3">
        {%if t_project_chuna_history%}{{t_project_chuna_history.uid_name}} {{t_project_chuna_history.updated_at.strftime("%Y-%m-%d")}} 对信息继续改动：
        {%if  (len(t_project_chuna_history.company.split('|'))==2 and t_project_chuna_history.company.split('|')[1]!='') or len(t_project_chuna_history.company.split('|'))!=2 %}
        公司：{%if t_project_chuna_history.company.replace('|','➡')[-1]=='➡'%}{{t_project_chuna_history.company.replace('|','➡')[:-1]}}{%else%}{{t_project_chuna_history.company.replace('|','➡')}}{%end%}{%end%}
        {%if  (len(t_project_chuna_history.customer_name.split('|'))==2 and t_project_chuna_history.customer_name.split('|')[1]!='') or len(t_project_chuna_history.customer_name.split('|'))!=2 %}
        &nbsp;客户：{%if t_project_chuna_history.customer_name.replace('|','➡')[-1]=='➡'%}{{t_project_chuna_history.customer_name.replace('|','➡')[:-1]}}{%else%}{{t_project_chuna_history.customer_name.replace('|','➡')}}{%end%}{%end%}
        {%if  (len(t_project_chuna_history.customer_tel.split('|'))==2 and t_project_chuna_history.customer_tel.split('|')[1]!='') or len(t_project_chuna_history.customer_tel.split('|'))!=2 %}
        &nbsp;电话：{%if t_project_chuna_history.customer_tel.replace('|','➡')[-1]=='➡'%}{{t_project_chuna_history.customer_tel.replace('|','➡')[:-1]}}{%else%}{{t_project_chuna_history.customer_tel.replace('|','➡')}}{%end%}{%end%}
        {%if  (len(t_project_chuna_history.project_name.split('|'))==2 and t_project_chuna_history.project_name.split('|')[1]!='') or len(t_project_chuna_history.project_name.split('|'))!=2 %}
        &nbsp;业务内容：{%if t_project_chuna_history.project_name.replace('|','➡')[-1]=='➡'%}{{t_project_chuna_history.project_name.replace('|','➡')[:-1]}}{%else%}{{t_project_chuna_history.project_name.replace('|','➡')}}{%end%}{%end%}
        {%end%}
    </div>
    </li>
		<li>
        <div class="fayet" style="border-left: none;">公司曾用名</div>
        <div class="fayet3">

          {%if company_history%}
          {%for row_c in  company_history%}
          {{row_c.company}}-{{row_c.uid_name}} &nbsp;
          {%end%}
          {%else%}
          无
          {%end%}
          {%if (role=='8' or  t_project.uid==uid or company_history_permission) and company_history %}
            <a href="javascript:void(0);" id="delete_company_history">删除</a>
          {%end%}
        </div>
      </li>
		<li>
			<div class="fayet" style="border-left: none;">业务内容</div>
			<div class="fayet3"> {%if  t_project.project_name%}
                    {{t_project.project_name}}
                    {%else%}
                    {%end%}
        </div>
    </li>
   <!-- <li>
      <div class="fayet" style="border-left: none;">应收记录</div>
      <div class="fayet3">

上期应收: 2018.6-2018.11月服务费已收，2018.6-2019.5月账册费已收








      </div>
    </li>-->

		<li>
			<div class="fayet" style="border-left: none;">地址类型</div>
			<div class="fayet3">         {%if  t_project.addr_type%}
                    {{t_project.addr_type}}
                    {%else%}
                      无
                    {%end%}</div>
		</li>
    		<li>
			<div class="fayet" style="border-left: none;">合同情况</div>
			<div class="fayet3">
         {{t_project.contract_confirm_id_name}}
 {%if t_project.contract_confirm_id !=57%}




                 {%if t_project.contract_uid_name%}
      <span class="bg-success" style="color:#fff;font-size:16px; padding:5px;">  <b>


                  ({{t_project.contract_uid_name}} 已经确认）   {{t_project.contract_confirm_at}}   </b></span>

                  {%else%}
                    {%if int(role)==5%}
                <a href="javascript:void(0)" class="btn btn-primary" id="btn_contract_confrim">马上确认</a>
                {%else%}
                     <span class="bg-info" style="color:#fff;font-size:16px; padding:5px;">  <b>待合同岗确认
                </b></span>
                {%end%}
                  {%end%}

                {%if t_project.contract_remark%} 备注： {{t_project.contract_remark}} {%end%}

              {%else%}
                {%if int(role)==5%}
                <a href="javascript:void(0)" class="btn btn-primary" id="btn_contract_confrim">马上确认</a>
                {%else%}
                 <span class="bg-info" style="color:#fff;font-size:16px; padding:5px;">  <b>待合同岗确认
                </b></span>{%end%}
              {%end%}


                    </div>
</li>

<li>


			<div class="fayet" style="border-left: none;">来源关键词</div>
			<div class="fayet3">

        {%if t_project.busniess_from_id=="2"%}
             {%if t_project.from_word_uid >0 %}
                 {{t_project.from_word}}
                  ({{t_project.from_word_uid_name}} 已确认)


                   {{t_project.from_word_confirm_at}}

              {%else%}


                {%if int(role)==6%}
                 {{t_project.from_word}}
                    <a href="javascript:void(0)" class="btn btn-primary" id="btn_fromword_confrim">马上确认</a>
                {%else%}


                        <font color='blue'>待确认</font>




                  {%end%}

                {%end%}

              {%else%}
  <span style="background-color:yellow">非推广业务 无关键词</span>
 {%end%}
      </div>

		</li>




    		<li>
	<div class="fayet"  style="border-left: none;">是否记账</div>

			<div class="fayet1"> {%if t_project.is_finance%} 是{%else%} 否 {%end%}</div>



			<div class="fayet">来源关键词</div>
			<div class="fayet1">{{t_project.from_word}}

         </div>
			<div class="fayet">签约场景</div>
			<div class="fayet1">  {%if  t_project.contract_sign_type_name%}
                    {{t_project.contract_sign_type_name}}
                    {%else%}
                      无
                    {%end%}</div>
			<div class="fayet">成交周期</div>
			<div class="fayet1"> {{t_project.deal_day}} </div>
      	<div class="fayet">创建时间</div>
			<div class="fayet1">   {%if  t_project.created_at%}
                    {{t_project.created_at}}
                    {%else%}
                      无
                    {%end%}</div>
    </li>
		<li>
			<div class="fayet" style="border-left: none;">来源渠道</div>
			<div class="fayet1">{{t_project.busniess_from_id_name}}</div>
			<div class="fayet">来源方式</div>
			<div class="fayet1"> {%if t_project.talk_type_id_name%} {{t_project.talk_type_id_name}} {%else%} 无 {%end%}</div>

            	<div class="fayet" >创建人</div>
			<div class="fayet1"> {%if t_project.uid_name%} {{t_project.uid_name}} {%else%} 无 {%end%}</div>

			<div class="fayet">在线客服</div>
			<div class="fayet1">{{getMemberName(t_project_members,"在线客服")}}</div>
			<div class="fayet">客户推荐人</div>
			<div class="fayet1">{{t_project.recommend_by}} </div>
		</li>


        		<li>
			<div class="fayet" style="border-left: none;">客服顾问</div>
			<div class="fayet1">{{getMemberName(t_project_members,"客服顾问")}}</div>
			<div class="fayet">销售顾问</div>
			<div class="fayet1">{{getMemberName(t_project_members,"销售顾问")}}</div>
			<div class="fayet">工商专员</div>
			<div class="fayet1">{%raw getMemberNameCQ1(t_project_members,"工商专员")%}</div>
			<div class="fayet">内部推荐人</div>
			<div class="fayet1">{{t_project.recommend_staff}}</div>
			<div class="fayet">组长</div>
			<div class="fayet1"> {{getMemberName(t_project_members,"组长")}}</div>
		</li>{%if t_project.remark%}
		<li>

					<div class="fayet" style="color:red;font-size:20px; ">备注信息</div>
			<div class="fayet60" style="color:red; font-size:20px; padding-left:20px;"> {{t_project.remark}}</div>

		</li>  {%end%}
    <li>
        <div class="fayet"  style="border-left: none;">待收代收款</div>

        <div class="fayet3">
          {%if t_projects_income_all %}
          {%for t_projects_income in t_projects_income_all%}
          {{t_projects_income['income_name']}}:{{t_projects_income['income_money']}}
          {%end%}
          {%end%}
          {%if role=='3'%}
          <div  style="background-color:#eee; border-bottom: 1px solid #dedede;float: right;padding:0 5px;">
            <a id="add_project_type" href="javascript:void(0)" confirm_id="{{t_project.contract_confirm_id}}"><i class="fa fa-fw fa-comment"></i>设置</a>
          </div>
          {%end%}
        </div>

      </li>

		<li>
			<div class="fayet" style="border-left: none;">总服务费</div>
			<div class="fayet1"> {%if t_project.all_income%} {{t_project.all_income}} {%else%} 0  {%end%}</div>

			<div class="fayet">约定定金</div>
			<div class="fayet1">  {%if t_project.pre_income%} {{t_project.pre_income}} {%else%} 0  {%end%}</div>
			<div class="fayet">合同到款</div>
			<div class="fayet1"> {{t_project_income_wait.aa+t_project_income_wait.bb}}</div>

			<div class="fayet">合同欠款</div>
			<div class="fayet1">{{(t_project.all_income - t_project_income_wait.dd)}}</div>
      <div class="fayet">总欠款</div>
			<div class="fayet1">
        {%if t_projects_income_allmoney['sum(income_money)'] %}

        {{t_project.all_income - t_project_income_wait.dd+t_projects_income_allmoney['sum(income_money)']-t_project_income_wait.cc}}
        {%else%}
        {{t_project.all_income - t_project_income_wait.dd-t_project_income_wait.cc}}
        {%end%}

      </div>

		</li>

    <li class="gaodu">
			<div class="fayet6" style="border-left: none;">
				<span>合同定金 (合计: {{t_project_income_wait.aa}} 元)</span>
				<i>
				{%for item in t_project_income%}
						{%if item.income_id==40%}


								第{{item.income_num}}笔 {{item.income_money}}元

								{{item.pay_type_name}}  {{item.income_at_a.strftime("%Y-%m-%d")}}


								<br>

								{%if item.remark %}备注:{{item.remark}} <br>{%end%}
						{%end%}
						{%end%}
				</i>
			</div>
			<div class="fayet7">
				<span>尾款 (合计: {{t_project_income_wait.bb}} 元)</span>
				<i>
		{%for item in t_project_income%}
								{%if item.income_id==43%}
								第{{item.income_num}}笔 {{item.income_money}}元
							{{item.pay_type_name}}  {{item.income_at_a.strftime("%Y-%m-%d")}}	 <br>

								{%if item.remark %}备注:{{item.remark}} <br>{%end%}
            {%end%}	{%end%}
				</i>
			</div>
			<div class="fayet6">
				<span>代收款（合计：{{t_project_income_wait.cc}}  元）</span>
				<i>

									{%for item in t_project_income%}
								{%if item.income_id>43%}
								第{{item.income_num}}笔 {{item.income_name}}  {{item.income_money}}元
							{{item.pay_type_name}}  {{item.income_at_a.strftime("%Y-%m-%d")}}	 <br>

								{%if item.remark %}备注:{{item.remark}} <br>{%end%}
						{%end%}	{%end%}
				</i>
			</div>
		</li>
	</ul>
</div>



</div>


        </div>

      <div class="col-lg-12">





       <div class="card-columns">




               <div class="card mb-12 topxian" id="yewushouru">

              <div class="card-body" >
                <h6 class="card-title mb-1"><a href="#">业务收入明细</a>


                  {%if  (t_project.uid==int(uid) or int(getMemberId(t_project_members,"销售顾问")) == int(uid) or int(getMemberId(t_project_members,"客服顾问")) == int(uid) )and not t_project.contract_uid_name%}

                 <a href="javascript:void(0)" id="a_add_service"
                   class=" mr-3 d-inline-block"> <i class="fa fa-fw fa-comment"></i>设置</a>

                 {%elif  role=="2" or  role=="3" or  role=="5"  or role=="8" %}


                     <a href="javascript:void(0)" id="a_add_service"
                   class=" mr-3 d-inline-block"> <i class="fa fa-fw fa-comment"></i>设置</a>


                   {%end%}



 </h6></div>


              <hr class="my-0">

              <div class="card-body  bg-faded">
             {%if t_projects_service_income_list%}
            {%for item in t_projects_service_income_list%}
              <div class="card-body py-2 ">
            <span class="clearfix  z-1">

      <a href="javascript:void(0)" class="a_delete_service_money" guid="{{item.guid}}" id="{{item.guid}}"><img  alt="删除该条记录" src="/static/images/delete.png" width="25" /></a>
<b>{{item.uid_name}}</b> 设置  <b>{{item.service_name}}</b> 收入 {{item.service_money}} 元  ({{item.updated_at}} )



            </span>
             </div>  <hr class="my-0">
            {%end%}
          {%else%}     <hr class="my-0"><div class="card-body py-2 ">
                还没有业务收入明细哦
</div>
                {%end%}
                <p id='daokuanjiesuan'></p>
              </div>

              <div class="card-footer  text-muted"> 合计总服务费  {{t_project.all_income}} 元 </div>

            </div>

            <div class="card-columns topxian">
                <div class="card mb-12" >

                          <div class="card-body">
                        <h6 class="card-title mb-1"><a href="#">到款结算信息</a>
                                {%if t_project.uid==int(uid) or role== "2" or role== "3" or role=="8" or int(getMemberId(t_project_members,"销售顾问")) == int(uid)  or int(getMemberId(t_project_members,"客服顾问")) == int(uid)%} /
                                 <a href="javascript:void(0)" id="new_income_other1" class=" mr-3 d-inline-block">
                                  <i class="fa fa-fw fa-comment"></i>新建</a>{%end%}



             </h6>

                          </div>


                          <hr class="my-0">

                        {%if t_project_income_title%}
                        {%for item in t_project_income_title%}
                       <div class="card-body py-2 ">
                       {%if item.income_uid%} <a target="_blank" href="project?tag=print&project_id={{t_project.id}}&project_guid={{t_project.guid}}&title_id={{item.id}}">
                       <img width="20" src="/static/images/print.png">打印</a>{%end%}

                       {%if item.fi_confirm_uid%} <a target="_blank" href="project?tag=print_to_customer_preview&project_id={{t_project.id}}&project_guid={{t_project.guid}}&title_id={{item.id}}">
                       <img width="20" src="/static/images/print.png">打印客户告知函</a>{%end%}

                   {%if ( role=="3") or (role=="2"  and not item.income_uid) or  (t_project.uid==int(uid) and not item.income_uid) %}
                          <a alt="删除该条记录" href="javascript:void(0)" class="delete_income"
                          income_curr_id="{{item.id}}" income_curr_guid="{{item.guid}}">
                       <img width="20" src="/static/images/delete.png">删除</a>
            {%end%}


             <!-- {%if ( role=="3") or (role=="2"  and not item.income_uid) or (t_project.uid==int(uid) or not item.income_uid) %}{%end%} -->
            {%if  (role=='2' or role=='3' or role=='5') or (not item.income_uid) or (name=="陈太智")%}

                        <a href="javascript:void(0)" income_at="{{item.income_at}}" pay_type_id="{{item.pay_type_id}}" pay_type_name="{{item.pay_type_name}}" parent_id="{{item.id}}" company_id="{{item.company_id}}" company_id_name="{{item.company_id_name}}"  class="show_income_modify" >
                        <img width="20" src="/static/images/modify.png"> 修改</a>{%end%}
                            {{item.income_at}}  {{item.uid_name}} 入账-
                            {{item.income_title}}

                             -
                            {%if item.pay_list%}
                            <font color='blue'><b>[{{item.pay_list}}]</b></font>-
                            {%end%}
                            {{item.company_id_name}}-{{item.pay_type_name}} <b>合计:{{item.income_money_total}} 元</b>




                         {%if item.income_uid%}
                          <span class="bg-success" style="color:#fff;font-size:14px; padding:5px;">  <b>出纳({{item.income_uid_name}})于{{item.income_uid_at}}确认</b></span>

                            {%if item.fi_confirm_uid%}
                            <span class="bg-success" style="color:#fff;font-size:14px; padding:5px;">
                             <b>财务({{item.fi_confirm_uid_name}})于{{item.fi_confirm_at}}确认</b></span>

                            {%else%}
                            {%if role=="3"%}
                                  <input type="button" income_id="{{item.id}}" class="btn btn-primary btn-sm btn_confirm" value="确认"
                                   title_guid="{{item.guid}}"
                                    title_id="{{item.id}}" ctype="2" />
                              {%else%}
                                 <span class="bg-info" style="color:#fff;font-size:14px; padding:5px;">  <b>待财务确认</b>   </span>
                              {%end%}
                            {%end%}
                           {%if role=="3" or role=="2" or (t_project.uid==int(uid)) and not item.income_uid%}   </a>{%end%}
                           {%if item.is_print==0%}
                           <span class="bg-info" style="color:#fff;font-size:14px; padding:5px;margin-left:3px;">  <b>尚未打印</b>   </span>
                           {%else%}

                           <span class="bg-dark" style="color:#fff;font-size:14px; padding:5px;margin-left: 3px;">  <b>已打印</b>   </span>
                           {%end%}
                         {%else%}

                            {%if role=="2"%}
                                <input type="button" title_id="{{item.id}}"  ctype="1"  class="btn_confirm" value="确认"
                              title_guid="{{item.guid}}"
                              />

                              {%else%}
                               <span class="bg-info" style="color:#fff;font-size:16px; padding:8px;">   <b>待出纳确认</b>      </span>

                              {%end%}


                         {%end%}


                         </div>        <hr class="my-0">

                          {%end%}

                            {%else%}
                                <div class="card-body py-2 ">
                                          还没有代收款项结算信息哦
                                      </div>
                            {%end%}


                          <div class="card-footer  text-muted small">{{len(t_project_income_title)}} 笔到款

                          合同金额：{{t_project.all_income}} 元|  待确认合同: {{wait_rec_income_money}} 元 |
                          已确认合同: {{rec_income_money}} 元

                            代收合计：{{wait_rec_income_money_other.c+wait_rec_income_money_other.c}}
                             元|  待确认代收: {{wait_rec_income_money_other.c}} 元 |
                            已确认代收: {{rec_income_money_other.c}} 元



                          </div>
                </div>
                <div class="card mb-12 topxian" id='yewuxiangguan'>

                    <div class="card-body">
                      <h6 class="card-title mb-1"><a href="#">业务相关人员</a>
       {%if   t_project.uid==int(uid) or role=="7" or role=="8" or role=="3" or int(getMemberId(t_project_members,"客服顾问")) == int(uid) %} /
                       <a href="javascript:void(0)" id="a_add_team" class=" mr-3 d-inline-block"> <i class="fa fa-fw fa-comment"></i>设置</a>

       {%end%}
         {%if (role=="7") or (role=="8") or (name=="陈月娇")%}
                             <a href="javascript:void(0)" id="a_add_team_cq" class=" mr-3 d-inline-block"> <i class="fa fa-fw fa-comment"></i><b>新增工商专员</b></a>
                          {%end%}
       </h6> </div>
                    <hr class="my-0">
                    <div class="card-body  bg-faded">
                    {%if t_project_members %}
                       <div class="row">
                      {%for item in t_project_members%}
                      <div class="media col-xl-4 col-sm-6 mb-3">
                        <img class="d-flex mr-3" src="/static/images/avatar.jpeg" width="65" alt="{{item.team_name}}">
                        <div class="media-body">
                          <h6 class="mt-0 mb-1">
                          <a href="#">{{item.name}}</a></h6>{{item.team_name}}
                          {%if item.btype_id%}
      ({{item.btype_id_name}})
                          {%end%}



                       {%if  role=="7" and item.team_id==38 or  (item.btype_id==158 and name=="陈月娇") or  (item.updated_uid_name==name and item.team_id==38) or role=='8' or name=='吴蔚亮'%}

                        <a href="javascript:void(0)"
                          team_id="{{item.team_id}}"
                          project_id="{{item.project_id}}"
                          ddf="{{item.ddf}}"
                             mid="{{item.mid}}"
                             guid="{{item.guid}}" class="a_delete_member" guid="{{item.guid}}" staff_name="{{item.name}}">
                             <img width="20" src="/static/images/delete.png"/>
                             </a>
                      {%else%}


                          {%if t_project.uid==int(uid) and item.team_id!=38 or  item.updated_uid_name==name %}

                            <a href="javascript:void(0)"
                                team_id="{{item.team_id}}" project_id="{{item.project_id}}"
                                 mid="0" ddff="{{item.ddff}}"
                                  guid="{{item.guid}}" class="a_delete_member" guid="{{item.guid}}" staff_name="{{item.name}}">
                                  <img width="20" src="/static/images/delete.png"/>
                                  </a>
                        {%end%}


                          {%end%}



                                  <ul class="list-inline mb-0">
                            <li class="list-inline-item">
                              {{item.created_at}}
                            </li>


                          </ul>
                        </div>
                      </div>  {%end%}


                      </div>
                      {%else%}
                      还没有设置相关人员哦

                      {%end%}

                    </div>
                    <div class="card-footer  text-muted small"> 当前有 {{len(t_project_members)}} 位成员</div>
                  </div>
             <!-- Example Social Card-->
                        <div class="card mb-12 topxian" id='jiaodaishixiang'>

                          <div class="card-body">
                            <h6 class="card-title mb-1"><a href="#">交代事项</a>
                              {%if visible_project%}
                               <a href="javascript:void(0)" id="a_add_note"
                               class=" mr-3 d-inline-block"> <i class="fa fa-fw fa-comment"></i>新增</a>
                               
                               {%if role!='6'%}
                               <a href="javascript:void(0)" id="a_read_note"
                               class=" mr-3 d-inline-block"> <i class="fa fa-fw fa-align-justify"></i>查看</a>
                               {%end%}
                               {%end%}
                               {%if is_check=='1'%}
                               <a href="javascript:void(0)" id="a_check_note" class="mr-3 d-inline-block">
                                 <i class="fa fa-fw fa-align-justify"></i>审核
                               </a>
                               {%end%}
             </h6></div>


                          <hr class="my-0">

                          <div class="card-body  bg-faded">
                         {%if project_note%}
                         {% if visible_note%}
                         {%for item in project_note%}
                         <div class="card-body py-2" {%if item.is_check==1 %}style="background-color:#D6EAF8;"{%end%}>
                       <span class="clearfix  z-1 ">
                        {%if visible_project%}
                {%if item.note_id%}
                    <a class="mr-3 d-inline-block cancel_note" href="javascript:void(0)" note_id='{{item.aid}}' is_cancel='{{item.is_cancel}}'>
                        {%if item.is_cancel==0%}作废{%else%}恢复{%end%}</a>
                {%else%}
                 <a href="javascript:void(0)" class="a_change_note"  id="{{item.aid}}" note="{{item.msg}}">
                  <img  alt="修改该条记录" src="/static/images/modify.png" width="25" /></a>
                 <a href="javascript:void(0)" class="a_delete_note"  id="{{item.aid}}">
                   <img  alt="删除该条记录" src="/static/images/delete.png" width="25" /></a>
                  {%end%}
                  {%end%}
            <b>{%if item.state_id==0%} <span class="badge badge-info">已通过</span>{%elif item.state_id==1%} <span class="badge badge-danger">未通过</span>{%elif item.is_check==1%}<span class="badge badge-dark">待审核</span>{%end%}{{item.uid_name}} ({{item.creatd_at}} )</b> :<span style="font-size:20px; color:red;">
               <b>{%if item.is_cancel==1%}<s>{{item.msg}}</s>{%else%}{{item.msg}}{%end%}{%if item.remark%} 备注：{{item.remark}}{%end%}</b>
               <!--
            {%if item.note_id%}<span class="bg-primary" style="color:#fff;font-size: 80%;padding:5px;">已读</span>{%else%}
            <span class="bg-danger" style="color:#fff;font-size: 80%;padding:5px;">未读</span>{%end%}
                       </span>-->

            {%if item.read_name%}
            {%for strs in item.read_name.split(",")%}
                {%if strs%}
              <span class="badge badge-info">{{strs}}</span>
                {%end%}
            {%end%}
            {% if item.check_at%}
            {%if item.state_id==0 and item.check_at%}
            <span class="alert alert-success">{{item.check_name}}
            确认审核通过</span>{%else%} <span class="alert alert-danger">{{item.check_name}}驳回{</span>{%end%}
             {%if item.remark%}备注：{{item.remark}}{%end%}
             {%elif item.created_name%}
            {%if item.state_id==0%}
            <span class="alert alert-info">
               {{item.created_name}}
            审核通过(待确认)</span>
             {%if item.state_id==0 and not item.check_at and '287' in role_list%}
             <button  href="javascript:void(0);" check_id="{{item.check_id}}" class="check_note_finish">确认</button>
             <button  href="javascript:void(0);" check_id="{{item.check_id}}" class="check_note_bouhui">驳回</button>
             {%end%}
             {%else%}
             <span class="alert alert-danger">
                 {{item.created_name}}
             驳回</span>{%end%}
             {%if item.remark%}备注：{{item.remark}}{%end%}
             {%end%}
            {%end%}
            {%if role=='3'%}
            {%if item.is_add_to_print==0%}
            <a href="javascript:void(0);" class="button btn-secondary btn-sm add_to_print" id="{{item.id}}" >添加到打印</a>
            {%else%}
            <a href="javascript:void(0);" class="button btn-secondary btn-sm delete_from_print" id="{{item.id}}">从打印移除</a>
            {%end%}
            {%end%}
            </div>  <hr class="my-0">
                       {%end%}

                         {%else%}
                        {%for item in project_note%}
                          <div class="card-body py-2 ">
                        <span class="clearfix  z-1">
                          {%if visible_project%}
                  <a href="javascript:void(0)" class="a_delete_note"  id="{{item.aid}}">
                    <img  alt="删除该条记录" src="/static/images/delete.png" width="25" /></a>
                    {%end%}
                    {%if item.is_check==1 and not item.check_id %}
                    <span class="badge badge-dark">待审核</span>{%end%}
            <b> {{item.creatd_at}} {{item.uid_name}}</b> :<span style="font-size:20px; color:red;"> <b>{{item.msg}}</b>


                        </span>

            {%if item.read_name%}
            {%for strs in item.read_name.split(",")%}
              <span class="badge badge-info">{{strs}}</span>
            {%end%}

            {%end%}
          
            {% if item.check_at%}
           {%if item.state_id==0 and item.check_at%}
           <span class="alert alert-success">{{item.check_name}}
           确认审核通过</span>{%else%} <span class="alert alert-danger">{{item.check_name}}驳回{</span>{%end%}
            {%if item.remark%}备注：{{item.remark}}{%end%}
            {%elif item.created_name%}
           {%if item.state_id==0%}
           <span class="alert alert-info">
              {{item.created_name}}
           审核通过(待确认)</span>
            {%if item.state_id==0 and not item.check_at and '287' in role_list%}
            <button  href="javascript:void(0);" check_id="{{item.check_id}}" class="check_note_finish">确认</button>
            <button  href="javascript:void(0);" check_id="{{item.check_id}}" class="check_note_bouhui">驳回</button>
            {%end%}
            {%else%}
            <span class="alert alert-danger">
                {{item.created_name}}
            驳回</span>{%end%}
            {%if item.remark%}备注：{{item.remark}}{%end%}
            {%end%}

            {%if role=='3'%}
            {%if visible_project%}
            {%if item.is_add_to_print==0%}
            <a href="javascript:void(0);" class="button btn-secondary btn-sm add_to_print" id="{{item.id}}" >添加到打印</a>
            {%else%}
            <a href="javascript:void(0);" class="button btn-secondary btn-sm delete_from_print" id="{{item.id}}">从打印移除</a>
            {%end%}
            {%end%}
            {%end%}
            {%if item.is_chengjiao==1%}
            <b style="font-size:20px;">(成交事项)</b>
            {%end%}
                         </div>  <hr class="my-0">
                        {%end%}
                        {%end%}
                      {%else%}
                          <hr class="my-0"><div class="card-body py-2 ">
                            还没有交代事项哦
            </div>
                            {%end%}

                          </div>
                          <div class="card-footer  text-muted"> 合计总服务费  {{t_project.all_income}} 元 </div>
                        </div>



             <div class="card mb-3 topxian" id="banlijindu">

                          <div class="card-body ">
                            <h6 class="card-title mb-1 ">

            办理进度更新记录

            {%if t_project.is_expedited==1%}
                 <font color='red' style="font-size:18px;"> <b>(加急业务)</b></font>
            {%end%}


                               {%if t_project.building_id > 0%}
                                <font color='green'> (此业务为楼盘客户) </font>



                               {%end%}
                               <!-- <a href="javascript:void(0)"
                               type_id="2"
                                class=" mr-3 d-inline-block a_project_state_modal" style="font-size:14px;">
                                 <i class="fa fa-fw fa-comment"></i>新增</a> -->
                            </h6>

                          </div>

             <hr class="my-0">

            <div class="row">
            <div class="col">


            <div style="margin-top:10px;margin-bottom:40px">

                <div class="qa-message-list" id="wallmessages">
                          <center> <h6 class="card-title mb-1 "><a href="#">公司注册办理进度</a>

                           {%if t_project.building_id > 0%}
                           {%if visible_project%}
                           <span id="show_building_link_span">
                            <a target="_blank" class="show_building_link" href="http://building.gzfaye.com/show?modal_show=1&tag=customer_state&qid={{t_project.id}}&building_name={{t_project.building_id_name}}&urgent={{t_project.is_expedited}}&sales={{getMemberName(t_project_members,"销售顾问")}}&customer_tel={{t_project.customer_tel}}&customer_name={{t_project.customer_name}}&customer_company={{t_project.customer_company}}"
                            class=" mr-3 d-inline-block" style="font-size:14px;" type_id="1"> <i class="fa fa-fw fa-comment"></i>新增</a>
                            {%end%}
                            <a target="_blank" class="show_building_link" href="http://building.gzfaye.com/show?tag=customer_state&qid={{t_project.id}}&building_name={{t_project.building_id_name}}&urgent={{t_project.is_expedited}}&sales={{getMemberName(t_project_members,"销售顾问")}}&customer_tel={{t_project.customer_tel}}&customer_name={{t_project.customer_name}}&customer_company={{t_project.customer_company}}"
                            class=" mr-3 d-inline-block " style="font-size:14px;" ><span class="fa fa-fw fa-align-justify"></span>全部进度</a>
                            </span>



                            <a target="_blank" class="show_building_link"
                              href="http://building.gzfaye.com/show?tag=list&is_my=1" class=" mr-3 d-inline-block" style="font-size:14px;">
                             <span class="fa fa-fw fa-align-justify"></span> 进入楼盘系统</a>
                           {%else%}
                           {%if visible_project%}
                            <a href="javascript:void(0)"
                            class=" mr-3 d-inline-block a_project_state_modal" style="font-size:14px;" type_id="1"> <i class="fa fa-fw fa-comment"></i>新增</a>
                            {%end%}
                            <a href="javascript:void(0)"
                            class=" mr-3 d-inline-block show_all1" style="font-size:14px;" ><span class="fa fa-fw fa-align-justify"></span>全部进度</a>

               {%end%}


                          </h5></center>


            {%if t_project.building_id > 0%}
                    <div id="show_building_status">



                    </div>

            {%else%}
                     {%if t_project_state_msg1%}

                      {%for item in t_project_state_msg1[:4]%}
                      <div class="message-item" id="m9">
                        <div class="message-inner">
                          <div class="message-head clearfix">

                            <div class="avatar pull-left"><img  src="/static/images/avatar.jpeg"></div>
                            <div class="user-detail">
                              <h5 class="handle">{{item.uid_name}} <span style="font-size:13px;">{{item.created_at}} 将设置状态：
                               {{item.state_id_name}}</span>
                               </h5>

                            </div>
                          </div>
                          {%if item.state_remark%}
                          <div class="qa-message-content">
                            {{item.state_remark}}
                          </div>
                          {%else%}
                          无描述
                          {%end%}

                      </div>


                      </div>

                      {%end%}
                             {%else%}
                            <div class="card-body py-2 "><div class="alert alert-secondary" role="alert"> 还没有办理进度数据记录哦</div></div>
                            {%end%}   {%end%}
                    </div>

            </div>




            </div>

              <div class="col">


                <div style="margin-top:10px;margin-bottom:40px; margin-right: 10px;">

                  <div class="qa-message-list" id="wallmessages">
                    <center>
                      <h6 class="card-title mb-1 ">
                        <a href="#">公司变更办理进度</a>
                        {%if visible_project%}
                        <a href="javascript:void(0)"
                        class=" mr-3 d-inline-block a_project_state_modal1" style="font-size:14px;" type_id="2">
                        <i class="fa fa-fw fa-comment"></i>新增</a>{%end%}
                        <a href="javascript:void(0)"
                        class=" mr-3 d-inline-block show_all2" style="font-size:14px;" ><span class="fa fa-fw fa-align-justify"></span>全部进度</a>
                        </h5>
                    </center>

                    {%if t_project_state_msg2%}
                     {%for item in t_project_state_msg2[:4]%}

                    <div class="message-item" id="m9">
                      <div class="message-inner">
                        <div class="message-head clearfix">

                          <div class="avatar pull-left">
                            <img src="/static/images/avatar.jpeg">
                          </div>
                          <div class="user-detail">
                            <h5 class="handle">{{item.uid_name}}
                              <span style="font-size:13px;">{{item.created_at}} 将设置状态： {{item.state_id_name}}
                              </span>
                            </h5>

                          </div>
                        </div>
                        {%if item.state_remark%}
                        <div class="qa-message-content">
                          {{item.state_remark}}
                        </div>
                        {%else%} 无描述 {%end%}

                      </div>


                    </div>

                    {%end%} {%else%}
                    <div class="card-body py-2 ">
                      <div class="alert alert-secondary" role="alert"> 还没有办理进度数据记录哦</div>
                    </div>
                    {%end%}
                  </div>

                </div>




              </div>

            </div>
            <div class="row">
                <div class="col">


                <div style="margin-top:10px;margin-bottom:40px">

                    <div class="qa-message-list" id="wallmessages">
                              <center> <h6 class="card-title mb-1 "><a href="#">解除异常办理进度</a>
                                {%if visible_project%}
                                <a href="javascript:void(0)"
                                class=" mr-3 d-inline-block a_project_state_modal2" style="font-size:14px;" type_id="3"> <i class="fa fa-fw fa-comment"></i>新增</a>{%end%}
                                <a href="javascript:void(0)"
                                class=" mr-3 d-inline-block show_all3" style="font-size:14px;" ><span class="fa fa-fw fa-align-justify"></span>全部进度</a>
                              </h5></center>

                         {%if t_project_state_msg3%}
                          {%for item in t_project_state_msg3[:4]%}
                          <div class="message-item" id="m9">
                            <div class="message-inner">
                              <div class="message-head clearfix">

                                <div class="avatar pull-left"><img src="/static/images/avatar.jpeg"></div>
                                <div class="user-detail">
                                  <h5 class="handle">{{item.uid_name}} <span style="font-size:13px;">{{item.created_at}} 将设置状态：
                                   {{item.state_id_name}}</span>
                                   </h5>

                                </div>
                              </div>
                              {%if item.state_remark%}
                              <div class="qa-message-content">
                                {{item.state_remark}}
                              </div>
                              {%else%}
                              无描述
                              {%end%}

                          </div>


                          </div>

                          {%end%}
                                 {%else%}
                                <div class="card-body py-2 ">
                                  <div class="alert alert-secondary" role="alert"> 还没有办理进度数据记录哦</div>
                                </div>
                                {%end%}
                        </div>

                </div>




                </div>

                  <div class="col">


                    <div style="margin-top:10px;margin-bottom:40px; margin-right: 10px;">

                      <div class="qa-message-list" id="wallmessages">
                        <center>
                          <h6 class="card-title mb-1 ">
                            <a href="#">公司注销办理进度</a> {%if visible_project%}
                            <a href="javascript:void(0)"
                            class=" mr-3 d-inline-block a_project_state_modal3" style="font-size:14px;" type_id="4">
                            <i class="fa fa-fw fa-comment"></i>新增</a>{%end%}
                            <a href="javascript:void(0)"
                            class=" mr-3 d-inline-block show_all4" style="font-size:14px;" ><span class="fa fa-fw fa-align-justify"></span>全部进度</a>

                            </h5>
                        </center>

                        {%if t_project_state_msg4%}
                         {%for item in t_project_state_msg4[:4]%}

                        <div class="message-item" id="m9">
                          <div class="message-inner">
                            <div class="message-head clearfix">

                              <div class="avatar pull-left">
                                <img src="/static/images/avatar.jpeg">
                              </div>
                              <div class="user-detail">
                                <h5 class="handle">{{item.uid_name}}
                                  <span style="font-size:13px;">{{item.created_at}} 将设置状态： {{item.state_id_name}}
                                  </span>
                                </h5>

                              </div>
                            </div>
                            {%if item.state_remark%}
                            <div class="qa-message-content">
                              {{item.state_remark}}
                            </div>
                            {%else%} 无描述 {%end%}

                          </div>


                        </div>

                        {%end%} {%else%}
                        <div class="card-body py-2 ">
                          <div class="alert alert-secondary" role="alert"> 还没有办理进度数据记录哦</div>
                        </div>
                        {%end%}
                      </div>

                    </div>




                  </div>

                </div>
            <div class="row">
                    <div class="col">


                    <div style="margin-top:10px;margin-bottom:40px">

                        <div class="qa-message-list" id="wallmessages">
                                  <center> <h6 class="card-title mb-1 "><a href="#">许可证办理进度</a>
                                    {%if visible_project%}<a href="javascript:void(0)"
                                    class=" mr-3 d-inline-block a_project_state_modal4" style="font-size:14px;" type_id="5"> <i class="fa fa-fw fa-comment"></i>新增</a>{%end%}
                                    <a href="javascript:void(0)"
                                    class=" mr-3 d-inline-block show_all5" style="font-size:14px;" ><span class="fa fa-fw fa-align-justify"></span>全部进度</a>
                                  </h5></center>

                             {%if t_project_state_msg5%}
                              {%for item in t_project_state_msg5[:4]%}
                              <div class="message-item" id="m9">
                                <div class="message-inner">
                                  <div class="message-head clearfix">

                                    <div class="avatar pull-left"><img src="/static/images/avatar.jpeg"></div>
                                    <div class="user-detail">
                                      <h5 class="handle">{{item.uid_name}} <span style="font-size:13px;">{{item.created_at}} 将设置状态：
                                       {{item.state_id_name}}</span>
                                       </h5>

                                    </div>
                                  </div>
                                  {%if item.state_remark%}
                                  <div class="qa-message-content">
                                    {{item.state_remark}}
                                  </div>
                                  {%else%}
                                  无描述
                                  {%end%}

                              </div>


                              </div>

                              {%end%}
                                     {%else%}
                                    <div class="card-body py-2 ">
                                      <div class="alert alert-secondary" role="alert"> 还没有办理进度数据记录哦</div>
                                    </div>
                                    {%end%}
                            </div>

                    </div>




                    </div>

                      <div class="col">


                        <div style="margin-top:10px;margin-bottom:40px; margin-right: 10px;">

                          <div class="qa-message-list" id="wallmessages">
                            <center>
                              <h6 class="card-title mb-1 ">
                                <a href="#">商标办理进度</a>
                                {%if visible_project%}
                                <a href="javascript:void(0)"
                                class=" mr-3 d-inline-block a_project_state_modal5" style="font-size:14px;" type_id="6">
                                <i class="fa fa-fw fa-comment"></i>新增</a>{%end%}
                                <a href="javascript:void(0)"
                                class=" mr-3 d-inline-block show_all6" style="font-size:14px;" ><span class="fa fa-fw fa-align-justify"></span>全部进度</a>
                                </h5>
                            </center>

                            {%if t_project_state_msg6%}
                             {%for item in t_project_state_msg6[:4]%}

                            <div class="message-item" id="m9">
                              <div class="message-inner">
                                <div class="message-head clearfix">

                                  <div class="avatar pull-left">
                                    <img src="/static/images/avatar.jpeg">
                                  </div>
                                  <div class="user-detail">
                                    <h5 class="handle">{{item.uid_name}}
                                      <span style="font-size:13px;">{{item.created_at}} 将设置状态： {{item.state_id_name}}
                                      </span>
                                    </h5>

                                  </div>
                                </div>
                                {%if item.state_remark%}
                                <div class="qa-message-content">
                                  {{item.state_remark}}
                                </div>
                                {%else%} 无描述 {%end%}

                              </div>


                            </div>

                            {%end%} {%else%}
                            <div class="card-body py-2 ">
                              <div class="alert alert-secondary" role="alert"> 还没有办理进度数据记录哦</div>
                            </div>
                            {%end%}
                          </div>

                        </div>




                      </div>

              </div>
            <div class="row">
                    <div class="col">


                    <div style="margin-top:10px;margin-bottom:40px">

                        <div class="qa-message-list" id="wallmessages">
                                  <center> <h6 class="card-title mb-1 "><a href="#">特殊业务办理进度</a>
                                    {%if visible_project%}
                                    <a href="javascript:void(0)"
                                    class=" mr-3 d-inline-block a_project_state_modal6" style="font-size:14px;" type_id="7"> <i class="fa fa-fw fa-comment"></i>新增</a>
                                    {%end%}
                                    <a href="javascript:void(0)"
                                    class=" mr-3 d-inline-block show_all7" style="font-size:14px;" ><span class="fa fa-fw fa-align-justify"></span>全部进度</a>
                                  </h5></center>

                             {%if t_project_state_msg7%}
                              {%for item in t_project_state_msg7[:4]%}
                              <div class="message-item" id="m9">
                                <div class="message-inner">
                                  <div class="message-head clearfix">

                                    <div class="avatar pull-left"><img src="/static/images/avatar.jpeg"></div>
                                    <div class="user-detail">
                                      <h5 class="handle">{{item.uid_name}} <span style="font-size:13px;">{{item.created_at}} 将设置状态：
                                       {{item.state_id_name}}</span>
                                       </h5>

                                    </div>
                                  </div>
                                  {%if item.state_remark%}
                                  <div class="qa-message-content">
                                    {{item.state_remark}}
                                  </div>
                                  {%else%}
                                  无描述
                                  {%end%}

                              </div>


                              </div>

                              {%end%}
                                     {%else%}
                                    <div class="card-body py-2 ">
                                      <div class="alert alert-secondary" role="alert"> 还没有办理进度数据记录哦</div>
                                    </div>
                                    {%end%}
                            </div>

                    </div>




                    </div>

                      <div class="col">


                        <div style="margin-top:10px;margin-bottom:40px; margin-right: 10px;">

                          <div class="qa-message-list" id="wallmessages">
                            <center>
                              <h6 class="card-title mb-1 ">
                                <a href="#">其他业务办理进度</a>
                                {%if visible_project%}
                                <a href="javascript:void(0)"
                                class=" mr-3 d-inline-block a_project_state_modal7" style="font-size:14px;" type_id="8">
                                <i class="fa fa-fw fa-comment"></i>新增</a>{%end%}
                                <a href="javascript:void(0)"
                                class=" mr-3 d-inline-block show_all8" style="font-size:14px;" ><span class="fa fa-fw fa-align-justify"></span>全部进度</a>
                                </h5>
                            </center>

                            {%if t_project_state_msg8%}
                             {%for item in t_project_state_msg8[:4]%}

                            <div class="message-item" id="m9">
                              <div class="message-inner">
                                <div class="message-head clearfix">

                                  <div class="avatar pull-left">
                                    <img src="/static/images/avatar.jpeg">
                                  </div>
                                  <div class="user-detail">
                                    <h5 class="handle">{{item.uid_name}}
                                      <span style="font-size:13px;">{{item.created_at}} 将设置状态： {{item.state_id_name}}
                                      </span>
                                    </h5>

                                  </div>
                                </div>
                                {%if item.state_remark%}
                                <div class="qa-message-content">
                                  {{item.state_remark}}
                                </div>
                                {%else%} 无描述 {%end%}

                              </div>


                            </div>

                            {%end%} {%else%}
                            <div class="card-body py-2 ">
                              <div class="alert alert-secondary" role="alert"> 还没有办理进度数据记录哦</div>
                            </div>
                            {%end%}
                          </div>

                        </div>




                      </div>

              </div>
              <div class="row">
                  <div class="col">


                  <div style="margin-top:10px;margin-bottom:40px">

                      <div class="qa-message-list" id="wallmessages">
                                <center> <h6 class="card-title mb-1 "><a href="#">创业补贴办理进度</a>
                                  
                                  {%if visible_project%}<a href="javascript:void(0)"
                                  class=" mr-3 d-inline-block a_project_state_modal8" style="font-size:14px;" type_id="9"> <i class="fa fa-fw fa-comment"></i>新增</a>{%end%}
                                  <a href="javascript:void(0)"
                                  class=" mr-3 d-inline-block show_all9" style="font-size:14px;" ><span class="fa fa-fw fa-align-justify"></span>全部进度</a>
                                </h5></center>

                           {%if t_project_state_msg9%}
                            {%for item in t_project_state_msg9[:4]%}
                            <div class="message-item" id="m9">
                              <div class="message-inner">
                                <div class="message-head clearfix">

                                  <div class="avatar pull-left"><img src="/static/images/avatar.jpeg"></div>
                                  <div class="user-detail">
                                    <h5 class="handle">{{item.uid_name}} <span style="font-size:13px;">{{item.created_at}} 将设置状态：
                                     {{item.state_id_name}}</span>
                                     </h5>

                                  </div>
                                </div>
                                {%if item.state_remark%}
                                <div class="qa-message-content">
                                  {{item.state_remark}}
                                </div>
                                {%else%}
                                无描述
                                {%end%}

                            </div>


                            </div>

                            {%end%}
                                   {%else%}
                                  <div class="card-body py-2 ">
                                    <div class="alert alert-secondary" role="alert"> 还没有办理进度数据记录哦</div>
                                  </div>
                                  {%end%}
                          </div>

                  </div>




                  </div>

                    <div class="col">


                      <div style="margin-top:10px;margin-bottom:40px; margin-right: 10px;">

                        <div class="qa-message-list" id="wallmessages">
                          <center>
                            <h6 class="card-title mb-1 ">
                              <a href="#">经济普查办理进度</a>
                              {%if visible_project%}
                              <a href="javascript:void(0)"
                              class=" mr-3 d-inline-block a_project_state_modal9" style="font-size:14px;" type_id="10">
                              <i class="fa fa-fw fa-comment"></i>新增</a>{%end%}
                              <a href="javascript:void(0)"
                              class=" mr-3 d-inline-block show_all10" style="font-size:14px;" ><span class="fa fa-fw fa-align-justify"></span>全部进度</a>
                              </h5>
                          </center>

                          {%if t_project_state_msg10%}
                           {%for item in t_project_state_msg10[:4]%}

                          <div class="message-item" id="m9">
                            <div class="message-inner">
                              <div class="message-head clearfix">

                                <div class="avatar pull-left">
                                  <img src="/static/images/avatar.jpeg">
                                </div>
                                <div class="user-detail">
                                  <h5 class="handle">{{item.uid_name}}
                                    <span style="font-size:13px;">{{item.created_at}} 将设置状态： {{item.state_id_name}}
                                    </span>
                                  </h5>

                                </div>
                              </div>
                              {%if item.state_remark%}
                              <div class="qa-message-content">
                                {{item.state_remark}}
                              </div>
                              {%else%} 无描述 {%end%}

                            </div>


                          </div>

                          {%end%} {%else%}
                          <div class="card-body py-2 ">
                            <div class="alert alert-secondary" role="alert"> 还没有办理进度数据记录哦</div>
                          </div>
                          {%end%}
                        </div>

                      </div>




                    </div>

            </div>

            <div class="row">
              <div class="col col-6">


                <div style="margin-top:10px;margin-bottom:40px; margin-right: 10px;">

                  <div class="qa-message-list" id="wallmessages">
                    <center>
                      <h6 class="card-title mb-1 ">
                        <a href="#">税务报到办理进度</a>
                        {%if visible_project%}
                        <a href="javascript:void(0)"
                        class=" mr-3 d-inline-block a_project_state_modal10" style="font-size:14px;" type_id="11">
                        <i class="fa fa-fw fa-comment"></i>新增</a>{%end%}
                        <a href="javascript:void(0)"
                        class=" mr-3 d-inline-block show_all11" style="font-size:14px;" ><span class="fa fa-fw fa-align-justify"></span>全部进度</a>
                        </h5>
                    </center>

                    {%if t_project_state_msg11%}
                     {%for item in t_project_state_msg11[:4]%}

                    <div class="message-item" id="m9">
                      <div class="message-inner">
                        <div class="message-head clearfix">

                          <div class="avatar pull-left">
                            <img src="/static/images/avatar.jpeg">
                          </div>
                          <div class="user-detail">
                            <h5 class="handle">{{item.uid_name}}
                              <span style="font-size:13px;">{{item.created_at}} 将设置状态： {{item.state_id_name}}
                              </span>
                            </h5>

                          </div>
                        </div>
                        {%if item.state_remark%}
                        <div class="qa-message-content">
                          {{item.state_remark}}
                        </div>
                        {%else%} 无描述 {%end%}

                      </div>


                    </div>

                    {%end%} {%else%}
                    <div class="card-body py-2 ">
                      <div class="alert alert-secondary" role="alert"> 还没有办理进度数据记录哦</div>
                    </div>
                    {%end%}
                  </div>

                </div>




              </div>
            </div>




                        </div>


                    </div>

                <div class="card-columns">
                    <!-- Example Social Card-->
                       <div class="card mb-12 topxian" id="addr_list">

                      <div class="card-body">
                        <h6 class="card-title mb-1"><a href="#">安排地址动态</a>
                          {%if role=='9' or role=='7'%}
                          <a href="javascript:void(0)"
                          class=" mr-3 d-inline-block" id="a_add_addr" title="{{t_project.id}}" style="font-size:14px;">
                            <i class="fa fa-fw fa-comment"></i>请求安排地址</a>
                        {%end%}
         </h6></div>


                      <hr class="my-0">


         <div class="card-body  bg-faded">

        <ul class="nav nav-tabs" id="myTab" role="tablist">
        {%if projects_addr_provider%}
            {%for idx,item in enumerate(projects_addr_provider)%}

             <li class="nav-item">
            <a class="btn btn-light  nav_padding {%if  item.id==int(addr_provider)%}active{%end%}" id="home-tab{{item.id}}" href="/project?tag=show&guid={{t_project.guid}}&id={{t_project.id}}&addr_provider={{item.id}}#addr_list"

             >{%if item.fz_name%}({{item.fz_name}}){%else%}待接单{%end%}</a>
         </li>
            {%end%}
             </ul>
        <div class="tab-content">
            {%for idx,row in enumerate(projects_addr_provider)%}
            <div class="tab-pane {%if row.id==int(addr_provider)%}active{%end%}" id="home{{row.id}}" role="tabpanel" aria-labelledby="home-tab{{row.id}}">
            {% for id,item in enumerate(addr_milepost) %}
            {%if item.addr_provider_id==row.id%}
              {%if item.type_name=='待接单'%}
            <li class="list-group-item">
              {%if  role=='7' and not item.confirm_at%}
              流程1:等待接单安排地址<span class="badge badge-success">{{row.uid_name}}发起{{item.created_at}}</span>
              <button class="addr_jiedan" id="{{item.id}}" addr_provider_id={{row.id}}>确认接单</button>
              <button class="addr_remark" id="{{item.id}}">备注</button>
              {%elif item.uid_name==name and item.confirm_at %}
              流程1:{{item.uid_name}}已接单<span class="badge badge-success">{{row.uid_name}}发起{{item.confirm_at}}</span>
              <button class="addr_remark" id="{{item.id}}">备注</button>
              {%elif item.uid_name!=name and item.confirm_at %}
              流程1:{{item.uid_name}}已接单<span class="badge badge-success">{{row.uid_name}}发起{{item.confirm_at}}</span>
              {%else%}
              流程1:等待地址安排负责人接单<span class="badge badge-success">{{item.created_at}}</span>
              {%end%}
              {%if item.remark%}备注信息：{{item.remark}}{%end%}
            </li>
            {%end%}
            {%if item.type_name=='安排中'%}
            <li class="list-group-item">
                {%if item.uid_name==name and not item.confirm_at%}
                流程2:<button class="a_add_addr_provider" id="{{item.id}}" addr_provider_id="{{row.id}}" >安排地址</button>
                <button class="addr_remark" id="{{item.id}}">备注</button>
                {%elif item.uid_name==name and item.confirm_at%}
                流程2：已安排<span class="badge badge-success">{{item.confirm_at}}</span>
                <button class="addr_remark" id="{{item.id}}">备注</button>
                {%else%}
                流程2:地址安排负责人({{item.uid_name}})正在安排中
                <span class="badge badge-success">{{item.created_at}}</span>
                {%end%}
                {%if item.remark%}备注信息：{{item.remark}}{%end%}
            </li>
            {%end%}
            {%if item.type_name=='安排完成'%}

            <li class="list-group-item">
              流程3:负责人({{item.uid_name}})安排地址完成<span class="badge badge-success">{{item.created_at}}</span>
              {%if item.uid_name==name%}
              <button class="addr_remark" id="{{item.id}}">备注</button>
              {%if item.remark%}备注信息：{{item.remark}}{%end%}
              {%end%}
              <br><br>
              <div class="alert alert-info">
                  供应商：{{row.provider}}<br>
                  安排地址类型：{{row.addr_type}}<br>
                  区域：{{row.area}}<br>
                  发票限量：{{row.fp_limit}}<br>
                  担保事项：{{row.danbao_matter}}<br>
                  安排人：{{row.fz_name}}<br>
                  创建时间：{{row.created_at.strftime("%Y-%m-%d")}}<br>
                  {%if role=='8' or role=='3' or role=='7'%}
                  地址起始时间：{{row.addr_start_time.strftime("%Y-%m-%d")}}<br>
                  地址到期时间：{{row.addr_end_time.strftime("%Y-%m-%d")}}<br>
                  地址收费：{{row.addr_shoufei}}<br>
                  财务确认状态：{%if row.caiwu_confirm==1%}已确认{%else%}未确认{%end%}<br>
                  财务确认时间： {%if row.caiwu_confirm==1%}{{row.confirm_time.strftime("%Y-%m-%d")}}{%end%}<br>
                  财务确认人：{{row.confirm_name}}<br>
                  {%end%}
              </div>

            </li>
            {%end%}
            {%end%}

            {%end%}
            {%if row.uid_name==name or row.fz_name==name%}
            <li class="list-group-item">
              <button class="btn-danger delete_addr_btn" id="{{row.id}}">删除地址安排</button>
            </li>
            {%end%}
            </div>
        {%end %}




        {%else%}
        还没有设置相关信息.
        {%end %}





        </div> </div> </div>
        <div class="card mb-12 topxian" id="xiezhu_list">

          <div class="card-body">
            <h6 class="card-title mb-1"><a href="#">业务协助</a>
            {%if role=='7' or role=='9'%}
            <a href="javascript:void(0)" class="mr-3 d-inline-block" id="btn_add_xiezhu" >
              <i class="fa fa-fw fa-comment"></i>发起协助</a>
            {%end%}
</h6></div>


          <hr class="my-0">


<div class="card-body  bg-faded">

<ul class="nav nav-tabs" id="myTab" role="tablist">
{%if xiezhu_applys%}
{%for idx,item in enumerate(xiezhu_applys)%}

 <li class="nav-item">
<a class="btn btn-light  nav_padding {%if  item.id==int(xiezhu_id)%}active{%end%}" id="home-tab{{item.id}}"
 href="/project?tag=show&guid={{t_project.guid}}&id={{t_project.id}}&xiezhu_id={{item.id}}#xiezhu_list">
 {%if item.queren_confirm_at%}
                        {{item.queren_uid_name}}已办完
                        {%elif item.sh_confirm_at%}
                        待{{item.gs_uid_name}}确认
                        {%elif item.sh_is_pass==0%}
                          订单被驳回
                        {%elif item.sh_created_at%}
                        {{item.xs_uid_name}}申请办结
                        {%elif item.xs_confirm_at%}
                        {{item.xs_uid_name}}处理中
                        {%elif item.gs_is_pass==0 %}
                        申请被驳回
                        {%elif item.gs_confirm_at%}
                        待{{item.xs_uid_name}}接单
                        {%elif item.gs_uid_name%}
                        申请待审核
                        {%end%}</a>
</li>
{%end%}
 </ul>
<div class="tab-content">
{%for idx,row in enumerate(xiezhu_applys)%}
<div class="tab-pane {%if row.id==int(xiezhu_id)%}active{%end%}" id="home{{row.id}}" role="tabpanel" aria-labelledby="home-tab{{row.id}}">
{% for id,item in enumerate(xiezhu_apply_mileposts) %}
{%if item.xiezhu_id==row.id%}
  {%if item.type_name=='待审核'%}
<li class="list-group-item">
    流程1:工商专员{{item.uid_name}}发起协助：{{row.xiezhu_content}}<span class="badge badge-success">{{item.created_at}}</span>
    {%if name==item.uid_name and not item.confirm_at and  (item.is_pass==None or item.is_pass==0) %}
    <button class="edit_xiezhu_content" xiezhu_content="{{row.xiezhu_content}}" id="{{row.id}}" gs_id="{{item.id}}" >修改</button>
    {%end%}
</li>

{%if item.is_pass==0%}
<li class="list-group-item">
  流程2:协助申请被驳回<span class="badge badge-success">{{item.reject_at}}</span>
  {%if item.remark%}
  备注：{{item.remark}}
  {%end%}
</li>
{%elif not item.confirm_at and not item.is_pass%}
<li class="list-group-item">
    流程2:待经理审核中<span class="badge badge-success">{{item.created_at}}</span>
    {%if name=='罗文波'%}
    <button class="manage_sh" id="{{row.id}}" gs_id="{{item.id}}">审核</button>
    {%end%}
  </li>
  {%end%}
{%end%}

{%if item.type_name=='待接单'%}
<li class="list-group-item">
    流程2:{{item.fz_name}}审核通过<span class="badge badge-success">{{item.created_at}}</span>
    {%if item.remark%}
    备注：{{item.remark}}
    {%end%}
  </li>
<li class="list-group-item">
  {%if item.created_at and not item.confirm_at%}
  流程3:待销售顾问{{item.uid_name}}接单<span class="badge badge-success">{{item.created_at}}</span>
  {%if name==item.uid_name%}
  <button class="xs_jiedan" id="{{row.id}}" xs_id="{{item.id}}">接单</button>
  {%end%}
  {%elif item.confirm_at%}
  流程3:{{item.uid_name}}已接单，业务处理中<span class="badge badge-success">{{item.confirm_at}}</span>
  {%if name==item.uid_name and not row.sh_created_at%}
  <button class="xs_banjie"  id="{{row.id}}">确认办结</button>
  {%end%}
  {%end%}
</li>
{%end%}
{%if item.type_name=='结果审核'%}
<li class="list-group-item">
    流程4:销售顾问{{item.uid_name}}申请办结<span class="badge badge-success">{{item.created_at}}</span>
   {% if row.xiezhu_zj%}办理总结：{{row.xiezhu_zj}}{%end%}
    {%if item.is_pass==0%}
    <button class="xs_banjie" sh_id="{{item.id}}" id="{{row.id}}" project_zj="{{row.xiezhu_zj}}" is_pass="{{item.is_pass}}">修改办结</button>
    {%end%}
</li>
{%if item.is_pass==0%}
<li class="list-group-item">流程5:{{item.fz_name}}驳回办结<span class="badge badge-success">{{item.reject_at}}</span>
  {%if item.remark%}
  备注：{{item.remark}}
  {%end%}
</li>
{%elif item.created_at and not item.confirm_at%}
<li class="list-group-item">流程5:待部门负责人确认<span class="badge badge-success">{{item.created_at}}</span>
  {%if is_xz_manage=='1'%}
  <button class="shenhe_banjie" xs_uid_name="{{item.uid_name}}"
  xiezhu_zj="{{row.xiezhu_zj}}"sh_id="{{item.id}}" gs_uid_name="{{item.gs_uid_name}}"
  gs_uid="{{item.gs_uid}}" xiezhu_id="{{row.id}}">审核办结</button>
  {%end%}
</li>
{%elif item.confirm_at%}
<li class="list-group-item">流程5：{{item.fz_name}}确认办结<span class="badge badge-success">{{item.confirm_at}}</span>
  {%if item.remark%}
  备注：{{item.remark}}
  {%end%}
</li>
{%end%}
{%end%}
{%if item.type_name=='已确认'%}
<li class="list-group-item">
  {%if item.confirm_at%}
  流程6:工商专员{{item.uid_name}}确认业务已经办完<span class="badge badge-success">{{item.confirm_at}}</span>

  {%else%}
  流程6:待工商专员{{item.uid_name}}确认<span class="badge badge-success">{{item.created_at}}</span>
  {%if name==item.uid_name%}
  <button class="gs_queren" id="{{item.id}}">确认</button>
  {%end%}
  {%end%}
</li>
{%end%}

{%end%}

{%end%}
</div>
{%end %}




{%else%}
还没有设置相关信息.
{%end %}





</div> </div> </div>





<div class="card-columns">

                      <input type="hidden" id="income_a_type" value='0'/>
                        <input type="hidden" id="income_curr_id" value='0'/>
                          <input type="hidden" id="income_curr_guid" value='0'/>








       <div class="card-columns" id="trans_list">
            <!-- Example Social Card-->
               <div class="card mb-12 topxian" id='dingdanliuzhuan'>

              <div class="card-body">
                <h6 class="card-title mb-1"><a href="#">订单流转动态</a>

 </h6></div>


              <hr class="my-0">


 <div class="card-body  bg-faded">

<ul class="nav nav-tabs" id="myTab" role="tablist">
{%set cg_confirm_at=0%}
{%if project_btypes%}
    {%for idx,item in enumerate(project_btypes)%}

     <li class="nav-item">
    <a class="btn btn-light  nav_padding {%if  item.mid==int(mid)%}active{%end%}" id="home-tab{{item.mid}}" href="/project?tag=show&guid={{t_project.guid}}&id={{t_project.id}}&mid={{item.mid}}#trans_list"

     >{{item.btype_id_name}}({{item.member_name}})</a>
 </li>
    {%end%}
     </ul>

<div class="tab-content" {%if curr_member and  curr_member.btype_id_name==u"公司注销" %}style="float:left; width:58%;"{%end%}>

    {%for idx,item in enumerate(project_btypes)%}
  <div class="tab-pane {%if item.mid==int(mid)%}active{%end%}" id="home{{item.mid}}" role="tabpanel" aria-labelledby="home-tab{{item.mid}}">


{%if item.is_cancel%}
<li class='list-group-item' style="background:#aefefefe;">

      {{item.is_cancel_uid_name}} 请求取消该订单
      {%if item.is_cancel_confirm_at%}
        <span class="badge badge-pill badge-info"> 申请时间: {{item.is_cancel_at}}</span>

        <span class="badge badge-pill badge-success">{{item.is_cancel_confirm_uid_name}} 已同意取消({{item.btype_id_name}}) {{item.is_cancel_confirm_at}}</span>



 {%if role=="7"%}
<button class="btn-danger"  mid="{{item.mid}}"  name="btn_cancel_member" atype="manager_roll">

  恢复订单({{item.btype_id_name}})
</button>
{%end %}




      {%else%}


        <span class="badge badge-pill badge-info">审批中  {{item.is_cancel_at}}</span>

    {%if role=="7"%}
      <button class="btn-danger"  mid="{{item.mid}}"   name="btn_cancel_member" atype="manager" >

        同意取消({{item.btype_id_name}})
      </button>
      {%end %}


      {%end%}




  </li>
{%else%}


 {%if int(getMemberIdInProject(t_project_members,u"工商专员",item.member_id))==int(uid) %}
<li class='list-group-item' style="background:#eee;">



      <button class="btn-danger"  mid="{{item.mid}}"  atype="zhuangyuan"

        name="btn_cancel_member">取消本订单({{item.btype_id_name}})
      </button>


  </li>

{%end%}





{%end%}

 {%for idxe,row in enumerate(project_milepost_type)%}
  {%if  item.mid==row.member_id%}

    {%if row.income_name==u"待接单"%}


     <li class='list-group-item'> 流程{{row.order_int}}:
订单分配
       {%if   row.confirm_at%}


        <span class="badge badge-success"> 订单分配给{{row.uid_name}}  {{row.confirm_at}} </span>


        <!--<span class="badge badge-success">{{row.uid_name}}  于{{row.confirm_at}} 接单成功</span>-->

         {%else%}


          {%if row.uid==int(uid)%}
           {{item.created_at}}
          <button class=" btn_cq_rec_order" mid="{{row.member_id}}" mp_id="{{row.id}}" guid="{{row.guid}}" name="btn_cq_rec_order" update_id="{{row.update_id}}" >
          确认接单
          </button>
          {%else%}
          {%end%}
       {%end%}
       {%if row.remark%}
          备注信息:{{row.remark}}
       {%end%}

  {%if row.uid==int(uid)%}
        <button class=" btn_cq_rec_order_remark" remark="{%if row.remark%}{{row.remark}}{%end%}" mp_id="{{row.id}}" guid="{{row.guid}}" name="btn_cq_rec_order_remark">备注
          </button>
     {%end%}
       </li>

  {%elif  row.income_name==u"办理中" %}
     <li class='list-group-item'> 流程{{row.order_int}}:



       {%if   row.confirm_at%}
           {{row.income_name}}
        <span class="badge badge-success"> {{row.uid_name}} 已接单 {{row.confirm_at}} </span>


         {%else%}


          {%if row.uid==int(uid)%}

           正在等待 {{row.uid_name}} 确认接单

            <button class=" btn_cq_rec_order" mid="{{row.member_id}}"  mp_id="{{row.id}}" guid="{{row.guid}}" name="btn_cq_rec_order"> 接单办理
            </button>






          {%else%}

            <span class="badge badge-primary">正在等待 {{row.uid_name}} 确认接单... </span>

          {%end%}


       {%end %}
       {%if row.remark%}
          备注信息:{{row.remark}}
       {%end%}
  {%if row.uid==int(uid)%}
        <button class=" btn_cq_rec_order_remark" remark="{%if row.remark%}{{row.remark}}{%end%}"  update_id="{{row.update_id}}"  mp_id="{{row.id}}" guid="{{row.guid}}" name="btn_cq_rec_order_remark">备注
          </button>
     {%end%}
       </li>

  {%elif  row.income_name==u"办结" %}
     <li class='list-group-item'> 流程{{row.order_int}}:

       {{row.income_name}}

       {%if   row.confirm_at%}

        <span class="badge badge-success">{{row.uid_name}} 已办结 {{row.confirm_at}} </span>


         {%else%}


          {%if row.uid==int(uid)%}



            <button class=" btn_cq_rec_order" mid="{{row.member_id}}"  mp_id="{{row.id}}" guid="{{row.guid}}" name="btn_cq_rec_order"> 已办结
            </button>






          {%else%}

           <span class="badge badge-primary">{{row.uid_name}}正在光速办理中... </span>

          {%end%}


       {%end %}
       {%if row.remark%}
          备注信息:{{row.remark}}
       {%end%}
  {%if row.uid==int(uid)%}
        <button class=" btn_cq_rec_order_remark" remark="{%if row.remark%}{{row.remark}}{%end%}"
         mp_id="{{row.id}}" guid="{{row.guid}}" name="btn_cq_rec_order_remark">备注
          </button>
     {%end%}
     {%if confirm_banjie%}
  {%if '231' in role_list and  (confirm_banjie.confirm_banjie==0 or confirm_banjie.confirm_banjie==2)%}
  <button class="confirm_banjie_btn"
  id="{{confirm_banjie.id}}" guid="{{confirm_banjie.m_guid}}" confirm_banjie="{{confirm_banjie.confirm_banjie}}" banjie_remark="{{confirm_banjie.banjie_remark}}"
  >审核</button>
  {%elif confirm_banjie.confirm_banjie==1%}
  <span class="badge badge-dark">罗文波已确认审核</span>
  {%end%}
  {%end%}





       </li>

 {%elif  row.income_name==u"填写办结信息" %}
     <li class='list-group-item'> 流程{{row.order_int}}:

       {{row.income_name}}

       {%if   row.confirm_at%}

        <span class="badge badge-success">{{row.uid_name}} 已更新公司信息,及通知仓管 {{row.confirm_at}} </span>


         {%else%}


          {%if row.uid==int(uid)%}
          {%if t_project.company_confirm_at%}
               <span class="badge badge-primary">已更新办结公司信息  {{t_project.company_confirm_at}}</span>


           {%end%}





          {%else%}

           <span class="badge badge-primary">{{row.uid_name}}正在填写办结信息... </span>

          {%end%}


       {%end %}

       {%if row.remark%}
          备注信息:{{row.remark}}
       {%end%}
  {%if row.uid==int(uid)%}



                     {%if   not row.confirm_at%}
             <button  id="btn_modify2" btype_id_name="{{item.btype_id_name}}" >办结公司信息更新</button>
            <button class="btn_projects_transfile"
            mp_id="{{row.member_id}}" name="btn_projects_transfile" id="btn_projects_transfile">资料交接
              </button>
     <button class=" btn_cq_rec_order"  mid="{{row.member_id}}" btype_id_name="{{item.btype_id_name}}"  mp_id="{{row.id}}" guid="{{row.guid}}" name="btn_cq_rec_order"> 通知仓管 已办结
            </button>{%end%}
        <button class=" btn_cq_rec_order_remark" remark="{%if row.remark%}{{row.remark}}{%end%}" mp_id="{{row.id}}" guid="{{row.guid}}" name="btn_cq_rec_order_remark">备注
          </button>
     {%end%}

     {%if t_project.company_confirm_at%}
   <div class="alert alert-info" role="alert" style="padding:5px; margin-top:5px;">
办结公司信息: <br/>

 公司名称: <b>{{t_project.customer_company}}{%if row.confirm_at and not t_customer %} <button id='edit_banjie'>修改</button> {%end%}
 </b><br/>  统一社会信用代码: <b>{{t_project.company_uid}} </b><br/>
 法人:<b>{{t_project.comany_person}}</b><br/>
 注册地址:<b>{{t_project.city}}{{t_project.zone}}{{t_project.true_reg_addr}}</b><br/>


 成立日期:
  <b>{%if t_project.company_created_day%}
 {{t_project.company_created_day.strftime("%Y年%m月%d日")}}
  {%end%}

  </b><br/>
 执照到期时间:
 <b>
 {%if t_project.company_fever%}
   长期
 {%else%}
    {%if t_project.company_created_day%}
        {{t_project.company_expired_day}}
    {%end%}
 {%end%}</b>
 {%if row.reject_remark%}
 <br/>
 <div class="alert-danger">
驳回内容：
<b>{{row.reject_remark}}</b>
</div>
</div>
 {%end%}


{%end%}

{%if item_transfile%}
{%if item_transfile.pm_id==row.member_id%}
<div class="alert alert-primary" role="alert" style="padding:5px; margin-top:5px;">
给仓管的交接资料清单：
<b>{{item_transfile.trans_type_txt}}</b>
{%if item_transfile.remark%}
<br>
备注：<b>{{item_transfile.remark}}</b>
{%end%}

 {%if item_transfile.cq_uid_name%}
        <span class="badge badge-pill badge-warning">{{item_transfile.cq_uid_name}}于{{item_transfile.cq_uid_at}}确认签收</span>


      {%else%}
{%if item_transfile.is_ok==1%}
<br/>
<div class="alert-danger">
驳回内容：
<b>{{item_transfile.fback_remark}}</b>
</div>
</div>
{%end%}
   {%end%}
{%end%}



{%end%}


       </li>


  {%elif row.income_name==u"仓管通知销售交接"%}
     <li class='list-group-item'>




        {%if  row.is_close==1%}
流程{{row.order_int}}:

       仓管确认交接完成<font color='red'>*</font>
    <span class="badge badge-success">{{row.uid_name}} 确认已交接完成 该业务已经结束 {{row.confirm_at}} </span>


               {%if row.remark%}
          备注信息:{{row.remark}}
       {%end%}
       {%if 11==int(role)%}
        <button class=" btn_cq_rec_order_remark" remark="{%if row.remark%}{{row.remark}}{%end%}" mp_id="{{row.id}}" guid="{{row.guid}}" name="btn_cq_rec_order_remark">备注
          </button>
     {%end%}
        {%break%}
        {%elif   row.confirm_at%}

流程{{row.order_int}}:
      {{row.income_name}}
        <span class="badge badge-success">{{row.uid_name}} 已通知{{getMemberName(t_project_members,"销售顾问")}},与客户交接 {{row.confirm_at}} </span>


         {%else%}
流程{{row.order_int}}:
      {{row.income_name}}

          {%if 11==int(role)%}


          <button id="btn_check_cq_list" class="btn_modify_tran"
          mid="{{row.member_id}}"
          pm_id="{{row.member_id}}"
          mp_id="{{row.id}}"
          mtype="1"
          trans_type_txt="{%if item_transfile and item_transfile.trans_type_txt%}{{item_transfile.trans_type_txt}}{%end%}">工商专员交接资料清单</button>
          <button  class="btn_modify_companyinfo" by_type="仓管" pm_id="{{row.id}}" mid="{{row.member_id}}">审核公司信息</button>

                     <!--1专员交接 2 仓管交接
                     <button
                     pm_id="{{row.member_id}}"
                     mid="{{row.member_id}}"
                      mtype="2"
                       mp_id="{{row.id}}"


                      trans_type_txt="{%if item_transfile and item_transfile.trans_type_txt%}{{item_transfile.trans_type_txt}}{%end%}"
            name="btn_projects_transfile_sales" id="btn_projects_transfile_sales">交接资料给销售顾问
              </button> -->
          <button class=" btn_cq_rec_order"   mid="{{row.member_id}}"  mp_id="{{row.id}}" guid="{{row.guid}}" btype_id_name="{{item.btype_id_name}}" name="btn_cq_rec_order">确认工商已办结,通知销售顾问{{getMemberName(t_project_members,"销售顾问")}},与客户交接
          </button>

              <button class=" btn_cq_rec_order btn btn-primary btn-sm"  btype_id_name="{{item.btype_id_name}}"  mid="{{row.member_id}}" is_close="1" mp_id="{{row.id}}" guid="{{row.guid}}" name="btn_cq_rec_order"
              >业务办结,完成客户交接
          </button>
          {%else%}


          <span class="badge badge-primary"> (等待仓管确认,告知销售顾问与客户交接....)</span>

          {%end%}




       {%end %}
       {%if row.remark%}
          备注信息:{{row.remark}}
       {%end%}
       {%if 11==int(role)%}
        <button class=" btn_cq_rec_order_remark" remark="{%if row.remark%}{{row.remark}}{%end%}" mp_id="{{row.id}}" guid="{{row.guid}}" name="btn_cq_rec_order_remark">备注
          </button>
     {%end%}

 {%if item_transfile_sales%}
        {%if item_transfile_sales.pm_id==row.member_id%}
        <div class="alert alert-primary" role="alert" style="padding:5px; margin-top:5px;">
        给({{getMemberName(t_project_members,"销售顾问")}})交接资料清单：
        <b>{{item_transfile_sales.trans_type_txt}}</b>
        {%if item_transfile_sales.remark%}
        <br>
        备注：<b>{{item_transfile_sales.remark}}</b>
        {%end%}

        {%if item_transfile_sales.cq_uid_name%}
        <span class="badge badge-pill badge-warning">{{item_transfile_sales.cq_uid_name}}于{{item_transfile_sales.cq_uid_at}}确认签收</span>
        {%else%}

        {%if item_transfile_sales.is_ok==1%}
        <br/>
        <div class="alert-danger">
        驳回内容：
        <b>{{item_transfile_sales.fback_remark}}</b>
        </div>
        </div>
        {%end%}    {%end%}
  {%end%}  {%end%}

       </li>

  {%elif  row.income_name==u"销售顾问接受交接" %}
     <li class='list-group-item'> 流程{{row.order_int}}:

       {{row.income_name}}

       {%if   row.confirm_at%}

        <span class="badge badge-success">{{row.uid_name}} 接受交接请求 正在交接中 {{row.confirm_at}} </span>

         {%else%}


          {%if int(getMemberId(t_project_members,"销售顾问")) == int(uid)%}

   <!-- <button id="btn_sales_check_cg_list"  class="btn_modify_tran"
              mid="{{row.member_id}}"
          pm_id="{{row.member_id}}"
          mp_id="{{row.id}}"

          mtype="2"
          trans_type_txt="{%if item_transfile_sales and item_transfile_sales.trans_type_txt%}{{item_transfile_sales.trans_type_txt}}{%end%}">审核仓管交接资料清单</button>
-->
          <button class=" btn_cq_rec_order"  mid="{{row.member_id}}"  update_id="{{row.update_id}}"  mp_id="{{row.id}}" guid="{{row.guid}}" name="btn_cq_rec_order">开始与客户交接
          </button>
          {%else%}

          (等待销售顾问{{getMemberName(t_project_members,"销售顾问")}},接受交接确认)

          {%end%}

       {%end %}
       {%if row.remark%}
          备注信息:{{row.remark}}
       {%end%}
        {%if int(getMemberId(t_project_members,"销售顾问")) == int(uid)%}
            <button class=" btn_cq_rec_order_remark" remark="{%if row.remark%}{{row.remark}}{%end%}"
             mp_id="{{row.id}}" guid="{{row.guid}}" name="btn_cq_rec_order_remark">备注
              </button>
        {%end%}
       </li>

  {%elif  row.income_name==u"完成交接" %}
     <li class='list-group-item' > 流程{{row.order_int}}:

       {{row.income_name}}

       {%if   row.confirm_at%}

           <span class="badge badge-success">{{row.uid_name}} 已交接完成 等待仓管确认 {{row.confirm_at}} </span>


         {%else%}


          {%if int(getMemberId(t_project_members,"销售顾问")) == int(uid)%}

           <button id="a_add_trans_customer" title="{{t_project.id}}"  pm_id="{{row.member_id}}" >
          上传交接资料</button>

           <button class=" btn_cq_rec_order"  mid="{{row.member_id}}"  mp_id="{{row.id}}" guid="{{row.guid}}" name="btn_cq_rec_order">通知仓管,已交接完成
          </button>
          {%else%}

          (销售顾问{{getMemberName(t_project_members,"销售顾问")}}正在与客户交接中)

          {%end%}


       {%end %}
       {%if row.remark%}
          备注信息:{{row.remark}}
       {%end%}


      {%if int(getMemberId(t_project_members,"销售顾问")) == int(uid) or role=="11"%}
        <button class=" btn_cq_rec_order_remark" remark="{%if row.remark%}{{row.remark}}{%end%}"
        mp_id="{{row.id}}" guid="{{row.guid}}" name="btn_cq_rec_order_remark">备注
          </button>
         <br>
         {%if t_projects_transitions_customer%}
            交接资料：<br>

            {%for tans_row in t_projects_transitions_customer%}
            {%if tans_row.file_name %}
                <a href="{{tans_row.file_name}}" class="btn" target="_blank">
                查看附件</a>
            {%end%}

{{tans_row.uid_name}} 于{{tans_row.created_at}}上传

              <a href="javascript:void(0)" rec_by ="{{tans_row.rec_by}}"
              class="btn btn-primary btn-sm modify_transition"
              transition_id="{{tans_row.id}}"
              rec_by_uid_at ="{%if tans_row.rec_by_uid_at%}{{tans_row.rec_by_uid_at}}{%else%}{%end%}"

              pm_id={{tans_row.mid}}
            tran_at="{{tans_row.tran_at}}"
            tran_by ="{{tans_row.tran_by}}"
            type_ids="{{tans_row.type_ids}}"
            is_customer = "{{tans_row.is_customer}}"
            project_id="{{tans_row.project_id}}"
            remark="{{tans_row.remark}}">修改</a>
            <a
                          pm_id={{tans_row.mid}}
                          rec_by_uid_at ="{%if tans_row.rec_by_uid_at%}{{tans_row.rec_by_uid_at}}{%else%}{%end%}"

              href="javascript:void(0)"
              rec_by ="{{tans_row.rec_by}}"
              type_ids="{{tans_row.type_ids}}"
              class="btn btn-primary btn-sm modify_transition_mobile"
              transition_id="{{tans_row.id}}"
              tran_at="{{tans_row.tran_at}}"
              is_customer = "{{tans_row.is_customer}}"
              tran_by ="{{tans_row.tran_by}}"
              project_id="{{tans_row.project_id}}"
              remark="{{tans_row.remark}}">手机上传</a>
            <br>
            {%end%}
         {%end%}

     {%end%}




       </li>
  {%elif  row.income_name==u"仓管确认交接完成" %}
     <li class='list-group-item'> 流程{{row.order_int}}:

       {{row.income_name}}

       {%if   row.confirm_at%}
       {%set  cg_confirm_at+=1%}
        <span class="badge badge-success">{{row.uid_name}} 确认已交接完成 该业务已经结束 {{row.confirm_at}} </span>

         {%else%}


           {%if 11==int(role)%}
          <button class=" btn_cq_rec_order" mid="{{row.member_id}}"  mp_id="{{row.id}}" guid="{{row.guid}}" name="btn_cq_rec_order">确认已交接完成
          </button>
          {%else%}

          (等待仓管交接完成)

          {%end%}


       {%end %}
       {%if row.remark%}
          备注信息:{{row.remark}}
       {%end%}
   {%if 11==int(role)%}
        <button class=" btn_cq_rec_order_remark" remark="{%if row.remark%}{{row.remark}}{%end%}" mp_id="{{row.id}}" guid="{{row.guid}}" name="btn_cq_rec_order_remark">备注
          </button>
     {%end%}
       </li>
    {%end%}



       {%if not  row.confirm_at%}
          {%break%}

       {%end %}

{%end %}
{%end %}
</div>
{%end %}


{%else%}
还没有设置相关信息.
{%end %}





</div>

{%if curr_member and  curr_member.btype_id_name==u"公司注销" and (curr_member.member_id==int(uid) or role=="7" or role=="8")%}
<div class="tab-content" style="float:left;width:40%;">
<li class="list-group-item" style="background:#eee;">
注销业务办结确认
</li>{%for logoff_item in t_logff_type%}
<li class="list-group-item">
<b>{{logoff_item.income_name}}</b>
{%if logoff_item.finish_at%}
<span class="badge badge-info">{{logoff_item.uid_name}} - 申请{{logoff_item.finish_at}}办结</span>

{%if  logoff_item.state_id==2 %}
<span class="badge badge-success">{{logoff_item.leader_uid_name}} {{logoff_item.leader_at}}  已确认</span>


{%elif  logoff_item.state_id==3 %}

                                 <span class="badge badge-danger"> {%if logoff_item.leader_uid==int(uid)%} 你{%else%}{{logoff_item.leader_uid_name}}{%end%} 驳回办结:

                                 {%if logoff_item.last_reject_remark%} {{logoff_item.last_reject_remark}}{%else%}无{%end%} {{logoff_item.leader_at}}</span>
                                  <button type_id="{{logoff_item.order_int}}" mid="{{mid}}" project_id="{{t_project.id}}" class="btn_save_logoff">重新确认</button>

{%end%}


{%else%}
  <button type_id="{{logoff_item.order_int}}" mid="{{mid}}" project_id="{{t_project.id}}" class="btn_save_logoff">确认</button>
{%end%}



</li>{%end%}


     </div>{%end%}


</div>





 </div>

          <div class="card mb-3 topxian" id='xiangguanlianxiren'>

            <div class="card-body ">
              <h6 class="card-title mb-1 ">
                  <a href="#">相关联系人</a>

                  {%if visible_project%}
                  <a href="javascript:void(0)" class=" mr-3 d-inline-block" id="a_add_linkman" title="{{t_project.id}}" style="font-size:14px;">
                    <i class="fa fa-fw fa-comment"></i>新增</a>{%end%}

              </h6>

            </div>
            <hr class="my-0">
                <table class="table table-striped fayetable">
                  <thead>
                  <tr>
                          <th style="width:100px;">名字/称呼</th>
                          <th style="width:60px;"> 性别
                          <th style="width:120px;">电话</th>
                          <th>备注</th>
                          <th style="width:80px;">创建人</th>
                          <th style="width:120px;">创建时间</th>
                          <th  width="40"></th>
                  </tr>
                  </thead>
                  <tbody>
                    {%if t_projects_linkmans%}
                    {%for item in t_projects_linkmans%}
                      <tr>
                          <td>{{item.name}}
                            </td>
                            <td> {%if item.gender==1%}男{%else%}女{%end%}
                            </td>
                            <td >{{item.tel}} </td>


                            <td>{{item.remark}}</td>

                               <td>{{item.uid_name}}</td>
                            <td>{{item.created_at.strftime("%Y-%m-%d")}}</td>


                    <td>
                      {%if visible_project%}
                                          <a href="javascript:void(0)"
                                           class="btn btn-primary btn-sm modify_linkman"
                                            tel="{{item.tel}}"
                                            remark="{{item.remark}}"
                                            title="{{item.name}}"
                                            gender="{{item.gender}}"
                                            linkman_guid="{{item.guid}}"
                                            linkman_id="{{item.id}}">编辑</a>{%end%}

                      </td>



                  </tr>
                  {%end%}
                  {%else%}
                  <tr>
                  <td colspan="7">还没有哦。</td>

                  </tr>
                  {%end%}

                  </tbody>
                </table>



            </div>









          <div class="card mb-3 topxian" id='ziliaojiaojie'>

            <div class="card-body ">
              <h6 class="card-title mb-1 ">
     资料交接
     {%if visible_project%}
    <a href="javascript:void(0)" class=" mr-3 d-inline-block" id="a_add_trans" title="{{t_project.id}}" style="font-size:14px;">
      <i class="fa fa-fw fa-comment"></i>新增</a>{%end%}
      <a href="/project?tag=t_company&project_id={{t_project.id}}&company={{t_project.customer_company}}{%if t_project.company_uid%}&company_code={{t_project.company_uid}}{%end%}{%if t_company_id%}&id={{t_company_id.id}}{%end%}" class=" mr-3 d-inline-block" id="a_t_company" title="{{t_project.id}}" style="font-size:14px;">
          <i class="fa fa-fw fa-comment"></i>所有</a>
    </h3>

              </h6>

            </div>
            <hr class="my-0">

          <table class="table table-striped fayetable" style="padding:3px; margin:5px;width:99%;">
                  <thead>
                    <tr>
                      <th width="100">交接时间
                      </th>

                      <th  width="60"> 类型
                      </th>

                      <th width="80"> 签收方
                      </th>
                        <th width="100"> 签收状态
                      </th>
                           <th width="320"> 资料明细
                      </th>
                         <th  width="120"> 其他资料

                      </th>
                          <th width="120"> 资料用途
                      </th>

                   <th width="60"> 附件
                      </th>
                      <th width="80">移交方</th>
                      <th width="100">创建时间</th>
                      <th width="10"></th>
                    </tr>
                  </thead>
                  <tbody>
                    {%if t_projects_transitions%} {%for item in t_projects_transitions%}
                    <tr>
                      <td>

                      {%if item.tran_at%}{{item.tran_at.strftime("%Y-%m-%d")}}{%end%}


                      </td>
                       <td>
    {%if item.is_inner%}
内部

    {%else%}
外部
    {%end%}



                      </td>
                       <td> {{item.rec_by}}
                      </td>
                         <td>

                         {%if item.rec_by_uid_at%}

                        <span style='background-color:green;color:#fff;'>{%if item.is_customer%}
                         仓管{%end%}已确认</span>
                        {%else%}


      待确认



                         {%end%}
                      </td>
                       <td title="{{item.type_names}}">
                        {%if item.type_names%} {{item.type_names}} {%end%}
                      </td>

                           <td title=" {{item.remark}} ">



                            {%if item.remark%}{{item.remark}}{%end%}
                      </td>
                        <td title="{%if item.use_type%}{{item.use_type}}  {%end%}">

                         {%if item.use_type%} {{item.use_type}}{%end%}



                      </td>


                  <td>         {%if item.file_name%}

                   <a href="project?tag=view_img&img={{item.file_name}}" style="font-size:13px;" target="_blank"><img src="/static/ico/web_icon_051.png" height="20"/>
                          查看</a>
                      {%end%}</td>

                      <td>{{item.uid_name}}</td>

                      <td>{{item.created_at.strftime("%Y-%m-%d")}}</td>

                      <td>
                          {%if (item.uid==int(uid) or role=='11') and cg_confirm_at!=len(project_btypes) %}

                          <a href="javascript:void(0)"
                           rec_by ="{{item.rec_by}}"
                            class="btn btn-primary btn-sm modify_transition"
                             transition_id="{{item.id}}"
                          project_id="{{item.project_id}}"
                          tran_at="{{item.tran_at}}"
                          tran_by ="{{item.tran_by}}"
                          is_customer = "{{item.is_customer}}"
                          use_type="{%if item.use_type%}{{item.use_type}}{%end%}"
                          type_ids="{{item.type_ids}}"
                          rec_by_uid_at ="{%if item.rec_by_uid_at%}{{item.rec_by_uid_at}}{%else%}{%end%}"
                          remark="{%if item.remark%}{{item.remark}}{%end%}">修 &emsp;&nbsp; 改</a>
                          <a
                            style="margin-top:5px;"
                            href="javascript:void(0)"
                            rec_by ="{{item.rec_by}}"
                            class="btn btn-primary btn-sm modify_transition_mobile"
                            transition_id="{{item.id}}"
                            tran_at="{{item.tran_at}}"
                            is_customer = "{{item.is_customer}}"
                            tran_by ="{{item.tran_by}}"
                            type_ids="{{item.type_ids}}"
                                                      rec_by_uid_at ="{%if item.rec_by_uid_at%}{{item.rec_by_uid_at}}{%else%}{%end%}"

                            remark="{{item.remark}}">手机上传</a>
                            {%end%}
                      </td>


                    </tr>
                    {%end%} {%else%}
                    <tr>
                      <td colspan="11">还没有哦。</td>

                    </tr>
                    {%end%}

                  </tbody>
                </table>
              </div>

              <div class="card mb-3 topxian" id='shangchuanfujian'>

                <div class="card-body ">
                  <h6 class="card-title mb-1 ">
         上传附件
         {%if visible_project%}
        <a href="javascript:void(0)" class=" mr-3 d-inline-block" id="a_add_trans_file" title="{{t_project.id}}" style="font-size:14px;">
          <i class="fa fa-fw fa-comment"></i>新增</a>
          {%end%}

        </h3>

                  </h6>

                </div>
                <hr class="my-0">

                    <table class="table table-striped fayetable" style="padding:3px; margin:5px;width:99%;">
                      <thead>
                        <tr>
                       <th>附件名称</th>
                       <th width='120'>上传时间</th>
                       <th width='100'>创建人</th>
                       <th width='100'></th>
                        </tr>
                      </thead>
                      <tbody>
                        {%if t_projects_transitions_file%}
                        {%for item in t_projects_transitions_file%}
                        <tr>
                      <td><a href="{{item.file_name}}" download="{{item.file_name.split('/')[-1]}}" style="font-size:13px;">{{item.file_name.split('/')[-1].split('.')[0]}}</a>


                        <a href="project?tag=view_img&img={{item.file_name}}" target="_blank" style="font-size:13px;"><img src="/static/ico/web_icon_051.png" height="20"/>查看</a>


                      </td>
                      <td>{{item.created_at.strftime('%Y-%m-%d')}}</td>
                      <td>
                          {%if item.uid_name %}
                        {{item.uid_name}} {%end%}</td>

                          <td>
                              {%if (item.uid==int(uid) or role=='11') and cg_confirm_at!=len(project_btypes) or role=="8" or uid=='119' %}
                              <a href="javascript:void(0)"  class="btn-sm modify_transition1" transition_id="{{item.id}}"
                        >删除
                      {%end%}</a>


                          </td>
                        </tr>
                        {%end%} {%else%}
                        <tr>
                          <td colspan="7">还没有哦。</td>

                        </tr>
                        {%end%}

                      </tbody>
                    </table>

                </div>

              <div class="card mb-3 topxian" id='kuaidi'>

                    <div class="card-body ">
                      <h6 class="card-title mb-1 ">
             快递
             {%if visible_project%}
              <div class="dropdown">
                <a href="javascript:void(0)" class=" mr-3 d-inline-block" id="apply_express" title="{{t_project.id}}" style="font-size:14px;">
                  <i class="fa fa-fw fa-comment"></i>新增</a>
                <div class="dropdown-content">
                  <a href="javascript:void(0)"  id="btn_add_express" >新建寄件 </a>
                  <a href="javascript:void(0)"  id="btn_add_express_rec" >新建收件 </a>
                </div>
              </div>
              {%end%}
            </h3>

                      </h6>

                    </div>
                    <hr class="my-0">
                    <div class="card-body  bg-faded">

                        <ul class="nav nav-tabs" id="myTab" role="tablist">
                          <li class="nav-item">
                            <a class="btn btn-light  nav_padding {%if int(express_list_type)==0%}active{%end%}"
                            href="/project?tag=show&guid={{t_project.guid}}&id={{t_project.id}}&express_list_type=0#kuaidi">
                          寄件
                          </a>
                          </li>
                          <li>
                          <a class="btn btn-light  nav_padding {%if int(express_list_type)==1%}active{%end%}"
                          href="/project?tag=show&guid={{t_project.guid}}&id={{t_project.id}}&express_list_type=1#kuaidi">
                        收件
                        </a>
                          </li>
                          </ul>

                        {%if express_list_type=='0'%}
                         <table class="table table-striped fayetable" style="padding:3px; margin:5px;width:99%;">
                          <thead>
                            <tr>
                           <th width="80">附件</th>
                           <th width='110'>申请时间</th>
                           <th width='100'>发件时间</th>
                           <th width='200'>快递单号</th>
                           <th width='100'>客户名称</th>
                           <th width='100'>收件人电话</th>
                           <th width='250'>资料明细</th>
                           <th width='100'>其他资料</th>
                           <th width='100'>付款方式</th>
                           <th width='150'>寄件人/收件人</th>
                           <th width='100'>创建人</th>
                           <th width='150'>状态</th>
                           <th width='80'></th>
                            </tr>
                          </thead>
                          <tbody>
                            {%if t_express_send%}
                            {%for item in t_express_send%}
                            <tr>
                                <td><a href="javascript:void(0);" class="filepath_detail" id="{{item.id}}"
                                  file_path="{{item.file_path}}" uid_name="{{item.uid_name}}" send_at_name="{{item.send_at_name}}">附件</a></td>
                                <td>{{item.created_at.strftime("%Y-%m-%d")}}</td>
                                <td>{%if item.created_send_at %}{{item.created_send_at.strftime("%Y-%m-%d")}}{%end%}</td>
                                <td>{%if item.express_number%}{{item.express_number}}{%end%}</td>
                                <td>{{item.rec_name}}</td>
                                <td>{{item.rec_tel}}</td>
                                <td>{{item.rec_file}}</td>
                                <td>{{item.other_rec_file}}</td>
                                <td>{{item.payment_type_id_name }}</td>
                                <td>{{item.send_at_name}}/{{item.rec_name}}</td>
                                <td>{{item.uid_name}}</td>
                                <td>
                                  {%if item.send_at%}
                                  {{item.send_at.strftime("%Y-%m-%d")}} {{item.accept_uid_name}}确认发件
                                  {%elif not item.accept_at%}待审核
                                  {%elif item.accept_state==1%}
                                  {{item.accept_at.strftime("%Y-%m-%d")}} {{item.accept_uid_name}}审核通过
                                  {%elif item.accept_state==2%}
                                  {{item.accept_at.strftime("%Y-%m-%d")}} {{item.accept_uid_name}}审核不通过 备注:{{item.accept_uid_remark}}
                                  {%end%}</td>
                                <td>
                                  {%if visible_project%}
                                  {%if item.accept_state==1 and express_manage=='1' and not item.send_at %}
                                  <a class="btn btn-primary btn-sm confirm_send_express" id="{{item.id}}" href="javascript:void(0);">确认发件</a>
                                  {%elif not item.accept_at and express_manage=='1'%}
                                  <a class="btn btn-primary btn-sm check_express" id="{{item.id}}" href="javascript:void(0);">审核</a>
                                  {%else%}
                                  <a class="btn btn-primary btn-sm edit_express" href="javascript:void(0);"
                                  id="{{item.id}}" rec_name="{{item.rec_name}}" rec_tel="{{item.rec_tel}}" created_send_at="{%if item.created_send_at%}{{item.created_send_at}}{%end%}"
                                  rec_addr="{{item.rec_addr}}"  rec_file="{{item.rec_file}}" rec_company="{{item.rec_company}}"
                                  express_type_id="{{item.express_type_id}}" created_at="{{item.created_at}}" other_rec_file="{{item.other_rec_file}}"
                                  payment_type_id="{{item.payment_type_id}}" send_at_name="{{item.send_at_name}}" remark="{{item.remark}}" accept_at="{{item.accept_at}}"
                                  rec_file_ids="{{item.rec_file_ids}}" express_number="{{item.express_number}}" uid_name="{{item.uid_name}}"
                                  send_or_rec="{{item.send_or_rec}}"
                                >查看</a>
                                  {%end%}
                                  {%end%}
                                </td>
                            </tr>
                            {%end%}
                            {%else%}
                            <tr>
                              <td colspan="15">还没有哦。</td>

                            </tr>
                           {%end%}

                          </tbody>
                        </table>
                        {%elif express_list_type=='1'%}
                        <table class="table table-striped fayetable" style="padding:10px;">
                            <thead>
                              <tr>
                             <th width="80">附件</th>
                             <th width='100'>申请时间</th>
                             <th width="100">收件时间</th>
                             <th width='200'>快递单号</th>
                             <th width='100'>客户名称</th>
                             <th width='100'>寄件人电话</th>
                             <th width='250'>资料明细</th>
                             <th width='100'>其他资料</th>
                             <th width='100'>付款方式</th>
                             <th width='150'>寄件人/收件人</th>
                             <th width='100'>创建人</th>
                             <th width='150'>状态</th>
                             <th width='80'></th>
                              </tr>
                            </thead>
                            <tbody>
                              {%if t_express_rec%}
                              {%for item in t_express_rec%}
                              <tr>
                                  <td><a href="javascript:void(0);" class="filepath_detail" id="{{item.id}}"
                                    file_path="{{item.file_path}}" uid_name="{{item.uid_name}}" send_at_name="{{item.send_at_name}}">附件</a></td>
                                  <td>{{item.created_at.strftime("%Y-%m-%d")}}</td>
                                  <td>{%if item.created_send_at %}{{item.created_send_at.strftime("%Y-%m-%d")}}{%end%}</td>
                                  <td>{%if item.express_number%}{{item.express_number}}{%end%}</td>
                                  <td>{{item.rec_name}}</td>
                                  <td>{{item.rec_tel}}</td>
                                  <td>{{item.rec_file}}</td>
                                  <td>{{item.other_rec_file}}</td>
                                  <td>{{item.payment_type_id_name }}</td>
                                  <td>{{item.rec_name}}/{{item.send_at_name}}</td>
                                  <td>{{item.uid_name}}</td>
                                  <td>
                                    {%if item.send_at%}
                                    {{item.send_at.strftime("%Y-%m-%d")}} {{item.accept_uid_name}}确认发件
                                    {%elif not item.accept_at%}待审核
                                    {%elif item.accept_state==1%}
                                    {{item.accept_at.strftime("%Y-%m-%d")}} {{item.accept_uid_name}}审核通过
                                    {%elif item.accept_state==2%}
                                    {{item.accept_at.strftime("%Y-%m-%d")}} {{item.accept_uid_name}}审核不通过 备注:{{item.accept_uid_remark}}
                                    {%end%}</td>
                                  <td>
                                    {%if visible_project%}
                                    {%if item.accept_state==1 and express_manage=='1' and not item.send_at %}
                                    <a class="btn btn-primary btn-sm confirm_send_express" id="{{item.id}}" href="javascript:void(0);">确认发件</a>
                                    {%elif not item.accept_at and express_manage=='1'%}
                                    <a class="btn btn-primary btn-sm check_express" id="{{item.id}}" href="javascript:void(0);">审核</a>
                                    {%else%}
                                    <a class="btn btn-primary btn-sm edit_express" href="javascript:void(0);"
                                    id="{{item.id}}" rec_name="{{item.rec_name}}" rec_tel="{{item.rec_tel}}" created_send_at="{%if item.created_send_at%}{{item.created_send_at}}{%end%}"
                                    rec_addr="{{item.rec_addr}}"  rec_file="{{item.rec_file}}" rec_company="{{item.rec_company}}"
                                    express_type_id="{{item.express_type_id}}" created_at="{{item.created_at}}" other_rec_file="{{item.other_rec_file}}"
                                    payment_type_id="{{item.payment_type_id}}" send_at_name="{{item.send_at_name}}" remark="{{item.remark}}" accept_at="{{item.accept_at}}"
                                    rec_file_ids="{{item.rec_file_ids}}" express_number="{{item.express_number}}" uid_name="{{item.uid_name}}" send_or_rec="{{item.send_or_rec}}"
                                  >查看</a>
                                    {%end%}
                                    {%end%}
                                  </td>
                              </tr>
                              {%end%}
                              {%else%}
                              <tr>
                                <td colspan="15">还没有哦。</td>

                              </tr>
                             {%end%}

                            </tbody>
                          </table>
                        {%end%}
                      </div>
                      </div>

            </div>
        </div>
   </div></div>
</div>
<div class="modal fade" id="check_express_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document" >
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="xiezhu_title">审核快递

      </h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body" id="site_mod">
            <div class="form-group">
            <div class="col-sm-10">
                <input type="radio" id="accept_state" name="accept_state" value="1">通过
                <input type="radio" id="accept_state" name="accept_state" value="2">不通过
                <div class="alert alert-danger" role="alert" style="display:none;" id="er_accept_state">
                </div>
                </div>

            </div>
            <div class="form-group">
              <div class="col-sm-10">
                  <label for="recode">备注</label>
                  <textarea id="accept_uid_remark" placeholder="备注"></textarea>
                  <div class="alert alert-danger" role="alert" style="display:none;" id="er_accept_uid_remark">
                  </div>
                  </div>
              </div>

        </div>


        <div class="modal-footer">
            <input type="hidden" value="0" id="is_other" name="is_other" />
                   <button class="btn btn-primary" target="_blank" id="btn_check_express">保存</button>

        </div>
      </div>
    </div>
  </div>
<div id="add_linkman_modal" class="modal modal-ku fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" >
        <div class="modal-content">
      <div class="modal-header">
              <h5 id="myModalLabel_linkman">增加客户联系人

                  <a href="javascript:;" class="btn btn-danger btn-small " id="delete_linkman">
                    <i class="btn-icon-only icon-remove">×</i>
                    </i>
                  </a>

              </h5>
            </div>
                <div class="modal-body form-horizontal" id="site_mod">
                  <div class="form-group">
                      <label class="control-label" for="username">名字/称呼</label>
                      <div class="col-md-10">
                      <input type="text" class="span4 " id="name" name="name" value="">
                       <p id="msg_name" class="help-block" style="color:red"></p>
                       </div>
                                                          <!-- /controls -->
                         </div>
                                                      <!-- /control-group -->


                         <div class="form-group">
                          <label class="control-label" for="firstname">性别</label>
                          <div class="col-md-10">
                          <input type="radio" name="gender" value="1" /> 先生
                          <input type="radio" name="gender" value="0" /> 女士
                          <p id="msg_gender" class="help-block" style="color:red"></p>
                          </div>
                                                          <!-- /controls -->
                          </div>

                          <div class="form-group">
                          <label class="control-label" for="username">电话</label>
                          <div class="col-md-10">
                           <input type="text" class="span4 " id="tel" name="tel" value="">
                           <p id="msg_company" class="help-block" style="color:red"></p>
                             </div>
                                                          <!-- /controls -->
                           </div>
                                                      <!-- /control-group -->



                          <div class="form-group">
                          <label class="control-label" for="lastname">备注</label>
                          <div class="col-sm-12">
                          <textarea type="text" class="span4" id="linkman_remark" name="linkman_remark" value="" style="height: 70px;"></textarea>
                          </div>
                                                    <!-- /controls -->
                          </div>

            </div>
            <div class="modal-footer">
              <button class="btn" data-dismiss="modal" aria-hidden="true" >关闭</button>
              <button class="btn btn-primary" id="btn_save_linkman" linkman_id='None'>保存</button>
            </div>
          </div>
        </div>
        </div>
<!-- Modal -->
<div class="modal modal-ku fade" id="project_state_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document" >
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">公司注册办理进度</h5>
            <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
      <div class="modal-body form-horizontal" id="site_mod">

  <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">办理状态</label>
    <div class="col-sm-10">
       {%for idx,item in enumerate(t_project_state1)%}
          <input type="radio" value="{{item.id}}" state_id_name="{{item.msg_txt}}"

           name="state_id"/>{{item.msg_txt}}
       {%end%}
    </div>
  </div>


      <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">备注：</label>
    <div class="col-sm-10">
      <textarea type="text" class="form-control" id="state_remark" name="state_remark" placeholder=""></textarea>
    </div>
  </div>


      </div>
      <div class="modal-footer">
                 <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                 <button class="btn btn-primary"  id="btn_save_project_state">保 存</button>
      </div>
    </div>
  </div>
</div>
<div id="add_project_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
  <div class="modal-dialog" role="document" >
    <div class="modal-content">
  <div class="modal-header" >
    <h5 id="myModalLabel">增记录


    </h5>
  </div>
  <div class="modal-body">


<div class="control-group">
        <label class="control-label" for="username">添加业务调整记录</label>
        <div class="input-group">
          <div class="col-md-8">
                <input type="text" class="form-control" id="key" value="" >
              </div>
                <span class="input-group-btn">
                <button type="button" class="btn btn-primary" href="javascript:void(0)" id="query_project">查询</button>
              </span>


        </div>
        <p class="help-block" style="margin: 10px;"> 请输入业务调整后对应的收入确认单编号.</p>

        <!-- /controls -->
</div>

<div id="show_projects">


</div>



  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true" >关闭</button>
    <a class="btn btn-primary" id="btn_save_project3" href="#relation">选择</a>
  </div>
  </div>
  </div>
</div>

<div class="modal modal-ku fade" id="project_state_modal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document" >
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLongTitle">公司变更办理进度 </h5>
              <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
        <div class="modal-body form-horizontal" id="site_mod">

    <div class="form-group">
      <label for="inputEmail3" class="col-sm-4 control-label">办理状态</label>
      <div class="col-sm-10">
         {%for idx,item in enumerate(t_project_state2)%}
            <input type="radio" value="{{item.id}}" state_id_name="{{item.msg_txt}}"

             name="state_id1"/>{{item.msg_txt}}
         {%end%}
      </div>
    </div>

        <div class="form-group">
      <label for="inputEmail3" class="col-sm-4 control-label">备注：</label>
      <div class="col-sm-10">
        <textarea type="text" class="form-control" id="state_remark1" name="state_remark1" placeholder=""></textarea>
      </div>
    </div>


        </div>
        <div class="modal-footer">
                   <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                   <button class="btn btn-primary"  id="btn_save_project_state1">保 存</button>
        </div>
      </div>
    </div>
  </div>


  <div class="modal modal-ku fade" id="project_state_modal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
      <div class="modal-dialog" role="document" >
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">记账报税办理进度 </h5>
                <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>

            <div class="modal-body form-horizontal" id="site_mod">

        <div class="form-group">
          <label for="inputEmail3" class="col-sm-4 control-label">办理状态</label>
          <div class="col-sm-10">
             {%for idx,item in enumerate(t_project_state3)%}
                <input type="radio" value="{{item.id}}" state_id_name="{{item.msg_txt}}"

                 name="state_id2"/>{{item.msg_txt}}
             {%end%}
          </div>
        </div>

            <div class="form-group">
          <label for="inputEmail3" class="col-sm-4 control-label">备注：</label>
          <div class="col-sm-10">
            <textarea type="text" class="form-control" id="state_remark2" name="state_remark2" placeholder=""></textarea>
          </div>
        </div>


            </div>


          <div class="modal-footer">
                     <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                     <button class="btn btn-primary"  id="btn_save_project_state2">保 存</button>
          </div>
        </div>
      </div>
    </div>

  <div class="modal modal-ku fade" id="project_state_modal3" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
        <div class="modal-dialog" role="document" >
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLongTitle">公司注销办理进度 </h5>
                  <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>

              <div class="modal-body form-horizontal" id="site_mod">

          <div class="form-group">
            <label for="inputEmail3" class="col-sm-4 control-label">办理状态</label>
            <div class="col-sm-10">
               {%for idx,item in enumerate(t_project_state4)%}
                  <input type="radio" value="{{item.id}}" state_id_name="{{item.msg_txt}}"

                   name="state_id3"/>{{item.msg_txt}}
               {%end%}
            </div>
          </div>

              <div class="form-group">
            <label for="inputEmail3" class="col-sm-4 control-label">备注：</label>
            <div class="col-sm-10">
              <textarea type="text" class="form-control" id="state_remark3" name="state_remark3" placeholder=""></textarea>
            </div>
          </div>


              </div>


            <div class="modal-footer">
                       <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                       <button class="btn btn-primary"  id="btn_save_project_state3">保 存</button>
            </div>
          </div>
        </div>
      </div>

  <div class="modal modal-ku fade" id="project_state_modal4" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
          <div class="modal-dialog" role="document" >
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">许可证办理进度 </h5>
                    <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>

                <div class="modal-body form-horizontal" id="site_mod">

            <div class="form-group">
              <label for="inputEmail3" class="col-sm-4 control-label">办理状态</label>
              <div class="col-sm-10">
                 {%for idx,item in enumerate(t_project_state5)%}
                    <input type="radio" value="{{item.id}}" state_id_name="{{item.msg_txt}}"

                     name="state_id4"/>{{item.msg_txt}}
                 {%end%}
              </div>
            </div>

                <div class="form-group">
              <label for="inputEmail3" class="col-sm-4 control-label">备注：</label>
              <div class="col-sm-10">
                <textarea type="text" class="form-control" id="state_remark4" name="state_remark4" placeholder=""></textarea>
              </div>
            </div>


                </div>


              <div class="modal-footer">
                         <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                         <button class="btn btn-primary"  id="btn_save_project_state4">保 存</button>
              </div>
            </div>
          </div>
        </div>

  <div class="modal modal-ku fade" id="project_state_modal5" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
            <div class="modal-dialog" role="document" >
              <div class="modal-content">
                  <div class="modal-header">
                      <h5 class="modal-title" id="exampleModalLongTitle">商标办理进度 </h5>
                      <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>

                  <div class="modal-body form-horizontal" id="site_mod">

              <div class="form-group">
                <label for="inputEmail3" class="col-sm-4 control-label">办理状态</label>
                <div class="col-sm-10">
                   {%for idx,item in enumerate(t_project_state6)%}
                      <input type="radio" value="{{item.id}}" state_id_name="{{item.msg_txt}}"

                       name="state_id5"/>{{item.msg_txt}}
                   {%end%}
                </div>
              </div>

                  <div class="form-group">
                <label for="inputEmail3" class="col-sm-4 control-label">备注：</label>
                <div class="col-sm-10">
                  <textarea type="text" class="form-control" id="state_remark5" name="state_remark5" placeholder=""></textarea>
                </div>
              </div>


                  </div>


                <div class="modal-footer">
                           <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                           <button class="btn btn-primary"  id="btn_save_project_state5">保 存</button>
                </div>
              </div>
            </div>
          </div>

  <div class="modal modal-ku fade" id="project_state_modal6" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
              <div class="modal-dialog" role="document" >
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLongTitle">特殊业务办理进度 </h5>
                        <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>

                    <div class="modal-body form-horizontal" id="site_mod">

                <div class="form-group">
                  <label for="inputEmail3" class="col-sm-4 control-label">办理状态</label>
                  <div class="col-sm-10">
                     {%for idx,item in enumerate(t_project_state7)%}
                        <input type="radio" value="{{item.id}}" state_id_name="{{item.msg_txt}}"

                         name="state_id6"/>{{item.msg_txt}}
                     {%end%}
                  </div>
                </div>

                    <div class="form-group">
                  <label for="inputEmail3" class="col-sm-4 control-label">备注：</label>
                  <div class="col-sm-10">
                    <textarea type="text" class="form-control" id="state_remark6" name="state_remark6" placeholder=""></textarea>
                  </div>
                </div>


                    </div>


                  <div class="modal-footer">
                             <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                             <button class="btn btn-primary"  id="btn_save_project_state6">保 存</button>
                  </div>
                </div>
              </div>
            </div>

  <div class="modal modal-ku fade" id="project_state_modal7" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                <div class="modal-dialog" role="document" >
                  <div class="modal-content">
                      <div class="modal-header">
                          <h5 class="modal-title" id="exampleModalLongTitle">其他业务办理进度 </h5>
                          <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>

                      <div class="modal-body form-horizontal" id="site_mod">

                  <div class="form-group">
                    <label for="inputEmail3" class="col-sm-4 control-label">办理状态</label>
                    <div class="col-sm-10">
                       {%for idx,item in enumerate(t_project_state8)%}
                          <input type="radio" value="{{item.id}}" state_id_name="{{item.msg_txt}}"

                           name="state_id7"/>{{item.msg_txt}}
                       {%end%}
                    </div>
                  </div>

                      <div class="form-group">
                    <label for="inputEmail3" class="col-sm-4 control-label">备注：</label>
                    <div class="col-sm-10">
                      <textarea type="text" class="form-control" id="state_remark7" name="state_remark7" placeholder=""></textarea>
                    </div>
                  </div>


                      </div>


                    <div class="modal-footer">
                               <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                               <button class="btn btn-primary"  id="btn_save_project_state7">保 存</button>
                    </div>
                  </div>
                </div>
              </div>
  <div class="modal modal-ku fade" id="project_state_modal8" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                <div class="modal-dialog" role="document" >
                  <div class="modal-content">
                      <div class="modal-header">
                          <h5 class="modal-title" id="exampleModalLongTitle">创业补贴办理进度</h5>
                          <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>

                      <div class="modal-body form-horizontal" id="site_mod">

                  <div class="form-group">
                    <label for="inputEmail3" class="col-sm-4 control-label">办理状态</label>
                    <div class="col-sm-10">
                       {%for idx,item in enumerate(t_project_state9)%}
                          <input type="radio" value="{{item.id}}" state_id_name="{{item.msg_txt}}" checked

                           name="state_id8"/>{{item.msg_txt}}
                       {%end%}
                    </div>
                  </div>

                      <div class="form-group">
                    <label for="inputEmail3" class="col-sm-4 control-label">备注：</label>
                    <div class="col-sm-10">
                      <textarea type="text" class="form-control" id="state_remark8" name="state_remark8" placeholder=""></textarea>
                    </div>
                  </div>


                      </div>


                    <div class="modal-footer">
                               <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                               <button class="btn btn-primary"  id="btn_save_project_state8">保 存</button>
                    </div>
                  </div>
                </div>
              </div>
  <div class="modal modal-ku fade" id="project_state_modal9" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                <div class="modal-dialog" role="document" >
                  <div class="modal-content">
                      <div class="modal-header">
                          <h5 class="modal-title" id="exampleModalLongTitle">创业补贴办理进度</h5>
                          <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>

                      <div class="modal-body form-horizontal" id="site_mod">

                  <div class="form-group">
                    <label for="inputEmail3" class="col-sm-4 control-label">办理状态</label>
                    <div class="col-sm-10">
                       {%for idx,item in enumerate(t_project_state10)%}
                          <input type="radio" value="{{item.id}}" state_id_name="{{item.msg_txt}}" checked

                           name="state_id9"/>{{item.msg_txt}}
                       {%end%}
                    </div>
                  </div>

                      <div class="form-group">
                    <label for="inputEmail3" class="col-sm-4 control-label">备注：</label>
                    <div class="col-sm-10">
                      <textarea type="text" class="form-control" id="state_remark9" name="state_remark9" placeholder=""></textarea>
                    </div>
                  </div>


                      </div>


                    <div class="modal-footer">
                               <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                               <button class="btn btn-primary"  id="btn_save_project_state9">保 存</button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="modal modal-ku fade" id="project_state_modal10" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                <div class="modal-dialog" role="document" >
                  <div class="modal-content">
                      <div class="modal-header">
                          <h5 class="modal-title" id="exampleModalLongTitle">税务报到办理进度</h5>
                          <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>

                      <div class="modal-body form-horizontal" id="site_mod">

                  <div class="form-group">
                    <label for="inputEmail3" class="col-sm-4 control-label">办理状态</label>
                    <div class="col-sm-10">
                       {%for idx,item in enumerate(t_project_state11)%}
                          <input type="radio" value="{{item.id}}" state_id_name="{{item.msg_txt}}" checked

                           name="state_id10"/>{{item.msg_txt}}
                       {%end%}
                    </div>
                  </div>

                      <div class="form-group">
                    <label for="inputEmail3" class="col-sm-4 control-label">备注：</label>
                    <div class="col-sm-10">
                      <textarea type="text" class="form-control" id="state_remark10" name="state_remark10" placeholder=""></textarea>
                    </div>
                  </div>


                      </div>


                    <div class="modal-footer">
                               <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                               <button class="btn btn-primary"  id="btn_save_project_state10">保 存</button>
                    </div>
                  </div>
                </div>
              </div>
  <div class="modal modal-ku fade" id="project_state_show_all1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                  <div class="modal-dialog" role="document" >
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLongTitle">公司注册办理进度 </h5>
                            <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                            </button>
                          </div>

                        <div class="modal-body form-horizontal" id="site_mod">
                            {%if t_project_state_msg1%}
                            {%for item in t_project_state_msg1%}
                            <div class="message-item" id="m9">
                              <div class="message-inner">
                                <div class="message-head clearfix">

                                  <div class="avatar pull-left"><img src="/static/images/avatar.jpeg"></div>
                                  <div class="user-detail">
                                    <h5 class="handle">{{item.uid_name}} <span style="font-size:13px;">{{item.created_at}} 将设置状态：
                                     {{item.state_id_name}}</span>
                                     {%if item.uid==int(uid) or name=='罗文波'%}
                                     <div style="float: right;margin:5px;">
                                     <a curr_state_id="{{item.id}}" state_id="{{item.state_id}}" state_remark="{{item.state_remark}}" uid_name="{{item.uid_name}}" type_id="{{item.type_id}}"
                                state_guid="{{item.guid}}"  class="btn  btn-outline-danger btn-sm delete_state" href="javascript:void(0)" >删除</a>

                               <a curr_state_id="{{item.id}}" state_id="{{item.state_id}}" state_remark="{{item.state_remark}}" uid_name="{{item.uid_name}}" type_id="{{item.type_id}}"
                                state_guid="{{item.guid}}" class=" btn btn-outline-primary btn-sm  modify_state" href="javascript:void(0)" >修改</a>
                                </div>
                            {%end%}
                                     </h5>

                                  </div>
                                </div>
                                {%if item.state_remark%}
                                <div class="qa-message-content">
                                  {{item.state_remark}}
                                </div>
                                {%else%}
                                无描述
                                {%end%}

                            </div>


                            </div>

                            {%end%}
                                   {%else%}
                                  <div class="card-body py-2 ">
                                    <div class="alert alert-secondary" role="alert"> 还没有办理进度数据记录哦</div>
                                  </div>
                                  {%end%}


                        </div>


                      <div class="modal-footer">
                                 <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                      </div>
                    </div>
                  </div>
                </div>

<div class="modal modal-ku fade" id="project_state_show_all2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                    <div class="modal-dialog" role="document" >
                      <div class="modal-content">
                          <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLongTitle">公司变更办理进度 </h5>
                              <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                              </button>
                            </div>

                          <div class="modal-body form-horizontal" id="site_mod">
                              {%if t_project_state_msg2%}
                              {%for item in t_project_state_msg2%}
                              <div class="message-item" id="m9">
                                <div class="message-inner">
                                  <div class="message-head clearfix">

                                    <div class="avatar pull-left"><img src="/static/images/avatar.jpeg"></div>
                                    <div class="user-detail">
                                      <h5 class="handle">{{item.uid_name}} <span style="font-size:13px;">{{item.created_at}} 将设置状态：
                                       {{item.state_id_name}}</span>
                                       {%if item.uid==int(uid) or name=='罗文波'%}
                                       <div style="float: right;margin:5px;">
                                       <a curr_state_id="{{item.id}}" state_id="{{item.state_id}}" state_remark="{{item.state_remark}}" uid_name="{{item.uid_name}}" type_id="{{item.type_id}}"
                                  state_guid="{{item.guid}}"  class="btn  btn-outline-danger btn-sm delete_state" href="javascript:void(0)" >删除</a>

                                 <a curr_state_id="{{item.id}}" state_id="{{item.state_id}}" state_remark="{{item.state_remark}}" uid_name="{{item.uid_name}}" type_id="{{item.type_id}}"
                                  state_guid="{{item.guid}}" class=" btn btn-outline-primary btn-sm  modify_state1" href="javascript:void(0)" >修改</a>
                                  </div>
                              {%end%}

                                       </h5>

                                    </div>
                                  </div>
                                  {%if item.state_remark%}
                                  <div class="qa-message-content">
                                    {{item.state_remark}}
                                  </div>
                                  {%else%}
                                  无描述
                                  {%end%}
-->
                              </div>


                              </div>

                              {%end%}
                                     {%else%}
                                    <div class="card-body py-2 ">
                                      <div class="alert alert-secondary" role="alert"> 还没有办理进度数据记录哦</div>
                                    </div>
                                    {%end%}


                          </div>-->


                        <div class="modal-footer">
                                   <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                        </div>
                      </div>
                    </div>
                  </div>

<div class="modal modal-ku fade" id="project_state_show_all3" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                      <div class="modal-dialog" role="document" >
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLongTitle">记账报税办理进度 </h5>
                                <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
                                  <span aria-hidden="true">&times;</span>
                                </button>
                              </div>

                            <div class="modal-body form-horizontal" id="site_mod">
                                {%if t_project_state_msg3%}
                                {%for item in t_project_state_msg3%}
                                <div class="message-item" id="m9">
                                  <div class="message-inner">
                                    <div class="message-head clearfix">

                                      <div class="avatar pull-left"><img src="/static/images/avatar.jpeg"></div>
                                      <div class="user-detail">
                                        <h5 class="handle">{{item.uid_name}} <span style="font-size:13px;">{{item.created_at}} 将设置状态：
                                         {{item.state_id_name}}</span>
                                         {%if item.uid==int(uid) or name=='罗文波'%}
                                         <div style="float: right;margin:5px;">
                                         <a curr_state_id="{{item.id}}" state_id="{{item.state_id}}" state_remark="{{item.state_remark}}" uid_name="{{item.uid_name}}" type_id="{{item.type_id}}"
                                    state_guid="{{item.guid}}"  class="btn  btn-outline-danger btn-sm delete_state" href="javascript:void(0)" >删除</a>

                                   <a curr_state_id="{{item.id}}" state_id="{{item.state_id}}" state_remark="{{item.state_remark}}" uid_name="{{item.uid_name}}" type_id="{{item.type_id}}"
                                    state_guid="{{item.guid}}" class=" btn btn-outline-primary btn-sm  modify_state2" href="javascript:void(0)" >修改</a>
                                    </div>
                                {%end%}
                                         </h5>

                                      </div>
                                    </div>
                                    {%if item.state_remark%}
                                    <div class="qa-message-content">
                                      {{item.state_remark}}
                                    </div>
                                    {%else%}
                                    无描述
                                    {%end%}

                                </div>


                                </div>

                                {%end%}
                                       {%else%}
                                      <div class="card-body py-2 ">
                                        <div class="alert alert-secondary" role="alert"> 还没有办理进度数据记录哦</div>
                                      </div>
                                      {%end%}


                            </div>


                          <div class="modal-footer">
                                     <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                          </div>
                        </div>
                      </div>
                    </div>

<div class="modal modal-ku fade" id="project_state_show_all4" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                        <div class="modal-dialog" role="document" >
                          <div class="modal-content">
                              <div class="modal-header">
                                  <h5 class="modal-title" id="exampleModalLongTitle">公司注销办理进度 </h5>
                                  <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                  </button>
                                </div>

                              <div class="modal-body form-horizontal" id="site_mod">
                                  {%if t_project_state_msg4%}
                                  {%for item in t_project_state_msg4%}
                                  <div class="message-item" id="m9">
                                    <div class="message-inner">
                                      <div class="message-head clearfix">

                                        <div class="avatar pull-left"><img src="/static/images/avatar.jpeg"></div>
                                        <div class="user-detail">
                                          <h5 class="handle">{{item.uid_name}} <span style="font-size:13px;">{{item.created_at}} 将设置状态：
                                           {{item.state_id_name}}</span>
                                           {%if item.uid==int(uid) or name=='罗文波'%}
                                           <div style="float: right;margin:5px;">
                                           <a curr_state_id="{{item.id}}" state_id="{{item.state_id}}" state_remark="{{item.state_remark}}" uid_name="{{item.uid_name}}" type_id="{{item.type_id}}"
                                      state_guid="{{item.guid}}"  class="btn  btn-outline-danger btn-sm delete_state" href="javascript:void(0)" >删除</a>

                                     <a curr_state_id="{{item.id}}" state_id="{{item.state_id}}" state_remark="{{item.state_remark}}" uid_name="{{item.uid_name}}" type_id="{{item.type_id}}"
                                      state_guid="{{item.guid}}" class=" btn btn-outline-primary btn-sm  modify_state3" href="javascript:void(0)" >修改</a>
                                      </div>
                                  {%end%}
                                           </h5>

                                        </div>
                                      </div>
                                      {%if item.state_remark%}
                                      <div class="qa-message-content">
                                        {{item.state_remark}}
                                      </div>
                                      {%else%}
                                      无描述
                                      {%end%}

                                  </div>


                                  </div>

                                  {%end%}
                                         {%else%}
                                        <div class="card-body py-2 ">
                                          <div class="alert alert-secondary" role="alert"> 还没有办理进度数据记录哦</div>
                                        </div>
                                        {%end%}


                              </div>


                            <div class="modal-footer">
                                       <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                            </div>
                          </div>
                        </div>
                      </div>

<div class="modal modal-ku fade" id="project_state_show_all5" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                          <div class="modal-dialog" role="document" >
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLongTitle">许可证办理进度 </h5>
                                    <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
                                      <span aria-hidden="true">&times;</span>
                                    </button>
                                  </div>

                                <div class="modal-body form-horizontal" id="site_mod">
                                    {%if t_project_state_msg5%}
                                    {%for item in t_project_state_msg5%}
                                    <div class="message-item" id="m9">
                                      <div class="message-inner">
                                        <div class="message-head clearfix">

                                          <div class="avatar pull-left"><img src="/static/images/avatar.jpeg"></div>
                                          <div class="user-detail">
                                            <h5 class="handle">{{item.uid_name}} <span style="font-size:13px;">{{item.created_at}} 将设置状态：
                                             {{item.state_id_name}}</span>
                                             {%if item.uid==int(uid) or name=='罗文波'%}
                                             <div style="float: right;margin:5px;">
                                             <a curr_state_id="{{item.id}}" state_id="{{item.state_id}}" state_remark="{{item.state_remark}}" uid_name="{{item.uid_name}}" type_id="{{item.type_id}}"
                                        state_guid="{{item.guid}}"  class="btn  btn-outline-danger btn-sm delete_state" href="javascript:void(0)" >删除</a>

                                       <a curr_state_id="{{item.id}}" state_id="{{item.state_id}}" state_remark="{{item.state_remark}}" uid_name="{{item.uid_name}}" type_id="{{item.type_id}}"
                                        state_guid="{{item.guid}}" class=" btn btn-outline-primary btn-sm  modify_state4" href="javascript:void(0)" >修改</a>
                                        </div>
                                    {%end%}
                                             </h5>

                                          </div>
                                        </div>
                                        {%if item.state_remark%}
                                        <div class="qa-message-content">
                                          {{item.state_remark}}
                                        </div>
                                        {%else%}
                                        无描述
                                        {%end%}

                                    </div>


                                    </div>

                                    {%end%}
                                           {%else%}
                                          <div class="card-body py-2 ">
                                            <div class="alert alert-secondary" role="alert"> 还没有办理进度数据记录哦</div>
                                          </div>
                                          {%end%}


                                </div>


                              <div class="modal-footer">
                                         <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                              </div>
                            </div>
                          </div>
                        </div>

<div class="modal modal-ku fade" id="project_state_show_all6" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                            <div class="modal-dialog" role="document" >
                              <div class="modal-content">
                                  <div class="modal-header">
                                      <h5 class="modal-title" id="exampleModalLongTitle">商标办理进度</h5>
                                      <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                      </button>
                                    </div>

                                  <div class="modal-body form-horizontal" id="site_mod">
                                      {%if t_project_state_msg6%}
                                      {%for item in t_project_state_msg6%}
                                      <div class="message-item" id="m9">
                                        <div class="message-inner">
                                          <div class="message-head clearfix">

                                            <div class="avatar pull-left"><img src="/static/images/avatar.jpeg"></div>
                                            <div class="user-detail">
                                              <h5 class="handle">{{item.uid_name}} <span style="font-size:13px;">{{item.created_at}} 将设置状态：
                                               {{item.state_id_name}}</span>
                                               {%if item.uid==int(uid) or name=='罗文波' %}
                                               <div style="float: right;margin:5px;">
                                               <a curr_state_id="{{item.id}}" state_id="{{item.state_id}}" state_remark="{{item.state_remark}}" uid_name="{{item.uid_name}}" type_id="{{item.type_id}}"
                                          state_guid="{{item.guid}}"  class="btn  btn-outline-danger btn-sm delete_state" href="javascript:void(0)" >删除</a>

                                         <a curr_state_id="{{item.id}}" state_id="{{item.state_id}}" state_remark="{{item.state_remark}}" uid_name="{{item.uid_name}}" type_id="{{item.type_id}}"
                                          state_guid="{{item.guid}}" class=" btn btn-outline-primary btn-sm  modify_state5" href="javascript:void(0)" >修改</a>
                                          </div>
                                      {%end%}
                                               </h5>

                                            </div>
                                          </div>
                                          {%if item.state_remark%}
                                          <div class="qa-message-content">
                                            {{item.state_remark}}
                                          </div>
                                          {%else%}
                                          无描述
                                          {%end%}

                                      </div>


                                      </div>

                                      {%end%}
                                             {%else%}
                                            <div class="card-body py-2 ">
                                              <div class="alert alert-secondary" role="alert"> 还没有办理进度数据记录哦</div>
                                            </div>
                                            {%end%}


                                  </div>


                                <div class="modal-footer">
                                           <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                                </div>
                              </div>
                            </div>
                          </div>

<div class="modal modal-ku fade" id="project_state_show_all7" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                              <div class="modal-dialog" role="document" >
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLongTitle">特殊业务办理进度 </h5>
                                        <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
                                          <span aria-hidden="true">&times;</span>
                                        </button>
                                      </div>

                                    <div class="modal-body form-horizontal" id="site_mod">
                                        {%if t_project_state_msg7%}
                                        {%for item in t_project_state_msg7%}
                                        <div class="message-item" id="m9">
                                          <div class="message-inner">
                                            <div class="message-head clearfix">

                                              <div class="avatar pull-left"><img src="/static/images/avatar.jpeg"></div>
                                              <div class="user-detail">
                                                <h5 class="handle">{{item.uid_name}} <span style="font-size:13px;">{{item.created_at}} 将设置状态：
                                                 {{item.state_id_name}}</span>
                                                 {%if item.uid==int(uid) or name=='罗文波'%}
                                                 <div style="float: right;margin:5px;">
                                                 <a curr_state_id="{{item.id}}" state_id="{{item.state_id}}" state_remark="{{item.state_remark}}" uid_name="{{item.uid_name}}" type_id="{{item.type_id}}"
                                            state_guid="{{item.guid}}"  class="btn  btn-outline-danger btn-sm delete_state" href="javascript:void(0)" >删除</a>

                                           <a curr_state_id="{{item.id}}" state_id="{{item.state_id}}" state_remark="{{item.state_remark}}" uid_name="{{item.uid_name}}" type_id="{{item.type_id}}"
                                            state_guid="{{item.guid}}" class=" btn btn-outline-primary btn-sm  modify_state6" href="javascript:void(0)" >修改</a>
                                                </div>
                                        {%end%}
                                                 </h5>

                                              </div>
                                            </div>
                                            {%if item.state_remark%}
                                            <div class="qa-message-content">
                                              {{item.state_remark}}
                                            </div>
                                            {%else%}
                                            无描述
                                            {%end%}

                                        </div>


                                        </div>

                                        {%end%}
                                               {%else%}
                                              <div class="card-body py-2 ">
                                                <div class="alert alert-secondary" role="alert"> 还没有办理进度数据记录哦</div>
                                              </div>
                                              {%end%}


                                    </div>


                                  <div class="modal-footer">
                                             <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                                  </div>
                                </div>
                              </div>
                            </div>

<div class="modal modal-ku fade" id="project_state_show_all8" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                                <div class="modal-dialog" role="document" >
                                  <div class="modal-content">
                                      <div class="modal-header">
                                          <h5 class="modal-title" id="exampleModalLongTitle">其他业务办理进度</h5>
                                          <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                          </button>
                                        </div>

                                      <div class="modal-body form-horizontal" id="site_mod">
                                          {%if t_project_state_msg8%}
                                          {%for item in t_project_state_msg8%}
                                          <div class="message-item" id="m9">
                                            <div class="message-inner">
                                              <div class="message-head clearfix">

                                                <div class="avatar pull-left"><img src="/static/images/avatar.jpeg"></div>
                                                <div class="user-detail">
                                                  <h5 class="handle">{{item.uid_name}} <span style="font-size:13px;">{{item.created_at}} 将设置状态：
                                                   {{item.state_id_name}}</span>
                                                   </h5>
                                                   {%if item.uid==int(uid) or name=='罗文波'%}
                                                   <div style="float: right;margin:5px;">
                                                   <a curr_state_id="{{item.id}}" state_id="{{item.state_id}}" state_remark="{{item.state_remark}}" uid_name="{{item.uid_name}}" type_id="{{item.type_id}}"
                                              state_guid="{{item.guid}}"  class="btn  btn-outline-danger btn-sm delete_state" href="javascript:void(0)" >删除</a>

                                             <a curr_state_id="{{item.id}}" state_id="{{item.state_id}}" state_remark="{{item.state_remark}}" uid_name="{{item.uid_name}}" type_id="{{item.type_id}}"
                                              state_guid="{{item.guid}}" class=" btn btn-outline-primary btn-sm  modify_state7" href="javascript:void(0)" >修改</a>
                                            </div>
                                          {%end%}

                                                </div>
                                              </div>
                                              {%if item.state_remark%}
                                              <div class="qa-message-content">
                                                {{item.state_remark}}
                                              </div>
                                              {%else%}
                                              无描述
                                              {%end%}

                                          </div>


                                          </div>

                                          {%end%}
                                                 {%else%}
                                                <div class="card-body py-2 ">
                                                  <div class="alert alert-secondary" role="alert"> 还没有办理进度数据记录哦</div>
                                                </div>
                                                {%end%}


                                      </div>


                                    <div class="modal-footer">
                                               <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                                    </div>
                                  </div>
                                </div>
                              </div>
<div class="modal modal-ku fade" id="project_state_show_all9" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                                <div class="modal-dialog" role="document" >
                                  <div class="modal-content">
                                      <div class="modal-header">
                                          <h5 class="modal-title" id="exampleModalLongTitle">创业补贴办理进度</h5>
                                          <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                          </button>
                                        </div>

                                      <div class="modal-body form-horizontal" id="site_mod">
                                          {%if t_project_state_msg9%}
                                          {%for item in t_project_state_msg9%}
                                          <div class="message-item" id="m9">
                                            <div class="message-inner">
                                              <div class="message-head clearfix">

                                                <div class="avatar pull-left"><img src="/static/images/avatar.jpeg"></div>
                                                <div class="user-detail">
                                                  <h5 class="handle">{{item.uid_name}} <span style="font-size:13px;">{{item.created_at}} 将设置状态：
                                                   {{item.state_id_name}}</span>
                                                   </h5>
                                                   {%if item.uid==int(uid) or name=='罗文波'%}
                                                   <div style="float: right;margin:5px;">
                                                   <a curr_state_id="{{item.id}}" state_id="{{item.state_id}}" state_remark="{{item.state_remark}}" uid_name="{{item.uid_name}}" type_id="{{item.type_id}}"
                                              state_guid="{{item.guid}}"  class="btn  btn-outline-danger btn-sm delete_state" href="javascript:void(0)" >删除</a>

                                             <a curr_state_id="{{item.id}}" state_id="{{item.state_id}}" state_remark="{{item.state_remark}}" uid_name="{{item.uid_name}}" type_id="{{item.type_id}}"
                                              state_guid="{{item.guid}}" class=" btn btn-outline-primary btn-sm  modify_state8" href="javascript:void(0)" >修改</a>
                                            </div>
                                          {%end%}

                                                </div>
                                              </div>
                                              {%if item.state_remark%}
                                              <div class="qa-message-content">
                                                {{item.state_remark}}
                                              </div>
                                              {%else%}
                                              无描述
                                              {%end%}

                                          </div>


                                          </div>

                                          {%end%}
                                                 {%else%}
                                                <div class="card-body py-2 ">
                                                  <div class="alert alert-secondary" role="alert"> 还没有办理进度数据记录哦</div>
                                                </div>
                                                {%end%}


                                      </div>


                                    <div class="modal-footer">
                                               <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                                    </div>
                                  </div>
                                </div>
                              </div>
<div class="modal modal-ku fade" id="project_state_show_all10" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                                <div class="modal-dialog" role="document" >
                                  <div class="modal-content">
                                      <div class="modal-header">
                                          <h5 class="modal-title" id="exampleModalLongTitle">经济普查办理进度</h5>
                                          <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                          </button>
                                        </div>

                                      <div class="modal-body form-horizontal" id="site_mod">
                                          {%if t_project_state_msg10%}
                                          {%for item in t_project_state_msg10%}
                                          <div class="message-item" id="m9">
                                            <div class="message-inner">
                                              <div class="message-head clearfix">

                                                <div class="avatar pull-left"><img src="/static/images/avatar.jpeg"></div>
                                                <div class="user-detail">
                                                  <h5 class="handle">{{item.uid_name}} <span style="font-size:13px;">{{item.created_at}} 将设置状态：
                                                   {{item.state_id_name}}</span>
                                                   </h5>
                                                   {%if item.uid==int(uid) or name=='罗文波'%}
                                                   <div style="float: right;margin:5px;">
                                                   <a curr_state_id="{{item.id}}" state_id="{{item.state_id}}" state_remark="{{item.state_remark}}" uid_name="{{item.uid_name}}" type_id="{{item.type_id}}"
                                              state_guid="{{item.guid}}"  class="btn  btn-outline-danger btn-sm delete_state" href="javascript:void(0)" >删除</a>

                                             <a curr_state_id="{{item.id}}" state_id="{{item.state_id}}" state_remark="{{item.state_remark}}" uid_name="{{item.uid_name}}" type_id="{{item.type_id}}"
                                              state_guid="{{item.guid}}" class=" btn btn-outline-primary btn-sm  modify_state9" href="javascript:void(0)" >修改</a>
                                            </div>
                                          {%end%}

                                                </div>
                                              </div>
                                              {%if item.state_remark%}
                                              <div class="qa-message-content">
                                                {{item.state_remark}}
                                              </div>
                                              {%else%}
                                              无描述
                                              {%end%}

                                          </div>


                                          </div>

                                          {%end%}
                                                 {%else%}
                                                <div class="card-body py-2 ">
                                                  <div class="alert alert-secondary" role="alert"> 还没有办理进度数据记录哦</div>
                                                </div>
                                                {%end%}


                                      </div>


                                    <div class="modal-footer">
                                               <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                                    </div>
                                  </div>
                                </div>
                              </div>
<!-- Modal -->
<div class="modal fade" id="file_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">新增交接资料 </h5>
        <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body form-horizontal" id="site_mod">


  <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">资料名称</label>
    <div class="col-sm-10">

      {%for idx,item in enumerate(t_file_type)%}
          {%if idx==4%} <br/>{%end%}{%if idx==7%} <br/>{%end%}
          <input type="radio" value="{{item.id}}" ft_name="{{item.income_name}}" name="file_type_id" {%if idx==0%}checked{%end%} />{{item.income_name}}
       {%end%}

    </div>
  </div>

  <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">资料类型</label>
    <div class="col-sm-10">

       {%for idx,item in enumerate(t_file_type_cate)%}

          <input type="radio" value="{{item.id}}" ft_name="{{item.income_name}}" {%if idx==0 %}checked{%end%} name="file_type_cate_id"/>{{item.income_name}}

       {%end%}

    </div>
  </div>

  <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">数量</label>
    <div class="col-sm-10">

<input type="text" value="1" id="rec_num" name="rec_num"  class="form-control"/>
    </div>
  </div>
      <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">备 注</label>
    <div class="col-sm-10">
      <textarea type="text" class="form-control" id="remark" name="remark" placeholder="身份证号码等"></textarea>
    </div>
  </div>

    <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">电子版</label>
    <div class="col-sm-10">

<input type="file" value="1" id="file" name="file"  class="form-control"/>
    </div>
  </div>



      </div>


      <div class="modal-footer">

        <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                 <button class="btn btn-primary" target="_blank" id="btn_save_file">保 存</button>

      </div>
    </div>
  </div>
</div>



<div id="a_add_trans_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document" >
    <div class="modal-content">
  <div class="modal-header">
    <h3 id="myModalLabel_trans">新建交接资料</h3>
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
  </div>
  <div class="modal-body">
  <!--
    <div class="form-group">
      <label class="control-label" for="tran_by">移交方</label>
      <div class="col-sm-10">
        <input type="text" class="span4 " id="tran_by" name="tran_by" value="">
        <p id="msg_tran_by" class="help-block" style="color:red"></p>
      </div>

    </div>
    -->
    <!-- /control-group -->
        <div class="form-group">
      <label class="control-label" for="rec_by">签收方</label>
      <div class="col-md-10">
        <input type="text" id="rec_by" name="rec_by" value=""  class="form-control">

      </div>
      <!-- /controls -->
    </div>
    <div  class="form-group">
      <label for="is_inner">类型</label>
      <div class="col-sm-10">

        <input type="radio" name="is_inner" id="is_inner" value="0"/>外部交接
        <input type="radio" name="is_inner" id="is_inner" value="1"/>内部交接
        <p id="msg_rec_by" class="help-block" style="color:red"></p>

      </div>
    </div>
    <!-- /control-group -->
        <div class="form-group">
      <label class="control-label" for="tran_at">交接时间</label>
      <div class="col-sm-10">
        <input type="date datetime"  id="tran_at" name="tran_at" readonly="readonly"  class="form-control"/>
        <p id="msg_tran_at" class="help-block" style="color:red"></p>
      </div>
      <!-- /controls -->
    </div>
    <!-- /control-group -->

           <div class="form-group">
      <label class="control-label" for="tran_at">交接明细 </label>

       <input type="checkbox" name="allcheck_trans" id="allcheck_trans"/>全选
      <div class="col-sm-10">
      {% for item in t_projects_type%}
        <input type="checkbox" style="margin:0 0 0 10px;" name="check_projects_type_trans" id="trans_type_id_{{item.id}}"
         income_name="{{item.income_name}}" value="{{item.id}}"
          >{{item.income_name}}
        {%end%}
</p>
      </div>
      <!-- /controls -->
    </div>
    <!-- /control-group -->
        <div class="form-group">
      <label class="control-label" for="lastname">其他资料</label>
      <div class="col-sm-10">
        <textarea type="text"  class="form-control" id="trans_remark" name="trans_remark" value="" style="height: 60px;"></textarea>
      </div>
      <!-- /controls -->
    </div>



    <div class="form-group">
      <label class="control-label" for="lastname">资料用途</label>
      <div class="col-sm-10">
        <textarea type="text"  class="form-control" id="use_type" name="use_type" value="" style="height: 60px;"></textarea>
      </div>
      <!-- /controls -->
    </div>






    <div class="control-group">
      <label class="control-label" for="lastname">附件</label>
      <div class="controls">
        <input type="file" value="1" id="tran_file" name="tran_file" class="form-control" />
      </div>
      <!-- /controls -->
    </div>
  </div>





  <div class="modal-footer">
  <div class="alert alert-danger " role="alert" id="show_msg_by_transition">

</div>
  <a href="javascript:void(0)" id="delete_transition" class="btn-danger btn">删除本条数据</a>
    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
    <button class="btn btn-primary" id="btn_save_trans">保存</button>
  </div>
  </div>
  </div>
</div>

<div id="a_add_trans_modal1" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" >
      <div class="modal-content">
    <div class="modal-header">
      <h3 id="myModalLabel_trans">上传附件</h3>
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    </div>
    <div class="modal-body">
          <div class="form-group">
        <label class="control-label" for="lastname">备注</label>
        <div class="col-sm-10">
          <textarea type="text"  class="form-control" id="trans_remark1" name="trans_remark1" value="" style="height: 60px;"></textarea>
        </div>
        <!-- /controls -->
      </div>
      <div class="control-group">
        <label class="control-label" for="lastname">附件</label>
        <div class="controls">
          <input type="file" accept="image/*" multiple=""  id="uploaderInput">
          <ul id="uploaderFiles"></ul>
        </div>
        <!-- /controls -->
      </div>
    </div>





    <div class="modal-footer">
    <a href="javascript:void(0)" id="delete_transition1" class="btn-danger btn">删除本条数据</a>
      <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
      <button class="btn btn-primary" id="btn_save_trans1">保存</button>
    </div>
    </div>
    </div>
  </div>

<!-- Modal -->
<div class="modal fade" id="team_modal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">业务相关人员 </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

<div class="modal-body form-horizontal" id="site_mod">

  {%for item in t_project_role%}
     {%if (item.team_id!=38) %}
     {% if (item.team_name=="销售顾问".decode('utf-8')) %}
     <label for="inputEmail3" class="col-sm-5 control-label">{{item.team_name}}</label>
     <div class="col-sm-10">

  <select {%if item.member_id!=0 and item.ddff!=0 and  (role!='8' and name!='吴蔚亮') %} disabled cannot_update='1' {%end%} name="income_name_member" team_id="{{item.team_id}}" guid="{{item.guid}}" title="{{item.team_name}}"  class="form-control" >
                 <option value="0">请选择</option>
                         {%for m  in t_user_teams%}
                         {%if m.team_id==1%}
                             <option value="{{m.id}}" {%if item.member_id==m.id%}selected{%end%}>{{m.name}}</option>
                         {%end%}
                         {%end%}
                 </select>



     </div>
     {%end%}

     {% if (item.team_name=="客服顾问".decode('utf-8')) %}
     <label for="inputEmail3" class="col-sm-5 control-label">{{item.team_name}}</label>
     <div class="col-sm-10">

  <select {%if item.member_id!=0 and item.ddff!=0 and  (role!='8' and name!='吴蔚亮') %} disabled cannot_update='1'{%end%} name="income_name_member" team_id="{{item.team_id}}" guid="{{item.guid}}" title="{{item.team_name}}"  class="form-control" >
                 <option value="0">请选择</option>
                 {%for m  in t_user_teams%}
                 {%if m.team_id==2%}
                     <option value="{{m.id}}" {%if item.member_id==m.id%}selected{%end%}>{{m.name}}</option>
                 {%end%}
                 {%end%}
                 </select>



     </div>
     {%end%}
     {% if (item.team_name=="组长".decode('utf-8')) %}
     <label for="inputEmail3" class="col-sm-5 control-label">{{item.team_name}}</label>
     <div class="col-sm-10">

  <select {%if item.member_id!=0 and item.ddff!=0 and  (role!='8' and name!='吴蔚亮') %} disabled cannot_update='1'{%end%}  name="income_name_member" team_id="{{item.team_id}}" guid="{{item.guid}}" title="{{item.team_name}}"  class="form-control" >
                 <option value="0">请选择</option>
                 {%for m  in t_user_teams%}
                 {%if m.team_id==3%}
                     <option value="{{m.id}}" {%if item.member_id==m.id%}selected{%end%}>{{m.name}}</option>
                 {%end%}
                 {%end%}
                 </select>



     </div>
     {%end%}
     {% if (item.team_name=="在线客服".decode('utf-8')) %}
     <label for="inputEmail3" class="col-sm-5 control-label">{{item.team_name}}</label>
     <div class="col-sm-10">

  <select {%if item.member_id!=0 and item.ddff!=0 and  (role!='8' and name!='吴蔚亮') %} disabled cannot_update='1'{%end%} name="income_name_member" team_id="{{item.team_id}}" guid="{{item.guid}}" title="{{item.team_name}}"  class="form-control" >
                 <option value="0">请选择</option>
                 {%for m  in t_user_teams%}
                 {%if m.team_id==4%}
                     <option value="{{m.id}}" {%if item.member_id==m.id%}selected{%end%}>{{m.name}}</option>
                 {%end%}
                 {%end%}
                 </select>



     </div>
     {%end%}

  {%end%}
   {%end%}



      </div>


      <div class="modal-footer">

        <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                 <button class="btn btn-primary" target="_blank" id="btn_save_team">保 存</button>

      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="express_filepath_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document" >
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">附件

      </h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body" id="site_mod">
            <div class="form-group">
                <label class="control-label file_label" for="lastname" >上传附件</label>
                <div class="controls">
                    <a href="javascript:;" class="file">选择文件
                  <input type="file" accept="image/*" multiple=""  id="uploaderInput1">
                  </a>
                  <div class="alert alert-danger" id='er_uploaderInput' style="display:none;">请选择上传附件</div>
                  <ul id="uploaderFiles1"></ul>
                  <hr class="my-0 file_label">
                  <label class="control-label" for="lastname">已上传附件</label>
                  <ul id="showFiles"></ul>
                </div>

            </div>

        </div>


        <div class="modal-footer">
            <input type="hidden" value="0" id="is_other" name="is_other" />
                   <button class="btn btn-primary" target="_blank" id="btn_express_filepath">上传</button>

        </div>
      </div>
    </div>
  </div>
<!-- Modal -->
<div class="modal fade" id="income_modal_delete" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">请确认删除到款信息！ </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

<div class="modal-body form-horizontal" id="site_mod">
<center>
      {%if ( role=="3") or (role=="2"  ) or (t_project.uid==int(uid) ) %}
            <a href="javascript:void(0)" id="delete_income" class="btn  btn-danger">确认，删除该笔到款</a>
        {%end%}
</center>
      </div>

    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="team_cq1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">新增工商专员 </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

<div class="modal-body form-horizontal" id="site_mod">


    <div class="form-group">
    <label for="inputEmail3" class="col-sm-5 control-label">工商专员</label>
    <div class="col-sm-10">
          <select id="cq_member" name="cq_member"  class="form-control" >
                <option value="0">请选择</option>
                        {%for m  in t_user_teams_cq%}
                            <option value="{{m.id}}" >{{m.name}}</option>

                        {%end%}
                </select>
    </div>
  </div>

    <div class="form-group">
    <label for="inputEmail3" class="col-sm-5 control-label">跟单业务</label>
    <div class="col-sm-10">
            <select id="cq_btype_id" name="cq_btype_id"  class="form-control" >
                <option value="0">请选择</option>
                        {%for m  in t_cq_service%}

                            <option value="{{m.id}}">{{m.income_name}}</option>

                        {%end%}
                </select>
    </div>
  </div>

      </div>
      <div class="modal-footer">

        <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                 <button class="btn btn-primary" target="_blank" id="btn_save_team_cq">保 存</button>

      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modal_note" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document" >
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="projects_note">交代事项</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

  <div class="modal-body form-horizontal" id="site_mod">


        <div class="card-body py-2 " id='projects_note_confirm_content'>
            {%if role!='6'%}
            {%for item in project_note_unread%}

            <span class="clearfix  z-1">
<input type="checkbox" value={{item.id}} name="check_note" checked>
 <b>{{item.uid_name}} ({{item.creatd_at}} )</b> :<span style="font-size:20px; color:red;"> <b>{{item.msg}}</b>


            </span>

            {%end%}
            {%end%}
            <span id="not_project_note" style="display: none;">还没有哦</span>
             </div>
              <hr class="my-0">

      <div class="form-group" id='projects_note_content'>
      <label for="inputEmail3" class="col-sm-3 control-label" id="projects_lab">交代内容
        </label>
          <select name='note_chengjiao' style="width:120px;">
              <option value="">选择成交事项</option>
              {%for item in t_projects_note_chengjiao%}
              <option value="{{item.msg}}">{{item.msg}}</option>
              {%end%}
            </select>
            {%if name=="陈太智"%}
            <a href="/project?tag=manage_chengjiao"><span class="fa fa-cog">管理</span></a>

   {%end%}
      <div class="col-sm-12">
        <textarea id='note_content' class="form-control" type="text" name="note_content" style="height:110px;"></textarea>
      </div>
      <br>
      <div class="col-sm-10 checkdiv">
        <input type="checkbox" value="1" id="check_radio" name="check_radio">需要上级审核
        </div>
    </div>
        </div>
        <div class="modal-footer">

          <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                   <button class="btn btn-primary modal_note_btn" target="_blank" id="btn_save_modal_note">保 存</button>

        </div>
      </div>
    </div>
  </div>
<div class="modal fade" id="modal_addr" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
      <div class="modal-dialog" role="document" >
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="projects_note">新增地址安排</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>

    <div class="modal-body form-horizontal" id="site_mod">
        <form>
          <table>
            <tbody>
              <tr>
                <td>区域</td>
                <td>地址类型</td>
                <td>供应商</td>
              </tr>
              <tr>
                  <tr>
                      <td>
                          <select id="area" class="form-control">
                              <option value="">选择区域</option>
                              {%for item in area_type%}
                              <option value="{{item.income_name}}">{{item.income_name}}</option>
                              {%end%}
                          </select>
                      </td>
                      <td><input class="form-control" id="supply_addr_type"  placeholder="地址类型"></td>
                      <td><input class="form-control" id="provider" placeholder="供应商"></td>
                      <td><a class="btn btn-primary btn-sm" id="search_addr" href="javascript:void(0);">查询</a></td>
                    </tr>
              </tr>
            </tbody>
          </table>
        </form>
        <div id="search_result">
          </div>
          </div>
          <div class="modal-footer">

            <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                     <button class="btn btn-primary" target="_blank" id="btn_choose_addr">选择</button>

          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="modal_addr1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
        <div class="modal-dialog" role="document" >
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="projects_addr">新增地址安排</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>

      <div class="modal-body form-horizontal" id="site_mod">
            <div class="form-group">
              <div class="col-sm-10">
                <label for="inputEmail3"  class="col-sm-5 control-label">地址起始时间</label>
                <input type="text" id="addr_start_time" class="form-control" readonly="readonly">
                <div class="alert alert-danger" id="e_addr_start_time" style="display:none;"></div>
              </div>
            </div>
            <div class="form-group">
                <div class="col-sm-10">
                  <label  for="inputEmail3" class="col-sm-5 control-label">地址到期时间</label>
                  <input type="text" id="addr_end_time" class="form-control" readonly="readonly">
                  <div class="alert alert-danger" id="e_addr_end_time" style="display:none;"></div>
                </div>
              </div>
              <div class="form-group">
                  <div class="col-sm-10">
                    <label for="inputEmail3" class="col-sm-4 control-label">地址收费</label>
                    <input type="text" id="addr_shoufei" class="form-control">
                    <div class="alert alert-danger" id="e_addr_shoufei" style="display:none;"></div>
                  </div>
                </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                       <button class="btn btn-primary" target="_blank" id="btn_save_addr">添加</button>

            </div>
          </div>
        </div>
      </div>

  <div class="modal fade" id="modal_note_check" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
      <div class="modal-dialog" role="document" >
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="projects_note">审核</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>

    <div class="modal-body form-horizontal" id="site_mod">

                <hr class="my-0">

        <div class="form-group" id='projects_note_check'>
        <div class="col-sm-10">
            {%if t_projects_note_check %}
            {%for idx,item in enumerate(t_projects_note_check)%}
           
            <span class="clearfix  z-1">

  <br>
 <b>{{item.uid_name}} ({{item.creatd_at}} )</b> :<span style="font-size:20px; color:red;"> <b>{{item.msg}}</b>
            </span>
            <br>
            <input type="radio" value='0' name="check_note{{idx}}" id="check_note" nid='{{item.id}}' ><b style="font-size:15px;">同意</b>
            <input type="radio" value='1' name="check_note{{idx}}" id="check_note" nid='{{item.id}}'><b style="font-size:15px;">驳回</b>
            <br>
            <label for="inputEmail3" class="col-sm-5 control-label">备注：</label>
            <div class="col-sm-10">
              <textarea idx='{{idx}}' class="form-control note_content_check" type="text" name="note_content_check"></textarea>
            </div>
            {%end%}
            {%else%}
            还没有哦~
            {%end%}
          </div>
      </div>
          </div>
          <div class="modal-footer">

            <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                     <button class="btn btn-primary" target="_blank" id="btn_save_modal_note_check">保 存</button>

          </div>
        </div>
      </div>
    </div>



<!-- Modal -->
<div class="modal fade" id="file_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">新增交接资料 </h5>
        <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body form-horizontal" id="site_mod">


  <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">资料名称</label>
    <div class="col-sm-10">

      {%for idx,item in enumerate(t_file_type)%}
          {%if idx==4%} <br/>{%end%}{%if idx==7%} <br/>{%end%}
          <input type="radio" value="{{item.id}}" ft_name="{{item.income_name}}" name="file_type_id" {%if idx==0%}checked{%end%} />{{item.income_name}}
       {%end%}

    </div>
  </div>

  <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">资料类型</label>
    <div class="col-sm-10">

       {%for idx,item in enumerate(t_file_type_cate)%}

          <input type="radio" value="{{item.id}}" ft_name="{{item.income_name}}" {%if idx==0 %}checked{%end%} name="file_type_cate_id"/>{{item.income_name}}

       {%end%}

    </div>
  </div>

  <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">数量</label>
    <div class="col-sm-10">

<input type="text" value="1" id="rec_num" name="rec_num"  class="form-control"/>
    </div>
  </div>
      <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">备 注</label>
    <div class="col-sm-10">
      <textarea type="text" class="form-control" id="remark" name="remark" placeholder="身份证号码等"></textarea>
    </div>
  </div>

    <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">电子版</label>
    <div class="col-sm-10">

<input type="file" value="1" id="file" name="file"  class="form-control"/>
    </div>
  </div>



      </div>


      <div class="modal-footer">

<!-- Modal -->
<div class="modal fade" id="file_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">新增交接资料 </h5>
        <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body form-horizontal" id="site_mod">


  <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">资料名称</label>
    <div class="col-sm-10">

      {%for idx,item in enumerate(t_file_type)%}
          {%if idx==4%} <br/>{%end%}{%if idx==7%} <br/>{%end%}
          <input type="radio" value="{{item.id}}" ft_name="{{item.income_name}}" name="file_type_id" {%if idx==0%}checked{%end%} />{{item.income_name}}
       {%end%}

    </div>
  </div>

  <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">资料类型</label>
    <div class="col-sm-10">

       {%for idx,item in enumerate(t_file_type_cate)%}

          <input type="radio" value="{{item.id}}" ft_name="{{item.income_name}}" {%if idx==0 %}checked{%end%} name="file_type_cate_id"/>{{item.income_name}}

       {%end%}

    </div>
  </div>

  <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">数量</label>
    <div class="col-sm-10">

<input type="text" value="1" id="rec_num" name="rec_num"  class="form-control"/>
    </div>
  </div>
      <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">备 注</label>
    <div class="col-sm-10">
      <textarea type="text" class="form-control" id="remark" name="remark" placeholder="身份证号码等"></textarea>
    </div>
  </div>

    <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">电子版</label>
    <div class="col-sm-10">

<input type="file" value="1" id="file" name="file"  class="form-control"/>
    </div>
  </div>



      </div>


      <div class="modal-footer">

        <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                 <button class="btn btn-primary" target="_blank" id="btn_save_file">保 存</button>

      </div>
    </div>
  </div>
</div>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                 <button class="btn btn-primary" target="_blank" id="btn_save_file">保 存</button>

      </div>
    </div>
  </div>
</div>



<!-- Modal -->
<div class="modal fade" id="contract_confirm_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">合同确认 </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>


<div class="modal-body form-horizontal" id="site_mod">
    <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">确认状态</label>
    <div class="col-sm-10">



      {%for idx,item in enumerate(t_rec_contarct_type)%}
          <input type="radio" name="contract_type_id" value="{{item.id}}"
           {%if t_project.contract_confirm_id==item.id %}checked{%end%} title="{{item.income_name}}"/> {{item.income_name}}
       {%end%}


    </div>
  </div>
    <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">合同编号</label>
    <div class="col-sm-10">




          <input type="text" name="contract_number"  class="form-control" id="contract_number" value="{{t_project.id}}" disabled />



    </div>
  </div>
       <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">备 注</label>
    <div class="col-sm-10">
      <textarea type="text" class="form-control" id="contract_remark" name="contract_remark" placeholder=""></textarea>
    </div>
  </div>

      </div>


      <div class="modal-footer">

                 <button class="btn btn-primary" target="_blank" id="btn_save_contract_status">保 存</button>

      </div>
    </div>
  </div>
</div>



<!-- Modal -->
<div class="modal fade" id="modal_confirm_formword" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">来源关键词确认 </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>



<div class="modal-body form-horizontal" id="site_mod">
    <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">关键词</label>
    <div class="col-sm-10">




          <input type="text" name="from_word" value="{{t_project.from_word}}"  class="form-control" id="from_word"/>



    </div>
  </div>



   </div>


      <div class="modal-footer">

                 <button class="btn btn-primary" target="_blank" id="btn_save_fromword">确 认</button>

      </div>
    </div>
  </div>
</div>



<!-- Modal -->
<div class="modal fade" id="service_modal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">业务收入明细
          {%if role=='111111'%}
          <a class="btn btn-primary btn-sm" id="project_type_detail_btn" href="javascript:void(0)">查看</a>
          <a class="btn btn-primary btn-sm" id="project_type_insert" href="javascript:void(0)" style="display:none;">新增</a>
          {%end%}
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

<div class="modal-body form-horizontal" id="site_mod">
<div class="row">
  {%for item in t_projects_service_income%}

    <div class="form-group" id="income_detail">
    <label for="inputEmail3" class="col-sm-12 control-label" id="">{{item.service_name}}</label>
    <div class="col-sm-12">
          <input type="text" sid="{{item.sid}}"  name="service_money"
          service_name="{{item.service_name}}" guid="{{item.guid}}"
           class="form-control" value="{{item.service_money}}" />
           <input type="checkbox" name="is_free" value="{{item.sid}}">免收费
    </div>
  </div>
    {%end%}
        {%for item in t_projects_types%}
        <div class="form-group" id="projects_type_detail" style="display:none;">
        <div class="col-sm-12">
              <input type="text"   name="income_name" id="{{item.id}}"
               class="form-control" value="{{item.income_name}}" />

        </div>
      </div>
       {%end%}

      </div>

</div>
      <div class="modal-footer">

        <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                 <button class="btn btn-primary" target="_blank" id="btn_save_income_servie">保 存</button>

      </div>
    </div>
  </div>
</div>

<div id="a_add_trans_modal_upload" class="modal fade"
 tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
 <div class="modal-dialog" role="document" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle_mfile">手机上传交接资料 </h5>
        <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body form-horizontal" id="show_qrcode">

</div>



  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
  </div>
  </div>
</div>
</div>



<!-- Modal -->
<div class="modal fade" id="modify_idcard_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle_mfile">交接资料 </h5>
        <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body form-horizontal" id="site_mod">


  <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">原件</label>
    <div class="col-sm-10">
      <input type="text" value="0" name="origin_num" id="origin_num" class="form-control" placeholder="数量"/>
    </div>
  </div>
  <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">复印件</label>
    <div class="col-sm-10">
      <input type="text" value="0" name="print_num" id="print_num" class="form-control" placeholder="数量"/>
    </div>
  </div>

      <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">身份证号码</label>
    <div class="col-sm-10">
      <input  type="text" class="form-control" id="id_number" name="id_number" placeholder="身份证号码" />
    </div>
  </div>

      <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">交代事项</label>
    <div class="col-sm-10">
          <textarea  type="text" class="form-control" id="id_remark" name="id_remark" placeholder="交代事项/备注信息" /></textarea>

    </div>
  </div>


    <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">电子版</label>
    <div class="col-sm-10">
<input type="file" value="1" id="id_file" name="id_file"  class="form-control"/>
<input type="hidden" name="guid_file_id" id="guid_file_id" class="form-control"/>
    </div>
  </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                 <button class="btn btn-primary" target="_blank" id="btn_save_file_idcard">保 存</button>
      </div>
    </div>
  </div>
</div>



<!-- Modal -->
<div class="modal fade" id="modify_license_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle_license">营业执照 </h5>
        <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body form-horizontal" id="site_mod">
      <div class="form-group" id="choice_form">
          <label for="inputEmail3" class="col-sm-4 control-label" id="license_option_title">营业执照</label>

          <span id="license_rec_num">
          <input type="checkbox" name="license_rec_num" />  正本
          </span>


         <input type="checkbox" name="license_origin_num"  />  原件
         <input type="checkbox" name="license_print_num"  />  复印件

       </div>


    <div class="form-group"  id="chop_form">
    <label for="inputEmail3" class="col-sm-4 control-label">公章数量</label>
    <div class="col-sm-10">
      <input  type="text" class="form-control" id="chop_num" value="0" name="chop_num" placeholder="数量" />
    </div>
  </div>

    <div class="form-group"  id="info_form">
    <div class="col-sm-10">
         <input type="checkbox" name="info_num"  />  已收集
    </div>
  </div>


      <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">备注</label>
    <div class="col-sm-10">
      <textarea  type="text" class="form-control" id="license_id_remark" name="license_id_remark" placeholder="其他信息" /></textarea>
    </div>
  </div>

    <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">电子版</label>
    <div class="col-sm-10">
<input type="file" value="1" id="id_file" name="id_file"  class="form-control"/>
<input type="hidden" name="license_guid_file_id" id="license_guid_file_id"/>
<input type="hidden" name="h_file_type_name" id="h_file_type_name" />
    </div>
  </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                 <button class="btn btn-primary" target="_blank" id="btn_save_file_license">保 存</button>
      </div>
    </div>
  </div>
</div>



<!-- Modal -->
<div class="modal fade" id="new_project_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">

  <div class="modal-dialog" role="document" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle_license">修改业务信息
            {%if role=='8' or (t_project.uid==int(uid) and not t_project.contract_uid_name )%}
            <button type="button" class="btn btn-danger" id="btn_delete_project" data-dismiss="modal">删除</button>
            {%end%}
        </h5>


        <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body form-horizontal" id="site_mod">



     {%if t_project.contract_uid_name %}
           <div class="alert alert-warning" role="alert">
                合同岗位核对确认后，信息停止更改

            </div>
      {%end%}
<!--
          <div class="form-group">
            <label for="exampleInputEmail1"  class="col-sm-4 control-label">业务所属公司:</label>

           {% for idx, item in enumerate(t_company) %}
                 <input type="radio" name="company"  value="{{item.id}}|{{item.income_name}}" {%if t_project.company_id==item.id%}checked{%end%}/> &nbsp;{{item.income_name}}
           {% end %}

          </div> -->
       <div class="form-group">
            <label for="exampleInputEmail1"  class="col-sm-4 control-label">业务来源:</label>

           {% for idx, item in enumerate(t_income_type) %}
                 {%if t_project.busniess_from_id==item.id%}
                 <input type="radio" name="busniess_from"  value="{{item.id}}|{{item.income_name}}" checked/> &nbsp;{{item.income_name}}
           {% end %}
           {%end%}

          </div>
          <div class="form-group" id="div_is_expedited">
              <label for="exampleInputEmail1"  class="col-sm-4 control-label">加急业务: </label>
              <input type="radio" name="is_expedited"  value="1"  {% if t_project.is_expedited==1%}checked{%end%}/>&nbsp;是
              <input type="radio" name="is_expedited" value="0" {% if t_project.is_expedited==0%}checked{%end%}/>&nbsp;否
          </div>
      <div id="div_building" class="well">

         <div class="form-group">
            <label for="exampleInputEmail1"  class="col-sm-4 control-label">所属楼盘: {{t_project.building_id}}</label>
        <select name="building_id" id="building_id"  class="form-control">
             <option value="0">==请选择楼盘==</option>
           {% for idx, item in enumerate(t_building) %}

              <option
               value="{{item.id}}|{{item.income_name}}" {%if t_project.building_id==item.id%}selected{%end%}>
              {{item.income_name}}
                </option>
           {% end %}
      </select>

          </div>


      </div>
      <div id="div_acc">

      </div>
      <div id="div_promo" style="  border:1px solid #eee; padding:10px;">

      <div class="form-group">
          <label for="exampleInputEmail1" class="col-sm-4 control-label">优惠活动:
          </label>
          <select name="promo_id" id="promo_id" class="form-control">
              <option value="0">==请选择优惠活动==</option>
              {% for idx, item in enumerate(t_promo_types) %}

              <option value="{{item.id}}|{{item.income_name}}" {%if t_project.promo_id==item.id%}selected{%end%}>
                  {{item.income_name}}
              </option>
              {% end %}
          </select>
          <small id="building_idHelpInline" class="text-danger">

          </small>
      </div>




          </div>


   <div id="div_recommend_by"  style="  border:1px solid #eee; padding:15px;">
          <div class="form-group">
            <label for="exampleInputEmail1"  class="col-sm-4 control-label">推荐客户人:</label>
            <input class="form-control"  type="text" name="recommend_by" id="recommend_by" placeholder="谁帮我们介绍的客户" value="{%if t_project.recommend_by%}{{t_project.recommend_by}}{%end%}">
          </div>
  </div>



   <div id="div_recommend_staff"  style="  border:1px solid #eee; padding:15px;">
          <div class="form-group">
            <label for="exampleInputEmail1" class="col-sm-4 control-label">内部推荐人:</label>

   <input type="text" name="recommend_staff" id="recommend_staff"   data-items="8" data-provide="typeahead" value="{%if t_project.recommend_staff%}{{t_project.recommend_staff}}{%end%}"/>

          </div>
  </div>



      <div id="div_from_word"  style="  border:1px solid #eee; padding:15px;">

         <!-- <div class="form-group">
            <label for="exampleInputEmail1"  class="col-sm-4 control-label">在线客服:</label>

        <select name="kf_id" id="kf_id"  class="form-control">
             <option value="0">选择在线客服</option>
           {% for idx, item in enumerate(t_users_kf) %}

              <option {%if t_project_kf and t_project_kf.member_id==item.id%}selected{%end%}
               value="{{item.id}}|{{item.name}}">
              {{item.name}}
                </option>
           {% end %}
      </select>
          </div> -->


 <div class="form-group" >
    <label for="inputEmail3" class=" control-label">来源关键词</label>

            <input class="form-control"  type="text" name="from_word1" id="from_word1" placeholder="" value="{%if t_project.from_word%}{{t_project.from_word}}{%end%}"/>



   </div>


         <div class="form-group">
            <label for="exampleInputEmail1"  class=" control-label">来源渠道:</label>

           {% for idx, item in enumerate(t_business_channel) %}

                 <input type="radio" name="business_channel"  value="{{item.id}}|{{item.income_name}}" {%if t_project.channel_id==item.id%}checked{%end%}/> &nbsp;{{item.income_name}}
           {% end %}

          </div>
         </div>

       <div class="form-group">
            <label for="exampleInputEmail1"  class="col-sm-4 control-label">签约方式:</label>

           {% for idx, item in enumerate(t_sign_type) %}
                 <input type="radio" name="sign_type_id"  value="{{item.id}}|{{item.income_name}}"
                 {%if t_project.contract_sign_type_id==item.id%}checked{%end%}/> &nbsp;{{item.income_name}}
           {% end %}

          </div>
       <div class="form-group div_talk_type" id="div_talk_type">
            <label for="exampleInputEmail1"  class="col-sm-4 control-label">来源方式:</label>

           {% for idx, item in enumerate(t_talk_type) %}
                 <input type="radio" name="talk_type"  value="{{item.id}}|{{item.income_name}}"
                  {%if t_project.talk_type_id==item.id%}checked{%end%}/> &nbsp;{{item.income_name}}
           {% end %}

          </div>
                 <div class="form-group" id="div_is_finance">
            <label for="exampleInputEmail1"  class="col-sm-4 control-label">是否记账:</label>


                 <input type="radio" name="is_finance"  value="0"
                  {%if t_project.is_finance==0%}checked{%end%} /> &nbsp;否

           <input type="radio" name="is_finance"  value="1"
                  {%if t_project.is_finance==1%}checked{%end%} /> &nbsp;是
           <small id="err_is_finance" class="text-danger"></small>
          </div>
                         <div class="form-group">
  <label for="exampleInputEmail1"  class="col-sm-4 control-label">合同情况:</label>
                {%for idx,item in enumerate(t_rec_contarct_type)%}
          <input type="radio" name="new_contract_type_id" value="{{item.id}}|{{item.income_name}}"
           {%if t_project.contract_confirm_id==item.id%}checked{%end%} title="{{item.income_name}}"/> {{item.income_name}}
       {%end%}
        </div>
<div class="row" style="margin:10px;" id="div_pre_value">

                 <div class=" form-group  span5   " style="margin:10px;">
            <label for="exampleInputEmail1"  class="control-label">成交周期(天）:</label>

            <input class="form-control" value="{%if t_project.deal_day%}{{t_project.deal_day}}{%end%}" type="text" name="deal_day" id="deal_day" placeholder="花了多少天完成了订单" />
          </div>
                  <div class="form-group span5" style="margin:10px;"    >
                        <label for="exampleInputEmail1"  class="control-label">预计合同定金:</label>
                        <input class="form-control"  value="{%if t_project.pre_income%}{{t_project.pre_income}}{%end%}"  type="text" name="pre_income" id="pre_income" placeholder="预计合同定金金额" value="">
                    </div>
  </div>
              <div class="form-group" id="div_addr_type">
            <label for="exampleInputEmail1"  class="control-label">地址类型:</label>
            <input class="form-control"  type="text"  value="{%if t_project.addr_type%}{{t_project.addr_type}}{%end%}"  name="addr_type" id="addr_type" placeholder="如果没有写无">
          </div>
                <div class="form-group">
            <label for="exampleInputEmail1"  class="control-label">业务内容:</label>
            <input class="form-control" value="{%if t_project.project_name%}{{t_project.project_name}}{%end%}"   type="text"  name="project_name" id="project_name" placeholder="业务内容 摘要">
          </div>
      <div class="form-group">
            <label for="exampleInputEmail1"  class="col-sm-4 control-label">客户姓名:</label>
            <input class="form-control" value="{%if t_project.customer_name%}{{t_project.customer_name}}{%end%}"  type="text" name="customer_name" id="customer_name" placeholder="客户姓名 称呼">
          </div>


          <div class="form-group">
            <label for="exampleInputEmail1"  class="col-sm-4 control-label">企业名称:</label>
            <input class="form-control"  value="{%if t_project.customer_company%}{{t_project.customer_company}}{%end%}" type="text" name="customer_company" id="customer_company"  placeholder="企业名称">
          </div>
          <div class="form-group">
            <label for="exampleInputEmail1"  class="col-sm-4 control-label">联系方式:</label>
            <input class="form-control" value="{%if t_project.customer_tel%}{{t_project.customer_tel}}{%end%}"   type="text" name="customer_tel" id="customer_tel" placeholder="手机号码">
          </div>
          <!-- <div class="form-group">
            <label for="exampleInputEmail1"  class="col-sm-4 control-label">备注</label>
            <textarea class="form-control" value=""  type="textarea" name="project_remark" id="project_remark"  placeholder="">{%if t_project.remark%}{{t_project.remark}}{%end%}</textarea>
          </div>-->



      </div>
      <div class="modal-footer">





     {%if not  t_project.contract_uid_name or role=="5" or role=="3" or role=="7" or role=="8"%}
            <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>

             <button class="btn btn-primary" id="btn_save_project">保 存</button>


      {%else%}
          <div class="alert alert-warning" role="alert">
                合同岗位核对确认后，信息停止更改！
            </div>

      {%end%}


      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="company_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">

    <div class="modal-dialog" role="document" >
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle_license">需要添加公司名才能更新记录</h5>


          <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body form-horizontal" id="site_mod">

            <div class="form-group">
                <label for="exampleInputEmail1"  class="col-sm-4 control-label">企业名称:</label>
                <input class="form-control"  value="{%if t_project.customer_company%}{{t_project.customer_company}}{%end%}" type="text" name="customer_company3" id="customer_company3"  placeholder="企业名称">
              </div>
        </div>
        <div class="modal-footer">


              <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>

               <button class="btn btn-primary" id="btn_save_company">保 存</button>
        </div>
      </div>
    </div>
  </div>


<div class="modal fade" id="new_project_modal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">

    <div class="modal-dialog" role="document" >
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle_license">办结公司信息 </h5>


          <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body form-horizontal" id="site_mod">

            <div class="form-group">
                <label for="exampleInputEmail1"  class="col-sm-4 control-label">企业名称:</label>
                <input class="form-control"  value="{%if t_project.customer_company%}{{t_project.customer_company}}{%end%}" type="text" name="customer_company1" id="customer_company1"  placeholder="企业名称">
              </div>
        </div>
        <div class="modal-footer">





       {%if not  t_project.contract_uid_name or role=="5" or role=="3" or role=='9' or role=='13'%}

              <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>

               <button class="btn btn-primary" id="btn_save_project1">保 存</button>


        {%else%}
            <div class="alert alert-warning" role="alert">
                  合同岗位核对确认后，信息停止更改！
              </div>

        {%end%}


        </div>
      </div>
    </div>
  </div>
<div class="modal fade" id="edit_banjie_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">

    <div class="modal-dialog" role="document" >
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle_license">办结公司信息 </h5>


          <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body form-horizontal" id="site_mod">

            <div class="form-group">
                <label for="exampleInputEmail1"  class="col-sm-4 control-label">企业名称:</label>
                <input class="form-control"  value="{%if t_project.customer_company%}{{t_project.customer_company}}{%end%}" type="text" name="banjie_customer_company" id="banjie_customer_company"  placeholder="企业名称">
              </div>
              <div class="form-group">
                <label for="exampleInputEmail1"  class="col-sm-4 control-label">统一社会信用代码:</label>
                <input class="form-control"  value="{%if t_project.company_uid%}{{t_project.company_uid}}{%end%}" type="text" name="banjie_company_uid" id="banjie_company_uid"  placeholder="统一社会信用代码">
              </div>
        </div>
        <div class="modal-footer">





       {%if not  t_project.contract_uid_name or role=="5" or role=="3" or role=='9' or role=='13'%}

              <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>

               <button class="btn btn-primary" id="btn_save_banjie_project">保 存</button>


        {%else%}
            <div class="alert alert-warning" role="alert">
                  合同岗位核对确认后，信息停止更改！
              </div>

        {%end%}


        </div>
      </div>
    </div>
  </div>

<div class="modal fade" id="new_project_modal_kehu" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">

    <div class="modal-dialog" role="document" >
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle_license">客户联系人 </h5>


          <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body form-horizontal" id="site_mod">

            <div class="form-group">
                <label for="exampleInputEmail1"  class="col-sm-4 control-label">客户联系人名称:</label>
                <input class="form-control"  value="{%if t_project.customer_name%}{{t_project.customer_name}}{%end%}" type="text" name="customer_name_edit" id="customer_name_edit"  placeholder="客户联系人">
              </div>
        </div>
        <div class="modal-footer">





       {%if role=='13'%}

              <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>

               <button class="btn btn-primary" id="btn_save_project_kehu">保 存</button>


        {%else%}
            <div class="alert alert-warning" role="alert">
                  合同岗位核对确认后，信息停止更改！
              </div>

        {%end%}


        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="insert_project_type_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">

      <div class="modal-dialog" role="document" >
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle_license">新增 </h5>


            <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>

          <div class="modal-body form-horizontal" id="site_mod">

              <div class="form-group">
                  <label for="exampleInputEmail1"  class="col-sm-4 control-label">名称:</label>
                  <input class="form-control"  type="text" name="project_type_name" id="project_type_name"  placeholder="">
                </div>
          </div>
          <div class="modal-footer">






                <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>

                 <button class="btn btn-primary" id="btn_save_project_type_name">保 存</button>
          </div>
        </div>
      </div>
    </div>



  <div class="modal fade" id="new_project_modal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">

    <div class="modal-dialog" role="document" >
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle_company">更新办结公司信息 </h5>


          <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body form-horizontal" id="site_mod">
            <div class="form-group">
              <label for="exampleInputEmail1"  class="col-sm-6 control-label">公司名:</label>
              <input class="form-control to_customer" type="text" name="customer_company2" value="{% if t_project.customer_company%}{{t_project.customer_company}}{%end%}" id='customer_company2' placeholder="输入公司名">
            </div>
         <div class="form-group">
              <label for="exampleInputEmail1"  class="col-sm-6 control-label">统一社会信用代码:</label>
              <input class="form-control to_customer" type="text" name="company_uid" value="{% if t_project.company_uid%}{{t_project.company_uid}}{%end%}" id='company_uid' placeholder="输入信用代码">
            </div>



           <div class="form-group">
              <label for="exampleInputEmail1"  class="col-sm-6 control-label">法人:</label>
              <input class="form-control to_customer" type="text" name="comany_person" value="{% if t_project.comany_person%}{{t_project.comany_person}}{%end%}" id='comany_person' placeholder="输入法人">
            </div>

   <div class="form-group" >
          <label for="inputEmail3 " class=" col-sm-4  control-label">注册地址</label>
    <select name="city" id="city" class=" to_customer_dp">

        {%for item in citys%}
      <option value="{{item.income_name}}"  {%if t_project.city==item.income_name%}selected{%end%}>{{item.income_name}}</option>
    {%end%}

    </select>
    <select name="zone" id="zone" class="to_customer_dp">
      <option value="0">选择所属区域</option>

    {%for item in zones%}
      <option value="{{item.income_name}}" {%if t_project.zone==item.income_name%}selected{%end%}>{{item.income_name}}</option>
    {%end%}
    </select>

              <input class="form-control to_customer"  type="text" name="true_reg_addr" value="{% if t_project.true_reg_addr%}{{t_project.true_reg_addr}}{%end%}" id="true_reg_addr" placeholder="输入真实注册地址" />



     </div>


    <div class="form-group">
              <label for="exampleInputEmail1"  class="col-sm-6 control-label">成立日期:</label>
              <input class="form-control to_customer"  type="text" readonly="readonly" name="company_created_day" value="{% if t_project.company_created_day%}{{t_project.company_created_day}}{%end%}" id="company_created_day" placeholder="输入成立日期">
            </div>

    <div class="form-group">
      <label for="exampleInputEmail1" class="col-sm-6 control-label">执照到期时间:
          <input type="checkbox" id="company_fever" class="to_customer" value="1" {%if t_project.company_fever==1%}checked{%end%}>长期


      </label>
      <input class="form-control to_customer" readonly="readonly" type="text" name="company_expired_day" value="{% if t_project.company_expired_day%}{{t_project.company_expired_day}}{%end%}"
        id="company_expired_day" placeholder="执照到期时间,长期执照为空,勾选长期">
    </div>



        <div class="modal-footer">




              <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>




 {%if 11==int(role)%}


    <button class="btn btn-danger" id="btn_save_to_back">驳回</button>

    <button class="btn btn-primary" id="btn_save_to_customer">确认无误,入库到客户管理系统</button>

 {%else%}
      <button class="btn btn-primary" id="btn_save_companyinfo">保 存</button>
{%end%}


        </div>
        <div class="alert alert-danger hide" role="alert" id="save_to_customer_msg"></div>
      </div>
    </div>
  </div>
  </div>

  <div style="margin-top: 200px;" class="modal fade" id="modal_reject_remark" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document" >
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">驳回</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

  <div class="modal-body form-horizontal" id="site_mod">


      <div class="form-group">
      <label for="inputEmail3" class="col-sm-5 control-label">驳回内容</label>
      <div class="col-sm-10">
        <textarea id='reject_remark' class="form-control" type="text" name="reject_remark"></textarea>
      </div>
    </div>
        </div>
        <div class="modal-footer">

          <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                   <button class="btn btn-primary" target="_blank" id="btn_save_reject_remark">保 存</button>

        </div>
      </div>
    </div>
  </div>

<div class="modal fade" id="project_type_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="income_title_type">设置金额


        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>


      <div class="modal-body form-horizontal" id="site_mod">

        {%for item in t_income_other_type%} {%if item.income_name.encode('utf-8') in ['CA费用','税控盘','印花税','罚款','其他','退款']%}
        <div class="form-group">
          <label for="inputEmail3" class="col-sm-12 control-label">
            <b>{{item.income_name}}</b>
          </label>
          <div class="col-sm-10">
            <div class="row">


              <div class="col-sm-6">
                <input type="text" class="form-control" id="{{item.id}}" name="{{item.income_name}}" placeholder="填写金额" value="{%if t_projects_income_all%}{% for t_projects_income in t_projects_income_all %}
             {%if t_projects_income['income_name']==item.income_name%}
             {{t_projects_income['income_money']}}{%end%}{%end%}{%end%}" />

              </div>

            </div>
          </div>
        </div>
        {%end%} {%end %}

      </div>


      <div class="modal-footer">
        <input type="hidden" value="0" id="is_other" name="is_other" />
        <button class="btn btn-primary" target="_blank" id="btn_save_project_type_money">保 存</button>

      </div>
    </div>
  </div>
</div>





<!-- Modal -->
<div class="modal fade" id="income_detail_modal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="income_deital_title">合同到款明细


        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>


      <div class="modal-body form-horizontal" id="site_mod">


      <div class="card-body  bg-faded">
        {%if t_projects_service_income_list%} {%for item in t_projects_service_income_list%}
        <div class="card-body py-2 ">
          <span class="clearfix  z-1">
          <b>{{item.service_name}}({{item.service_money}} 元)</b>
           <input type="text"
            service_name="{{item.service_name}}"
            service_id="{{item.service_id}}"
            name="txt_income_detail"
            id="txt_income_detail_{{item.service_id}}"
            class="form-control"/>
          </span>
        </div>
        <hr class="my-0"> {%end%} {%else%}
        <hr class="my-0">
        <div class="card-body py-2 ">
          还没有业务收入明细哦
        </div>
        {%end%}

      </div>



        <div class="modal-footer">
          <input type="hidden" value="0" id="is_other" name="is_other" />
         <button class="btn " target="_blank" id="btn_save_income_detail_back">返 回</button>

          <button class="btn btn-primary" target="_blank" id="btn_save_income_detail">保 存</button>

        </div>
      </div>
    </div>
  </div>
</div>


<!-- Modal -->
<div class="modal fade" id="income_modal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="income_title_type">新增合同到款信息


    </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>


      <div class="modal-body form-horizontal" id="site_mod">


  <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">入款公司</label>
    <div class="col-sm-10">
 <select id="company_id" name="company_id"  class="form-control">
      <option value="0">选择入款公司</option>
       {%for item in t_company%}
          <option value="{{item.id}}">{{item.income_name}}</option>

       {%end%}
       </select>

    </div>
  </div>

    <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">支付方式</label>
    <div class="col-sm-10">

  <select id="pay_type_id" name="pay_type_id"  class="form-control">
      <option value="0">选择支付方式</option>
       {%for item in t_pay_type%}
          <option value="{{item.id}}">{{item.income_name}}</option>

       {%end%}
       </select>

    </div>
  </div>



  <div class="form-group">
    <label for="inputEmail3" class="col-sm-6 control-label">收款日期(客户付款当天日期)</label>
    <div class="col-sm-10">
      <input type="text" class="form-control form_datetime" value="{{created_at.strftime('%Y-%m-%d %H:%M')}}" readonly value="" size="16"  id="income_at" name="income_at">
    </div>
  </div>

{%for item in t_income_other_type%}
  <div class="form-group">
    <label for="inputEmail3" class="col-sm-12 control-label"><b>{{item.income_name}}</b></label>
        <div class="col-sm-10">
    <div class="row">

    {%for row in range(1,4)%}
      <div class="col-sm-4">第{{row}}笔



{%if item.income_name.encode('utf-8') not  in ['CA费用','税控盘','印花税','罚款','其他','退款']%}
       <a
       href="javascript:void(0)"
       title_name="{{item.income_name}}"
       num="{{row}}"
       class="a_income_pay_detail"
       income_input_id="income_{{item.id}}_{{row}}"
       income_id="{{item.id}}"
       income_name="{{item.income_name}}"
       id="a_income_{{item.id}}_{{row}}"
       >设置</a>

     <input type="text" remark=""
        parent_id="0"
        class="form-control"
        id="income_{{item.id}}_{{row}}"
        income_id_num="{{item.id}}_{{row}}"
        name="income_val"
        income_id="{{item.id}}"
        income_name="{{item.income_name}}"
         num="{{row}}"
             disabled="disabled"

        placeholder="第{{row}}笔"/>
       {%else%}

        <input type="text" remark=""
        parent_id="0"
        class="form-control"
        id="income_{{item.id}}_{{row}}"
        income_id_num="{{item.id}}_{{row}}"
        name="income_val"
        income_id="{{item.id}}"
        income_name="{{item.income_name}}"
         num="{{row}}"
        placeholder="第{{row}}笔"/>

{%end%}



      </div>
    {%end %}

    </div>
  </div>
  </div>
     <div class="form-group">
    <label for="inputEmail3" class="col-sm-8 control-label">{{item.income_name}}到款不足说明/备注</label>
    <div class="col-sm-10">
      <textarea type="text" name="income_remark" class="form-control" income_id="{{item.id}}" income_name="{{item.income_name}}" id="income_remark_{{item.id}}" placeholder=""></textarea>
    </div>
  </div>
  {%end %}



      </div>


      <div class="modal-footer">
          <input type="hidden" value="0" id="is_other" name="is_other" />
                 <button class="btn btn-primary" target="_blank" id="btn_save_income">保 存</button>

      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="project_type_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document" >
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="income_title_type">设置金额


      </h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>


        <div class="modal-body form-horizontal" id="site_mod">

  {%for item in t_income_other_type%}
  {%if item.income_name.encode('utf-8') in ['CA费用','税控盘','印花税','罚款','其他','退款']%}
    <div class="form-group">
      <label for="inputEmail3" class="col-sm-12 control-label"><b>{{item.income_name}}</b></label>
          <div class="col-sm-10">
      <div class="row">


        <div class="col-sm-6">
            <input type="text" class="form-control" id="{{item.id}}" name="{{item.income_name}}"
             placeholder="填写金额" value="{%if t_projects_income_all%}{% for t_projects_income in t_projects_income_all %}
             {%if t_projects_income['income_name']==item.income_name%}
             {{t_projects_income['income_money']}}{%end%}{%end%}{%end%}"/>

        </div>

      </div>
    </div>
    </div>
    {%end%}
    {%end %}

        </div>


        <div class="modal-footer">
            <input type="hidden" value="0" id="is_other" name="is_other" />
            <button class="btn btn-primary" target="_blank" id="btn_save_project_type_money">保 存</button>

        </div>
      </div>
    </div>
  </div>


<!-- Modal -->
<div class="modal fade" id="modify_milepost_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle_license">订单流转动态 </h5>
        <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body form-horizontal" id="site_mod">


      <div class="form-group">
    <label for="inputEmail3" class="col-sm-4 control-label">备注</label>
    <div class="col-sm-10">
      <textarea  type="text" class="form-control" id="milepost_remark" name="milepost_remark" placeholder="备注信息" ></textarea>
    </div>
  </div>


      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                 <button class="btn btn-primary" target="_blank" id="btn_save_milepost">保 存</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="addr_milepost_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document" >
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle_license">安排地址动态 </h5>
          <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body form-horizontal" id="site_mod">


        <div class="form-group">
      <label for="inputEmail3" class="col-sm-4 control-label">备注</label>
      <div class="col-sm-10">
        <textarea  type="text" class="form-control" id="addr_milepost_remark" name="addr_milepost_remark" placeholder="备注信息" ></textarea>
      </div>
    </div>


        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                   <button class="btn btn-primary" target="_blank" id="btn_save_addr_milepost">保 存</button>
        </div>
      </div>
    </div>
  </div>


<div class="modal fade" id="projects_transfile_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document" >
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle_license">交接资料

           {%if 11!=int(role)%}
          <input type="checkbox" id="checkalltrans" /> 全选
          {%end%}
          </h5>
          <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

   <div class="modal-body form-horizontal" id="site_mod">


        <div class="form-group">
      <div class="col-sm-10">
          {%if 11==int(role)%}
          {%if item_transfile%}
          {%if item_transfile.trans_type_txt%}
            {{item_transfile.trans_type_txt}}<br/>
            {%else%}
      无<br/>
            {%end%}



{%if item_transfile.remark%}
            备注：{{item_transfile.remark}}


{%end%}

      {%else%}
      没有清单哦.

          {%end%}
          {%else%}

          {% for item in t_projects_type%}
        <input type="checkbox" style="margin:0 0 0 10px;" name="check_projects_type"
         income_name="{{item.income_name}}" value="{{item.id}}"
         {%if item_transfile %}
         {%set str1=item_transfile.trans_type.encode('utf-8').split(',') %}
         {% if str(item.id) in str1 %}checked{%end%}{%else%}{%end%}>{{item.income_name}}
        {%end%}
        <label for="inputEmail3" class="col-sm-4 control-label">备注:</label>
        <div class="col-sm-12">
          <textarea  type="text" class="form-control" id="projects_type_remark" name="projects_type_remark" placeholder="备注" >{%if item_transfile %}{%if item_transfile.remark %}{{item_transfile.remark}} {%end%}{%end%}</textarea>
        </div>
        {%end%}



      </div>
    </div>


        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>

{%if 11==int(role)%}
          <button class="btn btn-danger " mtype="1" id="btn_save_to_back_transfile">驳回</button>

          <button class="btn btn-primary " mtype="1" id="accept_project_transfile">确认无误,签收</button>

         {%else%}
<button class="btn btn-primary "  id="btn_save_projects_transfile">保 存</button>
{%end%}

        </div>
      </div>
    </div>
  </div>


<div class="modal fade" id="projects_transfile_modal_sales" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document" >
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle_transfile_sales">交接(销售顾问)资料

           {%if 11==int(role)%}
          <input type="checkbox" id="checkalltrans_sales" /> 全选
          {%end%}
          </h5>
          <button type="button" class="clcreated_atose" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

   <div class="modal-body form-horizontal" id="site_mod">


        <div class="form-group">
      <div class="col-sm-10">
          {%if 1==int(role)%}
          {%if item_transfile_sales%}

  {%if item_transfile_sales.trans_type_txt%}
            {{item_transfile_sales.trans_type_txt}}<br/>
            {%else%}
      无<br/>
            {%end%}

            {%if item_transfile_sales.remark%}
            备注：{{item_transfile_sales.remark}}
            {%end%}

      {%else%}
      没有清单哦.
          {%end%}
          {%else%}

          {% for item in t_projects_type%}
        <input type="checkbox" style="margin:0 0 0 10px;" name="check_projects_type_sales"
         income_name="{{item.income_name}}" value="{{item.id}}"
         {%if item_transfile_sales %}
         {%set str1=item_transfile_sales.trans_type.encode('utf-8').split(',') %}
         {% if str(item.id) in str1 %}checked{%end%}{%else%}{%end%}>{{item.income_name}}
        {%end%}
        <label for="inputEmail3" class="col-sm-4 control-label">备注:</label>
        <div class="col-sm-12">
          <textarea  type="text" class="form-control" id="projects_type_remark_sales" name="_sales" placeholder="备注" >{%if item_transfile_sales %}{%if item_transfile_sales.remark %}{{item_transfile_sales.remark}} {%end%}{%end%}</textarea>
        </div>
        {%end%}



      </div>
    </div>


        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>

{%if 1==int(role)%}
          <button class="btn btn-danger " id="btn_save_to_back_transfile" mtype="2">驳回</button>

          <button class="btn btn-primary " mtype="2" id="accept_project_transfile">确认无误,通过</button>

         {%else%}
<button class="btn btn-primary " id="btn_save_projects_transfile_sales" >保 存</button>
{%end%}

        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="shenhe_xiezhu_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
      <div class="modal-dialog" role="document" >
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="income_title_type">审核
        </h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>


          <div class="modal-body form-horizontal" id="site_mod">
              <div class="form-group">
                      <div class="col-sm-10">
                          <label for="recode">状态：</label>
                          <input type="radio" name="is_pass" value="1">通过
                          <input type="radio" name="is_pass" value="0">不通过
                          </div>
                      </div>
              <div class="form-group">
              <div class="col-sm-10">
                  <label for="recode">分配销售顾问：</label>
                  <select name="fenpei_xs">
                  <option value="">选择销售顾问</option>
                  {%for m  in t_user_teams%}
                  {%if m.team_id==1%}
                      <option value="{{m.id}}">{{m.name}}</option>
                  {%end%}
                  {%end%}
              </select>
                  </div>
              </div>
              <div class="form-group">
              <div class="col-sm-10">
                  <label for="recode">备注：</label>
                  <textarea class="form-control"
                   name="remark" id="remark_xiezhu" type="text" placeholder="填写备注">
                      </textarea>
                  </div>
              </div>

          </div>


          <div class="modal-footer">
              <input type="hidden" value="0" id="is_other" name="is_other" />
                     <button class="btn btn-primary" target="_blank" id="btn_save_shenhe_xiezhu">确定</button>

          </div>
        </div>
      </div>
    </div>
<div class="modal fade" id="banjie_xiezhu_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
      <div class="modal-dialog" role="document" >
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="income_title_type">申请办结
        </h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>


          <div class="modal-body form-horizontal" id="site_mod">
              <div class="form-group">
              <div class="col-sm-10">
                  <label for="recode">总结：</label>
                  <textarea class="form-control"
                   name="xiezhu_zj" id="xiezhu_zj" type="text" placeholder="填写总结">
                      </textarea>
                  </div>
              </div>

          </div>


          <div class="modal-footer">
              <input type="hidden" value="0" id="is_other" name="is_other" />
                     <button class="btn btn-primary" target="_blank" id="btn_save_banjie_xiezhu">确定</button>

          </div>
        </div>
      </div>
    </div>
<div class="modal fade" id="shenhe_banjie_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
      <div class="modal-dialog" role="document" >
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="income_title_type">审核办结
        </h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>


          <div class="modal-body form-horizontal" id="site_mod">
              <div class="form-group">
              <div class="col-sm-10">
                  <div class="xs_zj"></div>

                  </div>
              </div>
              <div class="form-group">
                      <div class="col-sm-10">
                          <label>状态:</label>
                          <input type="radio" name="is_pass1" id="is_pass1" value="1">确认
                          <input type="radio" name="is_pass1" id="is_pass1" value="0">驳回
                          </div>
                      </div>
                 <div class="form-group">
                      <div class="col-sm-10">
                          <label>备注:</label>
                      <textarea class="form-control"
                          name="remark1" id="remark1" type="text" placeholder="填写总结">
                              </textarea>
                          </div>
                      </div>
          </div>


          <div class="modal-footer">
              <input type="hidden" value="0" id="is_other" name="is_other" />
                     <button class="btn btn-primary" target="_blank" id="btn_save_shenhe_banjie">确定</button>

          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="add_project_xiezhu" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
        <div class="modal-dialog" role="document" >
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="xiezhu_title">发起协助

          </h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>


            <div class="modal-body form-horizontal" id="site_mod">
                <div class="form-group">
                <div class="col-sm-10">
                    <label for="recode">协助内容</label>
                    <textarea class="form-control" name="xiezhu_content" id="xiezhu_content" type="text" placeholder="填写协助内容">
                        </textarea>
                    </div>
                </div>

            </div>


            <div class="modal-footer">
                <input type="hidden" value="0" id="is_other" name="is_other" />
                       <button class="btn btn-primary" target="_blank" id="btn_save_project_xiezhu">发起</button>

            </div>
          </div>
        </div>
      </div>
      <div class="modal fade" id="modal_relation_other_project" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
          <div class="modal-dialog" role="document" >
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title_project" id="exampleModalLongTitle">关联其他订单 </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>



        <div class="modal-body form-horizontal" id="site_mod">
            {%if t_relation_projects%}
            {%for item in t_relation_projects%}
            {%if item[0].split('|')[1]!=str(t_project.id)%}
            <div class="form-group all_other_project">
                <div class="col-sm-12">

                  {{item[0].split('|')[1]}} <a href="/project?tag=show&guid={{item[0].split('|')[0]}}&id={{item[0].split('|')[1]}}">查看订单</a>
                  <a class="delete_relation_ids" href="javascript:void(0)" id="{%if t_projects_relation.id%}{{t_projects_relation.id}}{%end%}" relation_id="{{item[0].split('|')[1]}}">删除</a>

            </div>
            </div>
            {%end%}
            {%end%}
            {%else%}
            <div class="form-group all_other_project">
                <div class="col-sm-12">
              还没有关联订单~
              </div>
              </div>
            {%end%}
            <div class="form-group search_other_project">
            <div class="col-sm-12">
            <form>
              <table>
                <thread>
                  <tr>
                    <th>订单编号</th>
                    <th width="60%">业务内容</th>
                    <th></th>
                  </tr>
                </thread>
                <tbody>
                  <tr>
                    <td><input class="form-control" name="search_other_project_id" id="search_other_project_id" placeholder="订单编号">
                    </td>
                    <td><input class="form-control" name="search_other_project_name" id="search_other_project_name" placeholder="业务内容"></td>
                    <td><input type="button" id="search_other_project" value="检索"></td>
                  </tr>
                </tbody>
              </table>
            </form>
            </div>
          </div>
          <div class="form-group">
            <div class="col-sm-12">
              <div class="relation_project_box">
              </div>
          </div>
          </div>
           </div>
              <div class="modal-footer">

                         <button class="btn btn-primary" target="_blank" id="btn_save_relation">关 联</button>

              </div>
            </div>
          </div>
        </div>

        <div class="modal fade" id="add_express_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
          <div class="modal-dialog" role="document" >
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" ><span id="express_title">发起快递申请</span>
                  <a class="btn btn-primary btn-sm" id="choose_cutomer_addr_msg" href="javascript:void(0);">选择收件人信息</a>
            </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>


              <div class="modal-body" id="site_mod">
                  <div class="form-group">
                  <div class="col-sm-10">
                      <label for="recode" id="l_rec_name">收件人</label>
                      <input class="form-control" name="rec_name" id="rec_name" type="text" placeholder="收件人" value="{%if  t_project.customer_name%}
                      {{t_project.customer_name}}{%end%}">
                      <div class="alert alert-danger" role="alert" style="display:none;" id="er_rec_name">
                        </div>
                      </div>

                  </div>
                  <div class="form-group">
                    <div class="col-sm-10">
                        <label for="recode" id="l_rec_tel">收件人电话</label>
                        <input class="form-control" name="rec_tel" id="rec_tel" type="text" placeholder="收件人电话" value="{%if  t_project.customer_tel%}
                        {{t_project.customer_tel}}{%else%}无{%end%}">
                        <div class="alert alert-danger" role="alert" style="display:none;" id="er_rec_tel">
                          </div>
                        </div>
                    </div>
                    <div class="form-group">
                      <div class="col-sm-10">
                          <label for="recode" id="l_rec_addr">收件人地址</label>
                          <input class="form-control" name="rec_addr" id="rec_addr" type="text" placeholder="收件人地址" value="{%if  t_project.true_reg_addr%}
                          {{t_project.true_reg_addr}}{%end%}">
                          <input type="checkbox" name="save_customer_add_msg" value="1" checked hidden>
                          <span hidden>收件人信息存入系统</span>
                          <div class="alert alert-danger" role="alert" style="display:none;" id="er_rec_addr">
                            </div>
                          </div>
                      </div>
                      <div class="form-group">
                        <label class="control-label" for="tran_at">交接明细 </label>

                         <input type="checkbox" name="allcheck_express" id="allcheck_express"/>全选
                        <div class="col-sm-10">
                        {% for item in t_projects_type1%}
                        <input type="checkbox" style="margin:0 0 0 10px;" name="rec_file" id="rec_file_{{item.id}}"
                        income_name="{{item.income_name}}" value="{{item.id}}"
                         >{{item.income_name}}
                         {%if item.id==176 or item.id==209 %}
                         <br><hr>
                         {%end%}
                          {%end%}
                  </p>
                        </div>
                        <!-- /controls -->
                      </div>
                      <!-- /control-group -->
                          <div class="form-group">
                        <label class="control-label" for="lastname">其他资料</label>
                        <div class="col-sm-10">
                          <textarea type="text"  class="form-control" id="other_rec_file" name="other_rec_file" value="" style="height: 60px;"></textarea>
                          <div class="alert alert-danger" role="alert" style="display:none;" id="er_other_rec_file">
                          </div>
                        </div>

                        <!-- /controls -->
                      </div>
                             <div class="form-group">
                    <div class="col-sm-10">
                        <label for="recode">公司名称</label>
                        <input class="form-control" name="rec_company" id="rec_company" type="text" placeholder="公司名称" value="{%if  t_project.customer_company%}
                        {{t_project.customer_company}}{%else%}无{%end%}">
                        <div class="alert alert-danger" role="alert" style="display:none;" id="er_rec_company">
                          </div>
                        </div>
                    </div>
                    <div class="form-group">
                      <div class="col-sm-10">
                        <label for="recode">快递单号</label>
                        <input class="form-control" id="express_number" placeholder="快递单号">
                        <div class="alert alert-danger" role="alert" style="display:none;" id="er_express_number">
                        </div>
                       </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-10">
                          <label for="recode">快递类型</label>
                          <select  name="express_type" class="form-control" id="express_type">
                            {% for item in express_type%}
                            <option value="{{item.id}}">{{item.income_name}}</option>
                            {%end%}
                          </select>
                         </div>
                      </div>
                      <div class="form-group">
                          <div class="col-sm-10">
                            <label for="recode">快递付费</label>
                            <select  name="payment_type" class="form-control" id="payment_type">
                              {% for item in payment_type%}
                              <option value="{{item.id}}">{{item.income_name}}</option>
                              {%end%}
                            </select>
                           </div>
                        </div>
                        <div class="form-group" id="created_send_div">
                            <div class="col-sm-10">
                                <label for="recode" id='l_created_send_at'>发件时间</label>
                                <input class="form-control" name="created_send_at" id="created_send_at" type="text" readonly="readonly">
                                <div class="alert alert-danger" role="alert" style="display:none;" id="er_created_send_at">
                                  </div>
                              </div>
                            </div>
                      <div class="form-group">
                        <div class="col-sm-10">
                            <label for="recode" id="l_send_name">发件人</label>
                            <input class="form-control" name="send_name" id="send_name" type="text" placeholder="申请人" value="{{name}}">
                            <div class="alert alert-danger" role="alert" style="display:none;" id="er_send_name">
                              </div>
                          </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-10">
                                <label for="recode">备注</label>
                                <textarea class="form-control" name="express_remark" id="express_remark" type="text" placeholder="备注">
                      </textarea>

                              </div>
                            </div>
              </div>


              <div class="modal-footer">
                  <div class="alert alert-danger" role="alert" style="display:none;" id="er_express">
                      已审核不能修改
                    </div>
                         <button class="btn btn-primary" target="_blank" id="btn_save_express" >保存</button>

              </div>
            </div>
          </div>
        </div>
        <div class="modal fade" id="choose_customer_addr_msg_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
            <div class="modal-dialog" role="document" >
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" >选择 寄/收 件人信息

              </h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>

              <div class="modal-body" id="site_mod">
                {% for item in t_cutomer_addr_msg%}
                  <div class="form-group">
                  <div class="col-sm-10">
                    <input type="radio" name="choose_customer_addr" c_name="{{item.name}}" addr="{{item.addr}}" tel="{{item.tel}}">{{item.name}}<br>
                    {{item.addr}} {{item.tel}}
                  </div>
              </div>
              {%end%}
            </div>
            <div class="modal-footer">

                <button class="btn btn-primary" target="_blank" id="btn__save_customer_addr_msg">填入</button>

     </div>
              </div>
              </div>
            </div>
            <div class="modal fade" id="confirm_banjie_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
              <div class="modal-dialog" role="document" >
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="xiezhu_title">办结确认

                </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>

                  <div class="modal-body" id="site_mod">
                      <div class="form-group">
                      <div class="col-sm-10">
                          <input type="radio"  name="confirm_banjie" value="1">确认
                          <input type="radio"  name="confirm_banjie" value="2">异常待确认
                          <div class="alert alert-danger" role="alert" style="display:none;" id="er_confirm_banjie">
                          </div>
                          </div>

                      </div>
                      <div class="form-group">
                        <div class="col-sm-10">
                            <label for="recode">备注</label>
                            <textarea class="form-control" id="remark_confirm_banjie" placeholder="填写备注">
                                </textarea>
                            <div class="alert alert-danger" role="alert" style="display:none;" id="er_remark">
                            </div>

                            </div>
                        </div>

                  </div>


                  <div class="modal-footer">
                      <input type="hidden" value="0" id="is_other" name="is_other" />
                             <button class="btn btn-primary" target="_blank" id="btn_confirm_banjie">保存</button>

                  </div>
                </div>
              </div>
            </div>

<input type="hidden" value="0" name="parent_id_hide" id="parent_id_hide" />

{%for item in t_income_other_type%}
    <input type="hidden" value="" name="income_val_hide" num="0" id="{{item.id}}_val_body" />

{%end%}



 {% end %}

 {%block js%}
<script>

$(function(){


$("#show_msg_by_transition").hide()
{%if mid%}
 $("#home-tab{{mid}}").tab('show')
{%end%}
_xsrf =  getCookie("_xsrf")


  $("button[name=btn_cancel_member]").on("click", function () {

    {%if role=="7"%}
         msg = "确认同意该业务取消申请?"
    {%else%}
        msg = "确认申请取消该订单业务吗?"
    {%end%}

    if(confirm(msg)){
        mid = $(this).attr("mid")
        guid = $(this).attr("guid")
        atype = $(this).attr("atype")
        $.post("/project?tag=cancel_memeber_task", { "mid": mid, "project_id": "{{t_project.id}}", "guid": guid, "_xsrf": _xsrf, "atype": atype }, function (result) {
          location.reload()
        })
    }


  })


$.ajax({
  type: "GET",
  url: "http://building.gzfaye.com/api",
  data: "tag=show_to_income&qid={{t_project.id}}&customer_name={{t_project.customer_company}}&code={{md5_str}}&dt={{dt}}",
  success: function(data){
    if(data=="0"){
        $("#show_building_link_span").hide()

        {%for item in t_project_members%}
              {%if item.team_id==38 and item.member_id==int(uid)%}
              $("#show_building_link_span").show()
                {%break%}
            {%end%}
        {%end%}
        $("#show_building_status").html('<div class="card-body py-2 "><div class="alert alert-secondary" role="alert">请找工商专员创建楼盘客户或直接进入楼盘系统哦</div></div>')

    }else{
            $('#show_building_status').html(data);
           $("#show_building_link_span").show()
    }

  },
  error: function(xhr, textStatus, error) {
      console.log(xhr.statusText);
      console.log(textStatus);
      console.log(error);
 $("#show_building_status").html('<div class="card-body py-2 "><div class="alert alert-secondary" role="alert">数据读取失败'+error+"/"+textStatus+'</div></div>')


  }
});



$("#allcheck_trans").on("change",function(){

        $('input[name=check_projects_type_trans]').not(this).prop('checked', this.checked);

  })

$("#allcheck_express").on("change",function(){

$('input[name=rec_file]').not(this).prop('checked', this.checked);

})

$("#checkalltrans").on("change",function(){

        $('input[name=check_projects_type]').not(this).prop('checked', this.checked);

  })

$("#checkalltrans_sales").on("change",function(){

        $('input[name=check_projects_type_sales]').not(this).prop('checked', this.checked);

  })




$('#rec_by').typeahead({
source: function (query, process) {
return $.post('/api', { query: query ,"_xsrf":_xsrf}, function (data) {
return process(JSON.parse(data));
});
}
});

$('#send_name').typeahead({
source: function (query, process) {
return $.post('/api', { query: query ,"_xsrf":_xsrf}, function (data) {
return process(JSON.parse(data));
});
}
});

$("#tran_at").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 00:00:00',
    language: 'zh-CN',initialDate: new Date()});
$("#true_addr_start").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 00:00:00',
    language: 'zh-CN',initialDate: new Date()});
$("#true_addr_end").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 00:00:00',
    language: 'zh-CN',initialDate: new Date()});
$("#true_addr_pay_at").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 00:00:00',
    language: 'zh-CN',initialDate: new Date()});
$("#company_confirm_at").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 00:00:00',
    language: 'zh-CN',initialDate: new Date()});
$("#company_created_day").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 00:00:00',
    language: 'zh-CN',initialDate: new Date()});
$("#company_expired_day").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 00:00:00',
    language: 'zh-CN',initialDate: new Date()});

$("#addr_start_time").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 00:00:00',
    language: 'zh-CN',initialDate: new Date()});
$("#addr_end_time").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 00:00:00',
    language: 'zh-CN',initialDate: new Date()});

$("#express_created_at").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 00:00:00',
    language: 'zh-CN',initialDate: new Date()});
    $("#send_at").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 00:00:00',
    language: 'zh-CN',initialDate: new Date()});

$("#created_send_at").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 00:00:00',
    language: 'zh-CN',initialDate: new Date()});

$("#btn_add_express").on("click",function () {
  $('#l_rec_name').text('收件人')
  $('#l_rec_tel').text('收件人电话')
  $('#l_rec_addr').text('收件人地址')
  $('#l_send_name').text('发件人')
  $("#express_title").text('发起快递寄件申请')
  $('#choose_cutomer_addr_msg').text('选择收件人信息')
  $('#save_customer_add_msg').text('收件人信息存入系统')
  $("#customer_message_title").text("选择收件人信息")
  $("#l_created_send_at").text('发件时间')
  $("#created_send_at").val('')
  $('#btn_save_express').attr('send_or_rec','0')

  $("#er_express").hide()
  $('#btn_save_express').show()
  $('#btn_save_express').removeAttr('express_id')
  $('input[name=rec_file]').prop('checked', false)
  $('#other_rec_file').val('')
  $('#express_number').val('')
  $('#express_remark').val('')
  $("#er_rec_name").hide()
  $("#er_rec_tel").hide()
  $("#er_rec_addr").hide()
  $("#er_rec_company").hide()
  $('#er_express_number').hide()
  $("#er_send_name").hide()
  $("#add_express_modal").modal("show")
 })
 $("#btn_add_express_rec").on('click',function () {
      $('#l_rec_name').text('寄件人')
      $('#l_rec_tel').text('寄件人电话')
      $('#l_rec_addr').text('寄件人地址')
      $('#l_send_name').text('收件人')
      $("#express_title").text('发起快递收件申请')
      $('#choose_cutomer_addr_msg').text('选择寄件人信息')
      $("#customer_message_title").text("选择寄件人信息")
      $('#save_customer_add_msg').text('寄件人信息存入系统')
      $("#l_created_send_at").text('收件时间')
      $("#created_send_at").val('')
       $('#btn_save_express').attr('send_or_rec','1')
       $("#er_express").hide()
      $('#btn_save_express').show()
      $('#btn_save_express').removeAttr('express_id')
      $('input[name=rec_file]').prop('checked', false)
      $('#other_rec_file').val('')
      $('#express_number').val('')
      $('#express_remark').val('')
      $("#er_rec_name").hide()
      $("#er_rec_tel").hide()
      $("#er_rec_addr").hide()
      $("#er_rec_company").hide()
      $('#er_express_number').hide()
      $("#er_send_name").hide()
        $("#add_express_modal").modal("show")
      })
 $(".edit_express").on("click",function () {
  $('input[name=rec_file]').prop('checked', false)
  type_ids_arr =$(this).attr('rec_file_ids').split(',')

  for (var i = 0; i < type_ids_arr.length; i++) {
    $('#rec_file_'+type_ids_arr[i]).prop('checked', true);

    }
    $('#created_send_at').val($(this).attr('created_send_at'))
    if($(this).attr('send_or_rec')=='1'){
      $('#l_rec_name').text('寄件人')
      $('#l_rec_tel').text('寄件人电话')
      $('#l_rec_addr').text('寄件人地址')
      $('#l_send_name').text('收件人')
      $('#save_customer_add_msg').text('寄件人信息存入系统')
      $('#choose_cutomer_addr_msg').text('选择寄件人信息')
      $("#l_created_send_at").text('收件时间')


    }
    else if($(this).attr('send_or_rec')=='0'){
      $('#l_rec_name').text('收件人')
      $('#l_rec_tel').text('收件人电话')
      $('#l_rec_addr').text('收件人地址')
      $('#l_send_name').text('发件人')
      $('#save_customer_add_msg').text('寄件人信息存入系统')
      $('#choose_cutomer_addr_msg').text('选择收件人信息')

    }
  $("#other_rec_file").val($(this).attr('other_rec_file'))
  $("#express_number").val($(this).attr('express_number'))
  $("#rec_name").val($(this).attr('rec_name'))
  $("#rec_tel").val($(this).attr('rec_tel'))
  $("#rec_addr").val($(this).attr('rec_addr'))
  $("#rec_file").val($(this).attr('rec_file'))

  $("#rec_company").val($(this).attr('rec_company'))

  $("#express_type").val($(this).attr('express_type_id'))
  $("#payment_type").val($(this).attr('payment_type_id'))

  $("#express_created_at").val($(this).attr('created_at'))
  $("#send_name").val($(this).attr('send_at_name'))
  $("#express_remark").val($(this).attr('remark'))
  $("#btn_save_express").attr('express_id',$(this).attr('id'))
  if($(this).attr('uid_name')!="{{name}}"  || ($(this).attr('uid_name')=="{{name}}" && $(this).attr('accept_at')!='None')){
    $("#er_express").show()
    $('#btn_save_express').hide()
  }else{
    $("#er_express").hide()
    $('#btn_save_express').show()
  }
  $("#add_express_modal").modal("show")
 })

 $("#btn_save_express").on("click",function(){

    var this_btn=$(this)
    var rec_name=$("#rec_name").val()
    var rec_tel=$("#rec_tel").val()
    var rec_addr=$("#rec_addr").val()
    var rec_company=$("#rec_company").val()
    var express_type_id=$("#express_type").val()
    var express_type_name=$("#express_type").find("option:selected").text()
    var send_name=$("#send_name").val()
    var payment_type_id=$("#payment_type").val()
    var payment_type_name=$("#payment_type").find("option:selected").text()
    var express_remark=$("#express_remark").val()
    var express_id=$(this).attr('express_id')
    var other_rec_file=$("#other_rec_file").val()
    var express_number=$("#express_number").val()
    var save_customer_add_msg=$('input[name=save_customer_add_msg]:checked').val()
    var send_or_rec=$(this).attr('send_or_rec')
    var created_send_at=$('#created_send_at').val()
    var type_ids=[]
    var type_names=[]
    $('input[name=rec_file]:checked').each(function () {
                type_ids.push($(this).val());
                type_names.push($(this).attr('income_name'))
           })

    type_ids=type_ids.join(',')
    type_names=type_names.join(',')

    if(rec_name==''){
      $('#rec_name').focus()
      $('#er_rec_name').text('收件人不能为空')
      $("#er_rec_name").show()
    }else if(rec_tel==''){
      $('#rec_tel').focus()
      $('#er_rec_tel').text('收件人电话不能为空')
      $("#er_rec_tel").show()
    }
    else if(rec_addr==''){
      $('#rec_addr').focus()
      $('#er_rec_addr').text('收件人地址不能为空')
      $("#er_rec_addr").show()
    }
    else if(type_ids=='' && other_rec_file.replace(/\r\n|\n|\s/g,'')==''){
      $('#er_other_rec_file').text('交接明细和其他资料需填其一')
      $("#er_other_rec_file").show()
    }
    else if(rec_company==''){
      $('#er_rec_company').text('公司名不能为空')
      $("#er_rec_company").show()
    }
    else if(express_number==''){
      $('#er_express_number').text('快递单号不能为空')
      $('#er_express_number').show()
    }
    else if(created_send_at=='' && send_or_rec=='0'){
      $('#er_created_send_at').text('发件时间不能为空')
      $('#er_created_send_at').show()
    }
    else if(send_name==''){
      $('#er_send_name').text('申请人不能为空')
      $("#er_send_name").show()
    }else{
      $(this).text('保存中...')
      $(this).attr('disabled','disabled')
    $.post("/project?tag=express",{
      'source':0,
      'rec_name':rec_name,
      'rec_tel':rec_tel,
      'rec_addr':rec_addr,
      'rec_company':rec_company,
      'express_type_id':express_type_id,
      'express_type_name':express_type_name,
      'send_name':send_name,
      'project_id':"{{t_project.id}}",
      'send_or_rec':send_or_rec,
      'payment_type_id':payment_type_id,
      'payment_type_name':payment_type_name,
      'express_remark':express_remark,
      'express_id':express_id,
      'other_rec_file':other_rec_file,
      'express_number':express_number,
      'rec_file_ids':type_ids,
      'rec_file':type_names,
      'guid':'{{t_project.guid}}',
      'save_customer_add_msg':save_customer_add_msg,
      'created_send_at':created_send_at,
      '_xsrf':_xsrf
      },function (result) {

         if(result=='-2'){
          alert('已审核不能修改')
          location.reload()
        } else if(result=='-3'){
          alert('寄/收 件人不存在系统中')
          this_btn.text('保存')
          this_btn.removeAttr('disabled')
        }
        else{
          location.reload()
        }

       })
          }
 })

$("#company_fever").click(function () {
  if(this.checked){
    $('#company_expired_day').hide();
  }else{
    $('#company_expired_day').show();
  }

 })
if($('input:checkbox[id="company_fever"]').is(':checked')){
  $('#company_expired_day').hide();
}

     $("#btn_modify3").on("click",function(){
                $("#add_project_modal").modal('show')
           })

$(".modify_linkman").on("click",function(){
          var linkman_guid  = $(this).attr("linkman_guid")

          var linkman_id = $(this).attr("linkman_id")

          var linkman_remark = $(this).attr("remark")
          var tel = $(this).attr('tel')
          var name = $(this).attr("title")
          var gender = $(this).attr('gender')
          $("#delete_linkman").attr("linkman_id",linkman_id)
          $("#delete_linkman").attr("linkman_guid",linkman_guid)
          $("#delete_linkman").show()
          $("#btn_save_linkman").attr("linkman_id",linkman_id)
          $("#tel").val(tel)
          $("input[type=radio]").filter('[value="'+gender+'"]').attr("checked",true)
          $("#name").val(name)
          $("#linkman_remark").val(linkman_remark)



          $("#add_linkman_modal").modal('show')



        })
$("#delete_linkman").on("click",function(){
           var linkman_id = $(this).attr('linkman_id')
           var linkman_guid = $(this).attr('linkman_guid')

            if(confirm("确认删除吗？")){
                $.post("/project?tag=delete_linkman",
                {
                  "_xsrf": _xsrf,
                  "id": linkman_id,
                  "guid":linkman_guid
                  },function(result){
                    alert("删除成功！")
                    location.reload()
                })

            }
        })

$("#a_add_linkman").on("click", function () {
              $("#delete_linkman").attr("guid", "")
              $("#delete_linkman").hide()
              $("#tel").val("")
              $("input[type=radio]").filter('[value="1"]').attr("checked",true)
              $("#name").val(name)
              $("#add_linkman_modal").modal('show')
            })

$("#btn_save_linkman").on("click",function(){
            var gender = $("input[name=gender]:checked").val()
            var name = $("#name").val()
            var tel = $("#tel").val()
            var remark = $("#linkman_remark").val()
            var linkman_id=$(this).attr('linkman_id')
            if (name==""){
              $("#msg_name").text("客户的名字必须要填写哦。")
               $("#name").focus()
              return false

            }else if(gender==undefined){
              $("#msg_gender").text("请选择客户的性别")
               $("input[name=gender]").focus()
              return false
            }

            else{
              $(this).text('保存中')
              $(this).attr('disabled','disabled')
                $.post("/project?tag=add",{
                  "_xsrf":_xsrf,
                  "project_id":{{t_project.id}},
                  "tel":tel,
                  "name":name,
                  "remark":remark,
                  "gender":gender,
                  "linkman_id":linkman_id
                  },
                  function(result){
                  location.reload()

                })


            }


        })
$("#a_add_trans").on("click", function () {
    $('input[name=check_projects_type_trans]').prop('checked', false);
        $("#delete_transition").hide()
        $("#btn_save_trans").attr("transition_id","0")
         $("#btn_save_trans").attr("project_id","0")
         $("#btn_save_trans").attr("mid","0")
         // $("#tran_by").val("")
          $("#rec_by").val("")
          $("#is_inner").show()
           $("#tran_at").val("")
           $("#trans_remark").val("")
           $("#use_type").val("")
          $("#a_add_trans_modal").modal('show')
           $("#show_msg_by_transition").hide()
           $("#btn_save_trans").show()
  })

$("#a_add_trans_customer").on("click", function () {
    $('input[name=check_projects_type_trans]').prop('checked', false);
        $("#myModalLabel_trans").text("客户交接资料")
        $("#delete_transition").hide()
        $("#btn_save_trans").attr("transition_id","0")
         $("#btn_save_trans").attr("project_id","0")
         pm_id =  $(this).attr("pm_id")

         // $("#tran_by").val("")
          $("#rec_by").val("")
           $("#tran_at").val("")
           $("#trans_remark").val("")
           $("#use_type").val("")
           $("#is_inner").prop('checked', false);
            $("#is_inner_span").hide()
          $("#a_add_trans_modal").modal('show')
           $("#show_msg_by_transition").hide()
           $("#btn_save_trans").show()
            $("#btn_save_trans").attr("is_customer","1")
            $("#btn_save_trans").attr("mid",pm_id)
  })


  $("#a_add_trans_file").on("click", function () {
        $("#delete_transition1").hide()
        $("#btn_save_trans1").attr("transition_id","0")
        $("#btn_save_trans1").attr("project_id","0")

          $("#trans_remark1").val("")
          $("#a_add_trans_modal1").modal('show')

  })


$("#btn_save_trans").on("click",function(){

       // var tran_by = $("#tran_by").val()
        var rec_by = $("#rec_by").val()
        var tran_at = $("#tran_at").val()
        var trans_remark =$("#trans_remark").val()
        var transition_id =$(this).attr("transition_id")
        var is_customer = $(this).attr("is_customer")
        var mid = $(this).attr("mid")
        if(is_customer==undefined){
            is_customer=0
        }
        if(mid==undefined){
            mid=0
        }

        var is_inner =  $("input[name=is_inner]:checked").val()
        var use_type = $("#use_type").val()
          var type_ids=[]
          var type_names=[]
          var remark=$('#projects_type_remark').val();

          $('input[name=check_projects_type_trans]:checked').each(function () {
                type_ids.push($(this).val());
                type_names.push($(this).attr('income_name'))
           })
           type_ids=type_ids.join(',')
           type_names=type_names.join(',')

        if (is_inner==undefined){
            $("#msg_rec_by").text("未选择类型")
        }
        else if(rec_by==""){
            $("#rec_by").focus()
             $("#show_msg_by_transition").text("签收方不能为空")
        }
        else if(tran_at==""){
              $("#show_msg_by_transition").text("交接时间不能为空")
              $("#tran_at").focus()
        }
          else{

          var formData = new FormData();
          formData.append('file', $('#tran_file')[0].files[0]);
          formData.append('_xsrf', _xsrf)
          formData.append("trans_remark",trans_remark)
          formData.append("tran_at", tran_at)
          formData.append("is_inner",is_inner)
          formData.append("rec_by", rec_by)
          formData.append("project_id",{{t_project.id}})
          formData.append("type_ids", type_ids)
          formData.append("type_names", type_names)
          formData.append("transition_id", transition_id)
          formData.append("use_type", use_type)
          formData.append("is_customer", is_customer)
          formData.append("mid", mid)



          $(this).text("保存中..")
          $(this).attr("disabled", "disabled")

            $.ajax({
                url: '/project?tag=add_tran',
                type: 'POST',
                data: formData,
                processData: false,  // tell jQuery not to process the data
                contentType: false,  // tell jQuery not to set contentType
                success: function (data) {
                  if(data >=0){
                   location.reload()

                  }
                  else{
                      if(data=="内部交接:签收用户不存在哦."){
                          $("#rec_by").focus()
                      }
                      $("#show_msg_by_transition").show()
                      $("#show_msg_by_transition").text(data)

                  }

                }
              });



          }

      })

 $(".modify_transition1").on("click",function(){

          if(confirm("确认删除吗？")){
            $.post("/project?tag=delete_tran_upload",{"transition_id":$(this).attr('transition_id'),"_xsrf":_xsrf,"project_id":'{{t_project.id}}'},function(result){
                alert("删除成功")
                location.reload()


            })

            }
      })
$(".modify_transition").on("click",function(){
          $("#delete_transition").show()
          var tran_by = $(this).attr("tran_by")
          var rec_by = $(this).attr("rec_by")
          var tran_at = $(this).attr("tran_at")
          var trans_remark =$(this).attr("remark")
          var transition_id = $(this).attr("transition_id")
          var type_ids = $(this).attr('type_ids')
          var rec_by_uid_at =$(this).attr("rec_by_uid_at")
          var use_type = $(this).attr("use_type")
          var project_id = $(this).attr("project_id")
          var is_customer = $(this).attr("is_customer")
          var is_inner = $(this).attr("is_inner")


          if(is_customer==1){
            $("#is_inner_span").hide()
          }
          if(is_inner==1){
               $("#is_inner").prop('checked', true);
          }else{
              $("#is_inner").prop('checked', false);
          }
          if (rec_by_uid_at!="" || rec_by_uid_at==undefined){
              $("#btn_save_trans").hide()

              $("#show_msg_by_transition").show()
             $("#show_msg_by_transition").text("该交接"+rec_by+"("+rec_by_uid_at+")"+"已确认签收")
          }

          $('input[name=check_projects_type_trans]').prop('checked', false);
          type_ids_arr = type_ids.split(',')

          for (var i = 0; i < type_ids_arr.length; i++) {
              $('#trans_type_id_'+type_ids_arr[i]).prop('checked', true);

          }
          $("#use_type").val(use_type)
          $("#tran_by").val(tran_by)
          $("#rec_by").val(rec_by)
          $("#tran_at").val(tran_at)
          $("#trans_remark").val(trans_remark)
          $("#myModalLabel_trans").text("修改交接信息")
          $("#btn_save_trans").attr("transition_id",transition_id)
          $("#btn_save_trans").attr("project_id",project_id)
          $("#btn_save_trans").attr("is_customer",is_customer)



          $("#a_add_trans_modal").modal('show')


      })
    $("#delete_transition").on("click",function(){
          if(confirm("确认删除吗？")){
            transition_id = $("#btn_save_trans").attr("transition_id")
            project_id = $("#btn_save_trans").attr("project_id")
            $.post("/mtransition?tag=delete_tran",{"transition_id":transition_id,"_xsrf":_xsrf,"project_id":project_id},function(result){
                alert("删除成功")
               location.reload()


            })

            }
      })

{%if t_project.busniess_from_id==2%}
$('#t_customer_company').hide()
  $('#same_company').hide()
  $(".div_talk_type").show()
  $("#div_from_word").show()
  $("#div_pre_value").show()
  $("#div_building").hide()
  $("#div_recommend_by").hide()
  $("#div_acc").hide()
  $("#div_recommend_staff").hide()
  $("#div_addr_type").show()

{%end%}

{%if t_project.busniess_from_id==3%}
$('#t_customer_company').hide()
  $('#same_company').hide()
  $(".div_talk_type").hide()
  $("#div_from_word").hide()
  $("#div_building").hide()
  $("#div_recommend_by").show()
  $("#div_acc").hide()
  $("#div_recommend_staff").show()
    $("#msg_inner_re").text("")
    $("#customer_company").removeAttr('readonly')
      $("#div_pre_value").show()
      $("#div_addr_type").show()

{%end%}


{%if t_project.busniess_from_id==4%}
$('#t_customer_company').hide()
  $('#same_company').hide()
  $(".div_talk_type").show()
  $("#div_from_word").hide()
  $("#div_building").show()
  $("#div_recommend_by").hide()
  $("#div_recommend_staff").show()
  $("#div_acc").hide()
  $("#customer_company").removeAttr('readonly')
    $("#div_pre_value").show()
    $("#div_addr_type").show()

{%end%}

{%if t_project.busniess_from_id==81%}
$('#t_customer_company').hide()
  $('#same_company').hide()
  $(".div_talk_type").show()
  $("#div_from_word").hide()
  $("#div_building").hide()
  $("#div_recommend_by").hide()
  $("#div_recommend_staff").show()
  $("#msg_inner_re").text("（必填）")
  $("#div_acc").hide()
  $("#customer_company").removeAttr('readonly')
  $("#div_pre_value").show()
  $("#div_addr_type").show()

{%end%}
{%if t_project.busniess_from_id==200%}
$('#same_company').show()
  $("#div_recommend_by").hide()
  $(".div_talk_type").hide()
  $("#div_from_word").hide()
  $("#div_building").hide()
  $("#div_acc").hide()
  $("#div_recommend_staff").show()
    $("#msg_inner_re").text("")
      $("#div_pre_value").show()
      $("#div_addr_type").show()
      $("#div_promo").hide()

{%end%}
{%if t_project.busniess_from_id==202%}
$('#t_customer_company').hide()
  $('#same_company').hide()
  $(".div_talk_type").hide()
  $("#div_from_word").hide()
  $("#div_building").hide()
  $("#div_recommend_by").hide()
  $("#div_recommend_staff").hide()
  $("#div_acc").hide()
      $("#div_pre_value").hide()
      $("#div_addr_type").hide()
      $("#div_promo").hide()
{%end%}
{%if t_project.busniess_from_id==203%}
$('#t_customer_company').hide()
  $('#same_company').hide()
  $(".div_talk_type").hide()
  $("#div_from_word").hide()
  $("#div_building").hide()
  $("#div_recommend_by").hide()
  $("#div_recommend_staff").hide()
  $("#div_acc").hide()
  $("#div_pre_value").hide()
  $("#div_addr_type").hide()
  $("#div_promo").show()
{%end%}
{%if t_project.busniess_from_id==278%}
  $('#t_customer_company').hide()
  $('#same_company').hide()
  $(".div_talk_type").hide()
  $("#div_from_word").hide()
  $("#div_building").hide()
  $("#div_recommend_by").hide()
  $("#div_recommend_staff").hide()
  $("#div_acc").hide()
  $("#div_pre_value").hide()
  $("#div_addr_type").hide()
  $("#div_promo").hide()
  $("#div_is_expedited").hide()
  $("#div_is_finance").hide()
{%end%}
$(".delete_state").on("click",function(){


  if(confirm("确认删除该状态吗？")){
        curr_state_id = $(this).attr("curr_state_id")
        name=$(this).attr('uid_name')
        guid = $(this).attr('state_guid')
        type_id=$(this).attr('type_id')
        $.post("project?tag=delete",{
              "_xsrf":_xsrf,
              "curr_state_id":curr_state_id,
              "project_id":{{t_project.id}},
              "name":name,
              "type_id":type_id,
              "guid":guid},
              function(result){
                if(result=='-100'){
                  alert('已过删除期,如需删除,请联系罗文波')
                }else{
                alert('删除成功！')
                location.reload()
              }

              }
          )
    }
})

$('.show_all1').on('click',function(){
  $('#project_state_show_all1').modal("show");
})
$('.show_all2').on('click',function(){
  $('#project_state_show_all2').modal("show");
})
$('.show_all3').on('click',function(){
  $('#project_state_show_all3').modal("show");
})
$('.show_all4').on('click',function(){
  $('#project_state_show_all4').modal("show");
})
$('.show_all5').on('click',function(){
  $('#project_state_show_all5').modal("show");
})
$('.show_all6').on('click',function(){
  $('#project_state_show_all6').modal("show");
})
$('.show_all7').on('click',function(){
  $('#project_state_show_all7').modal("show");
})
$('.show_all8').on('click',function(){
  $('#project_state_show_all8').modal("show");
})
$('.show_all9').on('click',function(){
  $('#project_state_show_all9').modal("show");
})
$('.show_all10').on('click',function(){
  $('#project_state_show_all10').modal("show");
})

$(".modify_state").on('click',function(){
    //  $("#project_state_modal").attr("width","756px;")
      state_remark = $(this).attr("state_remark")
      curr_state_id = $(this).attr("curr_state_id")
      state_id = $(this).attr("state_id")
      type_id=$(this).attr('type_id')
      $.post("/project?tag=expire_msg",
      {
        "_xsrf":_xsrf,
        "project_id":"{{t_project.id}}",
        "curr_state_id":curr_state_id,
        "type_id":type_id
      },function (data) {
        if(data=='-100'){
          alert('已过修改期,如需修改,请联系罗文波')
        }else{
          $(":radio[name='state_id'][value='"+state_id+"']").prop("checked","checked")
      $("#state_remark").val(state_remark)
      $("#btn_save_project_state").attr({"curr_state_id":curr_state_id,'type_id':1})

//      $('#project_state_modal').css('width', '850px');
   //   $("#project_state_modal").css('margin', '100px auto 100px auto');
      $("#project_state_modal").modal("show")
      $("#project_state_show_all1").modal("hide")
        }
       })

})
$(".modify_state1").on('click',function(){
    //  $("#project_state_modal").attr("width","756px;")
      state_remark = $(this).attr("state_remark")
      curr_state_id = $(this).attr("curr_state_id")
      state_id = $(this).attr("state_id")
      type_id=$(this).attr('type_id')
      $.post("/project?tag=expire_msg",
      {
        "_xsrf":_xsrf,
        "project_id":"{{t_project.id}}",
        "curr_state_id":curr_state_id,
        "type_id":type_id
      },function (data) {
        if(data=='-100'){
          alert('已过修改期,如需修改,请联系罗文波')
        }else{
          $(":radio[name='state_id1'][value='"+state_id+"']").prop("checked","checked")
      $("#state_remark1").val(state_remark)
      $("#btn_save_project_state1").attr({"curr_state_id":curr_state_id,'type_id':2})
//      $('#project_state_modal').css('width', '850px');
   //   $("#project_state_modal").css('margin', '100px auto 100px auto');
      $("#project_state_modal1").modal("show")
      $("#project_state_show_all2").modal("hide")
        }
       })


})
$(".modify_state2").on('click',function(){
    //  $("#project_state_modal").attr("width","756px;")
      state_remark = $(this).attr("state_remark")
      curr_state_id = $(this).attr("curr_state_id")
      state_id = $(this).attr("state_id")
      type_id=$(this).attr('type_id')
      $.post("/project?tag=expire_msg",
      {
        "_xsrf":_xsrf,
        "project_id":"{{t_project.id}}",
        "curr_state_id":curr_state_id,
        "type_id":type_id
      },function (data) {
        if(data=='-100'){
          alert('已过修改期,如需修改,请联系罗文波')
        }else{
          $(":radio[name='state_id2'][value='"+state_id+"']").prop("checked","checked")
      $("#state_remark2").val(state_remark)
      $("#btn_save_project_state2").attr({"curr_state_id":curr_state_id,'type_id':3})
//      $('#project_state_modal').css('width', '850px');
   //   $("#project_state_modal").css('margin', '100px auto 100px auto');
      $("#project_state_modal2").modal("show")
      $("#project_state_show_all3").modal("hide")
        }
       })

})
$(".modify_state3").on('click',function(){
    //  $("#project_state_modal").attr("width","756px;")
      state_remark = $(this).attr("state_remark")
      curr_state_id = $(this).attr("curr_state_id")
      state_id = $(this).attr("state_id")
      type_id=$(this).attr('type_id')
      $.post("/project?tag=expire_msg",
      {
        "_xsrf":_xsrf,
        "project_id":"{{t_project.id}}",
        "curr_state_id":curr_state_id,
        "type_id":type_id
      },function (data) {
        if(data=='-100'){
          alert('已过修改期,如需修改,请联系罗文波')
        }else{
          $(":radio[name='state_id3'][value='"+state_id+"']").prop("checked","checked")
      $("#state_remark3").val(state_remark)
      $("#btn_save_project_state3").attr({"curr_state_id":curr_state_id,'type_id':4})
//      $('#project_state_modal').css('width', '850px');
   //   $("#project_state_modal").css('margin', '100px auto 100px auto');
      $("#project_state_modal3").modal("show")
      $("#project_state_show_all4").modal("hide")
        }
       })

})
$(".modify_state4").on('click',function(){
    //  $("#project_state_modal").attr("width","756px;")
      state_remark = $(this).attr("state_remark")
      curr_state_id = $(this).attr("curr_state_id")
      state_id = $(this).attr("state_id")
      type_id=$(this).attr('type_id')
      $.post("/project?tag=expire_msg",
      {
        "_xsrf":_xsrf,
        "project_id":"{{t_project.id}}",
        "curr_state_id":curr_state_id,
        "type_id":type_id
      },function (data) {
        if(data=='-100'){
          alert('已过修改期,如需修改,请联系罗文波')
        }else{
          $(":radio[name='state_id4'][value='"+state_id+"']").prop("checked","checked")
      $("#state_remark4").val(state_remark)
      $("#btn_save_project_state4").attr({"curr_state_id":curr_state_id,'type_id':5})
//      $('#project_state_modal').css('width', '850px');
   //   $("#project_state_modal").css('margin', '100px auto 100px auto');
      $("#project_state_modal4").modal("show")
      $("#project_state_show_all5").modal("hide")
        }
       })

})
$(".modify_state5").on('click',function(){
    //  $("#project_state_modal").attr("width","756px;")
      state_remark = $(this).attr("state_remark")
      curr_state_id = $(this).attr("curr_state_id")
      state_id = $(this).attr("state_id")
      type_id=$(this).attr('type_id')
      $.post("/project?tag=expire_msg",
      {
        "_xsrf":_xsrf,
        "project_id":"{{t_project.id}}",
        "curr_state_id":curr_state_id,
        "type_id":type_id
      },function (data) {
        if(data=='-100'){
          alert('已过修改期,如需修改,请联系罗文波')
        }else{
          $(":radio[name='state_id5'][value='"+state_id+"']").prop("checked","checked")
      $("#state_remark5").val(state_remark)
      $("#btn_save_project_state5").attr({"curr_state_id":curr_state_id,'type_id':6})
//      $('#project_state_modal').css('width', '850px');
   //   $("#project_state_modal").css('margin', '100px auto 100px auto');
      $("#project_state_modal5").modal("show")
      $("#project_state_show_all6").modal("hide")
        }
       })

})
$(".modify_state6").on('click',function(){
    //  $("#project_state_modal").attr("width","756px;")
      state_remark = $(this).attr("state_remark")
      curr_state_id = $(this).attr("curr_state_id")
      state_id = $(this).attr("state_id")
      type_id=$(this).attr('type_id')
      $.post("/project?tag=expire_msg",
      {
        "_xsrf":_xsrf,
        "project_id":"{{t_project.id}}",
        "curr_state_id":curr_state_id,
        "type_id":type_id
      },function (data) {
        if(data=='-100'){
          alert('已过修改期,如需修改,请联系罗文波')
        }else{
          $(":radio[name='state_id6'][value='"+state_id+"']").prop("checked","checked")
      $("#state_remark6").val(state_remark)
      $("#btn_save_project_state6").attr({"curr_state_id":curr_state_id,'type_id':7})
//      $('#project_state_modal').css('width', '850px');
   //   $("#project_state_modal").css('margin', '100px auto 100px auto');
      $("#project_state_modal6").modal("show")
      $("#project_state_show_all7").modal("hide")
        }
       })

})
$(".modify_state7").on('click',function(){
    //  $("#project_state_modal").attr("width","756px;")
      state_remark = $(this).attr("state_remark")
      curr_state_id = $(this).attr("curr_state_id")
      state_id = $(this).attr("state_id")
      type_id=$(this).attr('type_id')
      $.post("/project?tag=expire_msg",
      {
        "_xsrf":_xsrf,
        "project_id":"{{t_project.id}}",
        "curr_state_id":curr_state_id,
        "type_id":type_id
      },function (data) {
        if(data=='-100'){
          alert('已过修改期,如需修改,请联系罗文波')
        }else{
          $(":radio[name='state_id7'][value='"+state_id+"']").prop("checked","checked")
      $("#state_remark7").val(state_remark)
      $("#btn_save_project_state7").attr({"curr_state_id":curr_state_id,'type_id':8})
//      $('#project_state_modal').css('width', '850px');
   //   $("#project_state_modal").css('margin', '100px auto 100px auto');
      $("#project_state_modal7").modal("show")
      $("#project_state_show_all8").modal("hide")
        }
       })

})
$(".modify_state8").on('click',function(){
    //  $("#project_state_modal").attr("width","756px;")
      state_remark = $(this).attr("state_remark")
      curr_state_id = $(this).attr("curr_state_id")
      state_id = $(this).attr("state_id")
      type_id=$(this).attr('type_id')
      $.post("/project?tag=expire_msg",
      {
        "_xsrf":_xsrf,
        "project_id":"{{t_project.id}}",
        "curr_state_id":curr_state_id,
        "type_id":type_id
      },function (data) {
        if(data=='-100'){
          alert('已过修改期,如需修改,请联系罗文波')
        }else{
          $(":radio[name='state_id8'][value='"+state_id+"']").prop("checked","checked")
      $("#state_remark8").val(state_remark)
      $("#btn_save_project_state8").attr({"curr_state_id":curr_state_id,'type_id':9})
//      $('#project_state_modal').css('width', '850px');
   //   $("#project_state_modal").css('margin', '100px auto 100px auto');
      $("#project_state_modal8").modal("show")
      $("#project_state_show_all9").modal("hide")
        }
       })

})
$(".modify_state9").on('click',function(){
    //  $("#project_state_modal").attr("width","756px;")
      state_remark = $(this).attr("state_remark")
      curr_state_id = $(this).attr("curr_state_id")
      state_id = $(this).attr("state_id")
      type_id=$(this).attr('type_id')
      $.post("/project?tag=expire_msg",
      {
        "_xsrf":_xsrf,
        "project_id":"{{t_project.id}}",
        "curr_state_id":curr_state_id,
        "type_id":type_id
      },function (data) {
        if(data=='-100'){
          alert('已过修改期,如需修改,请联系罗文波')
        }else{
          $(":radio[name='state_id9'][value='"+state_id+"']").prop("checked","checked")
      $("#state_remark9").val(state_remark)
      $("#btn_save_project_state9").attr({"curr_state_id":curr_state_id,'type_id':10})
//      $('#project_state_modal').css('width', '850px');
   //   $("#project_state_modal").css('margin', '100px auto 100px auto');
      $("#project_state_modal9").modal("show")
      $("#project_state_show_all10").modal("hide")
        }
       })

})
$(".modify_state10").on('click',function(){
    //  $("#project_state_modal").attr("width","756px;")
      state_remark = $(this).attr("state_remark")
      curr_state_id = $(this).attr("curr_state_id")
      state_id = $(this).attr("state_id")
      type_id=$(this).attr('type_id')
      $.post("/project?tag=expire_msg",
      {
        "_xsrf":_xsrf,
        "project_id":"{{t_project.id}}",
        "curr_state_id":curr_state_id,
        "type_id":type_id
      },function (data) {
        if(data=='-100'){
          alert('已过修改期,如需修改,请联系罗文波')
        }else{
          $(":radio[name='state_id10'][value='"+state_id+"']").prop("checked","checked")
      $("#state_remark10").val(state_remark)
      $("#btn_save_project_state10").attr({"curr_state_id":curr_state_id,'type_id':11})
//      $('#project_state_modal').css('width', '850px');
   //   $("#project_state_modal").css('margin', '100px auto 100px auto');
      $("#project_state_modal10").modal("show")
      $("#project_state_show_all11").modal("hide")
        }
       })

})

 $(".a_project_state_modal").on("click",function(){
    $("#btn_save_project_state").attr("curr_state_id","0")
    $("#btn_save_project_state").removeAttr("disabled")
    $("#project_state_modal").modal("show")
    $("#btn_save_project_state").attr("type_id",$(this).attr("type_id"))

 })
 $('#btn_save_company').on('click',function () {
  var type_id=$(this).attr('type_id');
  var curr_state_id = $(this).attr("curr_state_id")
  var  state_id_name = $(this).attr("state_id_name")
  var  state_remark = $(this).attr('state_remark')
  var  state_id =  $(this).attr('state_id')
  customer_company = $("#customer_company3").val();
  if(customer_company==''){
    alert("公司名称不能为空哦")
    customer_name.focus()
    return false
  }else{
    if(type_id=='1'){
    $("#btn_save_project1").attr('disabled','disabled')
                    $(this).text("保存中...")
                    $.post("/project?tag=modify1",{
                        "project_id":{{t_project.id}},
                        "project_guid":"{{t_project.guid}}",
                        "customer_company":customer_company,
                        "_xsrf":_xsrf},function(result){
                          $.post("project?tag=add_state",{
                              "_xsrf":_xsrf,
                              "type_id": type_id,
                              "curr_state_id":curr_state_id,
                              "project_id":{{t_project.id}},
                              "state_id":state_id,
                              "state_id_name":state_id_name,
                              "state_remark":state_remark}
                          ,function(result){
                              location.reload()
    })
                        })
  }
  }

})

 $(".a_project_state_modal1").on("click",function(){
$("#btn_save_project_state1").attr("curr_state_id","0")
$("#btn_save_project_state1").removeAttr("disabled")
$("#project_state_modal1").modal("show")
$("#btn_save_project_state1").attr("type_id",$(this).attr("type_id"))

})



 $(".a_project_state_modal2").on("click",function(){
$("#btn_save_project_state2").attr("curr_state_id","0")
$("#btn_save_project_state2").removeAttr("disabled")
$("#project_state_modal2").modal("show")
$("#btn_save_project_state2").attr("type_id",$(this).attr("type_id"))

})

 $(".a_project_state_modal3").on("click",function(){

$("#btn_save_project_state3").attr("curr_state_id","0")
$("#btn_save_project_state3").removeAttr("disabled")
$("#project_state_modal3").modal("show")
$("#btn_save_project_state3").attr("type_id",$(this).attr("type_id"))

})
$(".a_project_state_modal4").on("click",function(){

$("#btn_save_project_state4").attr("curr_state_id","0")
$("#btn_save_project_state4").removeAttr("disabled")
$("#project_state_modal4").modal("show")
$("#btn_save_project_state4").attr("type_id",$(this).attr("type_id"))

})

 $(".a_project_state_modal5").on("click",function(){
$("#btn_save_project_state5").attr("curr_state_id","0")
$("#btn_save_project_state5").removeAttr("disabled")
$("#project_state_modal5").modal("show")
$("#btn_save_project_state5").attr("type_id",$(this).attr("type_id"))

})

 $(".a_project_state_modal6").on("click",function(){

$("#btn_save_project_state6").attr("curr_state_id","0")
$("#btn_save_project_state6").removeAttr("disabled")
$("#project_state_modal6").modal("show")
$("#btn_save_project_state6").attr("type_id",$(this).attr("type_id"))

})

 $(".a_project_state_modal7").on("click",function(){
$("#btn_save_project_state7").attr("curr_state_id","0")
$("#btn_save_project_state7").removeAttr("disabled")
$("#project_state_modal7").modal("show")
$("#btn_save_project_state7").attr("type_id",$(this).attr("type_id"))

})
$(".a_project_state_modal8").on("click",function(){
$("#btn_save_project_state8").attr("curr_state_id","0")
$("#btn_save_project_state8").removeAttr("disabled")
$("#project_state_modal8").modal("show")
$("#btn_save_project_state8").attr("type_id",$(this).attr("type_id"))

})
$(".a_project_state_modal9").on("click",function(){
$("#btn_save_project_state9").attr("curr_state_id","0")
$("#btn_save_project_state9").removeAttr("disabled")
$("#project_state_modal9").modal("show")
$("#btn_save_project_state9").attr("type_id",$(this).attr("type_id"))

})
$(".a_project_state_modal10").on("click",function(){
$("#btn_save_project_state10").attr("curr_state_id","0")
$("#btn_save_project_state10").removeAttr("disabled")
$("#project_state_modal10").modal("show")
$("#btn_save_project_state10").attr("type_id",$(this).attr("type_id"))

})

$("#btn_save_project_state").on("click",function(){
    var curr_state_id = $(this).attr("curr_state_id")
    var type_id = $(this).attr("type_id")
    if(type_id==1){
    var state_id_name = $("input[name=state_id]:checked").attr("state_id_name")
    var state_remark = $("#state_remark").val()
    var state_id =  $("input[name=state_id]:checked").val()
    }else{
    state_id_name = $("input[name=state_id1]:checked").attr("state_id_name")
    state_remark = $("#state_remark0").val()
    state_id =  $("input[name=state_id1]:checked").val()}
    if(state_id==undefined){

      alert("要选择办理状态哦")
    }else{

    if( state_id_name=='资料审查' || state_id_name=='已与客户建立联系' || state_id_name=='受阻' || state_id_name=='预计核名' || state_id_name=='核名中' || state_id_name=='领取核名'){
    $(this).attr("disabled","disabled")
    $(this).text('保存中..')
    $.post("project?tag=add_state",{
        "_xsrf":_xsrf,
        "type_id": type_id,
        "curr_state_id":curr_state_id,
        "project_id":{{t_project.id}},
        "state_id":state_id,
        "state_id_name":state_id_name,
        "state_remark":state_remark}
    ,function(result){
         location.reload()
    })
    }
    else{
    if('{{t_project.customer_company}}'==""){

    $('#btn_save_company').attr('type_id',$(this).attr('type_id'));
    $('#btn_save_company').attr('curr_state_id',curr_state_id);
    $('#btn_save_company').attr('state_id_name',state_id_name);
    $('#btn_save_company').attr('state_remark',state_remark);
    $('#btn_save_company').attr('state_id',state_id);
    $("#company_modal").modal("show")
    }else{
      $(this).attr("disabled","disabled")
       $(this).text('保存中..')
      $.post("project?tag=add_state",{
        "_xsrf":_xsrf,
        "type_id": type_id,
        "curr_state_id":curr_state_id,
        "project_id":{{t_project.id}},
        "state_id":state_id,
        "state_id_name":state_id_name,
        "state_remark":state_remark}
    ,function(result){
         location.reload()
    })
    }
}
          }
})


$("#btn_save_project_state1").on("click",function(){
    curr_state_id = $(this).attr("curr_state_id")
    type_id = $(this).attr("type_id")
    if(type_id==2){
    state_id_name = $("input[name=state_id1]:checked").attr("state_id_name")
    state_remark = $("#state_remark1").val()
    state_id =  $("input[name=state_id1]:checked").val()
    }else{
    state_id_name = $("input[name=state_id1]:checked").attr("state_id_name")
    state_remark = $("#state_remark0").val()
    state_id =  $("input[name=state_id1]:checked").val()}
    if(state_id==undefined){

      alert("要选择办理状态哦")
    }else{
    $(this).attr("disabled","disabled")
    $(this).text('保存中..')

    $.post("project?tag=add_state",{
        "_xsrf":_xsrf,
        "type_id": type_id,
        "curr_state_id":curr_state_id,
        "project_id":{{t_project.id}},
        "state_id":state_id,
        "state_id_name":state_id_name,
        "state_remark":state_remark}
    ,function(result){
         location.reload()
    })
}

})

$("#btn_save_project_state2").on("click",function(){
    curr_state_id = $(this).attr("curr_state_id")
    type_id = $(this).attr("type_id")
    if(type_id==3){
    state_id_name = $("input[name=state_id2]:checked").attr("state_id_name")
    state_remark = $("#state_remark2").val()
    state_id =  $("input[name=state_id2]:checked").val()
    }else{
    state_id_name = $("input[name=state_id1]:checked").attr("state_id_name")
    state_remark = $("#state_remark0").val()
    state_id =  $("input[name=state_id1]:checked").val()}
    if(state_id==undefined){

      alert("要选择办理状态哦")
    }else{
    $(this).attr("disabled","disabled")
    $(this).text('保存中..')

    $.post("project?tag=add_state",{
        "_xsrf":_xsrf,
        "type_id": type_id,
        "curr_state_id":curr_state_id,
        "project_id":{{t_project.id}},
        "state_id":state_id,
        "state_id_name":state_id_name,
        "state_remark":state_remark}
    ,function(result){
         location.reload()
    })
}

})

$("#btn_save_project_state3").on("click",function(){
    curr_state_id = $(this).attr("curr_state_id")
    type_id = $(this).attr("type_id")
    if(type_id==4){
    state_id_name = $("input[name=state_id3]:checked").attr("state_id_name")
    state_remark = $("#state_remark3").val()
    state_id =  $("input[name=state_id3]:checked").val()
    }else{
    state_id_name = $("input[name=state_id1]:checked").attr("state_id_name")
    state_remark = $("#state_remark0").val()
    state_id =  $("input[name=state_id1]:checked").val()}
    if(state_id==undefined){

      alert("要选择办理状态哦")
    }else{
    $(this).attr("disabled","disabled")
    $(this).text('保存中..')

    $.post("project?tag=add_state",{
        "_xsrf":_xsrf,
        "type_id": type_id,
        "curr_state_id":curr_state_id,
        "project_id":{{t_project.id}},
        "state_id":state_id,
        "state_id_name":state_id_name,
        "state_remark":state_remark}
    ,function(result){
         location.reload()
    })
}

})

$("#btn_save_project_state4").on("click",function(){
    curr_state_id = $(this).attr("curr_state_id")
    type_id = $(this).attr("type_id")
    if(type_id==5){
    state_id_name = $("input[name=state_id4]:checked").attr("state_id_name")
    state_remark = $("#state_remark4").val()
    state_id =  $("input[name=state_id4]:checked").val()
    }else{
    state_id_name = $("input[name=state_id1]:checked").attr("state_id_name")
    state_remark = $("#state_remark0").val()
    state_id =  $("input[name=state_id1]:checked").val()}
    if(state_id==undefined){

      alert("要选择办理状态哦")
    }else{
    $(this).attr("disabled","disabled")
    $(this).text('保存中..')

    $.post("project?tag=add_state",{
        "_xsrf":_xsrf,
        "type_id": type_id,
        "curr_state_id":curr_state_id,
        "project_id":{{t_project.id}},
        "state_id":state_id,
        "state_id_name":state_id_name,
        "state_remark":state_remark}
    ,function(result){
         location.reload()
    })
}

})

$("#btn_save_project_state5").on("click",function(){
    curr_state_id = $(this).attr("curr_state_id")
    type_id = $(this).attr("type_id")
    if(type_id==6){
    state_id_name = $("input[name=state_id5]:checked").attr("state_id_name")
    state_remark = $("#state_remark5").val()
    state_id =  $("input[name=state_id5]:checked").val()
    }else{
    state_id_name = $("input[name=state_id1]:checked").attr("state_id_name")
    state_remark = $("#state_remark0").val()
    state_id =  $("input[name=state_id1]:checked").val()}
    if(state_id==undefined){

      alert("要选择办理状态哦")
    }else{
    $(this).attr("disabled","disabled")
    $(this).text('保存中..')

    $.post("project?tag=add_state",{
        "_xsrf":_xsrf,
        "type_id": type_id,
        "curr_state_id":curr_state_id,
        "project_id":{{t_project.id}},
        "state_id":state_id,
        "state_id_name":state_id_name,
        "state_remark":state_remark}
    ,function(result){
         location.reload()
    })
}

})

$("#btn_save_project_state6").on("click",function(){
    curr_state_id = $(this).attr("curr_state_id")
    type_id = $(this).attr("type_id")
    if(type_id==7){
    state_id_name = $("input[name=state_id6]:checked").attr("state_id_name")
    state_remark = $("#state_remark6").val()
    state_id =  $("input[name=state_id6]:checked").val()
    }else{
    state_id_name = $("input[name=state_id1]:checked").attr("state_id_name")
    state_remark = $("#state_remark0").val()
    state_id =  $("input[name=state_id1]:checked").val()}
    if(state_id==undefined){

      alert("要选择办理状态哦")
    }else{
    $(this).attr("disabled","disabled")
    $(this).text('保存中..')

    $.post("project?tag=add_state",{
        "_xsrf":_xsrf,
        "type_id": type_id,
        "curr_state_id":curr_state_id,
        "project_id":{{t_project.id}},
        "state_id":state_id,
        "state_id_name":state_id_name,
        "state_remark":state_remark}
    ,function(result){
         location.reload()
    })
}

})

$("#btn_save_project_state7").on("click",function(){
    curr_state_id = $(this).attr("curr_state_id")
    type_id = $(this).attr("type_id")
    if(type_id==8){
    state_id_name = $("input[name=state_id7]:checked").attr("state_id_name")
    state_remark = $("#state_remark7").val()
    state_id =  $("input[name=state_id7]:checked").val()
    }else{
    state_id_name = $("input[name=state_id1]:checked").attr("state_id_name")
    state_remark = $("#state_remark0").val()
    state_id =  $("input[name=state_id1]:checked").val()}
    if(state_id==undefined){

      alert("要选择办理状态哦")
    }else{
    $(this).attr("disabled","disabled")
    $(this).text('保存中..')

    $.post("project?tag=add_state",{
        "_xsrf":_xsrf,
        "type_id": type_id,
        "curr_state_id":curr_state_id,
        "project_id":{{t_project.id}},
        "state_id":state_id,
        "state_id_name":state_id_name,
        "state_remark":state_remark}
    ,function(result){
         location.reload()
    })
}

})
$("#btn_save_project_state8").on("click",function(){
    curr_state_id = $(this).attr("curr_state_id")
    type_id = $(this).attr("type_id")
    if(type_id==9){
    state_id_name = $("input[name=state_id8]:checked").attr("state_id_name")
    state_remark = $("#state_remark8").val()
    state_id =  $("input[name=state_id8]:checked").val()
    }else{
    state_id_name = $("input[name=state_id1]:checked").attr("state_id_name")
    state_remark = $("#state_remark0").val()
    state_id =  $("input[name=state_id1]:checked").val()}
    if(state_id==undefined){

      alert("要选择办理状态哦")
    }else{
    $(this).attr("disabled","disabled")
    $(this).text('保存中..')

    $.post("project?tag=add_state",{
        "_xsrf":_xsrf,
        "type_id": type_id,
        "curr_state_id":curr_state_id,
        "project_id":{{t_project.id}},
        "state_id":state_id,
        "state_id_name":state_id_name,
        "state_remark":state_remark}
    ,function(result){
         location.reload()
    })
}

})

$("#btn_save_project_state9").on("click",function(){
    curr_state_id = $(this).attr("curr_state_id")
    type_id = $(this).attr("type_id")
    if(type_id==10){
    state_id_name = $("input[name=state_id9]:checked").attr("state_id_name")
    state_remark = $("#state_remark9").val()
    state_id =  $("input[name=state_id9]:checked").val()
    }else{
    state_id_name = $("input[name=state_id1]:checked").attr("state_id_name")
    state_remark = $("#state_remark0").val()
    state_id =  $("input[name=state_id1]:checked").val()}
    if(state_id==undefined){

      alert("要选择办理状态哦")
    }else{
    $(this).attr("disabled","disabled")
    $(this).text('保存中..')

    $.post("project?tag=add_state",{
        "_xsrf":_xsrf,
        "type_id": type_id,
        "curr_state_id":curr_state_id,
        "project_id":{{t_project.id}},
        "state_id":state_id,
        "state_id_name":state_id_name,
        "state_remark":state_remark}
    ,function(result){
         location.reload()
    })
}

})

$("#btn_save_project_state10").on("click",function(){
    curr_state_id = $(this).attr("curr_state_id")
    type_id = $(this).attr("type_id")
    if(type_id==11){
    state_id_name = $("input[name=state_id10]:checked").attr("state_id_name")
    state_remark = $("#state_remark10").val()
    state_id =  $("input[name=state_id10]:checked").val()
    }else{
    state_id_name = $("input[name=state_id1]:checked").attr("state_id_name")
    state_remark = $("#state_remark0").val()
    state_id =  $("input[name=state_id1]:checked").val()}
    if(state_id==undefined){

      alert("要选择办理状态哦")
    }else{
    $(this).attr("disabled","disabled")
    $(this).text('保存中..')

    $.post("project?tag=add_state",{
        "_xsrf":_xsrf,
        "type_id": type_id,
        "curr_state_id":curr_state_id,
        "project_id":{{t_project.id}},
        "state_id":state_id,
        "state_id_name":state_id_name,
        "state_remark":state_remark}
    ,function(result){
         location.reload()
    })
}

})
    $("textarea[name=income_remark]").on("blur",function(){
              remark = $(this).val()
              income_id = $(this).attr("income_id")
             // $("#"+income_id+"_remark_body").val(remark)
           $("#"+income_id+"_val_body").attr("remark",remark)
    })



    $('#recommend_staff').typeahead({
      source: function (query, process) {
        return $.post('/api', { query: query ,"_xsrf":_xsrf}, function (data) {
            return process(JSON.parse(data));
        });
    }
    });
    $('#addr_type').typeahead({
      source: function (query, process) {
        return $.post('/api', { query: query ,"_xsrf":_xsrf,"tag":"addr"}, function (data) {
            return process(JSON.parse(data));
        });
    }
    });

  $(document).on("change", 'input[name=busniess_from]',function(){

  bf_value = $(this).val().split('|')[0]

  if (bf_value=="2"){
  $('#t_customer_company').hide()
  $('#same_company').hide()
  $(".div_talk_type").show()
  $("#div_from_word").show()
  $("#div_pre_value").show()
  $("#div_building").hide()
  $("#div_recommend_by").hide()
  $("#div_acc").hide()
  $("#div_recommend_staff").hide()
  $("#div_addr_type").show()
  $("#div_promo").hide()
  $("#customer_company").removeAttr('readonly')
  }else if(bf_value=="3"){
  $('#t_customer_company').hide()
  $('#same_company').hide()
  $(".div_talk_type").hide()
  $("#div_from_word").hide()
  $("#div_building").hide()
  $("#div_recommend_by").show()
  $("#div_acc").hide()
  $("#div_recommend_staff").show()
    $("#msg_inner_re").text("")
    $("#customer_company").removeAttr('readonly')
      $("#div_pre_value").show()
      $("#div_addr_type").show()
      $("#div_promo").hide()
  }else if(bf_value=="4"){
  $('#t_customer_company').hide()
  $('#same_company').hide()
  $(".div_talk_type").show()
  $("#div_from_word").hide()
  $("#div_building").show()
  $("#div_recommend_by").hide()
  $("#div_recommend_staff").hide()
  $("#div_acc").hide()
  $("#customer_company").removeAttr('readonly')
    $("#div_pre_value").show()
    $("#div_addr_type").show()
    $("#div_promo").hide()

  } else if(bf_value=="81"){
  $('#t_customer_company').hide()
  $('#same_company').hide()
  $(".div_talk_type").show()
  $("#div_from_word").hide()
  $("#div_building").hide()
  $("#div_recommend_by").hide()
  $("#div_recommend_staff").show()
  $("#msg_inner_re").text("（必填）")
  $("#div_acc").hide()
  $("#customer_company").removeAttr('readonly')
  $("#div_pre_value").show()
  $("#div_addr_type").show()
  $("#div_promo").hide()

  } else if(bf_value=="194"){
  $('#t_customer_company').hide()
  $('#same_company').hide()
  $(".div_talk_type").show()
  $("#div_from_word").hide()
  $("#div_building").hide()
  $("#div_recommend_by").hide()
  $("#div_recommend_staff").hide()
  $("#div_acc").hide()
  $("#customer_company").removeAttr('readonly')
    $("#div_pre_value").show()
    $("#div_addr_type").show()
    $("#div_promo").hide()
  }
  else if(bf_value=="202"){
  $('#t_customer_company').hide()
  $('#same_company').hide()
  $(".div_talk_type").hide()
  $("#div_from_word").hide()
  $("#div_building").hide()
  $("#div_recommend_by").hide()
  $("#div_recommend_staff").hide()
  $("#div_acc").hide()
      $("#div_pre_value").hide()
      $("#div_addr_type").hide()
      $("#div_promo").hide()


  }else if(bf_value == "203"){
  $('#t_customer_company').hide()
  $('#same_company').hide()
  $(".div_talk_type").hide()
  $("#div_from_word").hide()
  $("#div_building").hide()
  $("#div_recommend_by").hide()
  $("#div_recommend_staff").hide()
  $("#div_acc").hide()
  $("#div_pre_value").hide()
  $("#div_addr_type").hide()
  $("#div_promo").show()
  }
  else if(bf_value=="200"){
  $('#same_company').show()
  $("#div_recommend_by").hide()
  $(".div_talk_type").hide()
  $("#div_from_word").hide()
  $("#div_building").hide()
  $("#div_acc").hide()
  $("#div_recommend_staff").show()
    $("#msg_inner_re").text("")
      $("#div_pre_value").show()
      $("#div_addr_type").show()
      $("#div_promo").hide()
  }
  else{
  $('#t_customer_company').hide()
  $("#customer_company").removeAttr('readonly')
  $('#same_company').hide()
  $(".div_talk_type").show()
  $("#div_acc").hide()
  $("#div_from_word").hide()
  $("#div_building").hide()
  $("#div_recommend_by").hide()
    $("#div_recommend_staff").hide()
      $("#div_pre_value").show()
      $("#div_addr_type").show()
  }



  })

$("#btn_save_project1").on("click",function () {
  customer_company = $("#customer_company1").val();
  is_update_company_customer=''
  is_update_company_project=''
  if(customer_company==''){
    alert("公司名称不能为空哦")
    customer_name.focus()
    return false
  }else{
    $.get("/project?tag=same_company",
                  {  "project_id":"{{t_project.id}}",
                    'customer_company':customer_company,
                    'company':"{{t_project.customer_company}}"
                  },function (res) {
                    if(res['customer']!=undefined && res['customer']!='-1' && res['customer']!='-2'){
                      if(confirm("公司名存在，是否要更改?")){

                        if(res['same_customer']!=undefined){
                        // if(confirm('是否修改客户系统中相同公司的公司名？')){
                        //   is_update_company_customer=1
                        // }
                        }
                        if(res['project']!=undefined){
                        // if(confirm('是否修改确认单系统中其他相同公司的公司名？')){
                        //   is_update_company_project=1
                        // }
                        }
                        $.post("/project?tag=modify1",{
                        "project_id":"{{t_project.id}}",
                        "project_guid":"{{t_project.guid}}",
                        "customer_company":customer_company,
                        "is_update_company_project":is_update_company_project,
                        "is_update_company_customer":is_update_company_customer,
                        "_xsrf":_xsrf},function(result){
                            console.log("result"+result)
                            location.reload()
                        })
                      }

                  }else{
                      if(res['same_customer']!=undefined){
                        // if(confirm('是否修改客户系统中相同公司的公司名？')){
                        //   is_update_company_customer=1
                        // }
                        }
                      if(res['project']!=undefined){
                        // if(confirm('是否修改确认单系统中其他相同公司的公司名？')){
                        //   is_update_company_project=1
                        // }
                        }
                        $("#btn_save_project1").attr('disabled','disabled')
                        $("#btn_save_project1").text("保存中...")
                        $.post("/project?tag=modify1",{
                        "project_id":"{{t_project.id}}",
                        "project_guid":"{{t_project.guid}}",
                        "is_update_company_project":is_update_company_project,
                        "is_update_company_customer":is_update_company_customer,
                        "customer_company":customer_company,
                        "_xsrf":_xsrf},function(result){
                            console.log("result"+result)
                            location.reload()
                        })
                  }
                  })

  }
 })
$('#btn_save_project_kehu').on('click',function () {
  customer_name = $("#customer_name_edit").val();
  if(customer_name_edit==''){
    alert("公司名称不能为空哦")
    return false
  }else{
    $("#btn_save_project_kehu").attr('disabled','disabled')
                    $(this).text("保存中...")
                    $.post("/project?tag=modify1",{
                        "project_id":{{t_project.id}},
                        "project_guid":"{{t_project.guid}}",
                        "customer_name":customer_name,
                        "_xsrf":_xsrf},function(result){
                            console.log("result"+result)
                            location.reload()
                        })
  }
 })

$("#btn_save_project").on("click",function(){
                pre_income = $("#pre_income")
                project_name = $("#project_name")
                customer_name=$("#customer_name")
                busniess_from = $("input[name=busniess_from]:checked")
                new_contract_type_id = $("input[name=new_contract_type_id]:checked")
                recommend_by =$("#recommend_by")
                deal_day = $("#deal_day")
                recommend_staff = $("#recommend_staff")
                b = $.isNumeric(pre_income.val())
                b_deal_day= $.isNumeric(deal_day.val())
                bf_value = busniess_from.val().split('|')[0]
                business_channel= $("input[name=business_channel]:checked")
                customer_company = $("#customer_company")
                customer_tel = $("#customer_tel")
                sign_type_id = $("input[name=sign_type_id]:checked")
               // remark = $("#project_remark")
                talk_type = $("input[name=talk_type]:checked").val()
                from_word = $("#from_word1")
                // company = $("input[name=company]:checked")
                is_finance = $("input[name=is_finance]:checked")
                building_id = $("#building_id")
                addr_type = $("#addr_type")
                is_expedited=$("input[name=is_expedited]:checked")
                promo_id = $("#promo_id")
                kf_id = $("#kf_id")
                is_company_history=''
                type_in_customer=''
                is_update_company_customer=''
                is_update_company_project=''

                // if (company.val()=="0" || company.val()==undefined){
                //   $("#pcompanyHelpInline").text("请选择业务所属公司哦。")
                //   $("#company").focus()
                //    console.log("hi1")
                //   return false;
                // }
                if (busniess_from=="2" && (business_channel.val()=="0" || business_channel.val()==undefined)){
                  $("#business_channelHelpInline").text("请选择来源渠道哦。")
                  $("input[name=business_channel]:first").focus()
                   console.log("hi2")
                  return false;
                }


                else if(bf_value=="2" && kf_id.val()=="0"){
                   console.log("hi7")

                    $("#kf_idHelpInline").text("在线客服人员必选哦！")
                    kf_id.focus()
                   $("input[name=kf_id]:first").focus()

                    return false
                }
              else if(bf_value=="3" && recommend_by.val()==""){
                 console.log("hi8")

                    $("#recommend_byHelpInline").text("客户推荐人必填哦")

                    recommend_by.focus()
                    return false
                }
                else if(bf_value=="81" && recommend_staff.val()==""){
                   console.log("hi9")

                    $("#recommend_staffHelpInline").text("内部推荐人必填哦")

                    recommend_staff.focus()
                    return false
                }
                else if(bf_value=="4" && building_id.val()=="0" || building_id.val()==undefined){
                   console.log("hi9")

                    $("#building_idHelpInline").text("内部推荐人必填哦")

                    building_id.focus()
                    return false
                }
                else if (sign_type_id.val()=="0" || sign_type_id.val()==undefined){
                  $("#sign_type_idHelpInline").text("请选择签约方式哦。")

                  $("input[name=sign_type_id]:first").focus()
                   console.log("hi3")
                  return false;
                }
              else if ((talk_type=="0" || talk_type==undefined) && (bf_value!="200" &&  bf_value != "202" && bf_value != "203" && bf_value!="3" && bf_value!='278')){
                  $("#talk_typeHelpInline").text("请选择来源方式哦。")
                   $("input[name=talk_type]:first").focus()

                  return false;
                }
                else if ( is_finance.val()==undefined && bf_value!='278'){
                  $("#is_financeHelpInline").text("请选择是否记账。")
                    console.log("hi5")
                 $("input[name=is_finance]:first").focus()
                  return false;
                }
                else if (new_contract_type_id.val()=="0" && new_contract_type_id.val()==undefined){
                   console.log("hi6")
                  $("#new_contract_type_idHelpInline").text("请选择合同情况")

                  $("input[name=new_contract_type_id]:first").focus()
                  return false;
                }

                else if (deal_day.val()==""  && (bf_value != "200" && bf_value != "202" && bf_value != "203" && bf_value != "3" && bf_value!='278')){
                   console.log("hi10")
                     $("#deal_dayHelpInline").text("成交周期不能为空哦！")
                     deal_day.focus()
                    return false
                }
                else if(b_deal_day==false  && (bf_value != "200" && bf_value != "202" && bf_value != "203" && bf_value != "3" && bf_value!='278')){
                     console.log("hi11")
                    $("#deal_dayHelpInline").text("成交周期的天数必须是数值哦！")
                    deal_day.focus()

                    return false
                }
                else if(b==false  && (bf_value != "200" && bf_value != "202" && bf_value != "203" && bf_value != "3"  && bf_value!='278')){
                   console.log("b")
                    //alert("预计合同定金必须是数值哦！")
                     $("#pre_incomeHelpInline").text("预计合同定金必须是数值哦！")
                    pre_income.focus()
                    return false
                }

                else if(project_name.val()==""){
                   console.log("hi")
                    $("#project_nameHelpInline").text("业务名称不能为空哦")
                    project_name.focus()
                  return false
                }
                else if(customer_name.val()==""){
                   console.log("hi")
                    $("#customer_nameHelpInline").text("客户名称不能为空哦")
                    customer_name.focus()
                  return false
                }
                 else{
                   // $(this).attr("disabled","disabled")
                   //$(this).text("保存中...")
                    if(bf_value=="3" || bf_value=="200"){
                        talk_type=$("input[name=talk_type]:first").val()
                    }
                   pre_income_val =  pre_income.val()
                    if (pre_income_val==""){
                        pre_income_val = 0
                    }
                     deal_day_val = deal_day.val()
                    if (deal_day_val == "") {
                        deal_day_val = 0
                    }
                }
                $.get("/project?tag=customer_type_name",
                  {
                    'customer_company':customer_company.val()
                  },function (res) {
                    if(res['customer']!=undefined){
                      alert('客户管理系统中该客户为记账客户 请核实')
                    if ( is_finance.val()==undefined || is_finance.val()=='0'){
                  $("#err_is_finance").text("请选择记账。")
                    console.log("hi5")
                  $("input[name=is_finance][value=1]").focus()
                  type_in_customer='-1';

                }
              }
              if(type_in_customer!='-1'){
                  $.get("/project?tag=same_company",
                  {  "project_id":"{{t_project.id}}",
                    'customer_company':customer_company.val(),
                    'company':"{{t_project.customer_company}}"
                  },function (res) {
                    if(res['customer']!=undefined && res['customer']!='-1' && res['customer']!='-2'){
                      if(confirm("公司名存在，是否要更改?")){
                        if(confirm('是否将原公司添加到公司曾用名？')){
                          is_company_history=1
                        }
                        {%if '279' in role_list%}
                        if(res['same_customer']!=undefined && res['same_customer']!='' && "{{getMemberName(t_project_members,'销售顾问')}}"!="{{name}}" && $.inArray('279','{{role_list}}')){
                        // if(confirm('是否修改客户系统中相同公司的公司名？')){
                        //   is_update_company_customer=1
                        // }
                        }
                        if(res['project']!=undefined && res['project']!='' && "{{getMemberName(t_project_members,'销售顾问')}}"!="{{name}}" && $.inArray('279','{{role_list}}')){
                        // if(confirm('是否修改确认单系统中其他相同公司的公司名？')){
                        //   is_update_company_project=1
                        // }
                        }
                        {%end%}
                        $(this).attr("disabled","disabled")
                        $(this).text("保存中...")
                        $.post("/project?tag=modify",{
                        "is_update_company_customer":is_update_company_customer,
                        "is_update_company_project":is_update_company_project,
                        "is_company_history":is_company_history,
                        "project_id":"{{t_project.id}}",
                        "project_guid":"{{t_project.guid}}",
                        "pre_income":pre_income.val(),
                        "project_name":project_name.val(),
                        "customer_name":customer_name.val(),
                        "busniess_from":busniess_from.val(),
                        "recommend_by":recommend_by.val(),
                        "deal_day":deal_day.val(),
                        "business_channel":business_channel.val(),
                        "customer_company":customer_company.val(),
                        "customer_tel":customer_tel.val(),
                       // "remark":remark.val(),
                        "sign_type_id":sign_type_id.val(),
                        "talk_type":talk_type,
                        "from_word":from_word.val(),
                        // "company":company.val(),
                        "is_finance":is_finance.val(),
                        "building_id":building_id.val(),
                        "new_contract_type_id":new_contract_type_id.val(),
                        "addr_type":addr_type.val(),
                        "promo_id": promo_id.val(),
                        "is_expedited":is_expedited.val(),
                        "recommend_staff":recommend_staff.val(),"_xsrf":_xsrf,
                        "same_company":1,"customer_id":res['customer'].id,"customer_company":res['customer'].company},function(result){
                            console.log("result"+result)
                            location.reload()
                        })
                      }
                    }else{
                      if(res['customer']==undefined){
                      if(confirm('是否将原公司添加到公司曾用名？')){
                          is_company_history=1
                        }
                      }
                      {%if '279' in role_list%}
                      if(res['same_customer']!=undefined && res['same_customer']!=''  && "{{getMemberName(t_project_members,'销售顾问')}}"!="{{name}}"){
                        // if(confirm('是否修改客户系统中相同公司的公司名？')){
                        //   is_update_company_customer=1
                        // }

                        }
                        if(res['project']!=undefined && res['project']!=''  && "{{getMemberName(t_project_members,'销售顾问')}}"!="{{name}}" ){
                        // if(confirm('是否修改确认单系统中其他相同公司的公司名？')){
                        //   is_update_company_project=1
                        // }
                        }
                        {%end%}
                      // $('#btn_save_project').attr("disabled","disabled")
                      // $('#btn_save_project').text("保存中...")
                      $.post("/project?tag=modify",{
                        "is_update_company_customer":is_update_company_customer,
                        "is_update_company_project":is_update_company_project,
                        "is_company_history":is_company_history,
                        "project_id":"{{t_project.id}}",
                        "project_guid":"{{t_project.guid}}",

                        "pre_income":pre_income.val(),
                        "project_name":project_name.val(),
                        "customer_name":customer_name.val(),
                        "busniess_from":busniess_from.val(),
                        "recommend_by":recommend_by.val(),
                        "deal_day":deal_day.val(),
                        "business_channel":business_channel.val(),
                        "customer_company":customer_company.val(),
                        "customer_tel":customer_tel.val(),
                        "promo_id": promo_id.val(),
                       // "remark":remark.val(),
                        "sign_type_id":sign_type_id.val(),
                        "talk_type":talk_type,
                        "from_word":from_word.val(),
                        // "company":company.val(),
                        "is_finance":is_finance.val(),
                        "building_id":building_id.val(),
                        "new_contract_type_id":new_contract_type_id.val(),
                        "addr_type":addr_type.val(),
                        "is_expedited":is_expedited.val(),
                        "recommend_staff":recommend_staff.val(),
                        "_xsrf":_xsrf},function(result){
                            console.log("result"+result)
                            location.reload()
                        })
                    }
                   }
                  )
                  }
                   })

})


$("#btn_save_team_cq").on('click',function(){
    var member_id = $("#cq_member").val()
    var cq_btype_id = $("#cq_btype_id").val()
    var cq_btype_id_name =$("#cq_btype_id option:selected").text()
    $(this).attr("disabled", "disabled")
   $(this).text("保存中...")
    if(member_id=="0"){
      alert("请选择工商专员哦。")
      $("#cq_member").focus()
      return false;
    }
    else if(cq_btype_id=="0"){
      alert("请选择办理的业务哦。")
      $("#cq_member").focus()
      return false;

    }else{
      console.log(member_id)
      $.post("/project?tag=add_member_cq",{"cq_btype_id_name":cq_btype_id_name,"member_id":member_id,"project_id":{{t_project.id}},"team_id":38,'_xsrf': _xsrf,"cq_btype_id":cq_btype_id },function(result){
          location.reload()
      })
    }
})


$("#a_add_team_cq").on("click",function(){

  $("#btn_save_team_cq").removeAttr("disabled", "disabled")
  $("#btn_save_team_cq").text("保存")
  $("#cq_member").val("0")
$("#team_cq1").modal("show")
})



$("#btn_modify").on("click",function(){
     $("#new_project_modal").modal("show")

  })
  $("#btn_modify1").on("click",function(){
     $("#new_project_modal1").modal("show")

  })
  $("#btn_modify2").on("click",function(){
    $("#exampleModalLongTitle_company").text("更新办结公司信息")
    $("#btn_save_companyinfo").attr('btype_id_name',$(this).attr('btype_id_name'))
     $("#new_project_modal2").modal("show")

  })
  $(".btn_modify_companyinfo").on("click",function(){
     $("#save_to_customer_msg").hide()
     by_type = $(this).attr("by_type")
     pm_id = $(this).attr("pm_id")
     mid= $(this).attr("mid")
     $("#btn_save_reject_remark").attr("pm_id",pm_id)
     $("#btn_save_reject_remark").attr("mid",mid)

      if(by_type=="仓管"){
          $(".to_customer").attr("readonly","readonly")

      }else{

             $(".to_customer").removeAttr('readonly');
     }


     $("#btn_save_reject_remark").attr("tag","companyinfo")
    $("#exampleModalLongTitle_company").text("公司信息入库资料")
     $("#new_project_modal2").modal("show")

  })



$(".a__license_file").on("click",function(){

    $("input[name=license_print_num]").prop("checked", false)
    $("input[name=license_origin_num]").prop("checked", false)
    $("input[name=license_rec_num]").prop("checked", false)
    $("#license_id_remark").val("")
     $("input[name=chop_num]").val("0")
    $("input[name=info_num]").val("0")



     file_type_name = $(this).attr("file_type_name")
      $("#chop_form").hide()
    if (file_type_name=="公章"){

          $("#choice_form").hide()
          $("#chop_form").show()
          $("#info_form").hide()

    }
    else if (file_type_name=="信息采集表"){

        $("#info_form").show()
         $("#choice_form").hide()
          $("#chop_form").hide()
    }
    else{
      $("#choice_form").show()
      $("#chop_form").hide()
         $("#info_form").hide()
        if (file_type_name=="房产证" || file_type_name=="房屋租赁证明"  || file_type_name =="经营场所场地使用证明"){
              $("#license_rec_num").hide()
          }else{
              $("#license_rec_num").show()

          }
      }

     $("#exampleModalLongTitle_license").text(file_type_name)
      license_print_num = $(this).attr("print_num")
      license_origin_num  = $(this).attr("origin_num")
      license_rec_num = $(this).attr("rec_num")
      id_remark = $(this).attr("license_remark")
      chop_num = $(this).attr("chop_num")
      info_num = $(this).attr("info_num")

      $("#h_file_type_name").val(file_type_name)
      $("#license_option_title").text(file_type_name)
       $("input[name=license_print_num]").val(license_print_num)
      $("input[name=license_origin_num]").val(license_origin_num)
       $("input[name=license_rec_num]").val(license_rec_num)



      $("input[name=chop_num]").val(chop_num)
      $("input[name=info_num]").val(info_num)


      $("#license_id_remark").val(id_remark)


     guid = $(this).attr("guid")
     $("#license_guid_file_id").val(guid)


     console.log("print_num" + license_print_num + "origin_num" + license_origin_num + "rec_num" + license_rec_num+"info_num"+info_num)
    if (license_print_num ==  1) {
      $("input[name=license_print_num]").prop("checked", true)

    }
    if (license_origin_num == 1) {
      $("input[name=license_origin_num]").prop("checked", true)

    }
    if (license_rec_num == 1) {
      $("input[name=license_rec_num]").prop("checked", true)

    }
  if (info_num == 1) {
      $("input[name=info_num]").prop("checked", true)

    }
      $("#modify_license_modal").modal('show')
})

$("#btn_save_file_license").on("click",function(){

          guid =$("#license_guid_file_id").val()
          print_num = $("input[name=license_print_num]:checked").val()
          origin_num = $("input[name=license_origin_num]:checked").val()
          rec_num = $("input[name=license_rec_num]:checked").val()
          chop_num= $("input[name=chop_num").val()



          info_num= $("input[name=info_num]:checked").val()

         id_remark = $("#license_id_remark").val()

       if (chop_num=== undefined){
                chop_num = 0
          }else{
          if(!$.isNumeric(chop_num)){
            alert("公章的枚数为数值哦。")
            $("input[name=chop_num]").focus()

              return false
          }


          }



        if (info_num=== undefined){
                info_num = 0
          }else{
              info_num=1
          }

          if (origin_num=== undefined){
                origin_num = 0
          }else{
              origin_num=1
          }
          if (print_num=== undefined){
                print_num = 0
          }else{
              print_num=1
          }
          if (rec_num=== undefined){
                rec_num = 0
          }    else {
            rec_num = 1
          }

          var formData = new FormData();
          formData.append('file', $('#id_file')[0].files[0]);
          formData.append('_xsrf', _xsrf );
            formData.append("project_id",{{t_project.id}})
           formData.append("print_num",print_num)
            formData.append("origin_num",origin_num)
            formData.append("rec_num",rec_num)
           formData.append("guid",guid)
            formData.append("id_remark",id_remark)
           formData.append("chop_num",chop_num)
                 formData.append("info_num",info_num)
        $(this).text("保存中..")
        $(this).attr("disabled","disabled")

            $.ajax({
                  url : '/project?tag=upload_file_info',
                  type : 'POST',
                  data : formData,
                  processData: false,  // tell jQuery not to process the data
                  contentType: false,  // tell jQuery not to set contentType
                  success : function(data) {

                if(data== 0){

                      location.reload()


                  }}
            });
        })

        $(".a_id_modify_file").on("click",function(){
            file_type_name = $(this).attr("file_type_name")
            $("#exampleModalLongTitle_mfile").text(file_type_name)
            id_number= $(this).attr("id_number")
            print_num = $(this).attr("print_num")
            origin_num  = $(this).attr("origin_num")
            id_remark = $(this).attr("remark")
            $("input[name=print_num]").val(print_num)
            $("input[name=origin_num]").val(origin_num)
            $("#id_remark").val(id_remark)
            $("input[name=id_number]").val(id_number)
            guid = $(this).attr("guid")
            $("#guid_file_id").val(guid)
            $("#modify_idcard_modal").modal('show')
        })


        $("#btn_save_file_idcard").on("click",function(){

          guid =$("#guid_file_id").val()
          print_num = $("input[name=print_num]").val()
          origin_num = $("input[name=origin_num]").val()
          id_number = $("input[name=id_number]").val()
          if(!$.isNumeric(print_num)){
            alert("复印件数量要为数值哦。")
            $("input[name=print_num]").focus()

              return false
          }
          if(!$.isNumeric(origin_num)){
            alert("复印件数量要为数值哦。")
            $("input[name=origin_num]").focus()
              return false
          }

          id_remark = $("#id_remark").val()
          var formData = new FormData();
          formData.append('file', $('#id_file')[0].files[0]);
          formData.append('_xsrf', _xsrf );
            formData.append("project_id",{{t_project.id}})
           formData.append("print_num",print_num)
            formData.append("origin_num",origin_num)
           formData.append("guid",guid)
            formData.append("id_remark",id_remark)
            formData.append("id_number",id_number)
                      $(this).text("保存中..")
             $(this).attr("disabled","disabled")
            $.ajax({
                  url : '/project?tag=upload_file_info',
                  type : 'POST',
                  data : formData,
                  processData: false,  // tell jQuery not to process the data
                  contentType: false,  // tell jQuery not to set contentType
                  success : function(data) {
                if(data== 0){
                          location.reload()
                  }}
            });
        })



   $(".a_delete_service_money").on("click",function(){
      guid =  $(this).attr('guid')
      if(confirm("确认删除吗？")){
        $.post("/project?tag=delete_service_money",{"project_id":"{{t_project.id}}","_xsrf":_xsrf,"guid":guid},function(result){
          if(result==0){
            alert("删除成功")
            location.reload()

          }else{
            alert(result)
          }

        })
      }

   })
   $(".a_delete_note").on("click",function () {
      id =  $(this).attr('id')
      if(confirm("确认删除吗？")){
        $.post(
          '/project?tag=delete_note',
          {
            "_xsrf":_xsrf,
            'id':id
          },function (result) {
            alert('删除成功')
            location.reload()
           }
        )
      }
    })

$("body").on("click",'#btn_save_income_servie',function(){
      var jsonArr = [];
      var FreeList=[];
      $("input[name=service_money]").each(function(){
          guid = $(this).attr("guid")
          service_money = $(this).val()
          sid = $(this).attr("sid")

          b_service_money = $.isNumeric(service_money)
          if(service_money !="" && b_service_money==false){
            alert("金额要为数值哦。")
          }else if (service_money==""){
            console.log("空不做动作。")
          }else  if(b_service_money==false){
               $(this).focus()
              alert("金额要为数值哦。")
              return false
          }else{
              jsonArr.push({
                  service_money:service_money,
                  guid: guid,
                  sid:sid
              });
          }
      })
      $("input[name=is_free]:checked").each(function () {
          sid=$(this).val()
          FreeList.push(sid)
       })
       FreeList=FreeList.join(',')

      $(this).text("保存中..")
      $(this).attr("disabled","disabled")

          var formData = new FormData();
          formData.append('body',  JSON.stringify(jsonArr));
          formData.append('free',FreeList);
          formData.append('_xsrf', _xsrf );
          formData.append("project_id",{{t_project.id}})
          $.ajax({
                url : '/project?tag=add_service_income',
                type : 'POST',
                data : formData,
                contentType: 'application/json; charset=utf-8',
                processData: false,  // tell jQuery not to process the data
                contentType: false,  // tell jQuery not to set contentType
                success : function(data) {
                  console.log(data)
                  if(data=="0"){
                    location.reload()
                  }else{

                    alert(data)
                  }

                }
          });




})

$("#a_add_service").on("click",function(){
      $("#btn_save_income_servie").text("保存")
      $("#btn_save_income_servie").removeAttr("disabled")
    $("#service_modal1").modal("show")
})
$("#a_add_note").on("click",function(){
  $("#projects_note").text('交代事项')
  $('#projects_lab').text('交代内容')
  $('.modal_note_btn').text('保存')
  $('.modal_note_btn').attr('id','btn_save_modal_note')
  $('.modal_note_btn').removeAttr('note_id')
  $('#btn_save_modal_note').removeAttr('is_chengjiao')
  $('#note_content').val('');
  $('#projects_note_confirm_content').hide();
  $('#projects_note_content').show();
  $("#modal_note").modal("show")
})
$("#a_read_note").on("click",function () {
  $("#projects_note").text('选择未读事项')
  $('.modal_note_btn').text('确定已读')
  $('.modal_note_btn').attr('id','btn_save_modal_note_confirm')
  $('#projects_note_content').hide();
  $('#projects_note_confirm_content').show();
  $("#modal_note").modal("show")
 })
$("#btn_save_fromword").on("click",function(){

   $(this).text("保存中..")
    $(this).attr("disabled","disabled")
   from_word =  $("#from_word").val()
   $.post("/project?tag=confirm_word",{"from_word":from_word,"_xsrf":_xsrf,"project_id": {{ t_project.id }},"project_guid":"{{t_project.guid}}"},function(result){

      alert("确认成功！")
      location.reload()

   })

})
  $("#btn_fromword_confrim").on("click",function(){
      $("#modal_confirm_formword").modal("show")

  })

  $(".a_delete_file").on("click",function(){
      guid= $(this).attr("guid")
      id= $(this).attr('id')


      if(confirm("确认永久删除该资料记录吗？")){

        $.post("/project?tag=delete_file",{ "_xsrf": _xsrf,"file_id":id,"file_guid":guid},function(result){
          alert("删除成功")
          location.reload()
        })


      }

  })
  $(".a_delete_member").on("click",function(){
    //  id= $(this).attr('id')
      project_id =$(this).attr("project_id")
      guid = $(this).attr("guid")
      mid = $(this).attr("mid")
      staff_name = $(this).attr("staff_name")
      ddf=$(this).attr('ddf')
      ddff=$(this).attr('ddff')
      team_id=$(this).attr('team_id')
    if( (ddf!='0' && team_id=='38' || ddff!='0' && team_id!='38') && ('{{role}}'!='8' && '{{name}}'!='吴蔚亮' && "{{role}}"!='7') )
    {
        alert('已过删除时间，请联系管理员或财务经理删除!')
      }
    else{
        if(confirm("确认"+staff_name+"移出项目组吗？")){
          $.post("/project?tag=delete_member",{"mid":mid, "_xsrf": _xsrf,"project_id":project_id,"guid":guid
          },function(result){
                alert(staff_name+"移出操作成功！")
                 location.reload()
          })


      }
      }

  })
   $("#btn_contract_confrim").on("click",function(){

     $("#contract_confirm_modal").modal("show")

   })

    $("#btn_save_contract_status").on("click",function(){

      contract_type_id= $("input[name=contract_type_id]:checked").val()
      contract_remark = $("#contract_remark").val()
      contract_confirm_id_name = $("input[name=contract_type_id]:checked").attr("title")
      contract_number = $("#contract_number").val()
              $(this).text("保存中..")
        $(this).attr("disabled","disabled")
            $.post("/project?tag=contract_confirm",{
              "contract_type_id":contract_type_id,
              "contract_remark":contract_remark,
              "contract_confirm_id_name":contract_confirm_id_name,
              "contract_number":contract_number,
              "_xsrf": _xsrf,
         "guid": "{{t_project.guid}}", "project_id": {{ t_project.id }}},function(result) {

                location.reload()
          })

    })

   $("#btn_save_file").on("click",function(){

     rec_num =$("#rec_num").val()
     file_type_id = $("input[name=file_type_id]:checked").val()
      file_type_name = $("input[name=file_type_id]:checked").attr("ft_name")

      file_type_cate_id = $("input[name=file_type_cate_id]:checked").val()
     file_type_cate_name =$("input[name=file_type_cate_id]:checked").attr("ft_name")

    var formData = new FormData();
     formData.append('file', $('#file')[0].files[0]);
     formData.append('_xsrf', _xsrf );
      formData.append("project_id",{{t_project.id}})
        formData.append("file_type_cate_id",file_type_cate_id)
          formData.append("file_type_id",file_type_id)
         formData.append("rec_num",rec_num)
   formData.append("file_type_name",file_type_name)
      formData.append("file_type_cate_name",file_type_cate_name)
      $(this).text("保存中..")
        $(this).attr("disabled","disabled")
      $.ajax({
            url : '/project?tag=upload',
            type : 'POST',
            data : formData,
            processData: false,  // tell jQuery not to process the data
            contentType: false,  // tell jQuery not to set contentType
            success : function(data) {
           if(data > 0){

                    location.reload()


            }}
      });
   })
   $("#new_file").on("click",function(){
        $("#file_modal").modal("show")
   })

   $(".btn_confirm").on("click",function(){
     if(confirm("确认该笔到款已经到帐？")){
          title_id = $(this).attr("title_id")
          title_guid = $(this).attr("title_guid")
          ctype = $(this).attr("ctype")

          $.post("/project?tag=confirm",{ "_xsrf": _xsrf,
          "guid":"{{t_project.guid}}","project_id":{{t_project.id}},"title_id":title_id,
          "title_guid":title_guid,
          "ctype":ctype
          },
          function(result){
               location.reload()
          })

      }
   })
    $("#income_at").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 00:00:00',
    language: 'zh-CN',initialDate: new Date()});


    $("#btn_save_income").on("click",function(){

         var   pay_type_id = $("#pay_type_id").val()//
         var   pay_type_name =$("#pay_type_id option:selected").text()

         var   company_id = $("#company_id").val()
         var   company_id_name = $("#company_id option:selected").text()
         var   income_at = $("#income_at").val()
        // var    is_other = $("#is_other").val()
        //var    remark = $("#income_remark").val()
         var   income_a_type = $(this).attr("income_a_type")
         var  curr_parent_id= $(this).attr("parent_id_hide")
         var jsonArr = [];
         var title =""
         var is_null = 0


         if (company_id==0){
           $("#company_id").focus()


          return false
        }else if (pay_type_id==0){
             $("#pay_type_id").focus()


          return false
        }else{

        $("input[name=income_val]").each(function(){

            income_money = $(this).val()
            var  parent_id= $(this).attr("parent_id")

            if(income_money!=""  &&  curr_parent_id==parent_id){
                var income_num =  $(this).attr("num")
                var income_id =  $(this).attr("income_id")
                var income_name = $(this).attr("income_name")
                var income_remark =   $(this).attr("remark")
            //    console.log("parent_id"+parent_id+"curr_parent_id"+curr_parent_id+"income_money"+income_money)
                if(income_remark==undefined){
                  income_remark=""
                }
                if(income_money!="" && $.isNumeric(income_money)==false){
                  alert("金额要为数值哦。")
                  $("#income_"+income_id+"_"+income_num).focus()
                  return false
                }
                else if (income_money==""){
                  console.log("沙耶")
                }
                 else if (curr_parent_id  ==  0 && parent_id > 0 ){
                  console.log("沙耶")
                }
                else{

                    b = $.isNumeric(income_money)
                    var income_detail = $(this).attr("income_detail")
                    console.log(income_detail)
                    console.log("income_detail"+income_name+income_detail+curr_parent_id)

                    if(curr_parent_id > 0  && income_detail==undefined  &&  (income_name=="合同定金" || income_name=="尾款")){
                        alert("没有设置收入明细"+income_name)
                        return false
                    }else{
                      /*
                     if (income_name!="CA费用" || income_name!="税控盘" || income_name!="印花税" || income_name!="罚款" || income_name!="其他" ){
                      is_null=1

                    }*/



                    is_null=1
                     jsonArr.push({
                        income_money:income_money,
                        income_num: income_num,
                        income_id:income_id,
                        income_name:income_name,
                        pay_type_id:pay_type_id,
                        pay_type_name:pay_type_name,
                        income_at:income_at,
                       // is_other:is_other,
                        remark:income_remark,
                        income_a_type:income_a_type,
                        income_detail:income_detail
                    });

                    }

              }
           }
        })

        if (curr_parent_id > 0 && is_null==0){
            alert("到款金额没有改动哦。")
            return false
        }
         else if (is_null==0){
            alert("到款金额不能为空哦。")
            return false
        }
        else if(jsonArr.length > 0 ){

          var formData = new FormData();
           formData.append('body',  JSON.stringify(jsonArr));
           formData.append('_xsrf', _xsrf );
           formData.append("project_id",{{t_project.id}})
           formData.append("pay_type_id",pay_type_id)
           formData.append("pay_type_name",pay_type_name)
           formData.append("company_id",company_id)
           formData.append("company_id_name",company_id_name)
           formData.append("income_a_type",income_a_type)
           formData.append("parent_id",curr_parent_id)
           formData.append("income_at",income_at)
           //$(this).text('保存中')
          // $(this).attr('disabled','disabled')

           $(this).attr("disabled","disabled")
           $.ajax({
                    url : '/project?tag=add_income',
                    type : 'POST',
                    data : formData,
                    contentType: 'application/json; charset=utf-8',
                    processData: false,  // tell jQuery not to process the data
                    contentType: false,  // tell jQuery not to set contentType
                    async: false,
                    success : function(data) {
                    location.reload()
                    }
              });
        }
}
  /*
        if(income_money > 1110){
                    $.post("/project?tag=add_income",{
                      "_xsrf": _xsrf,
                      "income_num":income_num,
                      "income_money":income_money,
                      "income_name": income_name,
                      "pay_type_id":pay_type_id,
                      "pay_type_name":pay_type_name,
                      "income_id":income_id,
                      "company_name":company_name,
                      "company_id":company_id,
                      "project_id":{{t_project.id}},
                      "income_at":income_at,
                      "is_other":is_other,
                      "remark":remark,
                      "parent_id":timestamp
                    },function(result){
                        if(result>0){
                          location.reload()
                        }
                    })
            }


        income_money = $("#income_money").val()
        income_name = $("#income_id option:selected").text()
        income_id = $("#income_id").val()
        pay_type_id = $("#pay_type_id").val()//
        pay_type_name =$("#pay_type_id option:selected").text()
  2
        company_id = $("#company_id").val()
        company_name = $("#company_id option:selected").text()
        income_at = $("#income_at").val()
        is_other = $("#is_other").val()
        remark = $("#income_remark").val()
        income_a_type = $("#income_a_type").val()
        b = $.isNumeric(income_money)
        if(b==false){
          alert("到款金额，请输入数值.")
          $("#income_money").focus()
          return false
        }else if (income_id ==0){
          alert("到款类型要选择哦。")
          return false
        }else if (company_id==0){
          alert("收入公司要选择哦")
          return false
        }else if (pay_type_id==0){
          alert('支付方式要选择哦')
          return false
        }
        else{
            $(this).text("保存中..")
            $(this).attr("disabled","disabled")

          if(income_a_type==0){
            $.post("/project?tag=add_income",{
              "_xsrf": _xsrf,
              "income_money":income_money,
              "income_name": income_name,
              "pay_type_id":pay_type_id,
              "pay_type_name":pay_type_name,
              "income_id":income_id,
              "company_name":company_name,
              "company_id":company_id,
              "project_id":{{t_project.id}},
              "income_at":income_at,
              "is_other":is_other,
              "remark":remark
            },function(result){
                if(result>0){
                  location.reload()
                }
            })
          }else{

             income_curr_id = $("#income_curr_id").val()
             income_curr_guid =  $("#income_curr_guid").val()
                $.post("/project?tag=modify_income",{
                  "_xsrf": _xsrf,
                  "income_money":income_money,
                  "income_name": income_name,
                  "pay_type_id":pay_type_id,
                  "pay_type_name":pay_type_name,
                  "income_id":income_id,
                  "company_name":company_name,
                  "company_id":company_id,
                  "project_id":{{t_project.id}},
                  "income_at":income_at,
                  "is_other":is_other,
                  "remark":remark,
                  "project_id":{{t_project.id}},
                  "project_guid":"{{t_project.guid}}",
                  "guid":income_curr_guid,
                  "id":income_curr_id

                },function(result){

                      location.reload()

                })

          }
        }
*/
    })


    $("#btn_save_team").on("click",function(){
        $(this).text("保存中..")
        $(this).attr("disabled","disabled")
       $("select[name=income_name_member]").each(function(){
                guid =   $(this).attr("guid")
                member_id = $(this).val()
                cannot_update=$(this).attr('cannot_update')
                $.post("/project?tag=add_member",{"_xsrf": _xsrf,"guid":guid,'cannot_update':cannot_update,
                "member_id":member_id,"project_id":{{t_project.id}}},function(result){
                    location.reload()
                    console.log(result)
                })

        });
    })
/*
    $("#new_income").on("click",function(){
      $("#income_a_type").val(0)
      $("#income_modal").modal("show")
      $("#income_title_type").text("新增合同到款信息")
      $("#is_other").val(0)
    })
  */
    $(".delete_income").on("click",function(){
        $("#income_curr_id").val($(this).attr("income_curr_id"))
         $("#income_curr_guid").val($(this).attr("income_curr_guid"))

       $("#income_modal_delete").modal("show")

    })

    $("#delete_income").on("click",function(){
        income_curr_id = $("#income_curr_id").val()

         income_curr_guid =  $("#income_curr_guid").val()

         console.log("income_curr_id"+income_curr_id+"income_curr_guid"+income_curr_guid)
        if(confirm("确认删除该笔到款吗？")){

            $.post("/project?tag=delete_income",{"project_id":{{t_project.id}},"_xsrf":_xsrf,"id":income_curr_id,"guid":income_curr_guid,
            "project_guid":"{{t_project.guid}}",function(result){

                alert("删除成功！")
                 location.reload()
            }})
        }

    })
  var show_val_body = ""



 function getALlIncome(t){
        $.get("/project?tag=income_detail_by_project",{"project_id":{{t_project.id}},"_xsrf":_xsrf},function(result){

            $.each(result.incomes,function(i,val){

                  console.log(i+"_"+val.income_id)

                  $("#income_"+val.income_id+"_"+val.income_num).attr("income_id",val.income_id)
                  $("#income_"+val.income_id+"_"+val.income_num).attr("income_num",val.income_num)
                   $("#income_"+val.income_id+"_"+val.income_num).val(val.income_money)
                 if (t==0){
                   $("#income_"+val.income_id+"_"+val.income_num).attr("disabled","disabled")
                 }else{
                    $("#income_"+val.income_id+"_"+val.income_num).removeAttr("disabled","disabled")

                 }

            })
        },"json")

 }

  $(".show_income_modify").on("click",function(){
   //   getALlIncome(0);
     // $("#income_a_type").val("edit")

     //  $("#parent_id_hide").val(parent_id)
      $("#btn_save_income").removeAttr("disabled")
      var  parent_id = $(this).attr("parent_id")
      var  company_id = $(this).attr("company_id")
      var   company_id_name= $(this).attr("company_id_name")
      var  pay_type_id = $(this).attr("pay_type_id")
      var  pay_type_id_name= $(this).attr("pay_type_id_name")
      var  income_at = $(this).attr("income_at")
     $("input[name=income_val]").attr("disabled","disabled")

       $("#btn_save_income").attr("income_a_type","edit")
       $("#btn_save_income").attr("parent_id_hide",parent_id)
      // title_id = $(this).attr("pare")
        $("#company_id").val(company_id)
        $("#pay_type_id").val(pay_type_id)
        $("#income_at").val(income_at)
        $(".a_income_pay_detail").hide()
        $("input[name=income_val]").css('background-color', '');



        $.get("/project?tag=income_detail_by_project",{"project_id":{{t_project.id}},"_xsrf":_xsrf},function(result){

            $.each(result.incomes,function(i,val){
                console.log(result.incomes)

                  $("#income_"+val.income_id+"_"+val.income_num).attr("income_id",val.income_id)
                  $("#income_"+val.income_id+"_"+val.income_num).attr("income_num",val.income_num)
                  $("#income_"+val.income_id+"_"+val.income_num).val(val.income_money)
                  $("#income_"+val.income_id+"_"+val.income_num).attr("parent_id",val.parent_id)

                  $("#a_income_" + val.income_id + "_" + val.income_num).attr("income_id", val.income_id)
                  $("#a_income_" + val.income_id + "_" + val.income_num).attr("income_num", val.income_num)
                  $("#a_income_" + val.income_id + "_" + val.income_num).val(val.income_money)
                  $("#a_income_" + val.income_id + "_" + val.income_num).attr("parent_id", val.parent_id)

                  console.log(parent_id+"_val.parent_id"+val.parent_id)

                if(parent_id== val.parent_id){


                  $("#a_income_" + val.income_id + "_" + val.income_num).show()
                  $("#income_"+val.income_id+"_"+val.income_num).attr("income_detail",   JSON.stringify(val.income_detail))

                 if(val.income_name=="合同定金" || val.income_name=="尾款"){
                    $("#income_"+val.income_id+"_"+val.income_num).attr("disabled","disabled")
                  }
                  else{
                      $("#income_"+val.income_id+"_"+val.income_num).removeAttr("disabled","disabled")


                  }
                  $("#income_"+val.income_id+"_"+val.income_num).attr("class","form-control")
                //  $("#income_" + val.income_id + "_" + val.income_num).css('background-color', '#D6EAF8');




                }else{


                }


            })


        },"json")

          /*
        $.get("/project?tag=income_detail",{"parent_id":parent_id,"_xsrf":_xsrf},function(result){

            $.each(result.incomes,function(i,val){
                  console.log(i+"_"+val.remark+"val.income_id="+val.income_id+"val.income_num="+val.income_num+"val.parent_id"+val.parent_id)

                   $("#income_"+val.income_id+"_"+val.income_num).val(val.income_money)

                   $("#income_"+val.income_id+"_"+val.income_num).add("disabled","")

                   $("#income_remark_"+val.income_id).val(val.remark)

                  $("#income_"+val.income_id+"_"+val.income_num).attr("parent_id",val.parent_id)

            })
        },"json")

        */
         $("#income_modal1").modal("show")
  })


    $('#add_project_type').on("click",function () {
      $('#project_type_modal').modal('show')
     })

     $('#btn_save_project_type_money').on("click",function () {
       var caval=$("input[name='CA费用']").val();
       var caid=$("input[name='CA费用']").attr('id');
       var shuikongpanval=$("input[name='税控盘']").val();
       var shuikongpanid=$("input[name='税控盘']").attr('id');
       var yinhuashuival=$("input[name='印花税']").val();
       var yinhuashuiid=$("input[name='印花税']").attr('id');
       var fakuanval=$("input[name='罚款']").val();
       var fakuanid=$("input[name='罚款']").attr('id');
       var otherval=$("input[name='其他']").val();
       var otherid=$("input[name='其他']").attr('id');
       var tuikuanval=$("input[name='退款']").val();
       var tuikuanid=$("input[name='退款']").attr('id');

      if (isNaN(caval) | isNaN(shuikongpanval) | isNaN(yinhuashuival) | isNaN(fakuanval)| isNaN(otherval | isNaN(tuikuanval))){
          alert('金额必须为数字！！！')
      }
      else{
      $.post(
        "/project?tag=add_project_money",
        {
          'caval':caval,
          'ca':'CA费用',
          'caid':caid,
          'shuikongpanval':shuikongpanval,
          'shuikongpan':'税控盘',
          'shuikongpanid':shuikongpanid,
          'yinhuashuival':yinhuashuival,
          'yinhuashui':'印花税',
          'yinhuashuiid':yinhuashuiid,
          'fakuanval':fakuanval,
          'fakuan':'罚款',
          'fakuanid':fakuanid,
          'otherval':otherval,
          'other':'其他',
          'otherid':otherid,
          'tuikuan':'退款',
          'tuikuanval':tuikuanval,
          'tuikuanid':tuikuanid,
          'project_id':{{t_project.id}},
          "_xsrf": _xsrf
        },function (data) {
          location.reload()
         }
      )
      }
     })







     $(".a_income_pay_detail").hide()
     $(".a_income_pay_detail").on("click",function(){
        parent_id = $(this).attr("parent_id")
        income_id = $(this).attr("income_id")
        income_input_id = $(this).attr("income_input_id")
        income_name = $(this).attr("income_name")
        service_money = $(this).val()
        income_num =$(this).attr("num")

        var pay_type_id = $("#pay_type_id").val()//
        var pay_type_name = $("#pay_type_id option:selected").text()
        var company_id = $("#company_id").val()
        var company_id_name = $("#company_id option:selected").text()
        var income_at = $("#income_at").val()
        var income_remark = $("#income_remark_"+income_id).val()
        $("#income_deital_title").text(income_name+"第"+income_num+"笔到款明细")
        $("#btn_save_income_detail").attr("income_num", income_num)
        $("#btn_save_income_detail").attr("income_id", income_id)
        $("#btn_save_income_detail").attr("income_name", income_name)
        $("#btn_save_income_detail").attr("service_id", $(this).attr("service_id"))
        $("#btn_save_income_detail").attr("service_name",$(this).attr("service_name"))
        $("#btn_save_income_detail").attr("service_money", service_money)
        $("#btn_save_income_detail").attr("income_input_id", income_input_id)
        $("#btn_save_income_detail").attr("parent_id", parent_id)
        $("#btn_save_income_detail").attr("pay_type_id", pay_type_id)
        $("#btn_save_income_detail").attr("pay_type_name", pay_type_name)
        $("#btn_save_income_detail").attr("company_id", company_id)
        $("#btn_save_income_detail").attr("company_id_name", company_id_name)
        $("#btn_save_income_detail").attr("income_at", income_at)
        $("#btn_save_income_detail").attr("income_remark", income_remark)


        var income_detail = $("#"+income_input_id).attr("income_detail")
        console.log(income_detail)
        if (income_detail!=undefined){

              var  income_detail_json =  JSON.parse(income_detail)
              $.each(income_detail_json,function(i,val_detail){
                console.log(val_detail["detail_id"])
                      var curr_service_id = $(this).attr("service_id")
                      $("#txt_income_detail_"+val_detail.service_id).attr("detail_id",val_detail["detail_id"])
                      $("#txt_income_detail_"+val_detail.service_id).val(val_detail["service_money"])
                 //   console.log(val_detail["service_money"]+"service_id______"+val_detail["service_id"])
              })

        }



        $("#income_detail_modal1").modal("show")
       $("#income_modal1").modal("hide")

     })

     $("#btn_save_income_detail_back").on("click",function(){
          $("#income_detail_modal1").modal("hide")
       $("#income_modal1").modal("show")
     })

     $("#btn_save_income_detail").on("click",function(){
           var company_id = $(this).attr('company_id')
           var income_id = $(this).attr("income_id")
           var income_name = $(this).attr("income_name")
           var income_num = $(this).attr("income_num")
           var parent_id = $(this).attr('parent_id')
           var pay_type_id = $(this).attr('pay_type_id')
           var pay_type_name = $(this).attr('pay_type_name')
           var company_id_name = $(this).attr('company_id_name')
           var income_at = $(this).attr('income_at')
           var income_remark = $(this).attr("income_remark")
           var income_input_id = $(this).attr("income_input_id")


          jsonArr = []
          income_amount = 0
          $("input[name=txt_income_detail]").each(function (i, obj) {

            var service_id = $(obj).attr('service_id')
            var service_name = $(obj).attr("service_name")
            var service_money = $(obj).val()
            var detail_id = $(obj).attr("detail_id")

            if (detail_id ==undefined){
                detail_id = 0
            }
            if ($(obj).val() != "") {

              income_amount = income_amount + Number($(obj).val())
              jsonArr.push({
                service_id: service_id,
                service_name: service_name,
                service_money : service_money,
                detail_id:detail_id

              });
            }
          })



        if (jsonArr.length > 0) {
             $("#"+ income_input_id).attr("income_detail",   JSON.stringify(jsonArr))
             $("#"+ income_input_id).val(income_amount)
             $("#income_modal1").modal("show")
          }
     })

    $("#new_income_other1").on("click",function(){
        // getALlIncome(1)
        //$("#parent_id_hide").val("0")
        $("input[name=income_val]").removeAttr("disabled","disabled")
        $(".a_income_pay_detail").show()
        $("#btn_save_income").attr("income_a_type","add")
        $("#btn_save_income").attr("parent_id_hide","0")
         $("#btn_save_income").removeAttr("disabled")
        $("#income_a_type").val("add")
        $("input[name=txt_income_detail]").val("")
        var json_income_arr
        $.get("/project?tag=income_detail_by_project",
          {"project_id":{{t_project.id}},"_xsrf":_xsrf},function(result){
              json_income_arr = result.incomes
            //  console.log(result.incomes.length)
                if(result.incomes.length==0){
                      $.each($("input[name=income_val]"),function(i,val){
                              income_id= $(this).attr("income_id")
                              income_num  = $(this).attr("num")
                              income_name = $(this).attr("income_name")

                            //  alert(income_num)
                              if(income_num==1 ){
                                  $(this).removeAttr("disabled","disabled")
                              }else{


                                  $("#income_" + income_id + "_" + income_num).css('background-color', '#D6EAF8');
                                  $("#a_income_" + income_id+ "_" + income_num).hide()
                                 $("#income_"+val.income_id+"_"+val.income_num).attr("parent_id","0")

                              }
                               if(income_name=="合同定金" || income_name=="尾款"){
                                          $(this).attr("disabled","disabled")
                               }






                        })

                }else{
                    //    $("input[name=income_val]").removeAttr("disabled","disabled")
                        $.each(result.incomes,function(i,val){
                          $("#income_"+val.income_id+"_"+val.income_num).attr("income_id",val.income_id)
                          $("#income_"+val.income_id+"_"+val.income_num).attr("income_name",val.income_name)
                          $("#income_"+val.income_id+"_"+val.income_num).attr("parent_id",val.parent_id)

                         //if(val.income_name=="合同定金" || val.income_name=="尾款"){




                          $("#income_"+val.income_id+"_"+val.income_num).attr("disabled","disabled")



                          $("#income_"+val.income_id+"_"+val.income_num).attr("income_detail",JSON.stringify(val.income_detail))



                          $("#income_"+val.income_id+"_"+val.income_num).attr("income_num",val.income_num)
                          $("#income_"+val.income_id+"_"+val.income_num).val(val.income_money)
                         // $("#income_" + val.income_id + "_" + val.income_num).css('background-color', '#D6EAF8');
                          $("#a_income_" + val.income_id + "_" + val.income_num).hide()


                        })
                }

          },"json")


      $("#income_modal1").modal("show")
    })




     $("#a_add_team").on("click",function() {
               $("#team_modal1").modal("show")
     })

    $("#save_to_customer_msg").hide()

    $("#btn_save_to_back").on("click",function(){
         $('#modal_reject_remark').modal('show');
        $('#new_project_modal2').modal('hide');

    })

    $('#btn_save_to_customer').on("click",function () {


    $("#save_to_customer_msg").hide()
        var customer_company=$('#customer_company2').val();
        var company_uid=$('#company_uid').val();
        var comany_person=$('#comany_person').val();

        var company_created_day=$('#company_created_day').val();
        var company_expired_day=$('#company_expired_day').val();
        var company_fever  = $("#company_fever:checked").val();

        if (company_fever == undefined){
          company_fever = "0"
        }
        var zone = $("#zone").val();
        var city = $("#city").val();
        $.post("/project?tag=addto_customer",{"customer_company":customer_company,"company_uid":company_uid,
        "comany_person":comany_person,
        "company_created_day":company_created_day,
        "company_expired_day":company_expired_day,
        "company_fever":company_fever,
        "zone":zone,
        "city":city,
        "_xsrf":_xsrf,
        'project_id':{{t_project.id}},
        },function(result){
          if(result=="ok"){
             location.reload()
          }
          else{
              $("#save_to_customer_msg").html(result)
              $("#save_to_customer_msg").show()
          }
        })

    })
    $('select[name=note_chengjiao]').change(function () {
      if($(this).val()==''){
        $('#projects_lab').text('交代内容')
      $('#projects_note').text('交代事项')
      $('#btn_save_modal_note').removeAttr('is_chengjiao')
      $('#note_content').val($(this).val())
      }
      else{
      $('#projects_lab').text('成交内容')
      $('#projects_note').text('成交事项')
      $('#btn_save_modal_note').attr('is_chengjiao','1')
      $('#note_content').val($(this).val())
      }
     })
    $('#btn_save_modal_note').on("click",function(){
        var note_content=$('#note_content').val();
        var is_check=$('input[name=check_radio]:checked').val();
        var note_id=$(this).attr('note_id');
        var is_chengjiao=$(this).attr('is_chengjiao')
        if(note_content!=''){
          $(this).text('保存中...')
          $(this).attr('disabled','disabled')
            $.post(
            '/project?tag=project_note',
            {
              'note_id':note_id,
              'note_content':note_content,
              'project_id':"{{t_project.id}}",
              'is_chengjiao':is_chengjiao,
              'is_check':is_check,
              "_xsrf":_xsrf
            },function (result) {
              location.reload()
             }
          )
        }
    })
    $('#btn_save_companyinfo').on("click",function () {
        var customer_company=$('#customer_company2').val();
        var company_uid=$('#company_uid').val();
        var comany_person=$('#comany_person').val();
        var true_reg_addr =$("#true_reg_addr").val()
        var company_created_day=$('#company_created_day').val();
        var company_expired_day=$('#company_expired_day').val();
        var company_fever  = $("#company_fever:checked").val();
        var zone = $("#zone").val();
        var city = $("#city").val();
        var btype_id_name=$(this).attr('btype_id_name')
        if (btype_id_name=='公司注销'){
          if (company_fever == undefined){
          company_fever = "0"
            }
          $.post("/project?tag=set_companyinfo",{"customer_company":customer_company,"company_uid":company_uid,
          "comany_person":comany_person,
          "company_created_day":company_created_day,
          "company_expired_day":company_expired_day,
          "company_fever":company_fever,
          "zone":zone,
          "true_reg_addr":true_reg_addr,
          "city":city,
          "_xsrf":_xsrf,
          'project_id':"{{t_project.id}}",
          },function(result){
            location.reload()
          })
        }
        else{
        if (company_fever == undefined){
          company_fever = "0"
        }
        if (zone=="0"){
           $("#save_to_customer_msg").show()
           $("#zone").focus()
            $("#save_to_customer_msg").html("公司所属区域不能为空哦.")
        }else if(customer_company==""){
          $("#save_to_customer_msg").show()
           $("#customer_company2").focus()
            $("#save_to_customer_msg").html("公司名不能为空哦.")
        }
         else if (company_uid==""){
           $("#save_to_customer_msg").show()
           $("#company_uid").focus()
            $("#save_to_customer_msg").html("统一社会信用代码不能为空哦.")
        }
       else if (true_reg_addr==""){
           $("#save_to_customer_msg").show()
           $("#true_reg_addr").focus()
            $("#save_to_customer_msg").html("注册地址不能为空哦")
        }

        else if (company_uid==""){
           $("#save_to_customer_msg").show()
           $("#company_uid").focus()
            $("#save_to_customer_msg").html("统一社会信用代码不能为空哦.")
        }
      else if (comany_person==""){
           $("#save_to_customer_msg").show()
           $("#comany_person").focus()
            $("#save_to_customer_msg").html("法人不能为空哦.")
        }
        else if (company_created_day==""){
           $("#save_to_customer_msg").show()
           $("#company_created_day").focus()
            $("#save_to_customer_msg").html("公司成立日期不能为空哦.")
        }
        else{
          $.post("/project?tag=set_companyinfo",{"customer_company":customer_company,"company_uid":company_uid,
          "comany_person":comany_person,
          "company_created_day":company_created_day,
          "company_expired_day":company_expired_day,
          "company_fever":company_fever,
          "zone":zone,
          "true_reg_addr":true_reg_addr,
          "city":city,
          "_xsrf":_xsrf,
          'project_id':"{{t_project.id}}",
          },function(result){
            location.reload()
          })
        }
        }
    })

    $("#query_project").on("click",function(){
                        var key = $("#key").val()
                   $.get("project?tag=query_project",{"key":key,'project_id':{{t_project.id}}},function(result){
                           $("#show_projects").html(result)
                   })
    })

$("#btn_save_project3").on("click",function(){

                 var choice_pid = $("input[name=project_choice]:checked").val()

                 if(choice_pid==undefined){
                         alert("请选择业务")
                         return false
                 }else{
                     $.post("project?tag=relation_project",
                     {
                     'project_id':{{t_project.id}},
                     "other_project_id":choice_pid,
                     "_xsrf":_xsrf},
                     function(result){
                            if(result==1){
                              alert('该订单已关联')
                            }
                            else{
                             console.log(result)
                             location.reload()
                            }
                     })


                 }
            })

          $('.relation_btn').on("click",function () {

              if(confirm("确认移除关联吗?")){
                      var id = $(this).attr('id')
                      $.post(
                        "project?tag=delete_relation_project",
                        {
                          "project_id": {{ t_project.id }},
                    "_xsrf": _xsrf,
                      "id": id
                  }, function (result) {
                    location.reload()
                  }
                  )
              }


           })


            $(".btn_cq_rec_order").on("click",function(){

                mp_id  = $(this).attr("mp_id")
                guid = $(this).attr('guid')
                update_id = $(this).attr("update_id")
                mid= $(this).attr("mid")
                mtype = $(this).attr("mtype")
                is_close = $(this).attr('is_close')
                btype_id_name=$(this).attr("btype_id_name")
                if(is_close==undefined){
                  is_close = "0"

                }else{
                  if(!confirm("确认直接结束该业务吗?")){

                        return false
                  }
                }
                if (mid==undefined){
                  mid = 0
                }

              $("#accept_project_transfile").attr("mid",mid)
               $("#accept_project_transfile").attr("mp_id",mp_id)

                $.post("milepost?tag=confirm",
                {"is_close":is_close,"mid":mid,"update_id":update_id,"mp_id":mp_id,"guid":guid,
                "_xsrf":_xsrf,'project_id':"{{t_project.id}}","btype_id_name":btype_id_name},function(result){

                  if(result=='-100'){
                    $('#exampleModalLongTitle_company').text('请填写办结公司信息')
                    $('#exampleModalLongTitle_company').addClass('text-danger')

                    $("#btn_modify2").attr("mp_id",mp_id)
                    $('#new_project_modal2').modal('show');
                  // $("#btn_modify2").click()
                  }
                  else if(result=='wrong_tran'){
                      //$("# btn_projects_transfile").click($()
                     mp_id = $("#btn_projects_transfile").attr("mp_id")
                     $("#btn_save_projects_transfile").attr("mp_id",mp_id)
                    $('#projects_transfile_modal').modal('show');
                  }
                  else if(result=='wrong_tran_sales'){
                      //$("# btn_projects_transfile").click($()
                   //  var mp_id = $("#btn_projects_transfile_sales").attr("mp_id")
                     var  mid = $("#btn_projects_transfile_sales").attr("mid")
                     var  mtype = $("#btn_projects_transfile_sales").attr("mtype")
                     $("#btn_save_projects_transfile_sales").attr("mtype",mtype)
                     $("#btn_save_projects_transfile_sales").attr("mid",mid)
                    $('#projects_transfile_modal_sales').modal('show');
                  }
                  else if(result=='not_confirm_sales'){

                      //$("# btn_projects_transfile").click($()
                     var   mp_id = $("#btn_sales_check_cg_list").attr("mp_id")
                     var  mid = $("#btn_sales_check_cg_list").attr("mid")
                     var  mtype = $("#btn_sales_check_cg_list").attr("mtype")

                     $("#btn_save_to_back_transfile").attr("mtype",mtype)
                     $("#btn_save_to_back_transfile").attr("mid",mid)

                     $("#btn_save_reject_remark").attr("mtype",mtype)
                     $("#btn_save_reject_remark").attr("mid",mid)
                     $("#btn_save_reject_remark").attr("tag","transition")
                     $("#btn_save_reject_remark").attr("mp_id",mp_id)

                    $('#projects_transfile_modal_sales').modal('show');

                  }
                  else if(result=='not_confirm_cg'){

                      //$("# btn_projects_transfile").click($()
                   //  var mp_id = $("#btn_projects_transfile_sales").attr("mp_id")
                   //  var  mid = $("#btn_modify_tran").attr("mid")
                    /// var  mtype = $("#btn_modify_tran").attr("mtype")
                     var   mp_id = $("#btn_check_cq_list").attr("mp_id")
                     var  mid = $("#btn_check_cq_list").attr("mid")
                     var  mtype = $("#btn_check_cq_list").attr("mtype")
                     $("#btn_save_to_back_transfile").attr("mtype",mtype)
                     $("#btn_save_to_back_transfile").attr("mid",mid)

                     $("#accept_project_transfile").attr("mid",mid)
                     $("#accept_project_transfile").attr("mtype",mtype)



                     $("#btn_save_reject_remark").attr("mtype",mtype)
                     $("#btn_save_reject_remark").attr("mid",mid)
                     $("#btn_save_reject_remark").attr("tag","transition")
                     $("#btn_save_reject_remark").attr("mp_id",mp_id)

                    $('#projects_transfile_modal').modal('show');



                  }
                  else{
                   location.reload()
                  }
                })

           })


            $(".btn_cq_rec_order_remark").on("click",function(){

                  mp_id  = $(this).attr("mp_id")
                  guid = $(this).attr('guid')
                  remark = $(this).attr('remark')
                  $("#milepost_remark").val(remark)
                  $("#btn_save_milepost").attr("mp_id",mp_id)
                  $("#btn_save_milepost").attr("guid",guid)
                  $("#modify_milepost_modal").modal('show')
            })

            $("#btn_save_milepost").on("click",function(){
                   milepost_remark =  $("#milepost_remark").val()

                mp_id  = $(this).attr("mp_id")
                guid = $(this).attr('guid')

                $.post("milepost?tag=update_remark",{"mp_id":mp_id,"guid":guid,"_xsrf":_xsrf,"milepost_remark":milepost_remark,'project_id':{{t_project.id}}},function(result){

                  location.reload()
                })


            })

        $(".modify_transition_mobile").on("click",function(){
          transition_id = $(this).attr("transition_id")
          $.get("/project?tag=qrcode",
          {"id":'{{t_project.id}}',"guid":'{{t_project.guid}}',"trans_id":transition_id,"qtag":"trans"},
          function(result){

              $("#show_qrcode").html(result)
          })
            $("#a_add_trans_modal_upload").modal('show')
      })

      $('#project_type_detail_btn').on('click',function () {
        var name=$(this).attr('name');
        if(name=='income_detail'){
        $('div[id=projects_type_detail]').hide();
        $('div[id=income_detail]').show();
        $(this).text('查看');
        $(this).attr('name','');
        $('#project_type_insert').hide();
        $('#btn_save_type_detail').attr('id','btn_save_income_servie');
        }else{
        $('div[id=income_detail]').hide();
        $('div[id=projects_type_detail]').show();
        $(this).text('返回');
        $(this).attr('name','income_detail');
        $('#btn_save_income_servie').attr('id','btn_save_type_detail');
        $('#project_type_insert').show();
        }
       })

       $('body').on('click','#btn_save_type_detail',function () {
        var numArr = []; // 定义一个空数组
        var txt = $('.row').find(':text[name=income_name]'); // 获取所有文本框
        for (var i = 0; i < txt.length; i++) {
             var id=txt.eq(i).attr('id')
             if(typeof(id)!='undefined'){
              numArr.push([id,txt.eq(i).val()]);
             }else{
              numArr.push(txt.eq(i).val());
             }
        }
        numArr=numArr.join(',')
        $.post(
          "/project?tag=update_project_type",
          {
            "numarr":numArr,
            "_xsrf":_xsrf
          },function (result) {
            location.reload()
           }
        )
        })
        $('#project_type_insert').on('click',function () {
                $('#service_modal1').modal('hide');
               setTimeout(
              function () {  $('#insert_project_type_modal').modal('show');},450);


         })

        $('#btn_save_project_type_name').on('click',function () {
            var name=$('#project_type_name').val();

            $.post(
              '/project?tag=insert_project_type',
              {
                'name':name,
                '_xsrf':_xsrf
              },function (result) {
                location.reload();
               }
            )
         })

      $('body').on('click','#btn_save_modal_note_confirm',function () {
        check_val=[]
        var obj=$('input[name=check_note]');
        for (k in obj){
          if(obj[k].checked){
            check_val.push(obj[k].value);
          }
        }
        check_val=check_val.join(',')

        $.post(
          '/project?tag=projects_note_confirm',
          {
            'check_val':check_val,
            '_xsrf':_xsrf
          },function (result) {
            location.reload()
           }
        )
       })
       obj=$('input[name=check_note]')
       if(obj.length<1){
        $('#not_project_note').show();
       }else{
        $("#a_read_note").click();
       }


       $('.btn_projects_transfile').on('click',function () {
          var mp_id = $(this).attr("mp_id")
          $("#btn_save_projects_transfile").attr("mp_id",mp_id)
           $.post('/project?tag=check_transfile',{
              '_xsrf':_xsrf,
              "project_id":'{{t_project.id}}',
              'pm_id':mp_id,
                mtype:1
             },function (result) {
                  if(result ==0){
                      $('#projects_transfile_modal').modal('show')

                      $('input[name=check_projects_type]').prop('checked', false);
                  } else{
                      $('#projects_transfile_modal').modal('show')
                  }


              }
           )
        })

//btn_projects_transfile_sales
//btn_save_projects_transfile_sales

       $('#btn_projects_transfile_sales').on('click',function () {

         // $("#btn_save_projects_transfile_sales").attr("mp_id",mp_id)
          mid = $(this).attr("mid")
          mtype = $(this).attr("mtype")

           $.post('/project?tag=check_transfile',{
              '_xsrf':_xsrf,
              "project_id":'{{t_project.id}}',
              'pm_id':mid,
              'mtype':mtype
             },function (result) {
                  if(result ==0){
                      $('#projects_transfile_modal_sales').modal('show')
                      $('input[name=check_projects_type_sales]').prop('checked', false);
                  } else{
                      $('#projects_transfile_modal_sales').modal('show')

                  }


              }
           )
        })









        $('.btn_modify_tran').on('click',function () {
          //  var mp_id = $(this).attr("mp_id")
          var pm_id = $(this).attr("mp_id")
          var mtype=$(this).attr("mtype")
          var mid =$(this).attr("mid")

          $("#btn_save_to_back_transfile").attr("pm_id",pm_id)
          $("#btn_save_to_back_transfile").attr("mtype",mtype)
          $("#btn_save_to_back_transfile").attr("mid",mid)
          $("#btn_save_projects_transfile").attr("pm_id",pm_id)

          $("#btn_save_reject_remark").attr("tag","transition")
          $("#btn_save_reject_remark").attr("mtype",mtype)
          $("#btn_save_reject_remark").attr("pm_id",pm_id)
          $("#btn_save_reject_remark").attr("mid",mid)


          $("#accept_project_transfile").attr("mp_id",pm_id)
          $("#accept_project_transfile").attr("mid",mid)

          if(mtype=="1"){
              $('#projects_transfile_modal').modal('show')
          }
          else if(mtype=="2"){
              $('#projects_transfile_modal_sales').modal('show')
          }

        })


      $("#accept_project_transfile").on("click",function(){
           mid= $(this).attr("mid")

           mtype=$(this).attr("mtype")
           $.post(
                    '/project?tag=accept_project_transfile',
                    {
                      '_xsrf':_xsrf,
                      "project_id":'{{t_project.id}}',
                      'pm_id':mid,
                      'mtype':mtype
                    },function (result) {
                     // console.log(result)
                    location.reload()
                      }
                  )
      })
     $("#accept_project_transfile_sales").on("click",function(){
           mid= $(this).attr("mid")
           mtype=$(this).attr("mtype")



           $.post(
                    '/project?tag=accept_project_transfile',
                    {
                      '_xsrf':_xsrf,
                      "project_id":'{{t_project.id}}',
                      'pm_id':mid,
                      'mtype':mtype
                    },function (result) {
                     // console.log(result)
                    // $(".btn_cq_rec_order").click()
                     location.reload()
                      }
                  )
      })
      $('#btn_save_projects_transfile_sales').on('click',function () {
                var type_ids=[]
                var type_names=[]
                var remark=$('#projects_type_remark_sales').val();
                $('input[name=check_projects_type_sales]:checked').each(function () {
                      type_ids.push($(this).val());
                      type_names.push($(this).attr('income_name'))
                })

                type_ids=type_ids.join(',')
                type_names=type_names.join(',')
              //  mp_id= $(this).attr("mp_id")
                  mid = $("#btn_projects_transfile_sales").attr("mid")

                  mtype=$("#btn_projects_transfile_sales").attr("mtype")
                  $.post(
                    '/project?tag=add_project_transfile',
                    {
                      '_xsrf':_xsrf,
                      'type_ids':type_ids,
                      'type_names':type_names,
                      'remark':remark,
                      "project_id":'{{t_project.id}}',
                      'pm_id':mid,
                      'mtype':mtype
                    },function (result) {
                     // console.log(result)
                        location.reload()
                      }
                  )
        })

      $('#btn_save_projects_transfile').on('click',function () {
                var type_ids=[]
                var type_names=[]
                var remark=$('#projects_type_remark').val();
                $('input[name=check_projects_type]:checked').each(function () {
                      type_ids.push($(this).val());
                      type_names.push($(this).attr('income_name'))
                })
                type_ids=type_ids.join(',')
                type_names=type_names.join(',')
                mp_id= $(this).attr("mp_id")

                  $.post(
                    '/project?tag=add_project_transfile',
                    {
                      '_xsrf':_xsrf,
                      'type_ids':type_ids,
                      'type_names':type_names,
                      'remark':remark,
                      "project_id":'{{t_project.id}}',
                      'pm_id':mp_id,
                      'mtype':1
                    },function (result) {
                      console.log(result)
                    location.reload()
                      }
                  )
           })

      $('#btn_save_to_back_transfile').on('click',function () {

       mtype = $(this).attr('mtype')
       // $("#btn_save_reject_remark").attr("mtype",mtype)
        if(mtype=="1"){
             $('#projects_transfile_modal').modal('hide');
        }else if(mtype=="2"){
             $('#projects_transfile_modal_sales').modal('hide');

        }



       // $('#reject_remark').attr({'id':'reject_remark1','name':'reject_remark'});

        $("#btn_save_to_back_transfile").attr("tag","transition")

        //$('#btn_save_reject_remark').attr('id','btn_save_reject_remark1');
        $('#modal_reject_remark').modal('show');


       })


      $('#btn_save_to_back_transfile_sales').on('click',function () {
        $('#projects_transfile_modal_sales').modal('hide');
       // $('#reject_remark').attr({'id':'reject_remark1','name':'reject_remark'});

        $("#btn_save_to_back_transfile_sales").attr("tag","transition")

        //$('#btn_save_reject_remark').attr('id','btn_save_reject_remark1');
        $('#modal_reject_remark_sales').modal('show');
       })






      $("#btn_save_reject_remark").on("click",function () {
              var reject_remark=$('#reject_remark').val();
              var mid = $(this).attr("mid")
              var pm_id = $(this).attr("pm_id")
              var tag = $(this).attr("tag")
              if(reject_remark==""){
                  alert("驳回内容不能为空哦.")
                  return false


              }else{
              if (tag=="transition"){
                  mtype =$(this).attr('mtype')
                    $.post(
                      '/project?tag=reject_transfile',
                      {
                        '_xsrf':_xsrf,
                        'reject_remark':reject_remark,
                        'project_id':'{{t_project.id}}',
                        'pm_id':mid,
                        'mtype':mtype
                      },function (result) {
                        location.reload()
                        }
                    )
              }else if (tag=="companyinfo"){
                  $.post(
                    "/project?tag=reject",
                    {
                      "pm_id":pm_id,
                      "mid":mid,
                      "_xsrf":_xsrf,
                      'reject_remark':reject_remark,
                      "project_id":'{{t_project.id}}'
                    },function (result) {
                      location.reload()
                    }
                  )
}

              }
       })

      $('.a_change_note').on('click',function () {
        $('.checkdiv').hide();
        $("#projects_note").text('交代事项')
        $("#note_content").val($(this).attr('note'))
        $('#btn_save_modal_note_confirm').text('保存')
        $('#btn_save_modal_note_confirm').attr({'id':'btn_save_modal_note','note_id':$(this).attr('id')});
        $('#projects_note_confirm_content').hide();
        $('#projects_note_content').show();
        $("#modal_note").modal("show");
       })

       $('.cancel_note').on('click',function () {
         var note_id=$(this).attr('note_id')
         var is_cancel=$(this).attr('is_cancel')
         if(is_cancel==0){
          $.post(
            '/project?tag=project_note',
            {
              'note_id':note_id,
              'is_cancel':1,
              "_xsrf":_xsrf
            },function (result) {
              location.reload()
             }
          )
        }else{
          $.post(
            '/project?tag=project_note',
            {
              'note_id':note_id,
              'is_cancel':0,
              "_xsrf":_xsrf
            },function (result) {
              location.reload()
             }
          )
        }
        })


var tmpl = '<br><li style=" width:100%;height:20px;background-image:url(#url#); background-size:15px 10px;display:block;">#url1#</li>',
    all_files=[]
    $gallery = $("#gallery"),
    $galleryImg = $("#galleryImg"),
    $uploaderInput = $("#uploaderInput"),
    $uploaderFiles = $("#uploaderFiles");
    $uploaderInput.on("change", function(e) {
                var src, url = window.URL || window.webkitURL || window.mozURL,
                files = e.target.files;
                for(var i = 0, len = files.length; i < len; ++i) {
                    var file = files[i];
                    if(url) {
                        // src = url.createObjectURL(file);
                        src=file.name;
                    } else {
                        src = e.target.result;
                    }

                    $uploaderFiles.append($(tmpl.replace('#url1#', src)));
                    all_files.push(file)
                }

            });
    $uploaderInput1 = $("#uploaderInput1"),
    $uploaderFiles1 = $("#uploaderFiles1");
    $uploaderInput1.on("change", function(e) {
                var src, url = window.URL || window.webkitURL || window.mozURL,
                files = e.target.files;
                for(var i = 0, len = files.length; i < len; ++i) {
                    var file = files[i];
                    if(url) {
                        // src = url.createObjectURL(file);
                        src=file.name;
                    } else {
                        src = e.target.result;
                    }

                    $uploaderFiles1.append($(tmpl.replace('#url1#', src)));
                    all_files.push(file)
                }

            });
    $('#btn_save_trans1').on('click',function () {
     var trans_remark=$("#trans_remark1").val();
     var transition_id=$(this).attr('transition_id')
     var formData = new FormData();
          for(var i=0,len=all_files.length;i<len;i++){
            formData.append('file'+i,all_files[i])
          }
         formData.append("project_id", {{t_project.id}})
         formData.append('_xsrf', _xsrf)
         formData.append("trans_remark",trans_remark)
         formData.append('len',all_files.length)
         formData.append('transition_id',transition_id)
         $(this).text('保存中')
         $(this).attr('disabled','disabled')
          $.ajax({
                url: '/project?tag=add_tran1',
                type: 'POST',
                data: formData,
                processData: false,  // tell jQuery not to process the data
                contentType: false,  // tell jQuery not to set contentType
                success: function (data) {
                  location.reload()

                }
              });


 })
 $('#a_check_note').on('click',function () {
   $('#modal_note_check').modal('show');
  })

  $('#btn_save_modal_note_check').on('click',function () {
    var all_is_check=[]
    $('input[id=check_note]:checked').each(function (idx) {
      all_is_check.push([$(this).attr("nid"),$(this).val(),$('textarea[idx='+idx+']').val()])
     })

      all_is_check=all_is_check.join('-')
     $.post(
       "/project?tag=check_note",
       {
         '_xsrf':_xsrf,
         'all_is_check':all_is_check,
         "project_id":{{t_project.id}}
       },function () {
         location.reload()
        }
     )

   })
  $('.a_add_addr_provider').on('click',function () {
    $('#btn_save_addr').attr({'addr_milepost_id':$(this).attr('id'),'addr_provider_id':$(this).attr('addr_provider_id')})
    $('#modal_addr').modal('show')
   })
  $('#search_addr').on('click',function () {
    var area=$('#area').val()
    var addr_type=$('#supply_addr_type').val()
    var provider=$('#provider').val()
    $.get(
      '/project?tag=search_addr',
      {
        'area':area,
        'addr_type':addr_type,
        'provider':provider
      },function (result) {
        $('#search_result').children().remove();
        item=result['addr_provider']
        if(item!=undefined){
          var text='<table class="table table-striped" style="font-size:80%;"><thead><tr><th>供应商</th>'+
            '<th>安排地址类型</th><th>区域</th><th>发票限量</th><th>担保事项</th><th></th></tr></thread><tbody>'
        for(var i=0;i<item.length;i++){
          text+='<tr><td>'+item[i].provider+'</td><td>'+item[i].addr_type+'</td><td>'+item[i].area+
            '</td><td>'+item[i].fp_limit+'</td><td>'+item[i].danbao_matter+
              '</td><td><input type="radio" name="choose_addr" value="'+item[i].id+'"></td></tr>'
        }
        $('#search_result').append(text)

        }else{
          $('#search_result').append('<br><span>没找到~</span>')

        }
       }
    )
   })

   $('#btn_choose_addr').on('click',function () {
     var  choose=$('input[name=choose_addr]:checked').val()
     d=new Date()
    if(choose==undefined){
      alert('请先选择')
    }
    else{
     $('#btn_save_addr').attr('addr_id',choose)
     $('#modal_addr').modal('hide')
    $('#addr_start_time').val(d.toLocaleDateString())
    d.setFullYear(d.getFullYear()+1)
    $('#addr_end_time').val(d.toLocaleDateString())
    $('#addr_shoufei').val('')
    $('#e_addr_start_time').hide()
    $('#e_addr_end_time').hide()
    $('#e_addr_shoufei').hide()
    $('#projects_addr').text('新增地址安排')
    $('#btn_save_addr').text('添加')
     setTimeout(
        function () {  $('#modal_addr1').modal('show');},450);

    }
    })
  $('.edit_addr').on('click',function () {
    var addr_shoufei=$(this).attr('addr_shoufei')
    var addr_start_time=$(this).attr('addr_start_time')
    var addr_end_time=$(this).attr('addr_end_time')
    var id=$(this).attr('id')
    $('#addr_start_time').val(addr_start_time)
    $('#addr_end_time').val(addr_end_time)
    $('#addr_shoufei').val(addr_shoufei)
    $('#btn_save_addr').attr('project_addr_id',id)
    $('#e_addr_start_time').hide()
    $('#e_addr_end_time').hide()
    $('#e_addr_shoufei').hide()
    $('#projects_addr').text('修改地址安排')
    $('#btn_save_addr').text('修改')
    $('#modal_addr1').modal('show')
   })
  $('#btn_save_addr').on('click',function () {
    var addr_start_time=$('#addr_start_time').val()
    var addr_end_time=$('#addr_end_time').val()
    var addr_shoufei=$('#addr_shoufei').val()
    var addr_id=$(this).attr('addr_id')
    var addr_milepost_id=$(this).attr('addr_milepost_id')
    var addr_provider_id=$(this).attr('addr_provider_id')
    var project_addr_id=$(this).attr('project_addr_id')
    if(addr_start_time==''){
      $('#e_addr_start_time').text('地址起始时间不能为空')
      $('#e_addr_start_time').show()
    }
    else if(addr_start_time==''){
      $('#e_addr_end_time').text('地址到期时间不能为空')
      $('#e_addr_end_time').show()
    }
    else if(addr_shoufei==''){
      $('#e_addr_shoufei').text('地址收费不能为空')
      $('#e_addr_shoufei').show()
    }
    else if(addr_shoufei!='' & isNaN(addr_shoufei)){
      $('#e_addr_shoufei').text('需填写数字')
      $('#e_addr_shoufei').show()
    }
    else{
      $(this).text('保存中')
      $(this).attr('disabled','disabled')
        $.post(
      '/project?tag=add_addr',
      {
        '_xsrf':_xsrf,
        'project_addr_id':project_addr_id,
        'addr_start_time':addr_start_time,
        'addr_end_time':addr_end_time,
        'addr_shoufei':addr_shoufei,
        'addr_id':addr_id,
        "project_id":"{{t_project.id}}",
        "addr_milepost_id":addr_milepost_id,
        "addr_provider_id":addr_provider_id
      },function (result) {
        location.reload()
       }
    )


  }
   })

  $('.confirm_addr').on('click',function () {
    var confirm_id=$(this).attr('confirm_id')
    $.post(
      '/project?tag=add_addr',
      {
        '_xsrf':_xsrf,
        'confirm_id':confirm_id,
      },function (result) {
        location.reload()
       }
    )
   })
   $('#a_add_addr').on('click',function () {
     var id=$(this).attr('id')
     $.post(
       '/project?tag=add_addr_milepost',
       {
         '_xsrf':_xsrf,
         'project_id':"{{t_project.id}}",
         'step':1
       },function (res) {
         location.reload()
        }
     )
    })
  $('.addr_jiedan').on('click',function () {
    var id=$(this).attr('id')
    var addr_provider_id=$(this).attr('addr_provider_id')
    $(this).text('接单中')
    $(this).attr('disabled','disabled')
      $.post(
       '/project?tag=add_addr_milepost',
       {
         '_xsrf':_xsrf,
         'id':id,
         'project_id':"{{t_project.id}}",
         'addr_provider_id':addr_provider_id,
         'step':2
       },function (res) {
         location.reload()
        }
     )

   })
   $('.addr_remark').on('click',function () {
      $('#btn_save_addr_milepost').attr('addr_milepost_id',$(this).attr('id'))
     $('#addr_milepost_modal').modal('show')
    })

  $('#btn_save_addr_milepost').on('click',function () {
    var id=$(this).attr('addr_milepost_id')
    var remark=$('#addr_milepost_remark').val()
    $.post(
      '/project?tag=add_addr_milepost',
      {
        '_xsrf':_xsrf,
        'id':id,
        'remark':remark,
        'step':3
      },function (res) {
        location.reload()
       }
    )

  })
  $('.delete_addr_btn').on('click',function () {
    var id=$(this).attr('id')
    if(confirm('确定删除安排地址？')){

    $.post(
      '/project?tag=add_addr_milepost',
      {
        '_xsrf':_xsrf,
        'id':id,
        'project_id':"{{t_project.id}}",
        'step':4
      },function (result) {
        if(result['addr_provider']==null){
          location.reload()
        }else{
          location.href="/project?tag=show&guid={{t_project.guid}}&id={{t_project.id}}&addr_provider="+result['addr_provider'].id+"#addr_list"
        }
       }
    )
    }
   })
   $('#btn_edit_kehu').on('click',function () {
     $('#new_project_modal_kehu').modal('show')
    })

     $('#btn_add_xiezhu').on('click',function () {
        $('#xiezhu_title').text('发起协助')
        $('#xiezhu_content').val('')
        $('#btn_save_project_xiezhu').removeAttr('xiezhu_id')
        $('#btn_save_project_xiezhu').text('发起')
        $('#add_project_xiezhu').modal('show');
     })
     $('.edit_xiezhu_content').on('click',function () {
         var xiezhu_content=$(this).attr('xiezhu_content')
         var id=$(this).attr('id')
         var gs_id=$(this).attr('gs_id')
         $('#xiezhu_title').text('修改协助')
         $('#btn_save_project_xiezhu').text('修改')
         $('#xiezhu_content').val(xiezhu_content)
         $('#btn_save_project_xiezhu').attr('xiezhu_id',id)
         $('#btn_save_project_xiezhu').attr('gs_id',gs_id)
         $('#add_project_xiezhu').modal('show');
      })

    $('#btn_save_project_xiezhu').on('click',function () {
        var content=$('#xiezhu_content').val()
        var xiezhu_id=$(this).attr('xiezhu_id')
        var gs_id=$(this).attr('gs_id')
        if(content==''){
            alert('协助内容不能为空')
        }else{
          $(this).text('保存中')
          $(this).attr('disabled','disabled')
          $.post(
            '/project?tag=xiezhu_apply',
            {
                '_xsrf':_xsrf,
                'content':content,
                'xiezhu_id':xiezhu_id,
                'gs_id':gs_id,
                'project_id':"{%if t_project%}{{t_project.id}}{%end%}",
                'step':1
            },function (res) {
                if(res=='1'){
                    if(confirm('已审核通过不能修改')){
                        location.reload()
                    }
                  }
                else if(res=='-1'){
                  if(confirm('已被驳回不能修改')){
                        location.reload()
                    }
                }
                 else{
                location.reload()
                }
             }
        )

        }
     })
    $('.xiezhu_detail').on('click',function () {
        var id=$(this).attr('id')
            $.get(
                '/project?tag=xiezhu_apply_detail',
                {
                    'xiezhu_id':id
                },function (res) {
                    $('.detail_box').children().remove()
                    mileposts=res['mileposts']
                    var text=''
                    for( var i=0;i<mileposts.length;i++){
                        if(mileposts[i].type_name=='待审核' ){
                            text+='<p>流程1:工商专员'+mileposts[i].uid_name+'发起协助工单'+
                            '<span class="badge badge-success">'+mileposts[i].created_at+'</span></p>'
                            if(mileposts[i].confirm_at!=null){
                                text+='<p>流程2:'+mileposts[i+1].fz_name+'审核通过<span class="badge badge-success">'+
                                mileposts[i].confirm_at+'</span></p>'

                            }else if(mileposts[i].is_pass==0){
                                text+='<p>流程2:协助申请被驳回<span class="badge badge-success">'+mileposts[i].reject_at+'</span></p>'
                            }
                            else{
                                text+='<p>流程2:待经理审核中<span class="badge badge-success">'+mileposts[i].created_at+'</span></p>'

                            }
                            if(mileposts[i].remark!=''){
                                    text+='<p>备注：'+mileposts[i].remark+'</p>'
                            }
                        }
                        if(mileposts[i].type_name=='待接单'){
                            if(mileposts[i].created_at!=null & mileposts[i].confirm_at==null){
                                    text+='<p>流程3:待销售顾问'+mileposts[i].uid_name+'接单<span class="badge badge-success">'+
                                    mileposts[i].created_at+'</span></p>'
                            }else if(mileposts[i].confirm_at!=null){
                                text+='<p>流程3:'+mileposts[i].uid_name+'已接单，业务处理中'+
                                '<span class="badge badge-success">'+
                                mileposts[i].confirm_at+'</span></p>'
                            }
                        }
                        if(mileposts[i].type_name=='结果审核'){
                            text+='<p>流程4:销售顾问'+mileposts[i].uid_name+'申请办结<span class="badge badge-success">'+
                                mileposts[i].created_at+'</span></p>'
                            if(mileposts[i].is_pass==0){
                                text+='<p>流程5:'+mileposts[i].fz_name+'驳回办结<span class="badge badge-success">'+mileposts[i].reject_at+'</span></p>'
                            }
                            else if(mileposts[i].created_at!=null & mileposts[i].confirm_at==null){
                                text+='<p>流程5:待部门负责人确认<span class="badge badge-success">'+mileposts[i].created_at+'</span></p>'
                            } else if(mileposts[i].confirm_at!=null){
                                text+='<p>流程5：'+mileposts[i].fz_name+'确认办结<span class="badge badge-success">'+mileposts[i].confirm_at+'</span></p>'
                            }
                            if(mileposts[i].remark!=''){
                                    text+='<p>备注：'+mileposts[i].remark+'</p>'
                                }
                        }
                        if(mileposts[i].type_name=='已确认'){
                            if(mileposts[i].confirm_at==null){
                                text+='<p>流程6:待工商专员'+mileposts[i].uid_name+'确认<span class="badge badge-success">'+mileposts[i].created_at+
                                '</span></p>'
                            }else{
                                text+='<p>流程6:工商专员'+mileposts[i].uid_name+'确认业务已经办完<span class="badge badge-success">'+mileposts[i].confirm_at+
                                '</span></p>'

                            }
                        }


                    }
                    $('.detail_box').append(text)
                    $('#project_xiezhu_detail').modal('show')
                 }
            )
     })
     $('.manage_sh').on('click',function () {
         var id=$(this).attr('id')
         var gs_id=$(this).attr('gs_id')
         $('#btn_save_shenhe_xiezhu').attr('xiezhu_id',id)
         $('#btn_save_shenhe_xiezhu').attr('gs_id',gs_id)
         $('#shenhe_xiezhu_modal').modal('show')
      })

    $("#btn_save_shenhe_xiezhu").on('click',function () {
        var is_pass=$('input[name=is_pass]:checked').val()
        var fenpei_xs_id=$('select[name=fenpei_xs]').val()
        var fenpei_xs_name=$('select[name=fenpei_xs] option:selected').text()
        var xiezhu_id=$(this).attr('xiezhu_id')
        var remark=$('#remark_xiezhu').val()
        var gs_id=$(this).attr('gs_id')

        if(is_pass==undefined){
            alert('请选择是否通过')
        }
        else if(is_pass=='1' &fenpei_xs_id==''){
            alert('请选择销售顾问')
        }
        else{
        $.post(
            '/project?tag=xiezhu_apply',
            {
                '_xsrf':_xsrf,
                'xiezhu_id':xiezhu_id,
                'gs_id':gs_id,
                'is_pass':is_pass,
                'fenpei_xs_id':fenpei_xs_id,
                'fenpei_xs_name':fenpei_xs_name,
                'remark':remark,
                'step':2
            },function (res) {
                location.reload()
             }
        )
        }
     })
    $('.xs_jiedan').on('click',function () {
        var xiezhu_id=$(this).attr('id')
        var xs_id=$(this).attr('xs_id')
        $.post(
            '/project?tag=xiezhu_apply',
            {
                '_xsrf':_xsrf,
                'xs_id':xs_id,
                'step':3
            },function (res) {
                location.reload()
             }
        )
     })
    $('.xs_banjie').on('click',function () {
        var xiezhu_id=$(this).attr('id')
        $('#xiezhu_zj').val($(this).attr('project_zj'))
        $('#btn_save_banjie_xiezhu').attr({'xiezhu_id':xiezhu_id,'is_pass':$(this).attr('is_pass'),'sh_id':$(this).attr('sh_id')})
        $('#banjie_xiezhu_modal').modal('show')
     })
     $('#btn_save_banjie_xiezhu').on('click',function () {
         var xiezhu_id=$(this).attr('xiezhu_id')
         var xiezhu_zj=$('#xiezhu_zj').val()
         var is_pass=$(this).attr('is_pass')
         var sh_id=$(this).attr('sh_id')
         $.post(
            '/project?tag=xiezhu_apply',
            {
                '_xsrf':_xsrf,
                'xiezhu_id':xiezhu_id,
                'xiezhu_zj':xiezhu_zj,
                'is_pass':is_pass,
                'sh_id':sh_id,
                'step':4
            },function (res) {
                location.reload()
             }
        )
      })
      $('.shenhe_banjie').on('click',function () {
          var xs_uid_name=$(this).attr('xs_uid_name')
          var xiezhu_zj=$(this).attr('xiezhu_zj')
          var sh_id=$(this).attr('sh_id')
          var xiezhu_id=$(this).attr('xiezhu_id')
          var gs_uid_name=$(this).attr('gs_uid_name')
          var gs_uid=$(this).attr('gs_uid')
          $('.xs_zj').children().remove()
          $('.xs_zj').append('<p>销售顾问'+xs_uid_name+'办理总结：</p><p>'+xiezhu_zj+'</p>')
          $('#btn_save_shenhe_banjie').attr({'sh_id':sh_id,'xiezhu_id':xiezhu_id,'gs_uid_name':gs_uid_name,'gs_uid':gs_uid})
          $('#shenhe_banjie_modal').modal('show')
       })
       $('#btn_save_shenhe_banjie').on('click',function () {
           var is_pass=$('#is_pass1:checked').val()
           var remark=$('#remark1').val()
           var sh_id=$(this).attr('sh_id')
           var xiezhu_id=$(this).attr('xiezhu_id')
           var gs_uid_name=$(this).attr('gs_uid_name')
           var gs_uid=$(this).attr('gs_uid')
           if(is_pass==undefined){
               alert('请选择是否通过')
           }else{
           $.post(
            '/project?tag=xiezhu_apply',
            {
                '_xsrf':_xsrf,
                'is_pass':is_pass,
                'remark':remark,
                'sh_id':sh_id,
                'xiezhu_id':xiezhu_id,
                'gs_uid_name':gs_uid_name,
                'gs_uid':gs_uid,
                'step':5
            },function (res) {
                location.reload()
             }
           )
        }
        })
        $('.gs_queren').on('click',function () {
            var queren_id=$(this).attr('id')
            $.post(
            '/project?tag=xiezhu_apply',
            {
                '_xsrf':_xsrf,
                'queren_id':queren_id,
                'step':6
            },function (res) {
                location.reload()
             }
           )
         })

        $('#relation_other_project').on('click',function () {
            $('.all_other_project').hide()
            $('.search_other_project').show()
            $('.modal-title_project').text('关联其他订单')
            $('#btn_save_relation').show()
            $('.relation_project_box').show()
            $('#btn_save_relation').attr('project_relation_id',$(this).attr('project_relation_id'))
            $('#modal_relation_other_project').modal('show')
         })
        $('#search_other_project').on('click',function () {
          var project_id=$('#search_other_project_id').val()
          var project_name=$('#search_other_project_name').val()

          if(project_id=='' & project_name==''){
            alert('请填写检索内容')
          }else{
          $.get(
            '/project?tag=search_relation_project',
            {
              'project_id':project_id,
              'project_name':project_name,
              'current_id':"{{t_project.id}}"
            },function (result) {
              $('.relation_project_box').children().remove()
              result=result['projects']
              var text=''
              if(result==''){
               text+='<p>没找到~</p>'
              }
              else{
              text+='<form><table><thread><tr><th>订单编号</th><th>公司名称</th><th width="35%">业务内容</th><th></th></tr></thread><tbody>'
              for(var i=0;i<result.length;i++){
                  text+='<tr><td>'+result[i].id+'</td><td>'+result[i].customer_company+'</td><td>'+
                  result[i].project_name+'</td><td>'

                  if(result[i].relation_id==null || (result[i].customer_company=="{{t_project.customer_company}}"&&result[i].is_inside==0)){
                    if(result[i].relation_id!=null){
                      
                      text+='<input class="relation_id" project_relation_id="'+result[i].relation_id+'" name="relation_id" type="radio" value="'+result[i].id+'"></td></tr>'
                    }else{
                  text+='<input class="relation_id" name="relation_id" type="radio" value="'+result[i].id+'"></td></tr>'}}
                  else{
                    text+='已关联</td></tr>'
                  }
              }
              text+='</tbody></table></form>'
              }
              $('.relation_project_box').append(text)
             }
            )
          }
         })

    

        $('#btn_save_relation').on('click',function () {
              var be_relation_id=$('.relation_id:checked').val()
              var be_relation_project_id=$('.relation_id:checked').attr('project_relation_id')
              var id=$(this).attr('project_relation_id')
              if(be_relation_id==undefined){
                alert('未选择关联订单')
              }
              else if(be_relation_id=='{{t_project.id}}'){
                alert('不能关联当前订单')
              }
              else{
              $.post(
                '/project?tag=project_relation',
                {
                  '_xsrf':_xsrf,
                  'relation_id':"{{t_project.id}}",
                  'be_relation_id':be_relation_id,
                  'id':id,
                  'be_relation_project_id':be_relation_project_id
                },function (result){
                  if(result=='-1'){
                    if(confirm('该订单已经关联过了')){
                    }
                  }
                  else if(result=='-2'){
                    if(confirm('不能关联公司名不一样的订单')){
                    }
                    }
                  else{
                  location.reload()
                  }
                 }
              )
              }
         })

        $('.edit_relation_project').on('click',function () {
          $('#btn_save_relation').attr({'projects_relation_id':$(this).attr('id')})
          $('#modal_relation_other_project').modal('show')
         })
        $("#relation_other_project_detail").on('click',function () {
          $('.all_other_project').show()
            $('.search_other_project').hide()
            $('.modal-title_project').text('关联订单')
            $('.relation_project_box').hide()
            $('#btn_save_relation').hide()
            $('#modal_relation_other_project').modal('show')
         })
        $('.delete_relation_ids').on('click',function () {
          var relation_id=$(this).attr('relation_id')
          var id=$(this).attr('id')
          if(confirm('确定删除关联订单'+relation_id+'?')){
            $.post(
              '/project?tag=delete_relation',
              {
                '_xsrf':_xsrf,
                'id':id,
                'relation_id':relation_id
              },function (res) {
                location.reload()
               }
            )
          }
         })
      $('#btn_delete_project').on('click',function () {
        if(confirm('删除订单{{t_project.id}}？')){
          if(confirm('确定删除？')){
            $.post(
          '/project?tag=delete_project',
          {
            '_xsrf':_xsrf,
            'project_id':"{{t_project.id}}",
            'guid':"{{t_project.guid}}"
          },function (res) {
            location.reload()
           }
        )


        }
        }

       })
       $('.add_to_print').on('click',function () {
         $.post(
           '/project?tag=project_print',
           {
             '_xsrf':_xsrf,
             'id':$(this).attr('id')
           },function (res) {
             location.reload()
            }
         )
        })
        $('.delete_from_print').on('click',function () {
         $.post(
           '/project?tag=project_print',
           {
             '_xsrf':_xsrf,
             'delete_id':$(this).attr('id')
           },function (res) {
             location.reload()
            }
         )
        })
      $('#delete_company_history').on('click',function(){
        if(confirm('是否删除公司曾用名?')){
          $.post(
            '/project?tag=delete_company_history',
            {
              '_xsrf':_xsrf,
              'project_id':"{{t_project.id}}"
            },function (res) {
              location.reload()
             })
        }
      })
      $(".check_express").on('click',function () {
        $("#btn_check_express").attr('express_id',$(this).attr('id'))
        $("#check_express_modal").modal("show")
     })
     $(".confirm_express").on('click',function () {
        $("#btn_confirm_express").attr('express_id',$(this).attr('id'))
        $("#confrim_express_modal").modal("show")
     })
     $('#btn_check_express').on('click',function () {
   var accept_state=$('#accept_state:checked').val()
   var accept_uid_remark=$('#accept_uid_remark').val()
   var express_id=$(this).attr('express_id')
  if(accept_state==undefined){
      $("#er_accept_state").text('请先选择')
      $("#er_accept_state").show()
  }else if(accept_state=='2' && accept_uid_remark==''){
    $("#er_accept_uid_remark").text('不通过需要填写备注')
      $("#er_accept_uid_remark").show()
  }else{
    $.post('/project?tag=check_express',
    {
      '_xsrf':_xsrf,
      'accept_state':accept_state,
      'accept_uid_remark':accept_uid_remark,
      'express_id':express_id
    },function (result) {
      location.reload()
     })
  }

  })
  $('#btn_confirm_express').on("click",function () {
    var express_number=$("#express_number").val()
    var send_at=$("#send_at").val()
    var express_id=$(this).attr('express_id')
    if(express_number==''){
      $('#er_express_number').text('快递单号不能为空')
      $('#er_express_number').show()
    }
    else if(send_at==''){
      $('#er_send_at').text('发件时间')
      $('#er_send_at').show()
    }
    else{
    $.post('/project?tag=confrim_express',
    { '_xsrf':_xsrf,
      'express_number':express_number,
      'send_at':send_at,
      'express_id':express_id
    },function (result) {
      location.reload()
     })
    }
 })
 $(".confirm_send_express").on('click',function(){
  $.post('/project?tag=confirm_send_express',
    { '_xsrf':_xsrf,
      'express_id':$(this).attr('id')
    },function (result) {
      location.reload()
     })
 })
 $("#choose_cutomer_addr_msg").on('click',function(){
   $('#choose_customer_addr_msg_modal').modal('show')
 })
 $('#btn__save_customer_addr_msg').on('click',function(){
   var customer_name=$('input[name=choose_customer_addr]:checked').attr('c_name')
   var customer_addr=$('input[name=choose_customer_addr]:checked').attr('addr')
   var customer_tel=$('input[name=choose_customer_addr]:checked').attr('tel')
   $('#rec_name').val(customer_name)
   $('#rec_tel').val(customer_tel)
   $('#rec_addr').val(customer_addr)
   $('input[name=save_customer_add_msg]').prop('checked',false)
   $('#choose_customer_addr_msg_modal').modal('hide')
   })
   $('#choose_customer_addr_msg_modal').on('hidden.bs.modal', function () {
      document.getElementsByTagName('body')[0].className = 'fixed-nav sticky-footer bg-dark modal-open';
});

$('.filepath_detail').on('click',function () {
  uid_name=$(this).attr('uid_name')
  send_at_name=$(this).attr('send_at_name')
  if(uid_name=="{{name}}" || send_at_name=="{{name}}"){
    $('.file_label').show()
    $('.file').show()
    $('#btn_express_filepath').show()
  }else{
    $('.file_label').hide()
    $('.file').hide()
    $('#btn_express_filepath').hide()
  }
  $("#er_uploaderInput").hide()
    file_path=$(this).attr('file_path')
    file_path=file_path.split('|')
    showFiles=$('#showFiles')
    showFiles.children().remove()
    if(file_path!=''){
    for(var i=0;i<file_path.length-1;i++){
      f=file_path[i].split('/')

      showFiles.append('<br><li><a href="'+file_path[i]+'" download="'+f[f.length-1]+'">'+f[f.length-1].split('.')[0]+
      '</a><a href="'+file_path[i]+'" class="btn" target="_blank">查看</a></li>')
    }
    }
    else(
      showFiles.append('<p>还没有上传附件哦~</p>')
    )
    $("#btn_express_filepath").attr('express_id',$(this).attr('id'))
    $("#express_filepath_modal").modal("show")
 })
 $("#btn_express_filepath").on('click',function () {
    var formData = new FormData();
    for(var i=0,len=all_files.length;i<len;i++){
      formData.append('file'+i,all_files[i])
    }
    formData.append('len',all_files.length)
    formData.append('express_id',$(this).attr('express_id'))
    formData.append('_xsrf',_xsrf)
    if(all_files!=''){
      $(this).text('保存中')
      $(this).attr('disabled','disabled')
      $.ajax({
                url: '/project?tag=express',
                type: 'POST',
                data: formData,
                processData: false,  // tell jQuery not to process the data
                contentType: false,  // tell jQuery not to set contentType
                success: function (data) {
                  location.reload()

                }
              });
    }
    else{
      $("#er_uploaderInput").show()
    }

 })
 $('.confirm_banjie_btn').on('click',function () {
    $('#btn_confirm_banjie').attr('banjie_id',$(this).attr('id'))
    $('#btn_confirm_banjie').attr('guid',$(this).attr('guid'))
    $('input[name=confirm_banjie][value='+$(this).attr('confirm_banjie')+']').prop('checked',true)
    $('#remark_confirm_banjie').val($(this).attr('banjie_remark'))
    $("#confirm_banjie_modal").modal('show')
    })
    $('#btn_confirm_banjie').on('click',function () {
        confirm_banjie=$('input[name=confirm_banjie]:checked').val()
        banjie_remark=$('#remark_confirm_banjie').val()
        if(confirm_banjie==undefined){
            $('#er_confirm_banjie').text('未选择')
            $('#er_confirm_banjie').show()
        }else if(confirm_banjie=='2' && banjie_remark==''){
            $('#er_remark').text('选择异常需填写备注')
            $('#er_remark').show()
        }else{
        $.post('/project?tag=project_confirm_banjie',{
            '_xsrf':_xsrf,
            'confirm_banjie':confirm_banjie,
            'banjie_remark':banjie_remark,
            'guid':$(this).attr('guid'),
            'id':$(this).attr('banjie_id')
        },function (result) {
            location.reload()
         })
        }
     })

     $(".btn_save_logoff").on("click",function(){
       type_id=$(this).attr("type_id")
        mid = $(this).attr("mid")
        project_id = $(this).attr("project_id")
        $.post("/project?tag=set_logoff",{"project_id":project_id,"mid":mid,"type_id":type_id,'_xsrf':_xsrf},function(result){

          if(result=="0"){
            location.reload()
          }else{
            alert(result)
          }

        })


     })

        $(".btn_save_logoff_confirm").on("click",function(){
        logoff_id=$(this).attr("logoff_id")
        mid = $(this).attr("mid")
        project_id = $(this).attr("project_id")
        type_id = $(this).attr("type_id")
        $.post("/project?tag=confirm_logoff",{"project_id":project_id,"mid":mid,"type_id":type_id,'_xsrf':_xsrf,"logoff_id":logoff_id},function(result){

          if(result=="0"){
            location.reload()
          }else{
            alert(result)
          }
        })


     })
     $(".btn_save_logoff_reset").on("click",function(){
        logoff_id=$(this).attr("logoff_id")
        mid = $(this).attr("mid")
        project_id = $(this).attr("project_id")
        type_id = $(this).attr("type_id")
        $.post("/project?tag=reset_logoff",{"project_id":project_id,"mid":mid,"type_id":type_id,'_xsrf':_xsrf,"logoff_id":logoff_id},function(result){

          if(result=="0"){
            location.reload()
          }else{
            alert(result)
          }


        })


     })

     $("#edit_banjie").click(function () {
       $("#edit_banjie_modal").modal('show')
      })

    $('#btn_save_banjie_project').click(function () {
      customer_company = $("#banjie_customer_company").val();
      banjie_company_uid=$("#banjie_company_uid").val();
  is_update_company_customer=''
  is_update_company_project=''
  if(customer_company=='' || banjie_company_uid=='' ){
    alert("公司名称不能为空哦")
    return false
  }else{
    $.get("/project?tag=same_company",
                  {  "project_id":"{{t_project.id}}",
                    'customer_company':customer_company,
                    'company':"{{t_project.customer_company}}"
                  },function (res) {
                    if(res['customer']!=undefined && res['customer']!='-1' && res['customer']!='-2'){
                      if(confirm("公司名存在，是否要更改?")){

                        if(res['same_customer']!=undefined){
                        if(confirm('是否修改客户系统中相同公司的公司名？')){
                          is_update_company_customer=1
                        }
                        }
                        if(res['project']!=undefined){
                        if(confirm('是否修改确认单系统中其他相同公司的公司名？')){
                          is_update_company_project=1
                        }
                        }
                        $.post("/project?tag=modify1",{
                        "project_id":"{{t_project.id}}",
                        "project_guid":"{{t_project.guid}}",
                        "banjie_company_uid":banjie_company_uid,
                        "customer_company":customer_company,
                        "is_update_company_project":is_update_company_project,
                        "is_update_company_customer":is_update_company_customer,
                        "_xsrf":_xsrf},function(result){
                            console.log("result"+result)
                            location.reload()
                        })
                      }

                  }else{
                      if(res['same_customer']!=undefined){
                        if(confirm('是否修改客户系统中相同公司的公司名？')){
                          is_update_company_customer=1
                        }
                        }
                      if(res['project']!=undefined){
                        if(confirm('是否修改确认单系统中其他相同公司的公司名？')){
                          is_update_company_project=1
                        }
                        }
                        $.post("/project?tag=modify1",{
                        "project_id":"{{t_project.id}}",
                        "project_guid":"{{t_project.guid}}",
                        "banjie_company_uid":banjie_company_uid,
                        "is_update_company_project":is_update_company_project,
                        "is_update_company_customer":is_update_company_customer,
                        "customer_company":customer_company,
                        "_xsrf":_xsrf},function(result){
                            console.log("result"+result)
                            location.reload()
                        })
                  }
                  })

  }
     })

     $('.check_note_finish').click(function () {
    check_id=$(this).attr('check_id')
      if(confirm('确认通过?')){
        $.post(
       "/project?tag=check_note",
       {
         '_xsrf':_xsrf,
         "check_id_pass":check_id
       },function () { 
         location.reload()
        }
     )
      }
   })

   $('.check_note_bouhui').click(function () {
    check_id=$(this).attr('check_id')
      if(confirm('确认驳回?')){
        $.post(
       "/project?tag=check_note",
       {
         '_xsrf':_xsrf,
         "check_id_bouhui":check_id
       },function () { 
         location.reload()
        }
     )
      }
   })
   $("#add_to_economic").click(function () { 
     if(confirm('确认添加到经济普查?')){
      $.post('/company?tag=economic_census',{
        '_xsrf':_xsrf,
        'project_id':"{{t_project.id}}",
        'step':'other_add'
      },function (data) { 
         if(data=='-1'){
           alert('已是经济普查,无需添加。')
         }else if(data=='-2'){
           alert('需先创建客户')
         }else if(data=='-3'){
           alert('添加失败')
         }else{
           location.href=data
         }
       })
     }
    })

})

</script>
{%end%}
