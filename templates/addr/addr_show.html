{% extends "../base.html" %} {%block title%}收入管理{%end%} {%block head%}
<link href="/static/vendor/bootstrap/css/style.css" rel="stylesheet">
<link href="/static/vendor/bootstrap/css/dashboard.css" rel="stylesheet"> {%end%} {% block body %}


<ol class="breadcrumb">
    <li class="breadcrumb-item g1">
        主面板
    </li>
    <li class="breadcrumb-item g1">商机开发

  

    </li>    <li class="breadcrumb-item g1">地址商机
[<a href="/addr?tag={{from_tag}}">返回</a>]
  

    </li>
</ol>


<div class="row">
    <div class="col-lg-12">
        <div class="card mb-3">

<style>
.faye-table {
width: 100%;
height: auto;
/*background-color: purple;*/
margin: 0% auto;
font-weight: bold;
}
.faye-table ul {
overflow: hidden;
margin: 0;
padding: 0;
}
.faye-table ul li {
width: 100%;
list-style: none;
box-sizing: border-box;
border-bottom: 1px solid #dedede;
width: 100%;
height: 40px;
overflow: hidden;
}
.faye-table ul li div {
float: left;
height: 40px;
line-height: 40px;
text-align: center;
border-left: 1px solid #dedede;
}
.faye-table ul li div.fayet {
width: 8%;
background-color: #eee;
border-bottom: 1px solid #dedede;
}
.faye-table ul li div.fayet1 {
width: 12%;
}
.faye-table ul li div.fayet2 {
width: 25%;
}
.faye-table ul li div.fayet3 {
width: 92%;
}
.faye-table ul li div.fayet4 {
width: 10%;
}
.faye-table ul li div.fayet5 {
width: 15%;
}
.faye-table ul li div.fayet60 {
height: 180px;
border-left: 1px solid #dedede;
}
.faye-table ul li div.fayet70 {
width: 34%;
height: 180px;
border-left: 1px solid #dedede;
}
.faye-table ul li div.fayet6 {
width: 33%;
height: 180px;
border-left: 1px solid #dedede;
}
.faye-table ul li div.fayet7 {
width: 34%;
height: 180px;
border-left: 1px solid #dedede;
}
.faye-table ul li.gaodu {
height: 180px;
}
.faye-table ul li div.direction {
text-align: left;
padding-left: 10px;
box-sizing: border-box;
}
.faye-table ul li div.fayet6 span {
display: block;
width: 100%;
height: 40px;
border-bottom: 1px solid #dedede;
background-color: #eee;
}
.faye-table ul li div.fayet7 span {
display: block;
width: 100%;
height: 40px;
border-bottom: 1px solid #dedede;
background-color: #eee;
}
.faye-table ul li div.fayet6 i {
display: block;
width: 100%;
height: 140px;
line-height: 22px;
font-style: normal;
padding-top: 8px;
box-sizing: border-box;
}
.faye-table ul li div.fayet7 i {
display: block;
width: 100%;
height: 140px;
line-height: 22px;
font-style: normal;
padding-top: 8px;
box-sizing: border-box;
}
#box {
margin: 10px auto;
width: 100%;
min-height: 0;
background: #FF9
}
#demo {
margin: 10px auto;
width: 100%;
min-height: 0;
background: #CF9
}
.message-item {
margin-bottom: 5px;
margin-left: 40px;
position: relative;
}
.message-item .message-inner {
background: #fff;
border: 1px solid #ddd;
border-radius: 3px;
padding: 10px;
position: relative;
}
.message-item .message-inner:before {
border-right: 10px solid #ddd;
border-style: solid;
border-width: 10px;
color: rgba(0, 0, 0, 0);
content: "";
display: block;
height: 0;
position: absolute;
left: -20px;
top: 6px;
width: 0;
}
.message-item .message-inner:after {
border-right: 10px solid #fff;
border-style: solid;
border-width: 10px;
color: rgba(0, 0, 0, 0);
content: "";
display: block;
height: 0;
position: absolute;
left: -18px;
top: 6px;
width: 0;
}
.message-item:before {
background: #fff;
border-radius: 2px;
bottom: -30px;
box-shadow: 0 0 3px rgba(0, 0, 0, 0.2);
content: "";
height: 100%;
left: -30px;
position: absolute;
width: 3px;
}
.message-item:after {
background: #fff;
border: 2px solid #ccc;
border-radius: 50%;
box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
content: "";
height: 15px;
left: -36px;
position: absolute;
top: 10px;
width: 15px;
}
.clearfix:before,
.clearfix:after {
content: " ";
display: table;
}
.message-item .message-head {
border-bottom: 1px solid #eee;
margin-bottom: 8px;
padding-bottom: 8px;
}
.message-item .message-head .avatar {
margin-right: 20px;
}
.message-item .message-head .user-detail {
overflow: hidden;
}
.message-item .message-head .user-detail h5 {
font-size: 16px;
font-weight: bold;
margin: 0;
}
.message-item .message-head .post-meta {
float: left;
padding: 0 15px 0 0;
}
.message-item .message-head .post-meta>div {
color: #333;
font-weight: bold;
text-align: right;
}
.post-meta>div {
color: #777;
font-size: 12px;
line-height: 22px;
}
.message-item .message-head .post-meta>div {
color: #333;
font-weight: bold;
text-align: right;
}
.post-meta>div {
color: #777;
font-size: 12px;
line-height: 22px;
}
.message-item img {
min-height: 25px;
max-height: 25px;
}
.modal-ku {
width: 1750px;
margin: auto;
}
#nav {
height: 30px;
width: 100%;
background-color: #007bff;
}
#nav ul {
margin: 0 0 0 30px;
padding: 0px;
font-size: 12px;
color: #FFF;
line-height: 30px;
white-space: nowrap;
}
#nav li {
list-style-type: none;
display: inline;
}
#nav li a {
cursor: pointer;
text-decoration: none;
font-family: Arial, Helvetica, sans-serif;
padding: 7px 10px;
color: #FFF;
}
#nav li a:hover {
color: #ff0;
background-color: #007bff;
}
</style>

<div class="faye-table" style="font-size:14px;">
  <ul>
    <li>
      <div class="fayet">公司名称</div>
      <div class="fayet3">
      {%if t_customer%}
      <a href="/customer?tag=show&id={{t_customer.id}}&guid={{t_customer.guid}}&to_tag=finance_tab" target="_blank">
      {{t_addr_manager.company}}</a>
      {%else%}
      
      {{t_addr_manager.company}}
      {%end%}


      {%if role=="7" or role=="8"%}
        <a href="javascript:void(0)" class="a_modify" req_id="{{t_addr_manager.req_id}}" addr_id="{{t_addr_manager.id}}">
        <img src="/static/ico/web_icon_035.png" height="20"/>修改
        </a>
      {%end%}
      </div>
    </li>
    <li>
      <div class="fayet">企业代码</div>
      <div class="fayet2">{%if t_addr_manager.company_uid%}{{t_addr_manager.company_uid}}{%end%}</div>
            <div class="fayet">联系电话</div>
      <div class="fayet2">{%if t_addr_manager.customer_tel%}{{t_addr_manager.customer_tel}}{%end%}</div>
       <div class="fayet">安排时间</div>
      <div class="fayet2">{%if t_addr_manager.addr_arr%}{{t_addr_manager.addr_arr.strftime("%Y-%m-%d")}}{%end%}</div>


    </li>
    <li>
      <div class="fayet">承租人</div>
      <div class="fayet2">{{t_addr_manager.rent_by}}</div>
      <div class="fayet">地址性质</div>
      <div class="fayet2">{{t_addr_manager.addr_type}}</div>
      <div class="fayet">地址性质类型</div>
      <div class="fayet2">{{t_addr_manager.addr_con}}</div>
    </li>
    <li>
      <div class="fayet">租赁开始时间</div>
      <div class="fayet2">{%if t_addr_manager.rent_start%}{{t_addr_manager.rent_start.strftime("%Y-%m-%d")}}{%end%}</div>
      <div class="fayet">租赁结束时间</div>
      <div class="fayet2">{%if t_addr_manager.rent_end%}{{t_addr_manager.rent_end.strftime("%Y-%m-%d")}}{%end%}</div>
      <div class="fayet" >物业安排</div>
      <div class="fayet2">{%if role==7 or role==8%}{{t_addr_manager.addr_manager}}{%else%}*****{%end%}</div>
    </li>
    <li>
      <div class="fayet">原挂靠地址</div>
      <div class="fayet2">{%if t_addr_manager.old_addr%}{{t_addr_manager.old_addr}}{%end%}</div>
      <div class="fayet">现执照地址</div>
      <div class="fayet2">{%if t_addr_manager.now_addr%}{{t_addr_manager.now_addr}}{%end%}</div>
      <div class="fayet" >最新动态</div>
      <div class="fayet2" title="{{t_addr_manager.act_id_name}}">{{t_addr_manager.act_id_name}}</div>
    </li>

    <li>
      <div class="fayet">工商专员</div>
      <div class="fayet2">{%if t_addr_manager.cq_uid_name%}{{t_addr_manager.cq_uid_name}}{%end%}</div>
      <div class="fayet">销售顾问</div>
      <div class="fayet2">{%if t_addr_manager.xs_uid_name%}{{t_addr_manager.xs_uid_name}}{%end%}</div>
      <div class="fayet" >客服顾问</div>
      <div class="fayet2" title="{{t_addr_manager.gw_uid_name}}">{{t_addr_manager.gw_uid_name}}</div>
    </li>
    
 
  </ul>
</div>


        </div>
</div>

        <div class="col-lg-3">

<div class="card-columns">

    <div class="card mb-12">

        <div class="card-body">

        <hr class="my-0">
       

{%if t_addr_manager_req%}

{%if t_addr_manager_req.req_act_id>1%}{%if role=="8" or role=="7"%}

<ul class="list-group">
<li class="list-group-item">
<button class="a_add_set_member" mtype="modify" follow_uid_name="{{t_addr_manager_req.follow_uid_name}}" ass_remark="{%if t_addr_manager_req.ass_remark%}{{t_addr_manager_req.ass_remark}}{%end%}" req_id="{{t_addr_manager.req_id}}" addr_id="{{t_addr_manager.id}}">分配人修改</button>


</li>
</ul>{%end%}
{%end%}
{%if t_addr_manager_req.req_act_id==1%}
<ul class="list-group">
<li class="list-group-item">状态: {{t_addr_manager_req.req_act_id_name}}

{%if role=="8"%}
<button class="a_add_set_member" mtype="add" req_id="{{t_addr_manager.req_id}}" addr_id="{{t_addr_manager.id}}">分配跟进人</button>
{%end%}
{%if role=="8" or role=="7"%}
<button class="back_arrange" mtype="add" req_id="{{t_addr_manager.req_id}}" addr_id="{{t_addr_manager.id}}">重置</button>
{%end%}
</li>

  <li class="list-group-item">发起人: {{t_addr_manager_req.created_by}}</li>
  <li class="list-group-item">发起时间: {{t_addr_manager_req.created_at}}</li>


{%elif t_addr_manager_req.req_act_id==2%}
<ul class="list-group">
<li class="list-group-item">状态: <font color='red'>{{t_addr_manager_req.req_act_id_name}}</font>
{%if t_addr_manager_req.follow_uid==int(uid)%}
<button id="a_confirm_member" req_id="{{t_addr_manager.req_id}}" addr_id="{{t_addr_manager.id}}">点击接单</button>
{%end%}

</li>
  <li class="list-group-item">跟进人: {{t_addr_manager_req.follow_uid_name}}</li>

    <li class="list-group-item">发起人({{t_addr_manager_req.created_by}})<br/>
   发起时间:{{t_addr_manager_req.created_at}}<br/>
   
   备注:
   <font color='blue'>{%if t_addr_manager_req.req_remark%}
    {{t_addr_manager_req.req_remark}}{%else%}无{%end%}</font></li>



 <li class="list-group-item">分配人({{t_addr_manager_req.ass_uid_name}})<br/>分配时间:{{t_addr_manager_req.ass_uid_at}}<br/>备注:  
  <font color='blue'>{%if t_addr_manager_req.ass_remark%}{{t_addr_manager_req.ass_remark}}{%else%}无{%end%}</font></li>






{%elif t_addr_manager_req.req_act_id==3%}
<ul class="list-group">
<li class="list-group-item">状态: <font color='green'>{{t_addr_manager_req.req_act_id_name}}(处理中)</font>
{%if t_addr_manager_req.follow_uid==int(uid)%}
<button id="a_finish_modal" req_id="{{t_addr_manager.req_id}}" addr_id="{{t_addr_manager.id}}">已办结?</button>
{%end%}

</li>

  <li class="list-group-item">跟进人: {{t_addr_manager_req.follow_uid_name}}</li>

    <li class="list-group-item">发起人({{t_addr_manager_req.created_by}})<br/>
   发起时间:{{t_addr_manager_req.created_at}}<br/>
   
   备注:
   <font color='blue'>{%if t_addr_manager_req.req_remark%}
    {{t_addr_manager_req.req_remark}}{%else%}无{%end%}</font></li>



 <li class="list-group-item">分配人({{t_addr_manager_req.ass_uid_name}})<br/>分配时间:{{t_addr_manager_req.ass_uid_at}}<br/>备注:  
  <font color='blue'>{%if t_addr_manager_req.ass_remark%}{{t_addr_manager_req.ass_remark}}{%else%}无{%end%}</font></li>





{%elif t_addr_manager_req.req_act_id==4%}
<ul class="list-group">
<li class="list-group-item">状态: {{t_addr_manager_req.req_act_id_name}}(跟进人已处理)





</li>
  <li class="list-group-item">跟进人: {{t_addr_manager_req.follow_uid_name}}</li>

  <li class="list-group-item">跟进结果: <span style='color:{%if t_addr_manager_req.finish_type_id==11%}green{%elif t_addr_manager_req.finish_type_id==12%}red{%end%}'>{{t_addr_manager_req.finish_type_name}}</span>
  
  {%if t_addr_manager_req.finish_type_name=="已续费"%}
    {%if  role=="7" or role=="8"%}
    <button id="a_finish_modal_cq" class="a_modify" req_id="{{t_addr_manager.req_id}}" addr_id="{{t_addr_manager.id}}" act_id='6'>确认及信息更新</button>
    {%end%}
{%elif t_addr_manager_req.finish_type_name=="不续费"%}
    {%if  role=="8"%}
    <button id="a_finish_modal_leader" req_id="{{t_addr_manager.req_id}}" addr_id="{{t_addr_manager.id}}">不续费审批</button>
    {%end%}
{%end%}
  
  
  </li>
<li class="list-group-item">跟进结果备注: <span style='color:{%if t_addr_manager_req.finish_type_id==11%}green{%elif t_addr_manager_req.finish_type_id==12%}red{%end%}'>

{%if t_addr_manager_req.finish_remark%}
{{t_addr_manager_req.finish_remark}}
{%else%}
无
{%end%}
{%if t_addr_manager_upload%}
<br/>
{%for index,item in enumerate(t_addr_manager_upload)%}
    <a href="{{item.file_name}}" target="_blank">附件{{index+1}}</a><br/>

{%end%}
{%end%}
</span></li>


  <li class="list-group-item">跟进人: {{t_addr_manager_req.follow_uid_name}}</li>

    <li class="list-group-item">发起人({{t_addr_manager_req.created_by}})<br/>
   发起时间:{{t_addr_manager_req.created_at}}<br/>
   
   备注:<br/>
   <font color='blue'>{%if t_addr_manager_req.req_remark%}
    {{t_addr_manager_req.req_remark}}{%else%}无{%end%}</font></li>



 <li class="list-group-item">分配人({{t_addr_manager_req.ass_uid_name}})<br/>分配时间:{{t_addr_manager_req.ass_uid_at}}<br/>备注:  
  <font color='blue'>{%if t_addr_manager_req.ass_remark%}{{t_addr_manager_req.ass_remark}}{%else%}无{%end%}</font></li>








{%elif t_addr_manager_req.req_act_id==5 or t_addr_manager_req.req_act_id==6%}
<ul class="list-group">
<li class="list-group-item">状态: {{t_addr_manager_req.req_act_id_name}}({{t_addr_manager_req.leader_type_id_name}})
{%if t_addr_manager_req.leader_type_id==2%}
{{t_addr_manager_req.leader_uid_name}} {%if t_addr_manager_req.leader_remark%}驳回原因:{{t_addr_manager_req.leader_remark}}{%end%}
<button id="a_finish_modal" req_id="{{t_addr_manager.req_id}}" addr_id="{{t_addr_manager.id}}">重新提交</button>
{%end%}

</li>

  <li class="list-group-item">跟进结果: <span style='color:{%if t_addr_manager_req.finish_type_id==11%}green{%elif t_addr_manager_req.finish_type_id==12%}red{%end%}'>{{t_addr_manager_req.finish_type_name}}</span></li>
<li class="list-group-item">跟进结果备注: <span style='color:{%if t_addr_manager_req.finish_type_id==11%}green{%elif t_addr_manager_req.finish_type_id==12%}red{%end%}'>

{%if t_addr_manager_req.finish_remark%}
{{t_addr_manager_req.finish_remark}}
{%else%}
无
{%end%}
{%if t_addr_manager_upload%}
<br/>
{%for index,item in enumerate(t_addr_manager_upload)%}
    <a href="{{item.file_name}}" target="_blank">附件{{index+1}}</a><br/>

{%end%}
{%end%}
</span></li>

  <li class="list-group-item">跟进人: {{t_addr_manager_req.follow_uid_name}}</li>

   <li class="list-group-item">发起人({{t_addr_manager_req.created_by}})<br/>
   发起时间:{{t_addr_manager_req.created_at}}<br/>
   
   备注:<br/>
   <font color='blue'>{%if t_addr_manager_req.req_remark%}
    {{t_addr_manager_req.req_remark}}{%else%}无{%end%}</font></li>



 <li class="list-group-item">分配人({{t_addr_manager_req.ass_uid_name}})<br/>分配时间:{{t_addr_manager_req.ass_uid_at}}<br/>备注:  
  <font color='blue'>{%if t_addr_manager_req.ass_remark%}{{t_addr_manager_req.ass_remark}}{%else%}无{%end%}</font></li>


{%end%}
{%else%}

<li>无续费请求</li>
{%end%}
</ul>








        </div>

        </div>
      </div>




        </div>
        <div class="col-lg-9">

                        <div class="card-columns">

                            <div class="card mb-12">

                                <div class="card-body">
                                    <h6 class="card-title mb-1">

                                    </h6>
                                    <textarea style="width:100%" class="form-control" id="txt_msg">

                                    </textarea>
                                    <button id="btn_save_msg">确定添加</button>
                                </div>
                                <hr class="my-0">
                            <div style="margin-top:10px;margin-bottom:40px">
                                <div class="qa-message-list" id="wallmessages">
                                    <center>
                                        <h6 class="card-title mb-1 ">



                                            <a href="/addr?tag=show&addr_id={{t_addr_manager.id}}&guid=dfsafdasfafafafafdaf34432343232dfssfdfsd" class=" mr-3 d-inline-block show_all1" style="font-size:14px;">
                                                <span class="fa fa-fw fa-align-justify"></span>全部动态</a>

                                                <a href="/addr?tag=show&addr_id={{t_addr_manager.id}}&guid=dfsafdasfafafafafdaf34432343232dfssfdfsd&tag_type=跟进记录" class=" mr-3 d-inline-block a_project_state_modal" style="font-size:14px;" type_id="1">
                                                    <i class="fa fa-fw fa-comment"></i>跟进记录</a>

                                                <a href="/addr?tag=show&addr_id={{t_addr_manager.id}}&guid=dfsafdasfafafafafdaf34432343232dfssfdfsd&tag_type=操作标签" class=" mr-3 d-inline-block a_project_state_modal" style="font-size:14px;" type_id="1">
                                                    <i class="fa fa-fw fa-comment"></i>操作标签</a>

                                        </h6>
                                    </center>


                                    {%for item in t_company_msg%}
                                    <div class="message-item" id="msg_{{item.id}}">
                                        <div class="message-inner">
                                            <div class="message-head clearfix">
                                                <div class="avatar pull-left">
                                                    <img src="/static/images/avatar.jpeg">
                                                </div>
                                                <div class="user-detail">
                                                    <h5 class="handle">{{item.uid_name}} <span class="badge badge-pill badge-{%if item.tag_type==u"操作标签"%}warning{%elif item.tag_type==u"跟进记录"%}info{%elif item.tag_type==u"状态"%}danger{%else%}success{%end%}">{{item.tag_type}}</span>
                                                        <span style="font-size:13px;"> {{item.created_at}}
                                                        </span>
                                                    </h5>
                                                </div>
                                            </div>




{%if item.tag_type=="操作标签"%}
{%for row in item.message.split(",")%}
<span class="badge badge-pill badge-{%if row.split("_")[2]==u"质量"%}success{%elif row.split("_")[2]==u"需求" %}info{%elif row.split("_")[2]==u"状态" %}danger{%else%}warning{%end%}">
     {{row.split("_")[1]}}</span>

{%end%}
{%elif item.tag_type=="销售计划"%}
{%for row in item.message.split(",")%}
     {{row.split("_")[1]}} {{row.split("_")[2]}}  实施时间:{{row.split("_")[3]}} 
     {%end%}
{%else%}


 {{item.message}}
{%if item.file_list%}

 {%for index,row in enumerate(item.file_list.split(","))%}
    {%if row%}
    <a href="{{row}}" target="_blank">附件{{index}}</a>
    {%end%}
 {%end%}
 {%end%}


{%end%}



                                        </div>
                                    </div>
                                    {%end%}



                                </div>
                            </div>


    </div>
</div>


<div id="add_plan_modal" class="modal modal-ku fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="myModalLabel_linkman">创建销售计划
                    <a href="javascript:;" class="btn btn-danger btn-small " id="delete_linkman" style="display: none;">
                        <i class="btn-icon-only icon-remove">×</i>
                        </i>
                    </a>

                </h5>
            </div>
            <div class="modal-body form-horizontal" id="site_mod">



            <div class="form-group">
                    <div class="col-md-10">
                        <label class="control-label" for="username">计划类型</label>
                            <br/>

                    {%for item in t_type%}
                            <input type="radio" name="plan_type_id"  value="{{item.id}}" title="{{item.type_name}}"/> {{item.type_name}}
                             &nbsp;&nbsp;&nbsp;
                    {%end%}


                    </div>
                    <!-- /controls -->
                </div>
            <div class="form-group">
                <div class="col-md-10">
                    <label class="control-label" for="username">提醒时间</label>
                    <input type="text" class="form-control " id="reminder_at" name="reminder_at" value="" readonly="readonly">
                    <div class="alert alert-danger" role="alert" id="reminder_at" style="display:none;"></div>
                </div>
                <!-- /controls -->
            </div>

            <div class="form-group">
                <div class="col-md-10">
                    <label class="control-label" for="username">内容</label>
                    <textarea type="text" class="form-control " id="plan_body" name="plan_body" placeholder="计划内容"></textarea>
                    <div class="alert alert-danger" role="alert" id="plan_body_msg" style="display:none;"></div>
                    <br>
                    <a href="javascript:void(0);" class="regCap"><span class="badge badge-pill badge-info">法人</span></a>
                    <a href="javascript:void(0);" class="entName"><span class="badge badge-pill badge-info">公司</span></a>
                </div>
          
                <!-- /controls -->
            </div>
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
                <button class="btn btn-primary" id="btn_save_plan">保存</button>
            </div>
        </div>
    </div>
</div>
<div id="add_tag_modal" class="modal modal-ku fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="myModalLabel_linkman">选择标签

                    <a href="javascript:;" class="btn btn-danger btn-small " id="delete_linkman" style="display: none;">
                        <i class="btn-icon-only icon-remove">×</i>
                        </i>
                    </a>

                </h5>
            </div>
            <div class="modal-body form-horizontal" id="site_mod">

{%for item in t_company_tag_group%} <h6>{{item.tag_category}} :</h6>

{%for row in item.gc.split(",")%}

    <input type="checkbox" value="{{row.split("_")[0]}}" title="{{row.split("_")[1]}}" parent_name="{{item.tag_category}}" name="company_tag"

    {%if t_addr_manager.customer_tag%}
     {%for citem in t_addr_manager.customer_tag.split(",")%}{%if citem.split("_")[1]==row.split("_")[0]%}checked{%end%}

     {%end%}
     {%end%}

    > {{row.split("_")[0]}}

{%end%}
<hr/>
{%end%}
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
                <button class="btn btn-primary" id="btn_save_tag">保存</button>
            </div>
        </div>
    </div>
</div>



<div id="add_link_record_modal" class="modal modal-ku fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="myModalLabel_linkman">增加联系记录1

                    <a href="javascript:;" class="btn btn-danger btn-small " id="delete_linkman" style="display: none;">
                        <i class="btn-icon-only icon-remove">×</i>
                        </i>
                    </a>

                </h5>
            </div>
            <div class="modal-body form-horizontal" id="site_mod">
                <div class="form-group">
                    <div class="col-md-10">
                        <label class="control-label" for="username">细节记录</label>
                        <textarea type="text" class="form-control" id="detail_record" name="detail_record"></textarea>
                        <p id="msg_company" class="help-block" style="color:red"></p>
                    </div>
                    <!-- /controls -->
                </div>
                <div class="form-group">
                    <div class="col-md-10">
                        <label class="control-label" for="username">联系时间</label>
                        <input type="text" class="form-control " id="link_at" name="link_at" value="" readonly="readonly">
                        <div class="alert alert-danger" role="alert" id="save_to_record_link_at" style="display:none;"></div>
                    </div>
                    <!-- /controls -->
                </div>
                <div class="form-group">
                    <div class="col-md-10">
                        <label class="control-label" for="username">联系人</label>
                        <input type="text" class="form-control " id="record_link_man" name="record_link_man" value="">
                        <div class="alert alert-danger" role="alert" id="save_to_record_link_man" style="display:none;"></div>
                    </div>
                    <!-- /controls -->
                </div>
                <!-- /control-group -->

            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
                <button class="btn btn-primary" id="btn_save_linkman_record">保存</button>
            </div>
        </div>
    </div>
</div>

<div id="add_message_modal" class="modal modal-ku fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="myModalLabel_linkman">添加留言

                    <a href="javascript:;" class="btn btn-danger btn-small " id="delete_linkman" style="display: none;">
                        <i class="btn-icon-only icon-remove">×</i>
                        </i>
                    </a>

                </h5>
            </div>
            <div class="modal-body form-horizontal" id="site_mod">
                <div class="form-group">
                    <div class="col-md-10">
                        <label class="control-label" for="username">内容</label>
                        <textarea type="text" class="form-control " id="message" name="message" placeholder="填写留言"></textarea>
                        <div class="alert alert-danger" role="alert" id="save_to_message" style="display:none;"></div>
                    </div>
                    <!-- /controls -->
                </div>

            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
                <button class="btn btn-primary" id="btn_save_message">保存</button>
            </div>
        </div>
    </div>
</div>






<div id="add_set_member" class="modal modal-ku fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="myModalLabel_linkman">分配跟进人
                    <a href="javascript:;" class="btn btn-danger btn-small " id="delete_linkman" style="display: none;">
                        <i class="btn-icon-only icon-remove">×</i>
                        </i>
                    </a>

                </h5>
            </div>
            <div class="modal-body form-horizontal" id="site_mod">

          <div class="form-group well">
                <div class="col-md-12 " id="msg_cq" style="background-color:#ccc;">

                  
                   
                </div>
          
                <!-- /controls -->
            </div>



            <div class="form-group">
                <div class="col-md-10">
                    <label class="control-label" for="username" >跟进人</label>
                    <input type="text" class="form-control " id="follow_uid_name" name="follow_uid_name" placeholder=""/>
                </div>
                <!-- /controls -->
            </div>
  
            <div class="form-group">
                <div class="col-md-12">
                    <label class="control-label" for="username">备注内容</label>
                    <textarea type="text" class="form-control " id="ass_remark" name="ass_remark" placeholder=""></textarea>
                    <div class="alert alert-danger" role="alert" id="ass_remark_msg" style="display:none;"></div>
                  
                </div>
          
                <!-- /controls -->
            </div>
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
                <button class="btn btn-primary" id="btn_save_act_uid">保存</button>
            </div>
        </div>
    </div>
</div>





<div id="finish_modal_leader" class="modal modal-ku fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="myModalLabel_linkman">不续费办结审核
                    <a href="javascript:;" class="btn btn-danger btn-small " id="delete_linkman" style="display: none;">
                        <i class="btn-icon-only icon-remove">×</i>
                        </i>
                    </a>

                </h5>
            </div>
            <div class="modal-body form-horizontal" id="site_mod">




            <div class="form-group">
                <div class="col-md-10">
                    <label class="control-label" for="username" >审批状态</label>
     
                         {%for idx,m  in enumerate(t_type_finish_type)%}
                    
                             <input name="leader_type_id" value="{{m.order_int}}" type_name="{{m.type_name}}"  type="radio" {%if idx==0%}checked="true"{%end%}/>{{m.type_name}}
                       
                         {%end%}
         

                    
                </div>
                <!-- /controls -->
            </div>
  
            <div class="form-group">
                <div class="col-md-12">
                    <label class="control-label" for="username">备注内容</label>
                    <textarea type="text" class="form-control " id="leader_remark" name="leader_remark" placeholder=""></textarea>
                    <div class="alert alert-danger" role="alert" id="leader_uid_remark_msg" style="display:none;"></div>
                  
                </div>
          
                <!-- /controls -->
            </div>


  
  
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
                <button class="btn btn-primary" id="btn_save_finish_leader">保存</button>
            </div>
        </div>
    </div>
</div>



<div id="finish_modal" class="modal modal-ku fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="myModalLabel_linkman">办结
                    <a href="javascript:;" class="btn btn-danger btn-small " id="delete_linkman" style="display: none;">
                        <i class="btn-icon-only icon-remove">×</i>
                        </i>
                    </a>

                </h5>
            </div>
            <div class="modal-body form-horizontal" id="site_mod">


            <div class="form-group">
                <div class="col-md-12">
                    <label class="control-label" for="username" >跟进结果:</label>
     
                         {%for m  in t_type_finish%}
                    
                             <input name="t_type_finish" value="{{m.order_int}}" type_name="{{m.type_name}}"  type="radio"/>{{m.type_name}}
                       
                         {%end%}
         

                    
                </div>
                <!-- /controls -->
            </div>
           <div class="form-group">
                <div class="col-md-12">
                    <label class="control-label" for="username" >确认单编号</label>
                    <input type="text" name="project_id" id="project_id" class="form-control " value="{%if t_addr_manager.project_id%}{{t_addr_manager.project_id}}{%end%}" />
         
                </div>
                <!-- /controls -->
            </div>
            <div class="form-group">
                <div class="col-md-12">
                    <label class="control-label" for="username">备注内容</label>
                    <textarea type="text" class="form-control " id="follow_uid_remark" name="follow_uid_remark" placeholder=""></textarea>
                    <div class="alert alert-danger" role="alert" id="follow_uid_remark_msg" style="display:none;"></div>
                  
                </div>
          
                <!-- /controls -->
            </div>


            <div class="form-group">
                <div class="col-md-10">
     
                         {%for m  in range(1,4)%}
                        <label class="control-label" for="username" >附件</label>
                           <input name="uploaderInput[]" class="uploaderInput custom-file-input"  type="file"/><br/>
                       
                         {%end%}
         

                    
                </div>
                <!-- /controls -->
            </div>
  
  
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
                <button class="btn btn-primary" id="btn_save_finish">保存</button>
            </div>
        </div>
    </div>
</div>


<div id="finish_modal_cq" class="modal modal-ku fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="myModalLabel_linkman">客户地址信息更新

                <a href="javascript:void(0)" class="btn btn-danger" id="a_delete_addr" addr_id="{{t_addr_manager.id}}">删除该地址所有信息</a>
                    <a href="javascript:;" class="btn btn-danger btn-small " id="delete_linkman" style="display: none;">
                        <i class="btn-icon-only icon-remove">×</i>
                        </i>
                    </a>

                </h5>
            </div>
            <div class="modal-body form-horizontal" id="site_mod">

        <div style="background-color:#efefef; padding:10px; margin-bottom:10px;" id="cq_set">
            <div class="form-group">
                <div class="col-md-10">
                    <label class="control-label" for="username" >审批状态</label>
     
                         {%for idx,m  in enumerate(t_type_finish_type)%}
                    
                             <input name="ok_leader_type_id" value="{{m.order_int}}" type_name="{{m.type_name}}"  type="radio" {%if idx==0%}checked="true"{%end%}/>{{m.type_name}}
                       
                         {%end%}
         

                    
                </div>
                <!-- /controls -->
            </div>
  
            <div class="form-group">
                <div class="col-md-12">
                    <label class="control-label" for="username">备注内容</label>
                    <textarea type="text" class="form-control " id="ok_leader_remark" name="leader_remark" placeholder=""></textarea>
                    <div class="alert alert-danger" role="alert" id="ok_leader_uid_remark_msg" style="display:none;"></div>
                  
                </div>
          
                <!-- /controls -->
            </div>

</div>
        {%if role=='7' or role=='8'%}
        <div class="form-group">
            <div class="col-md-10">
                <label class="control-label" for="username" >标签 </label><br>
        <input type="radio" name="addr_tag" id="addr_tag"  value="1" {%if t_addr_manager.addr_tag==1%}checked{%end%} />变更 
        <input type="radio" name="addr_tag" id="addr_tag"  value="2" {%if t_addr_manager.addr_tag==2%}checked{%end%} />注销
 
                </div>
        <!-- /controls -->
        </div>
        {%end%}
            <div class="form-group">
                <div class="col-md-10">
                    <label class="control-label" for="username" >公司名称</label>
                    <input type="text" name="company" id="company" class="form-control " value="{%if t_addr_manager.company%}{{t_addr_manager.company}}{%end%}" />
         
                </div>
                <!-- /controls -->
            </div>
              <div class="form-group">
                <div class="col-md-10">
                    <label class="control-label" for="username" >企业代码</label>
                    <input type="text" name="company_uid" id="company_uid" class="form-control " value="{%if t_addr_manager.company_uid%}{{t_addr_manager.company_uid}}{%end%}" />
         
                </div>
                <!-- /controls -->
            </div>

                      <div class="form-group">
                <div class="col-md-10">
                    <label class="control-label" for="username" >客户电话</label>
                    <input type="text" name="customer_tel" id="customer_tel"  class="form-control " value="{%if t_addr_manager.customer_tel%}{{t_addr_manager.customer_tel}}{%end%}" />
         
                </div>
                <!-- /controls -->
            </div>


            <div class="form-group">
                <div class="col-md-10">
                    <label class="control-label" for="username" >承租人</label>
                    <input type="text" name="rent_by" id="rent_by" class="form-control " value="{%if t_addr_manager.rent_by%}{{t_addr_manager.rent_by}}{%end%}" />
         
                </div>
                <!-- /controls -->
            </div>
         <div class="form-group">
                <div class="col-md-10">
                    <label class="control-label" for="username" >地址性质</label>
                    <input type="text" name="addr_type" id="addr_type" class="form-control " value="{%if t_addr_manager.addr_type%}{{t_addr_manager.addr_type}}{%end%}" />
         
                </div>
                <!-- /controls -->
            </div>   
         <div class="form-group">
                <div class="col-md-10">
                    <label class="control-label" for="username" >地址性质类型</label>
                    <input type="text" name="addr_con" id="addr_con"  class="form-control " value="{%if t_addr_manager.addr_con%}{{t_addr_manager.addr_con}}{%end%}" />
         
                </div>
                <!-- /controls -->
            </div>   
                     <div class="form-group">
                <div class="col-md-10">
                    <label class="control-label" for="username" >安排时间</label>
                    <input type="text" name="addr_arr" id="addr_arr" class="form-control " value="{%if t_addr_manager.addr_arr%}{{t_addr_manager.addr_arr}}{%end%}" />
         
                </div>
                <!-- /controls -->
            </div>   
          <div class="form-group">
                <div class="col-md-10">
                    <label class="control-label" for="username" >租赁开始时间</label>
                    <input type="text" name="rent_start" id="rent_start" class="form-control " value="{%if t_addr_manager.rent_start%}{{t_addr_manager.rent_start}}{%end%}" />
         
                </div>
                <!-- /controls -->
            </div>   
          <div class="form-group">
                <div class="col-md-10">
                    <label class="control-label" for="username" >租赁结束时间</label>
                    <input type="text" name="rent_end"  id="rent_end" class="form-control " value="{%if t_addr_manager.rent_end%}{{t_addr_manager.rent_end}}{%end%}" />
         
                </div>
                <!-- /controls -->
            </div>  

                      <div class="form-group">
                <div class="col-md-10">
                    <label class="control-label" for="username" >物业安排</label>
                    <input type="text" name="addr_manager" id="addr_manager" class="form-control " value="{%if t_addr_manager.addr_manager%}{{t_addr_manager.addr_manager}}{%end%}" />
         
                </div>
                <!-- /controls -->
            </div>  
         <div class="form-group">
                <div class="col-md-10">
                    <label class="control-label" for="username" >原挂靠地址</label>
                    <input type="text" name="old_addr"  id="old_addr" class="form-control " value="{%if t_addr_manager.old_addr%}{{t_addr_manager.old_addr}}{%end%}" />
         
                </div>
                <!-- /controls -->
            </div>  

                     <div class="form-group">
                <div class="col-md-10">
                    <label class="control-label" for="username" >现执照地址	</label>
                    <input type="text" name="now_addr" id="now_addr"  class="form-control " value="{%if t_addr_manager.now_addr%}{{t_addr_manager.now_addr}}{%end%}" />
         
                </div>
                <!-- /controls -->
            </div>  
            
            <div class="form-group">
                <div class="col-md-12">
                    <label class="control-label" for="username">客户备注内容</label>
                    <textarea type="text" class="form-control " id="customer_remark" name="customer_remark" placeholder="" value="{%if t_addr_manager.customer_remark%}{{t_addr_manager.customer_remark}}{%end%}"></textarea>
                    <div class="alert alert-danger" role="alert" id="leader_uid_remark_msg" style="display:none;"></div>
                  
                </div>
          
                <!-- /controls -->
            </div>


  
  
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
                <button class="btn btn-primary" id="btn_save_finish_cq">保存</button>
            </div>
        </div>
    </div>
</div>





{%end%} {%block js%}

<script>
    $(function () {
            $("#cq_set").hide()
        _xsrf = getCookie("_xsrf")
        company_id = "{{t_addr_manager.id}}";
        company_guid = "xxxxxxx"

$("#list_company").click()


    $("#reminder_at").datetimepicker({
        minView: 0, pickTime: false, todayBtn: true, autoclose: true, format: 'yyyy-mm-dd hh:ii:00',
        language: 'zh-CN', initialDate: new Date()
    });
        $("#list_company").click()


        $("#add_plan").on("click",function(){
            $("#add_plan_modal").modal("show")


        })
            $("#add_tag").on("click", function () {
                // $("input[name=plan_type_id]").filter('[value="1"]').attr("checked", true)

                $("#add_tag_modal").modal("show")


            })

        $("#btn_save_plan").on("click",function(){
            reminder_at= $("#reminder_at").val()
            plan_body = $("#plan_body").val()
            plan_type_id = $("input[name=plan_type_id]:checked").val()
            plan_type_id_name = $("input[name=plan_type_id]:checked").attr("title")

            $.post("/plan?tag=add",{
                "plan_title":"{{t_addr_manager.company}}","rel_url":"/addr?tag=show&addr_id={{t_addr_manager.id}}",

                "reminder_at": reminder_at,"plan_body": plan_body,
            "plan_type_id": plan_type_id,"_xsrf":_xsrf,"rtype":1,"rel_id":company_id,"plan_type_id_name": plan_type_id_name},function(result){


                    location.reload()

            })

        })






        $("#btn_save_msg").on("click",function(){
            addr_id = {{t_addr_manager.id}}
            req_id ={%if t_addr_manager.req_id%}{{t_addr_manager.req_id}}{%else%}0{%end%}
            msg = $("#txt_msg").val()
            if(msg==""){
                alert("跟进记录不能为空哦.")
                return false
            }else{
                $.post("/company?tag=company_msg", { "_xsrf": _xsrf, "msg": msg, "company_id": company_id, "company_guid": company_guid,"rel_id":addr_id,"ext_id":req_id,"btype_id":2 }, function (result) {

                    location.reload()
                })
            }


        })


        $("#btn_save_tag").on("click",function(){
             var str = "";

            $('input[name=company_tag]').each(function () {
                if (this.checked) {

                    str += $(this).attr("title")+"_"+$(this).val()+"_"+ $(this).attr("parent_name") + ",";
                }
            });
            str = str.substr(0, str.length - 1);
            $.post("/company?tag=save_tags",{"_xsrf":_xsrf,"company_tags": str,"company_id":company_id,"company_guid": company_guid},function(result){

                location.reload()
            })

        })


        $("#link_at").datetimepicker({
            minView: 2, pickTime: false, todayBtn: true, autoclose: true,
            language: 'zh-CN', initialDate: new Date()
        });
        $('#online_kf').typeahead({
            source: function (query, process) {
                return $.post('/api', { query: query, "_xsrf": _xsrf }, function (data) {
                    return process(JSON.parse(data));
                });
            }
        });
        $('#kf_guwen').typeahead({
            source: function (query, process) {
                return $.post('/api', { query: query, "_xsrf": _xsrf }, function (data) {
                    return process(JSON.parse(data));
                });
            }
        });
        $('#sell_counselor').typeahead({
            source: function (query, process) {
                return $.post('/api', { query: query, "_xsrf": _xsrf }, function (data) {
                    return process(JSON.parse(data));
                });
            }
        });
        $('#follow_uid_name').typeahead({
            source: function (query, process) {
                return $.post('/api', { query: query, "_xsrf": _xsrf }, function (data) {
                    return process(JSON.parse(data));
                });
            }
        });
        $('.create_t_company').on('click', function () {
            var company = $('#company').val()
            var customer_name = $('#customer_name').val()
            var customer_tel = $('#customer_tel').val()
            var source_qd = $('input[name=source_qd]:checked').val()
            var source_way = $('input[name=source_way]:checked').val()
            var source_key = $('#source_key').val()
            var customer_introducer = $('#customer_introducer').val()
            var inner_introducer = $('#inner_introducer').val()
            var online_kf = $('#online_kf').val()
            var kf_guwen = $('#kf_guwen').val()
            var status = $('#status').val()
            var id = $(this).attr('id')
            if (company == '') {
                $('#e_company').text('公司名不能为空')
                $('#e_company').show()
            }
            else if (customer_name == '') {
                $('#e_customer_name').text('客户名不能为空')
                $('#e_customer_name').show()
            }
            else {
                $.post(
                    '/business?tag=t_company',
                    {
                        '_xsrf': _xsrf,
                        'company': company,
                        'customer_name': customer_name,
                        'customer_tel': customer_tel,
                        'source_qd': source_qd,
                        'source_way': source_way,
                        'source_key': source_key,
                        'customer_introducer': customer_introducer,
                        'inner_introducer': inner_introducer,
                        'online_kf': online_kf,
                        'kf_guwen': kf_guwen,
                        'status': status,
                        'id': id
                    }, function (result) {
                        location.reload()
                    }
                )
            }
        })
        $('.edit_t_company').on('click', function () {
            var id = $(this).attr('id')
            var company = $(this).attr('company')
            var customer_name = $(this).attr('customer_name')
            var customer_tel = $(this).attr('customer_tel')
            var source_qd = $(this).attr('source_qd')
            var source_way = $(this).attr('source_way')
            var source_key = $(this).attr('source_key')
            var customer_introducer = $(this).attr('customer_introducer')
            var inner_introducer = $(this).attr('inner_introducer')
            var online_kf = $(this).attr('online_kf')
            var kf_guwen = $(this).attr('kf_guwen')
            var status = $(this).attr('status')
            $('#company').val(company)
            $('#customer_name').val(customer_name)
            $('#customer_tel').val(customer_tel)
            $('#source_qd').val(source_qd)
            $('#source_way').val(source_way)
            $('#source_key').val(source_key)
            $('#customer_introducer').val(customer_introducer)
            $('#inner_introducer').val(inner_introducer)
            $('#online_kf').val(online_kf)
            $('#kf_guwen').val(kf_guwen)
            $('#status option[value="' + status + '"]').attr('selected', true)
            $('.create_t_company').attr('id', id)
            $('.delete_t_company').attr('id', id)
            $('.t_company_status').show()
            $('#t_company_modal').modal('show')
        })
        $('.delete_t_company').on('click', function () {
            var id = $(this).attr('id')
            if (confirm('确定删除?')) {
                $.post(
                    '/business?tag=t_company',
                    {
                        '_xsrf': _xsrf,
                        'delete_id': id
                    }, function (result) {
                        location.href = "/business?tag=t_company"
                    }
                )
            }
        })
        $('#a_add_linkman').on('click', function () {
            $('#linkman').val('')
            $('#tel').val('')
            $('#save_to_linkman').hide()
            $('#btn_save_linkman').removeAttr('linkman_id')
            $("#add_linkman_modal").modal('show')
        })
        $('#btn_save_linkman').on('click', function () {
            var linkman = $('#linkman').val()
            var tel = $('#tel').val()
            var linkman_id = $(this).attr('linkman_id')
            if (linkman == '') {
                $('#save_to_linkman').text('联系人不能为空')
                $('#save_to_linkman').show()
            } else {
                $(this).text('保存中')
                $(this).attr('disabled', 'disabled')
                $.post(
                    '/business?tag=business_linkman',
                    {
                        '_xsrf': _xsrf,
                        'linkman': linkman,
                        'business_id': "{{t_addr_manager.id}}",
                        'tel': tel,
                        'linkman_id': linkman_id
                    }, function (result) {
                        location.reload()
                    }
                )
            }
        })
        $('.edit_linkman').on('click', function () {
            $('#linkman').val($(this).attr('linkman'))
            $('#tel').val($(this).attr('tel'))
            $('#btn_save_linkman').attr('linkman_id', $(this).attr('id'))
            $('#save_to_linkman').hide()
            $("#add_linkman_modal").modal('show')
        })
        $('#a_add_cj_content').on('click', function () {
            $('#title').val('')
            $('#sell_counselor').val('')
            $('#save_to_title').hide()
            $('#save_to_sell_counselor').hide()
            $('#btn_save_cj_content').removeAttr('cj_content_id')
            $('#add_cj_content_modal').modal('show')
        })
        $('#btn_save_cj_content').on('click', function () {
            var title = $('#title').val()
            var sell_counselor = $('#sell_counselor').val()
            var cj_content_id = $(this).attr('cj_content_id')
            if (title == '') {
                $('#save_to_title').text('标题不能为空')
                $('#save_to_title').show()
            } else if (sell_counselor == '') {
                $('#save_to_sell_counselor').text('销售顾问不能为空')
                $('#save_to_sell_counselor').show()
            } else {
                $.post(
                    '/business?tag=business_cj_content',
                    {
                        '_xsrf': _xsrf,
                        'title': title,
                        'business_id': "{{t_addr_manager.id}}",
                        'sell_counselor': sell_counselor,
                        'cj_content_id': cj_content_id
                    }, function (result) {
                        location.reload()
                    }
                )
            }
        })

        $('.edit_cj_content').on('click', function () {
            $('#title').val($(this).attr('title'))
            $('#save_to_title').hide()
            $('#save_to_sell_counselor').hide()
            $('#sell_counselor').val($(this).attr('sell_counselor'))
            $('#btn_save_cj_content').attr('cj_content_id', $(this).attr('id'))
            $('#add_cj_content_modal').modal('show')
        })
        $('#a_add_link_record').on('click', function () {
            $('#detail_record').val('')
            $('#link_at').val('')
            $('#record_link_man').val('')
            $('#save_to_record_link_man').hide()
            $('#save_to_record_link_at').hide()
            $('#add_link_record_modal').modal('show')

        })
        $('#btn_save_linkman_record').on('click', function () {
            var detail_record = $('#detail_record').val()
            var link_at = $('#link_at').val()
            var link_man = $('#record_link_man').val()
            var id = $(this).attr('record_id')
            if (link_at == '') {
                $('#save_to_record_link_at').text('联系时间不能为空')
                $('#save_to_record_link_at').show()
            }
            else if (link_man == '') {
                $('#save_to_record_link_man').text('联系人不能为空')
                $('#save_to_record_link_man').show()
            }

            else {
                $(this).text('保存中')
                $(this).attr('disabled', 'disabled')
                $.post(
                    '/company?tag=company_record',
                    {
                        '_xsrf': _xsrf,
                        'detail_record': detail_record,
                        'link_at': link_at,
                        'link_man': link_man,
                        'company_id': "{{t_addr_manager.id}}",
                        'id': id
                    }, function () {
                        location.reload()
                    }
                )
            }
        })

        $('.edit_link_record').on('click', function () {
            var link_at = $(this).attr('link_at')
            var link_man = $(this).attr('link_man')
            var detail_record = $(this).attr('detail_record')
            var id = $(this).attr('id')
            $('#detail_record').val(detail_record)
            $('#link_at').val(link_at)
            $('#record_link_man').val(link_man)
            $('#save_to_record_link_man').hide()
            $('#save_to_record_link_at').hide()
            $('#btn_save_linkman_record').attr('record_id', id)
            $('#add_link_record_modal').modal('show')
        })
        $('#a_add_message').on('click', function () {
            $('#message').val('')
            $('#save_to_message').hide()
            $('#btn_save_message').removeAttr('message_id')
            $('#add_message_modal').modal('show')
        })
        $('#btn_save_message').on('click', function () {
            var message = $('#message').val()
            var id = $(this).attr('message_id')
            if (message == '') {
                $('#save_to_message').text('留言不能为空')
                $('#save_to_message').show()
            }
            else {
                $.post(
                    '/business?tag=business_message',
                    {
                        '_xsrf': _xsrf,
                        'message': message,
                        'business_id': "{{t_addr_manager.id}}",
                        'id': id
                    }, function (result) {
                        location.reload()
                    }
                )
            }
        })
        $('.a_change_message').on('click', function () {
            $('#save_to_message').hide()
            $('#message').val($(this).attr('message'))
            $('#btn_save_message').attr('message_id', $(this).attr('id'))
            $('#add_message_modal').modal('show')
        })
        $('.a_delete_message').on('click', function () {
            var id = $(this).attr('id')
            if (confirm('确定删除?')) {
                $.post(
                    '/business?tag=business_message',
                    {
                        '_xsrf': _xsrf,
                        'delete_id': id
                    }, function (result) {
                        location.reload()
                    }
                )
            }
        })
        $('.regCap').on('click',function () { 
            $('#plan_body').val('{{t_addr_manager.company}}')
         })
         $('.entName').on('click',function () { 
            $('#plan_body').val('{{t_addr_manager.company}}')
         })
       $(".a_add_set_member").on("click",function(){
            mtype = $(this).attr("mtype")

            $("#btn_save_act_uid").attr("addr_id",0)
            $("#req_id").attr("req_id",0)
            req_id = $(this).attr("req_id")
            addr_id = $(this).attr("addr_id")
            $("#btn_save_act_uid").attr("addr_id",addr_id)
            $("#btn_save_act_uid").attr("req_id",req_id)
            if(mtype=="modify"){
               ass_remark = $(this).attr("ass_remark")
                follow_uid_name = $(this).attr("follow_uid_name")
               $("#follow_uid_name").val(follow_uid_name)
               $("#ass_remark").val(ass_remark)
            }
            $("#add_set_member").modal("show")
        })

        $("#a_confirm_member").on("click",function(){
                req_id = $(this).attr("req_id")
                addr_id = $(this).attr("addr_id")
                $.post("/addr?tag=confirm_follow",
                { '_xsrf': _xsrf,"addr_id":addr_id,"req_id":req_id},function(result){

                            if (result==0){
                                location.reload()
                            }else{
                                alert(result)
                            }
                    })
        })

        $("#a_finish_modal").on("click",function(){
            $('#btn_save_finish').attr('req_id',$(this).attr('req_id'))
            $('#btn_save_finish').attr('addr_id',$(this).attr('addr_id'))
            $("#finish_modal").modal("show")
        })
    $("#a_finish_modal_leader").on("click",function(){
            $('#btn_save_finish_leader').attr('req_id',$(this).attr('req_id'))
            $('#btn_save_finish_leader').attr('addr_id',$(this).attr('addr_id'))
      
            $("#finish_modal_leader").modal("show")
        })
   $(".a_modify").on("click",function(){
            $('#btn_save_finish_cq').removeAttr('act_id')
            $('#btn_save_finish_cq').attr('req_id',$(this).attr('req_id'))
            $('#btn_save_finish_cq').attr('addr_id',$(this).attr('addr_id'))
            $('#btn_save_finish_cq').attr('act_id',$(this).attr('act_id'))
            $("#finish_modal_cq").modal("show")
        })

        
         $("#btn_save_act_uid").on("click",function(){
                follow_uid_name = $("#follow_uid_name").val()
                ass_remark = $("#ass_remark").val()
                req_id = $(this).attr("req_id")
                addr_id = $(this).attr("addr_id")
           
                if(follow_uid_name==""){
                    alert("跟进人不能为空哦")
                }else{

                    $.post("/addr?tag=ass",{ '_xsrf': _xsrf,"follow_uid_name":follow_uid_name,"ass_remark":ass_remark,"addr_id":addr_id,"req_id":req_id},function(result){

                            if (result==0){
                                location.reload()
                            }else{
                                alert(result)
                            }
                    })
                }

         })

         $("#btn_save_finish_leader").on("click",function(){
               leader_type_id=$('input[name=leader_type_id]:checked').val()
               leader_type_id_name=$('input[name=leader_type_id]:checked').attr("type_name")
                leader_remark = $("#leader_remark").val()
                req_id = $(this).attr("req_id")
                addr_id = $(this).attr("addr_id")
           
       

                    $.post("/addr?tag=leader",{ 'leader_remark':leader_remark,'_xsrf': _xsrf,"leader_type_id":leader_type_id,"leader_type_id_name":leader_type_id_name,"addr_id":addr_id,"req_id":req_id},function(result){

                            if (result==0){
                                location.reload()
                            }else{
                                alert(result)
                            }
                    })
                
         })



         $("#btn_save_finish_cq").on("click",function(){
              addr_tag=$("input[name=addr_tag]:checked").val()
               company=$('#company').val()
               company_uid=$('#company_uid').val()
                customer_tel=$('#customer_tel').val()
                rent_by=$('#rent_by').val()               
               addr_type=$('#addr_type').val()
               addr_con=$('#addr_con').val()
                addr_arr=$('#addr_arr').val()
                rent_start=$('#rent_start').val()               
               rent_end=$('#rent_end').val()
               addr_manager=$('#addr_manager').val()
                old_addr=$('#old_addr').val()
                now_addr=$('#now_addr').val()               
               customer_remark=$('#customer_remark').val()
                req_id = $(this).attr("req_id")
                addr_id = $(this).attr("addr_id")
                leader_type_id=$('input[name=ok_leader_type_id]:checked').val()
                leader_type_id_name=$('input[name=ok_leader_type_id]:checked').attr("type_name")
                leader_remark = $("#ok_leader_remark").val()
                act_id=$(this).attr('act_id')

                $.post("/addr?tag=modify",{ "addr_tag":addr_tag,'company':company,'_xsrf': _xsrf,"company_uid":company_uid,"customer_tel":customer_tel,
                "rent_by":rent_by,"addr_type":addr_type,"rent_by":rent_by,"addr_con":addr_con,"addr_arr":addr_arr,"rent_start":rent_start,"rent_end":rent_end,"addr_manager":addr_manager,"old_addr":old_addr,
                "now_addr":now_addr,"customer_remark":customer_remark,"leader_type_id":leader_type_id,"leader_type_id_name":leader_type_id_name,"leader_remark":leader_remark,
                "addr_id":addr_id,"req_id":req_id,"act_id":act_id},function(result){

                            if (result==0){
                                location.reload()
                            }else{
                                alert(result)
                            }
                  })
                
         })

        {%if role=="8" or role=="7"%}
                $("#a_delete_addr").on("click",function(){
                    addr_id =$(this).attr("addr_id")
                    if(confirm("确认删除吗?")){

                        $.post("/addr?tag=delete_addr",{'_xsrf': _xsrf,"addr_id":addr_id},function(result){
                            if(result=="0"){
                                alert('删除成功!')
                                        location.href='/addr?tag={{from_tag}}'

                            }else{
                                    alert(result)
                            }
                                
                        })  
                    }
                })

        {%end%}

         $('#btn_save_finish').on('click',function () { 
            t_type_finish_id=$('input[name=t_type_finish]:checked').val()
            t_type_finish_name=$('input[name=t_type_finish]:checked').attr("type_name")
            follow_uid_remark=$('#follow_uid_remark').val()
            project_id = $("#project_id").val()
            req_id=$(this).attr('req_id')
            addr_id = $(this).attr("addr_id")
            if(project_id ==""){
            alert('请选择填写确认单的编号哦')
            }
            else if(t_type_finish_id==undefined){
                alert('请选择跟进结果')
            }else{
                var formData = new FormData();
                $.each($(".uploaderInput"), function (i, obj) {                
                    $.each(obj.files, function (j, file) {                    
                        formData.append('uploaderInput', file); // is the var i against the var j, because the i is incremental the j is ever 0
                    });
                });

           
                formData.append('_xsrf', _xsrf)
                formData.append("t_type_finish_id",t_type_finish_id)
                formData.append("t_type_finish_name", t_type_finish_name)
                formData.append("follow_uid_remark",follow_uid_remark)
                formData.append("req_id", req_id)
                formData.append("addr_id",addr_id)
                formData.append("up_type","跟进人反馈")
                formData.append("project_id",project_id)
      $.ajax({
                url: '/addr?tag=finish',
                type: 'POST',
                data: formData,
                processData: false,  // tell jQuery not to process the data
                contentType: false,  // tell jQuery not to set contentType
                success: function (data) {
                  if(data >=0){
                   location.reload()

                  }
                  else{
                    
                        alert("errr")
                  }

                }
              });

            }
        
        })
    
        $('.back_arrange').click(function () { 
            req_id=$(this).attr('req_id')
            addr_id=$(this).attr('addr_id')
            if(confirm('确定撤回？')){
                $.post("/addr?tag=back_addr",{
                "_xsrf":_xsrf,
                'req_id':req_id,
                "addr_id":addr_id
            },function (data) { 
                location.reload()
             })
            }
      
         })
    })
</script> {%end%}