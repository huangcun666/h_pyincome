{% extends "../base.html" %} {%block title%}收入管理{%end%} {%block head%}
<link href="/static/vendor/bootstrap/css/style.css" rel="stylesheet">
<link href="/static/vendor/bootstrap/css/dashboard.css" rel="stylesheet"> {%end%} {% block body %}


<ol class="breadcrumb">
    <li class="breadcrumb-item g1">
        主面板
    </li>
    <li class="breadcrumb-item g1">商机开发

     {%if t_company.sales_uid%} <a href="/company?tag=list_company&my=1">返回</a> {%end%}

    </li>
</ol>


<div class="row">
    <div class="col-lg-12">
        <div class="card mb-3">

<style>
.faye-table {
width: 100%;
height: auto;
/*background-color: purple;*/
margin: 0% auto;
font-weight: bold;
}
.faye-table ul {
overflow: hidden;
margin: 0;
padding: 0;
}
.faye-table ul li {
width: 100%;
list-style: none;
box-sizing: border-box;
border-bottom: 1px solid #dedede;
width: 100%;
height: 40px;
overflow: hidden;
}
.faye-table ul li div {
float: left;
height: 40px;
line-height: 40px;
text-align: center;
border-left: 1px solid #dedede;
}
.faye-table ul li div.fayet {
width: 8%;
background-color: #eee;
border-bottom: 1px solid #dedede;
}
.faye-table ul li div.fayet1 {
width: 12%;
}
.faye-table ul li div.fayet2 {
width: 25%;
}
.faye-table ul li div.fayet3 {
width: 92%;
}
.faye-table ul li div.fayet4 {
width: 10%;
}
.faye-table ul li div.fayet5 {
width: 15%;
}
.faye-table ul li div.fayet60 {
height: 180px;
border-left: 1px solid #dedede;
}
.faye-table ul li div.fayet70 {
width: 34%;
height: 180px;
border-left: 1px solid #dedede;
}
.faye-table ul li div.fayet6 {
width: 33%;
height: 180px;
border-left: 1px solid #dedede;
}
.faye-table ul li div.fayet7 {
width: 34%;
height: 180px;
border-left: 1px solid #dedede;
}
.faye-table ul li.gaodu {
height: 180px;
}
.faye-table ul li div.direction {
text-align: left;
padding-left: 10px;
box-sizing: border-box;
}
.faye-table ul li div.fayet6 span {
display: block;
width: 100%;
height: 40px;
border-bottom: 1px solid #dedede;
background-color: #eee;
}
.faye-table ul li div.fayet7 span {
display: block;
width: 100%;
height: 40px;
border-bottom: 1px solid #dedede;
background-color: #eee;
}
.faye-table ul li div.fayet6 i {
display: block;
width: 100%;
height: 140px;
line-height: 22px;
font-style: normal;
padding-top: 8px;
box-sizing: border-box;
}
.faye-table ul li div.fayet7 i {
display: block;
width: 100%;
height: 140px;
line-height: 22px;
font-style: normal;
padding-top: 8px;
box-sizing: border-box;
}
#box {
margin: 10px auto;
width: 100%;
min-height: 0;
background: #FF9
}
#demo {
margin: 10px auto;
width: 100%;
min-height: 0;
background: #CF9
}
.message-item {
margin-bottom: 5px;
margin-left: 40px;
position: relative;
}
.message-item .message-inner {
background: #fff;
border: 1px solid #ddd;
border-radius: 3px;
padding: 10px;
position: relative;
}
.message-item .message-inner:before {
border-right: 10px solid #ddd;
border-style: solid;
border-width: 10px;
color: rgba(0, 0, 0, 0);
content: "";
display: block;
height: 0;
position: absolute;
left: -20px;
top: 6px;
width: 0;
}
.message-item .message-inner:after {
border-right: 10px solid #fff;
border-style: solid;
border-width: 10px;
color: rgba(0, 0, 0, 0);
content: "";
display: block;
height: 0;
position: absolute;
left: -18px;
top: 6px;
width: 0;
}
.message-item:before {
background: #fff;
border-radius: 2px;
bottom: -30px;
box-shadow: 0 0 3px rgba(0, 0, 0, 0.2);
content: "";
height: 100%;
left: -30px;
position: absolute;
width: 3px;
}
.message-item:after {
background: #fff;
border: 2px solid #ccc;
border-radius: 50%;
box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
content: "";
height: 15px;
left: -36px;
position: absolute;
top: 10px;
width: 15px;
}
.clearfix:before,
.clearfix:after {
content: " ";
display: table;
}
.message-item .message-head {
border-bottom: 1px solid #eee;
margin-bottom: 8px;
padding-bottom: 8px;
}
.message-item .message-head .avatar {
margin-right: 20px;
}
.message-item .message-head .user-detail {
overflow: hidden;
}
.message-item .message-head .user-detail h5 {
font-size: 16px;
font-weight: bold;
margin: 0;
}
.message-item .message-head .post-meta {
float: left;
padding: 0 15px 0 0;
}
.message-item .message-head .post-meta>div {
color: #333;
font-weight: bold;
text-align: right;
}
.post-meta>div {
color: #777;
font-size: 12px;
line-height: 22px;
}
.message-item .message-head .post-meta>div {
color: #333;
font-weight: bold;
text-align: right;
}
.post-meta>div {
color: #777;
font-size: 12px;
line-height: 22px;
}
.message-item img {
min-height: 25px;
max-height: 25px;
}
.modal-ku {
width: 1750px;
margin: auto;
}
#nav {
height: 30px;
width: 100%;
background-color: #007bff;
}
#nav ul {
margin: 0 0 0 30px;
padding: 0px;
font-size: 12px;
color: #FFF;
line-height: 30px;
white-space: nowrap;
}
#nav li {
list-style-type: none;
display: inline;
}
#nav li a {
cursor: pointer;
text-decoration: none;
font-family: Arial, Helvetica, sans-serif;
padding: 7px 10px;
color: #FFF;
}
#nav li a:hover {
color: #ff0;
background-color: #007bff;
}
</style>

<div class="faye-table" style="font-size:14px;">
  <ul>
    <li>
      <div class="fayet">公司名称</div>
      <div class="fayet3">{{t_company.entName}}</div>
    </li>
    <li>
      <div class="fayet">公司网站</div>
      <div class="fayet3">{{t_company.urls}}</div>
    </li>
    <li>
      <div class="fayet">法人代表</div>
      <div class="fayet2">{{t_company.regCap}}</div>
      <div class="fayet">联系电话</div>
      <div class="fayet2">{{t_company.phone}}</div>
      <div class="fayet">其他电话</div>
      <div class="fayet2">{{t_company.phone1}}</div>
    </li>
        <li>
      <div class="fayet">经营状态</div>
      <div class="fayet2">{{t_company.reg_state}}</div>
      <div class="fayet">注册资本</div>
      <div class="fayet2">{{t_company.reg_money}}</div>
      <div class="fayet">成立日期</div>
      <div class="fayet2">{{t_company.creater}}</div>
    </li>
    <li>
      <div class="fayet">入库时间</div>
      <div class="fayet2">{{t_company.created_at}}</div>
      <div class="fayet">创建人</div>
      <div class="fayet2">{{t_company.created_uid_name}}</div>
      <div class="fayet" title="{{t_company.email}}">邮箱</div>
      <div class="fayet2" title="{{t_company.email}}">{{t_company.email}}</div>
    </li>
    <li>
      <div class="fayet" title="{{t_company.reg_addr}}">注册地址</div>
      <div class="fayet3" title="{{t_company.reg_addr}}">{{t_company.reg_addr}}</div>
    </li>
    <li>
      <div class="fayet">经营范围</div>
      <div class="fayet3" title="{{t_company.scope}}">{{t_company.scope}}</div>
    </li>
  </ul>
</div>


        </div>
</div>

        <div class="col-lg-3">

<div class="card-columns">

    <div class="card mb-12">

        <div class="card-body">
            <h6 class="card-title mb-1">
                                客户状态

                                {%if not  t_company.sales_uid%}
                                <a href="javascript:void(0)" id="add_to_me" class=" mr-3 d-inline-block a_project_state_modal" style="font-size:14px;" type_id="1">
                                    <i class="fa fa-fw fa-comment"></i>标记为我的客户</a>

                                    {%else%}

  <a href="javascript:void(0)" id="free_to_me" class=" mr-3 d-inline-block a_project_state_modal" style="font-size:14px;" type_id="1">
                                    <i class="fa fa-fw fa-comment"></i>把客户放回公有池</a>

                              
                                    {%end%}
                                    
  

            </h6>

        </div>
        <hr class="my-0">
        {%if t_company.sales_uid%}




            <ul class="list-group">
                  <li class="list-group-item">商机级别: {{t_company.rank}}</li>

  <li class="list-group-item">归属人: {{t_company.sales_uid_name}}</li>
  <li class="list-group-item">标记时间: {{t_company.sales_uid_at}}</li>
 <li class="list-group-item">开发状态: {%if t_company.is_close=="2"%}已成交{%else%}开发中

     {%if t_company.sales_uid%}
    <input type="submit" value="创建收入确认单" onclick="location.href='/project?tag=my&company_id={{t_company.id}}&company_guid={{t_company.company_guid}}'"> {%end%}


     {%end%}</li>



</ul>

        {%else%}

            <ul class="list-group">
                                  <li class="list-group-item">商机级别: {{t_company.rank}}</li>

 <li class="list-group-item">开发状态:待认领


    </li>




</ul>

        {%end%}





        </div>

        </div>




<div class="card-columns">

    <div class="card mb-12">

        <div class="card-body">
            <h6 class="card-title mb-1">
                                客户标签<a href="javascript:void(0)" id="add_tag" class=" mr-3 d-inline-block a_project_state_modal" style="font-size:14px;" type_id="1">
                                    <i class="fa fa-fw fa-comment"></i>添加</a>
            </h6>

        </div>
        <hr class="my-0">
        <div style="padding:5px; margin-left:5px; font-size:18px;">
                {%if t_company.customer_tag%}
                {%for item in t_company.customer_tag.split(",")%}
            <span class="badge badge-pill badge-{%if item.split("_")[2]==u"质量"%}success{%elif item.split("_")[2]==u"需求" %}info{%elif item.split("_")[2]==u"状态" %}danger{%else%}warning{%end%}">{{item.split("_")[1]}}</span>

            {%end%}
            {%end%}
        </div>

        </div>

        </div>
<div class="card-columns">

    <div class="card mb-12">

        <div class="card-body">
            <h6 class="card-title mb-1">
                销售计划<a href="javascript:void(0)" id="add_plan" class=" mr-3 d-inline-block a_project_state_modal" style="font-size:14px;"
                    type_id="1">
                    <i class="fa fa-fw fa-comment"></i>创建</a>
            </h6>

        </div>
        <hr class="my-0">


            <ul class="list-group">

                {%for item in t_plan%}

                    <li class="list-group-item"><span class="badge badge-pill badge-success">{{item.plan_type_id_name}}</span> {{item.reminder_at}}</li>

                {%end%}
 </ul>
    </div>

</div>

        </div>
        <div class="col-lg-9">

                        <div class="card-columns">

                            <div class="card mb-12">

                                <div class="card-body">
                                    <h6 class="card-title mb-1">

                                    </h6>
                                    <textarea style="width:100%" class="form-control" id="txt_msg">

                                    </textarea>
                                    <button id="btn_save_msg">确定添加</button>
<a href="javascript:void(0)" close="1" class=" mr-3 d-inline-block pick_to_close" style="font-size:14px;" ><i class="fa fa-fw fa-comment"></i>标记无需求</a>
<a href="javascript:void(0)" close="2" class=" mr-3 d-inline-block pick_to_close" style="font-size:14px;" >
                                   <i class="fa fa-fw fa-comment"></i>标记空号</a>
                                </div>
                                <hr class="my-0">
                            <div style="margin-top:10px;margin-bottom:40px">
                                <div class="qa-message-list" id="wallmessages">
                                    <center>
                                        <h6 class="card-title mb-1 ">



                                            <a href="/company?tag=show&guid={{t_company.company_guid}}&id={{t_company.id}}" class=" mr-3 d-inline-block show_all1" style="font-size:14px;">
                                                <span class="fa fa-fw fa-align-justify"></span>全部动态</a>

                                                <a href="/company?tag=show&guid={{t_company.company_guid}}&id={{t_company.id}}&tag_type=跟进记录" class=" mr-3 d-inline-block a_project_state_modal" style="font-size:14px;" type_id="1">
                                                    <i class="fa fa-fw fa-comment"></i>跟进记录</a>

                                                <a href="/company?tag=show&guid={{t_company.company_guid}}&id={{t_company.id}}&tag_type=操作标签" class=" mr-3 d-inline-block a_project_state_modal" style="font-size:14px;" type_id="1">
                                                    <i class="fa fa-fw fa-comment"></i>操作标签</a>

                                        </h6>
                                    </center>


                                    {%for item in t_company_msg%}
                                    <div class="message-item" id="msg_{{item.id}}">
                                        <div class="message-inner">
                                            <div class="message-head clearfix">
                                                <div class="avatar pull-left">
                                                    <img src="/static/images/avatar.jpeg">
                                                </div>
                                                <div class="user-detail">
                                                    <h5 class="handle">{{item.uid_name}} <span class="badge badge-pill badge-{%if item.tag_type==u"操作标签"%}warning{%elif item.tag_type==u"跟进记录"%}info{%elif item.tag_type==u"状态"%}danger{%else%}success{%end%}">{{item.tag_type}}</span>
                                                        <span style="font-size:13px;"> {{item.created_at}}
                                                        </span>
                                                    </h5>
                                                </div>
                                            </div>




{%if item.tag_type=="操作标签"%}
{%for row in item.message.split(",")%}
<span class="badge badge-pill badge-{%if row.split("_")[2]==u"质量"%}success{%elif row.split("_")[2]==u"需求" %}info{%elif row.split("_")[2]==u"状态" %}danger{%else%}warning{%end%}">
     {{row.split("_")[1]}}</span>

{%end%}
{%elif item.tag_type=="销售计划"%}
{%for row in item.message.split(",")%}
     {{row.split("_")[1]}} {{row.split("_")[2]}}  实施时间:{{row.split("_")[3]}} 
     {%end%}
{%else%}
 {{item.message}}


{%end%}



                                        </div>
                                    </div>
                                    {%end%}



                                </div>
                            </div>


    </div>
</div>


<div id="add_plan_modal" class="modal modal-ku fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="myModalLabel_linkman">创建销售计划
                    <a href="javascript:;" class="btn btn-danger btn-small " id="delete_linkman" style="display: none;">
                        <i class="btn-icon-only icon-remove">×</i>
                        </i>
                    </a>

                </h5>
            </div>
            <div class="modal-body form-horizontal" id="site_mod">



            <div class="form-group">
                    <div class="col-md-10">
                        <label class="control-label" for="username">计划类型</label>
                            <br/>

                    {%for item in t_type%}
                            <input type="radio" name="plan_type_id"  value="{{item.id}}" title="{{item.type_name}}"/> {{item.type_name}}
                             &nbsp;&nbsp;&nbsp;
                    {%end%}


                    </div>
                    <!-- /controls -->
                </div>
            <div class="form-group">
                <div class="col-md-10">
                    <label class="control-label" for="username">提醒时间</label>
                    <input type="text" class="form-control " id="reminder_at" name="reminder_at" value="" readonly="readonly">
                    <div class="alert alert-danger" role="alert" id="reminder_at" style="display:none;"></div>
                </div>
                <!-- /controls -->
            </div>

            <div class="form-group">
                <div class="col-md-10">
                    <label class="control-label" for="username">内容</label>
                    <textarea type="text" class="form-control " id="plan_body" name="plan_body" placeholder="计划内容"></textarea>
                    <div class="alert alert-danger" role="alert" id="plan_body_msg" style="display:none;"></div>
                    <br>
                    <a href="javascript:void(0);" class="regCap"><span class="badge badge-pill badge-info">法人</span></a>
                    <a href="javascript:void(0);" class="entName"><span class="badge badge-pill badge-info">公司</span></a>
                </div>
          
                <!-- /controls -->
            </div>
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
                <button class="btn btn-primary" id="btn_save_plan">保存</button>
            </div>
        </div>
    </div>
</div>
<div id="add_tag_modal" class="modal modal-ku fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="myModalLabel_linkman">选择标签

                    <a href="javascript:;" class="btn btn-danger btn-small " id="delete_linkman" style="display: none;">
                        <i class="btn-icon-only icon-remove">×</i>
                        </i>
                    </a>

                </h5>
            </div>
            <div class="modal-body form-horizontal" id="site_mod">

{%for item in t_company_tag_group%} <h6>{{item.tag_category}} :</h6>

{%for row in item.gc.split(",")%}

    <input type="checkbox" value="{{row.split("_")[0]}}" title="{{row.split("_")[1]}}" parent_name="{{item.tag_category}}" name="company_tag"

    {%if t_company.customer_tag%}
     {%for citem in t_company.customer_tag.split(",")%}{%if citem.split("_")[1]==row.split("_")[0]%}checked{%end%}

     {%end%}
     {%end%}

    > {{row.split("_")[0]}}

{%end%}
<hr/>
{%end%}
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
                <button class="btn btn-primary" id="btn_save_tag">保存</button>
            </div>
        </div>
    </div>
</div>



<div id="add_link_record_modal" class="modal modal-ku fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="myModalLabel_linkman">增加联系记录1

                    <a href="javascript:;" class="btn btn-danger btn-small " id="delete_linkman" style="display: none;">
                        <i class="btn-icon-only icon-remove">×</i>
                        </i>
                    </a>

                </h5>
            </div>
            <div class="modal-body form-horizontal" id="site_mod">
                <div class="form-group">
                    <div class="col-md-10">
                        <label class="control-label" for="username">细节记录</label>
                        <textarea type="text" class="form-control" id="detail_record" name="detail_record"></textarea>
                        <p id="msg_company" class="help-block" style="color:red"></p>
                    </div>
                    <!-- /controls -->
                </div>
                <div class="form-group">
                    <div class="col-md-10">
                        <label class="control-label" for="username">联系时间</label>
                        <input type="text" class="form-control " id="link_at" name="link_at" value="" readonly="readonly">
                        <div class="alert alert-danger" role="alert" id="save_to_record_link_at" style="display:none;"></div>
                    </div>
                    <!-- /controls -->
                </div>
                <div class="form-group">
                    <div class="col-md-10">
                        <label class="control-label" for="username">联系人</label>
                        <input type="text" class="form-control " id="record_link_man" name="record_link_man" value="">
                        <div class="alert alert-danger" role="alert" id="save_to_record_link_man" style="display:none;"></div>
                    </div>
                    <!-- /controls -->
                </div>
                <!-- /control-group -->

            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
                <button class="btn btn-primary" id="btn_save_linkman_record">保存</button>
            </div>
        </div>
    </div>
</div>

<div id="add_message_modal" class="modal modal-ku fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="myModalLabel_linkman">添加留言

                    <a href="javascript:;" class="btn btn-danger btn-small " id="delete_linkman" style="display: none;">
                        <i class="btn-icon-only icon-remove">×</i>
                        </i>
                    </a>

                </h5>
            </div>
            <div class="modal-body form-horizontal" id="site_mod">
                <div class="form-group">
                    <div class="col-md-10">
                        <label class="control-label" for="username">内容</label>
                        <textarea type="text" class="form-control " id="message" name="message" placeholder="填写留言"></textarea>
                        <div class="alert alert-danger" role="alert" id="save_to_message" style="display:none;"></div>
                    </div>
                    <!-- /controls -->
                </div>

            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
                <button class="btn btn-primary" id="btn_save_message">保存</button>
            </div>
        </div>
    </div>
</div>
{%end%} {%block js%}

<script>
    $(function () {

        _xsrf = getCookie("_xsrf")
        company_id = {{t_company.id}};
        company_guid = "{{t_company.company_guid}}"


    $(".pick_to_close").on("click",function(){
        close = $(this).attr("close")

        $.post("company?tag=close",{"_xsrf":_xsrf,"company_id":company_id,"company_guid":company_guid,"close":close},function(result){

            location.reload()
        })
        
    })
    $("#reminder_at").datetimepicker({
        minView: 0, pickTime: false, todayBtn: true, autoclose: true, format: 'yyyy-mm-dd hh:ii:00',
        language: 'zh-CN', initialDate: new Date()
    });
        $("#list_company").click()
        $("#add_plan").on("click",function(){
            $("#add_plan_modal").modal("show")


        })
            $("#add_tag").on("click", function () {
                // $("input[name=plan_type_id]").filter('[value="1"]').attr("checked", true)

                $("#add_tag_modal").modal("show")


            })

        $("#btn_save_plan").on("click",function(){
            reminder_at= $("#reminder_at").val()
            plan_body = $("#plan_body").val()
            plan_type_id = $("input[name=plan_type_id]:checked").val()
            plan_type_id_name = $("input[name=plan_type_id]:checked").attr("title")

            $.post("/plan?tag=add",{
                "plan_title":"{{t_company.entName}}","rel_url":"/company?tag=show&guid={{t_company.company_guid}}&id={{t_company.id}}",

                "reminder_at": reminder_at,"plan_body": plan_body,
            "plan_type_id": plan_type_id,"_xsrf":_xsrf,"rtype":1,"rel_id":company_id,"plan_type_id_name": plan_type_id_name},function(result){


                    location.reload()

            })

        })





        $("#add_to_me").on("click",function(){
               $.post("/company?tag=add_to_me",
                { "_xsrf": _xsrf, "company_id": company_id, "company_guid": company_guid },
                function (result) {
                   if(result=="0"){
                    location.reload()

                   }else if(result=='-1'){
                       alert('超过系统限定,释放才能增加')
                   }
                   else{

                       alert(result)
                   }
                })


        })
       $("#free_to_me").on("click",function(){
               $.post("/company?tag=free_to_me", { "_xsrf": _xsrf, "company_id": company_id, "company_guid": company_guid }, function (result) {
                   if(result=="0"){
                    location.reload()

                   }else{

                       alert(result)
                   }
                })


        })



        $("#btn_save_msg").on("click",function(){
            msg = $("#txt_msg").val()
            if(msg==""){
                alert("跟进记录不能为空哦.")
                return false
            }else{
                $.post("/company?tag=company_msg", { "_xsrf": _xsrf, "msg": msg, "company_id": company_id, "company_guid": company_guid }, function (result) {

                    location.reload()
                })
            }


        })


        $("#btn_save_tag").on("click",function(){
             var str = "";

            $('input[name=company_tag]').each(function () {
                if (this.checked) {

                    str += $(this).attr("title")+"_"+$(this).val()+"_"+ $(this).attr("parent_name") + ",";
                }
            });
            str = str.substr(0, str.length - 1);
            $.post("/company?tag=save_tags",{"_xsrf":_xsrf,"company_tags": str,"company_id":company_id,"company_guid": company_guid},function(result){

                location.reload()
            })

        })


        $("#link_at").datetimepicker({
            minView: 2, pickTime: false, todayBtn: true, autoclose: true,
            language: 'zh-CN', initialDate: new Date()
        });
        $('#online_kf').typeahead({
            source: function (query, process) {
                return $.post('/api', { query: query, "_xsrf": _xsrf }, function (data) {
                    return process(JSON.parse(data));
                });
            }
        });
        $('#kf_guwen').typeahead({
            source: function (query, process) {
                return $.post('/api', { query: query, "_xsrf": _xsrf }, function (data) {
                    return process(JSON.parse(data));
                });
            }
        });
        $('#sell_counselor').typeahead({
            source: function (query, process) {
                return $.post('/api', { query: query, "_xsrf": _xsrf }, function (data) {
                    return process(JSON.parse(data));
                });
            }
        });

        $('.create_t_company').on('click', function () {
            var company = $('#company').val()
            var customer_name = $('#customer_name').val()
            var customer_tel = $('#customer_tel').val()
            var source_qd = $('input[name=source_qd]:checked').val()
            var source_way = $('input[name=source_way]:checked').val()
            var source_key = $('#source_key').val()
            var customer_introducer = $('#customer_introducer').val()
            var inner_introducer = $('#inner_introducer').val()
            var online_kf = $('#online_kf').val()
            var kf_guwen = $('#kf_guwen').val()
            var status = $('#status').val()
            var id = $(this).attr('id')
            if (company == '') {
                $('#e_company').text('公司名不能为空')
                $('#e_company').show()
            }
            else if (customer_name == '') {
                $('#e_customer_name').text('客户名不能为空')
                $('#e_customer_name').show()
            }
            else {
                $.post(
                    '/business?tag=t_company',
                    {
                        '_xsrf': _xsrf,
                        'company': company,
                        'customer_name': customer_name,
                        'customer_tel': customer_tel,
                        'source_qd': source_qd,
                        'source_way': source_way,
                        'source_key': source_key,
                        'customer_introducer': customer_introducer,
                        'inner_introducer': inner_introducer,
                        'online_kf': online_kf,
                        'kf_guwen': kf_guwen,
                        'status': status,
                        'id': id
                    }, function (result) {
                        location.reload()
                    }
                )
            }
        })
        $('.edit_t_company').on('click', function () {
            var id = $(this).attr('id')
            var company = $(this).attr('company')
            var customer_name = $(this).attr('customer_name')
            var customer_tel = $(this).attr('customer_tel')
            var source_qd = $(this).attr('source_qd')
            var source_way = $(this).attr('source_way')
            var source_key = $(this).attr('source_key')
            var customer_introducer = $(this).attr('customer_introducer')
            var inner_introducer = $(this).attr('inner_introducer')
            var online_kf = $(this).attr('online_kf')
            var kf_guwen = $(this).attr('kf_guwen')
            var status = $(this).attr('status')
            $('#company').val(company)
            $('#customer_name').val(customer_name)
            $('#customer_tel').val(customer_tel)
            $('#source_qd').val(source_qd)
            $('#source_way').val(source_way)
            $('#source_key').val(source_key)
            $('#customer_introducer').val(customer_introducer)
            $('#inner_introducer').val(inner_introducer)
            $('#online_kf').val(online_kf)
            $('#kf_guwen').val(kf_guwen)
            $('#status option[value="' + status + '"]').attr('selected', true)
            $('.create_t_company').attr('id', id)
            $('.delete_t_company').attr('id', id)
            $('.t_company_status').show()
            $('#t_company_modal').modal('show')
        })
        $('.delete_t_company').on('click', function () {
            var id = $(this).attr('id')
            if (confirm('确定删除?')) {
                $.post(
                    '/business?tag=t_company',
                    {
                        '_xsrf': _xsrf,
                        'delete_id': id
                    }, function (result) {
                        location.href = "/business?tag=t_company"
                    }
                )
            }
        })
        $('#a_add_linkman').on('click', function () {
            $('#linkman').val('')
            $('#tel').val('')
            $('#save_to_linkman').hide()
            $('#btn_save_linkman').removeAttr('linkman_id')
            $("#add_linkman_modal").modal('show')
        })
        $('#btn_save_linkman').on('click', function () {
            var linkman = $('#linkman').val()
            var tel = $('#tel').val()
            var linkman_id = $(this).attr('linkman_id')
            if (linkman == '') {
                $('#save_to_linkman').text('联系人不能为空')
                $('#save_to_linkman').show()
            } else {
                $(this).text('保存中')
                $(this).attr('disabled', 'disabled')
                $.post(
                    '/business?tag=business_linkman',
                    {
                        '_xsrf': _xsrf,
                        'linkman': linkman,
                        'business_id': "{{t_company.id}}",
                        'tel': tel,
                        'linkman_id': linkman_id
                    }, function (result) {
                        location.reload()
                    }
                )
            }
        })
        $('.edit_linkman').on('click', function () {
            $('#linkman').val($(this).attr('linkman'))
            $('#tel').val($(this).attr('tel'))
            $('#btn_save_linkman').attr('linkman_id', $(this).attr('id'))
            $('#save_to_linkman').hide()
            $("#add_linkman_modal").modal('show')
        })
        $('#a_add_cj_content').on('click', function () {
            $('#title').val('')
            $('#sell_counselor').val('')
            $('#save_to_title').hide()
            $('#save_to_sell_counselor').hide()
            $('#btn_save_cj_content').removeAttr('cj_content_id')
            $('#add_cj_content_modal').modal('show')
        })
        $('#btn_save_cj_content').on('click', function () {
            var title = $('#title').val()
            var sell_counselor = $('#sell_counselor').val()
            var cj_content_id = $(this).attr('cj_content_id')
            if (title == '') {
                $('#save_to_title').text('标题不能为空')
                $('#save_to_title').show()
            } else if (sell_counselor == '') {
                $('#save_to_sell_counselor').text('销售顾问不能为空')
                $('#save_to_sell_counselor').show()
            } else {
                $.post(
                    '/business?tag=business_cj_content',
                    {
                        '_xsrf': _xsrf,
                        'title': title,
                        'business_id': "{{t_company.id}}",
                        'sell_counselor': sell_counselor,
                        'cj_content_id': cj_content_id
                    }, function (result) {
                        location.reload()
                    }
                )
            }
        })

        $('.edit_cj_content').on('click', function () {
            $('#title').val($(this).attr('title'))
            $('#save_to_title').hide()
            $('#save_to_sell_counselor').hide()
            $('#sell_counselor').val($(this).attr('sell_counselor'))
            $('#btn_save_cj_content').attr('cj_content_id', $(this).attr('id'))
            $('#add_cj_content_modal').modal('show')
        })
        $('#a_add_link_record').on('click', function () {
            $('#detail_record').val('')
            $('#link_at').val('')
            $('#record_link_man').val('')
            $('#save_to_record_link_man').hide()
            $('#save_to_record_link_at').hide()
            $('#add_link_record_modal').modal('show')

        })
        $('#btn_save_linkman_record').on('click', function () {
            var detail_record = $('#detail_record').val()
            var link_at = $('#link_at').val()
            var link_man = $('#record_link_man').val()
            var id = $(this).attr('record_id')
            if (link_at == '') {
                $('#save_to_record_link_at').text('联系时间不能为空')
                $('#save_to_record_link_at').show()
            }
            else if (link_man == '') {
                $('#save_to_record_link_man').text('联系人不能为空')
                $('#save_to_record_link_man').show()
            }

            else {
                $(this).text('保存中')
                $(this).attr('disabled', 'disabled')
                $.post(
                    '/company?tag=company_record',
                    {
                        '_xsrf': _xsrf,
                        'detail_record': detail_record,
                        'link_at': link_at,
                        'link_man': link_man,
                        'company_id': "{{t_company.id}}",
                        'id': id
                    }, function () {
                        location.reload()
                    }
                )
            }
        })

        $('.edit_link_record').on('click', function () {
            var link_at = $(this).attr('link_at')
            var link_man = $(this).attr('link_man')
            var detail_record = $(this).attr('detail_record')
            var id = $(this).attr('id')
            $('#detail_record').val(detail_record)
            $('#link_at').val(link_at)
            $('#record_link_man').val(link_man)
            $('#save_to_record_link_man').hide()
            $('#save_to_record_link_at').hide()
            $('#btn_save_linkman_record').attr('record_id', id)
            $('#add_link_record_modal').modal('show')
        })
        $('#a_add_message').on('click', function () {
            $('#message').val('')
            $('#save_to_message').hide()
            $('#btn_save_message').removeAttr('message_id')
            $('#add_message_modal').modal('show')
        })
        $('#btn_save_message').on('click', function () {
            var message = $('#message').val()
            var id = $(this).attr('message_id')
            if (message == '') {
                $('#save_to_message').text('留言不能为空')
                $('#save_to_message').show()
            }
            else {
                $.post(
                    '/business?tag=business_message',
                    {
                        '_xsrf': _xsrf,
                        'message': message,
                        'business_id': "{{t_company.id}}",
                        'id': id
                    }, function (result) {
                        location.reload()
                    }
                )
            }
        })
        $('.a_change_message').on('click', function () {
            $('#save_to_message').hide()
            $('#message').val($(this).attr('message'))
            $('#btn_save_message').attr('message_id', $(this).attr('id'))
            $('#add_message_modal').modal('show')
        })
        $('.a_delete_message').on('click', function () {
            var id = $(this).attr('id')
            if (confirm('确定删除?')) {
                $.post(
                    '/business?tag=business_message',
                    {
                        '_xsrf': _xsrf,
                        'delete_id': id
                    }, function (result) {
                        location.reload()
                    }
                )
            }
        })
        $('.regCap').on('click',function () { 
            $('#plan_body').val('{{t_company.regCap}}')
         })
         $('.entName').on('click',function () { 
            $('#plan_body').val('{{t_company.entName}}')
         })
    })
</script> {%end%}