{% extends "../base.html" %} {%block title%}{%if kz%}刻章供应商{%else%}地址供应商{%end%}{%end%} {% block body %}


      <ol class="breadcrumb">
        <li class="breadcrumb-item">
         主面板
        </li>
        <li class="breadcrumb-item active">{%if kz%}刻章供应商{%else%}地址供应商{%end%}
                {%if is_gy_manage=='1'%} <a href="javascript:void(0)" class="btn btn-info btn-sm" id="{%if kz%}btn_add_kz{%else%}btn_add_addr{%end%}" >新 建 </a>
            {%end%}
        </li>

      </ol>
      <nav>
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
                <a class="nav-item nav-link {%if not kz%}active{%end%}" id="nav-home-tab"
                href="/project?tag=provider_manage" >地址供应商管理</a>
              
              <a class="nav-item nav-link {%if kz%}active{%end%}"
                href="/project?tag=provider_manage&kz=1" style="font-size:13px;">刻章供应商管理</a>
               </div>
        </nav>
        <br>
      <div class="card mb-3">
            <div class="card-body">
            <div class="table-responsive">
            
            <table class="table table-bordered" id="dataTable"  cellspacing="0">
            <thead style="background-color:#000;color:#fff">
                <tr>
                    {% if kz%}
                    <th width="100">区域</th>
                    <th>刻章项目</th>
                    <th width="100">价格</th>
                    <th width="100">创建时间</th>
                    <th width="100">创建人</th>
                    <th width="100">报价历史</th>
                    {%if is_gy_manage=='1'%}
                    <th width="100"></th>
                    {%end%}
                    {%else%}
                    <th width="100">区域</th>
                    <th >地址类型</th>
               
                    <th width="100">价格</th>
                    <th width="100">供应商</th>
                    <th width="100">创建时间</th>
                    <th width="100">创建人</th>
                    <th width="100">备注</th>
                    <th width="100">担保事项</th>
                    <th width="100">供应终止</th>
                    <th width="100">报价历史</th>
                    {%if is_gy_manage=='1'%}
                    <th width="100"></th>
                    {%end%}
                    {%end%}
                </tr>
            </thead>
                <tbody>

                        {% if kz%}
                            {% if kz_provider_manage %}
                            {%for item in kz_provider_manage%}
                            <tr>
                                    <td>{{item.area}}</td>
                                    <td>{{item.kz_project}}</td>
                                    <td>{{item.b}}</td>
                                    <td>{{item.created_at.strftime('%Y-%m-%d')}}</td>
                                    <td>{{item.uid_name}}</td>
                                    <td><a class="btn btn-info kz_detail_history" href="javascript:void(0);"
                                          kz_history="{{item.c}}">查看</a></td>
                                          {%if is_gy_manage=='1'%}
                                    <td><a class="btn btn-info change_kz" href="javascript:void(0);"
                                         id="{{item.id}}" kz_project="{{item.kz_project}}" 
                                         price="{{item.b}}" area="{{item.area}}">修改</a></td>
                                    {%end%}
                                    </tr>
                            {%end%}
                                {%else%}
                                <tr>
                                    <td colspan="10">
                                        还没有哦~
                                    </td>
                                </tr>
                                {%end%}
                        {%else%}
                        {% if addr_provider_manage %}
                       {% for item in addr_provider_manage%} 
                        <tr>
                            <td>{{item.area}}</td>
                            <td>{{item.addr_type}}</td>
                            <td>{{item.b}}</td>
                            <td>{{item.provider}}</td>
                            <td>{{item.created_at.strftime('%Y-%m-%d')}}</td>
                            <td>{{item.uid_name}}</td>
                            <td>{{item.remark}}</td>
                            <td>{{item.danbao_matter}}</td>
                            <td>{{item.proivde_end[:-8]}}</td>
                            <td><a class="btn btn-info addr_detail_history" href="javascript:void(0);"
                                addr_history="{{item.c}}">查看</a></td>
                                {%if is_gy_manage=='1'%}
                            <td><a class="btn btn-info change_addr" href="javascript:void(0);" id="{{item.id}}"
                                addr_type="{{item.addr_type}}" price="{{item.b}}" provider="{{item.provider}}"
                                remark="{{item.remark}}"  provide_end="{%if item.proivde_end%}{{item.proivde_end}}{%end%}"
                                 area="{{item.area}}" fp_limit="{{item.fp_limit}}" danbao_matter="{{item.danbao_matter}}"
                                >修改</a></td>
                                {%end%}
                        </tr>
                        {%end%}   
                        {%else%}
                        <tr>
                            <td colspan="10">
                                还没有哦~
                            </td>
                        </tr>
                        {%end%}   
                     
                       {%end%}
                  
                </tbody>
            </table>
            <div class="col-sm-12 col-md-7">
                    <div class="dataTables_paginate paging_simple_numbers" id="dataTable_paginate">
                        <ul class="pagination">
                            {%if kz%}
                            {% if pagination1.has_prev %}
                            <li class="paginate_button page-item previous " id="dataTable_previous">
                            <a href="/project?tag=provider_manage&kz=1&page={{ pagination.page - 1}}" aria-controls="dataTable" data-dt-idx="3" tabindex="0" class="page-link">&laquo; 上页</a></li> {% end %} {%for page in pagination.iter_pages() %} {% if page %} {% if page != pagination.page %}
                            <li class="paginate_button page-item ">
                                <a href="/project?tag=provider_manage&kz=1&page={{ page }}" aria-controls="dataTable" data-dt-idx="3" tabindex="0" class="page-link">{{ page }}</a></li>
                            {% else %}
                            <li class="paginate_button page-item active"><a href="#" aria-controls="dataTable" data-dt-idx="3" tabindex="0" class="page-link">{{ page }}</a></li>
                            {% end %} {% else %}
                            <li class="paginate_button page-item active"><a href="#" aria-controls="dataTable" data-dt-idx="3" tabindex="0" class="page-link">....</a></li>
                            {% end %} {%end %} {% if pagination1.has_next %}
                            <li class="paginate_button page-item next" id="dataTable_next"><a href="/project?tag=provider_manage&kz=1&page={{pagination.page+1}}" aria-controls="dataTable" data-dt-idx="3" tabindex="0" class="page-link">下页 &raquo;</a></li>
                            {%end%}
                            {%else%}
                            {% if pagination.has_prev %}
                            <li class="paginate_button page-item previous " id="dataTable_previous">
                            <a href="/project?tag=provider_manage&page={{ pagination.page - 1}}" aria-controls="dataTable" data-dt-idx="3" tabindex="0" class="page-link">&laquo; 上页</a></li> {% end %} {%for page in pagination.iter_pages() %} {% if page %} {% if page != pagination.page %}
                            <li class="paginate_button page-item ">
                                <a href="/project?tag=provider_manage&page={{ page }}" aria-controls="dataTable" data-dt-idx="3" tabindex="0" class="page-link">{{ page }}</a></li>
                            {% else %}
                            <li class="paginate_button page-item active"><a href="#" aria-controls="dataTable" data-dt-idx="3" tabindex="0" class="page-link">{{ page }}</a></li>
                            {% end %} {% else %}
                            <li class="paginate_button page-item active"><a href="#" aria-controls="dataTable" data-dt-idx="3" tabindex="0" class="page-link">....</a></li>
                            {% end %} {%end %} {% if pagination.has_next %}
                            <li class="paginate_button page-item next" id="dataTable_next"><a href="/project?tag=provider_manage&page={{pagination.page+1}}" aria-controls="dataTable" data-dt-idx="3" tabindex="0" class="page-link">下页 &raquo;</a></li>
                            {% end %}
                            {%end%}
                        </ul>
                    </div>
                </div>


            </div>
  
        </div>
    </div>
<!-- <modal> -->
      
<div class="modal fade" id="add_addr_provider" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                    <div class="modal-dialog" role="document" >
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="provider_title"></h5>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                
                        <div class="modal-body" id="site_mod">
                            {%if kz%}
                            <div class="form-group">
                                    <div class="col-sm-10">
                                    <label for="recode">区域</label>
                                    <select id="kz_area" class="form-control">
                                            <option value="">选择区域</option>
                                            {%for item in area_type%}
                                            <option value="{{item.income_name}}">{{item.income_name}}</option>
                                            {%end%}
                                        </select>
                                        <div class="alert alert-danger" role="alert" id="save_to_kz_area" style="display:none;"></div>
                                        </div>
                                        </div>
                                        
                            <div class="form-group">
                                <div class="col-sm-10">
                                <label for="recode">刻章项目</label>
                                <input class="form-control" name="kz_project" id="kz_project" type="text">
                                    <div class="alert alert-danger" role="alert" id="save_to_kz_project" style="display:none;"></div>
                                    </div>
                                    </div>
                            <div class="form-group">
                                <div class="col-sm-10">
                                <label for="recode">价格</label>
                                <input class="form-control" name="kz_price" id="kz_price" type="text">
                                    <div class="alert alert-danger" role="alert" id="save_to_kz_price" style="display:none;"></div>
                                    </div>
                                    </div>
                            {%else%}
                            <div class="form-group">
                                    <div class="col-sm-10">
                                    <label for="recode">区域</label>
                                    <select id="area" class="form-control">
                                            <option value="">选择区域</option>
                                            {%for item in area_type%}
                                            <option value="{{item.income_name}}">{{item.income_name}}</option>
                                            {%end%}
                                        </select>
                                    <div class="alert alert-danger" role="alert" id="save_to_area" style="display:none;"></div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                    <div class="col-sm-10">
                                    <label for="recode">发票限量</label>
                                    <input class="form-control" name="fp_limit" id="fp_limit" type="text">
                                        <div class="alert alert-danger" role="alert" id="save_to_fp_limit" style="display:none;"></div>
                                        </div>
                                        </div>
                            <div class="form-group">
                            <div class="col-sm-10">
                                <label for="recode">地址类型</label>
                                <input class="form-control" name="addr_type" id="addr_type" type="text">
                                <div class="alert alert-danger" role="alert" id="save_to_addr_type" style="display:none;"></div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-10">
                                    <label for="money">价格</label>
                                    <input class="form-control" name="price" id="price" type="text">
                                    <div class="alert alert-danger" role="alert" id="save_to_price" style="display:none;"></div>
                                </div>
                            </div>
                                <div class="form-group">
                                <div class="col-sm-10">
                                    <label for="dingjin">供应商</label>
                                    <input class="form-control" name="provider" id="provider" type="text">
                                    <div class="alert alert-danger" role="alert" id="save_to_provider" style="display:none;"></div>
                                </div>
                            </div>
                                <div class="form-group">
                                    <div class="col-sm-10">
                                            <label for="dingjin">备注</label>
                                            <textarea class="form-control" name="remark" id="remark" type="text"></textarea>
                                            <div class="alert alert-danger" role="alert" id="save_to_remark" style="display:none;"></div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                    <div class="col-sm-10">
                                            <label for="dingjin">担保事项</label>
                                            <textarea class="form-control" name="danbao_matter" id="danbao_matter" type="text"></textarea>
                                </div>
                            </div>
                                <div class="form-group">
                                <div class="col-sm-10">
                                        <label for="dingjin">供应终止</label>
                                        <input class="form-control" name="proivde_end" id="proivde_end" type="text" readonly="readonly">
                                    </div>
                                
                        </div>
                        {%end%}
                
                        <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                                         <button class="btn btn-primary" target="_blank" id="{%if kz%}btn_save_kz{%else%}btn_save_addr{%end%}">保 存</button>
                              </div>
                      </div>
                    </div>
            </div>
</div>
<div class="modal fade" id="price_history_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
        <div class="modal-dialog" role="document" >
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="income_title_type">历史报价
    
          </h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
    
    
            <div class="modal-body" id="site_mod">
                <div class="form-group">
                <div class="col-sm-10 price_box">
                    
                </div>
                </div>
          
            <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                  </div>
          </div>
        </div>
</div>
</div>      
{%end%}

{%block js%}

<script>
 $(function () {
    _xsrf =  getCookie("_xsrf")
    $("#proivde_end").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 00:00:00',
    language: 'zh-CN',initialDate: new Date()});
    $('#btn_add_addr').on('click',function () { 
        $('#addr_type').val('')
          $('#price').val('')
          $('#provider').val('')
          $('#remark').val('')
          $('#provide_end').val('')
          $('#danbao_matter').val('')
          $('#fp_limit').val('')
          $('#save_to_addr_type').hide()
          $('#save_to_price').hide()
          $('#save_to_provider').hide()
          $('#save_to_remark').hide()
          $('#save_to_provide_end').hide()
          $('#save_to_area').hide()
          $('#proivde_end').parent().show()
          $('#provider_title').text('新建地址供应商')
        $('#add_addr_provider').modal('show')
     })
     $('#btn_add_kz').on('click',function () {
          $('#kz_project').val('')
          $('#kz_price').val('')
          $('#save_to_kz_project').hide()
          $('#save_to_kz_price').hide()
          $('#save_to_kz_area').hide()
          $('#provider_title').text('新建刻章供应商')
        $('#add_addr_provider').modal('show')
     })
    $('#btn_save_kz').on('click',function () { 
        var kz_id=$(this).attr('kz_id')
        var kz_project=$('#kz_project').val()
        var kz_price=$('#kz_price').val()
        var kz_area=$('#kz_area').val()
        if(kz_area==''){
            $('#save_to_kz_area').html('请选择区域')
            $('#save_to_kz_area').show()
        }
        else if(kz_project==''){
            $('#save_to_kz_project').html('刻章项目不能为空')
            $('#save_to_kz_project').show()
        }
        else if(kz_price==''){
            $('#save_to_kz_price').html('价格不能为空')
            $('#save_to_kz_price').show()
        }
        else if(kz_price!='' & isNaN(kz_price)){
            $('#save_to_kz_price').html('需填写数字')
            $('#save_to_kz_price').show()
        }
        else{
        $.post(
            '/project?tag=provider_manage',
            {
                '_xsrf':_xsrf,
                'kz_project':kz_project,
                'kz_price':kz_price,
                'kz':1,
                'kz_id':kz_id,
                'kz_area':kz_area
            },function (result) { 
                location.reload()
             }
        )
        }
     })
     
    $('#btn_save_addr').on('click',function () {
         var area=$('#area').val()  
         var addr_type=$('#addr_type').val()
         var price=$('#price').val()
         var provider=$('#provider').val()
         var remark=$('#remark').val()
         var proivde_end=$('#proivde_end').val()
         var danbao_matter=$('#danbao_matter').val()
         var addr_id=$(this).attr('addr_id')
         var fp_limit=$('#fp_limit').val()
        if(area==''){
            $('#save_to_area').html('区域不能为空')
            $('#save_to_area').show()
        }
        else if(addr_type==''){
            $('#save_to_addr_type').html('地址类型不能为空')
            $('#save_to_addr_type').show()
         }
         else if(price==''){
            $('#save_to_price').html('价格不能为空')
            $('#save_to_price').show()
         }
         else if(price!='' & isNaN(price)){
            $('#save_to_price').html('需填写数字')
            $('#save_to_price').show()
         }
         else if(provider==''){
            $('#save_to_provider').html('供应商不能为空')
            $('#save_to_provider').show()
         }
         else{
         $.post(
             '/project?tag=provider_manage',
             {
                '_xsrf':_xsrf,
                'addr_type':addr_type,
                'price':price,
                'fp_limit':fp_limit,
                'provider':provider,
                'danbao_matter':danbao_matter,
                'remark':remark,
                'proivde_end':proivde_end,
                'addr_id':addr_id,
                'area':area
             },function (result) { 
                 location.reload()
              }
             )
            }
      })
      $('.change_addr').on('click',function () { 
          var addr_id=$(this).attr('id')
          var addr_type=$(this).attr('addr_type')
          var price=$(this).attr('price')
          var provider=$(this).attr('provider')
          var remark=$(this).attr('remark')
          var provide_end=$(this).attr('provide_end')
          var area=$(this).attr('area')
          var fp_limit=$(this).attr('fp_limit')
          var danbao_matter=$(this).attr('danbao_matter')
          $('#area').val(area)
          $('#addr_type').val(addr_type)
          $('#price').val(price)
          $('#provider').val(provider)
          $('#remark').val(remark)
          $('#provide_end').val(provide_end)
          $('#btn_save_addr').attr('addr_id',addr_id)
          $('#fp_limit').val(fp_limit)
          $('#danbao_matter').val(danbao_matter)
          $('#proivde_end').parent().hide()
          $('#provider_title').text('新建刻章供应商')
          $('#add_addr_provider').modal('show')
       })
    $('.change_kz').on('click',function () { 
        var kz_id=$(this).attr('id')
        var kz_project=$(this).attr('kz_project')
        var kz_price=$(this).attr('price')
        var kz_area=$(this).attr('area')
        $('#kz_project').val(kz_project)
        $('#kz_price').val(kz_price)
        $('#kz_area').val(kz_area)
        $('#btn_save_kz').attr('kz_id',kz_id)
        $('#provider_title').text('修改刻章供应商')
        $('#add_addr_provider').modal('show')
     })

    $('.addr_detail_history').on('click',function () { 
        var price_history=$(this).attr('addr_history')
        price_history=price_history.split(',')
        var text=''
        for(var i=0;i<price_history.length;++i){
            text+='<p>'+price_history[i]+'</p>'
        }
        $('.price_box').html(text)
        $('#price_history_modal').modal('show')
     })
     $('.kz_detail_history').on('click',function () { 
        var price_history=$(this).attr('kz_history')
        price_history=price_history.split(',')
        var text=''
        for(var i=0;i<price_history.length;++i){
            text+='<p>'+price_history[i]+'</p>'
        }
        $('.price_box').html(text)
        $('#price_history_modal').modal('show')
     })
})
</script>
{%end%}
