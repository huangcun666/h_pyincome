{%extends "../base.html" %}{%block title%}应收催款统计{%end%}{%block body%}

<style>

  .faye-btn {padding: 0.1rem 0.2rem; background-color: #9ec6ef; margin-left: 20px; border-radius: 2px;}
  .dropbtn {
    background-color: #4CAF50;
    color: white;
    padding: 16px;
    font-size: 10px;
    border: none;
    cursor: pointer;
}

.dropdown {
    position: relative;
    display: inline-block;
}

.dropdown-content {
    display: none;
    z-index:9999;
    position: absolute;
    background-color: #f9f9f9;
    width: 100%;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
}

.dropdown-content a {
    color: black;
    padding: 6px;
    text-align: center;
    text-decoration: none;
    display: block;
}

.dropdown-content a:hover {background-color: #f1f1f1}

.dropdown:hover .dropdown-content {
    display: block;
}

.dropdown:hover .dropbtn {
    background-color: #3e8e41;
}
</style>

<ol class="breadcrumb">
    <li class="breadcrumb-item g1">
        应收催款统计
    </li>
    <li class="g1 g1-left"><a  href="statis?tag=receive_remind_count&show_tag=1" {%if params[ "show_tag"]=='1' %}class="btn btn-primary btn-sm" {%else%}class="btn btn-default btn-sm" style="background-color: #9ec6ef;"{%end%}>接单列表</a>
    </li>
    <li class="g1 g1-left">
      <a  href="statis?tag=receive_remind_count&show_tag=2" {%if params["show_tag"]=="2" %}class="btn btn-primary btn-sm" {%else%}class="btn btn-default btn-sm" style="background-color: #9ec6ef;" {%end%}>办结列表</a>
    </li><li class="g1 g1-left">
      <a  href="statis?tag=receive_remind_count&show_tag=3" {%if params["show_tag"]=="3" %}class="btn btn-primary btn-sm" {%else%}class="btn btn-default btn-sm" style="background-color: #9ec6ef;" {%end%}>跟进客户量</a>
      </li><li class="g1 g1-left">
      <a  href="statis?tag=receive_remind_count&show_tag=4" {%if params["show_tag"]=="4" %}class="btn btn-primary btn-sm" {%else%}class="btn btn-default btn-sm" style="background-color: #9ec6ef;"{%end%}>跟进记录</a>
      </li><li class="g1 g1-left">
      <a  href="statis?tag=receive_remind_count&show_tag=5" {%if params["show_tag"]=="5" %}class="btn btn-primary btn-sm" {%else%}class="btn btn-default btn-sm" style="background-color: #9ec6ef;" {%end%}>办结待收金额统计</a>
      

</li>

  </ol>
<div class="card mb-3">
    <div class="card-body">
        {%if params['show_tag']=='5'%}
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
       <a class="btn btn-light  nav_padding {%if params['way']=='day'%}active{%end%}" href="statis?tag=receive_remind_count&show_tag=5{%if params['banjie_at_start']%}&banjie_at_start={{params['banjie_at_start']}}{%end%}{%if params['banjie_at_end']%}&banjie_at_end={{params['banjie_at_end']}}{%end%}{%if params['sale']%}&sale={{params['sale']}}{%end%}&way=day">日</a>
      <a class="btn btn-light  nav_padding {%if params['way']=='month'%}active{%end%}" href="statis?tag=receive_remind_count&show_tag=5{%if params['banjie_at_start']%}&banjie_at_start={{params['banjie_at_start']}}{%end%}{%if params['banjie_at_end']%}&banjie_at_end={{params['banjie_at_end']}}{%end%}{%if params['sale']%}&sale={{params['sale']}}{%end%}&way=month">月</a>
      <a class="btn btn-light  nav_padding {%if params['way']=='week'%}active{%end%}" href="statis?tag=receive_remind_count&show_tag=5{%if params['banjie_at_start']%}&banjie_at_start={{params['banjie_at_start']}}{%end%}{%if params['banjie_at_end']%}&banjie_at_end={{params['banjie_at_end']}}{%end%}{%if params['sale']%}&sale={{params['sale']}}{%end%}&way=week">周</a>
            </div>
            {%end%}
      <form class="pm2">
          <table>
              <tbody>
                  {%if params['show_tag']!='5'%}
                  <td><input value="{{params['distribute_at_start']}}" type="text" id="distribute_at_start" name="distribute_at_start" placeholder="分配开始时间" class="form-control"></td>
                  <td>至</td>
                  <td><input value="{{params['distribute_at_end']}}"  type="text" id="distribute_at_end" name="distribute_at_end" placeholder="分配结束时间" class="form-control"></td>
                  <td><input value="{{params['company']}}"  type="text" name="company" placeholder="公司名称" class="form-control"></td>
      
                {%if params['show_tag']=='1' or params['show_tag']=='2' %}
                <td><input value="{{params['jd_at_start']}}"  type="text" id="jd_at_start" name="jd_at_start" placeholder="接单开始时间" class="form-control"></td>
                <td>至</td>
                <td><input value="{{params['jd_at_end']}}"  type="text" id="jd_at_end" name="jd_at_end" placeholder="接单结束时间" class="form-control"></td>
                {%if params['show_tag']=='2'%}
                <td><input value="{{params['banjie_at_start']}}"  type="text" id="banjie_at_start" name="banjie_at_start" placeholder="办结开始时间" class="form-control"></td>
                <td>至</td>
                <td><input value="{{params['banjie_at_end']}}"  type="text" id="banjie_at_end" name="banjie_at_end" placeholder="办结结束时间" class="form-control"></td>
                {%end%}
                {%else%}
                <td><input value="{{params['genjin_at_start']}}"  type="text" id="genjin_at_start" name="genjin_at_start" placeholder="跟进开始时间" class="form-control"></td>
                <td>至</td>
                <td><input value="{{params['genjin_at_end']}}"  type="text" id="genjin_at_end" name="genjin_at_end" placeholder="跟进结束时间" class="form-control"></td>
                {%end%}
                {%else%}
                <td><input value="{{params['banjie_at_start']}}"  type="text" id="banjie_at_start" name="banjie_at_start" placeholder="办结开始时间" class="form-control"></td>
                <td>至</td>
                <td><input value="{{params['banjie_at_end']}}"  type="text" id="banjie_at_end" name="banjie_at_end" placeholder="办结结束时间" class="form-control"></td>
                {%end%}
                <td>
                        <select name="sale" class="custom-select" >
                            <option value="">跟进人</option>
                            {%for item in t_user_sales%}
                            <option value="{{item.id}}" {% if params['sale']==str(item.id) %}selected{%end%}>{{item.name}}</option>
                            {%end%}
                        </select>
                </td>
                <td>
                    <input  name="tag" value="{{tag}}" hidden>
                    <input  name="show_tag" value="{{params['show_tag']}}" hidden>
                    <input type="submit" class="btn btn-primary btn-sm" name="" id="" value="检索"></td>
              </tbody>
          </table>
      </form>
      <div class="table-responsive">

          <table class="table table-bordered fayetable" id="dataTable" 
          >
              <thead class="table_class">
                {%if params['show_tag']=='5'%}
                    {%if count.every_count%}
                    <tr>
                        <th width='100px'>日期</th>
                        <th width='100px'>合计</th>
                        {%for item in count.every_count.split(',')%}
                        <th width='80px'>{{item.split('|')[0]}}</th>
                        {%end%}
                        <th></th>
                    </tr>
                    {%end%}
                {%else%}
                 <tr>
                     {%if params['show_tag']=='3' or params['show_tag']=='4'%}
                     {%if params['show_tag']=='4'%}
                     <th width='100px'>跟进时间</th>
                     {%else%}
                <th width='100px'>最新跟进时间</th>
                    {%end%}
                <th width='100px'>公司名称</th>
                <th width='100px'>跟进人</th>
                <th width='100px'>分配日期</th>
                <th width='100px'>催款时长</th>
                {%if params['show_tag']=='4'%}
                <th width='100px'>跟进内容</th>
                {%else%}
                <th width='100px'>最新动态</th>
                {%end%}
                {%if params['show_tag']=='3'%}
                <th width='100px'>跟进数量</th>
                {%end%}
                     {%else%}
                     <th width='100px'>分配时间</th>
                     <th width='200px'>公司名称</th>
                     <th width='100px'>跟进人</th>
                     <th width='100px'>接单日期</th>
                     <th width='100px'>接单时长</th>
                     {%if params['show_tag']=='2'%}
                        <th width='100px'>办结日期</th>
                        <th width='100px'>办结时长</th>
                     {%end%}
                     {%end%}
                 </tr>
                 {%end%}
              </thead>
              <tbody>
                    {%if params['show_tag']=='5'%}
                    {%if count.every_count%}
                    <tr>
                        <th>合计</th>
                        <th>{{count.sssw}}</th>
                    {%for item in count.every_count.split(',')%}
                    <th>{{item.split('|')[1]}}</th>
                    {%end%}
                    </tr>
                    {%for item in wait_pay_amount_count %}
                        <tr>
                            <td>{{item.df}}</td>
                            <td>{{item.ssw}}</td>
                            {%for m in count.every_count.split(',')%}
                                <td>
                                    {%for row in item.gc.split(',')%}
                                        {%if row.split('|')[0]==m.split('|')[0]%}
                                        {{row.split('|')[1]}}
                                        {%end%}
                                        {%end%}
                                </td>
                            {%end%}
                            <td></td>
                        </tr>
                    {%end%}
                    {%else%}
                    还没有哦~
                    {%end%}
                    {%else%}
                  {%if t_customer_payment_assist%}
                  {%for item in t_customer_payment_assist%}
                  {%if params['show_tag']=='3' or params['show_tag']=='4'%}
                    <tr>
                        <td>{{item.new_genjin_at}}</td>
                        <td><a href="/payment?tag=customer&customer_id={{item.customer_id}}&to_tag=payment_tab">{{item.company}}</a></td>
                        <td>{{item.sale_name}}</td>
                        <td>{{item.distribute_at}}</td>
                        <td>{%if item.is_check==1%}{{item.banjie_day}}{%end%}</td>
                        <td>{{item.msg}}</td>
                        {%if params['show_tag']=='3'%}
                        <td>{{item.genjin_count}}</td>
                        {%end%}
                    </tr>
                  {%else%}
                  <tr>
                      <td>
                          {{item.distribute_at}}
                      </td>
                      <td>
                            <a href="/payment?tag=customer&customer_id={{item.customer_id}}&to_tag=payment_tab">{{item.company}}</a>
                        </td>
                        <td>
                                {{item.sale_name}}
                            </td>

                            <td>
                                    {{item.jd_at}}
                                </td>
                                <td>
                                        {{item.jd_day}}天
                                    </td>
                                    {%if params['show_tag']=='2'%}
                                    <td>{{item.check_at}}</td>
                                    <td>{{item.banjie_day}}</td>
                                    {%end%}
                  </tr>
                  {%end%}
                  {%end%}
                  {%else%}
                <tr><td colspan="10">还没有哦~</td></tr>
                  {%end%}
                  {%end%}
              </tbody>

          </table>
      </div>



      <div class="alert alert-secondary" role="alert">

        共 {{pagination.total_count}} 条记录
       
       
       </div>

        <div class="col-sm-12 col-md-7">
            <div class="dataTables_paginate paging_simple_numbers" id="dataTable_paginate">
               <ul class="pagination">
             {% if pagination.has_prev %}
                  <li class="paginate_button page-item previous " id="dataTable_previous">
                  <a href="/statis?tag=receive_remind_count
                  {%if params['show_tag']%}&show_tag={{params['show_tag']}}{%end%}
                  {% if params['distribute_at_start'] %}&distribute_at_start={{params['distribute_at_start']}}{%end%}
                  {% if params['distribute_at_end'] %}&distribute_at_end={{params['distribute_at_end']}}{%end%}
                  {% if params['jd_at_start'] %}&jd_at_start={{params['jd_at_start']}}{%end%}
                  {% if params['jd_at_end'] %}&jd_at_end={{params['jd_at_end']}}{%end%}
                  {% if params['banjie_at_start'] %}&banjie_at_start={{params['banjie_at_start']}}{%end%}
                  {% if params['banjie_at_end'] %}&banjie_at_end={{params['banjie_at_end']}}{%end%}
                  {% if params['company'] %}&company={{params['company']}}{%end%}
                  {% if params['sale'] %}&sale={{params['sale']}}{%end%}
                  {% if params['genjin_at_start'] %}&genjin_at_start={{params['genjin_at_start']}}{%end%}
                  {% if params['genjin_at_end'] %}&genjin_at_end={{params['genjin_at_end']}}{%end%}
                  {%if params['way']%}&way={{params['way']}}{%end%}
                  &page={{ pagination.page - 1}}
                      
                " aria-controls="dataTable" data-dt-idx="0" tabindex="0" class="page-link">&laquo; 上页</a></li>
                 {% end %}
                 {%for page in pagination.iter_pages() %}
                  {% if page %}
                  {% if page != pagination.page %}
                  <li class="paginate_button page-item ">
                    <a href="/statis?tag=receive_remind_count{%if params['show_tag']%}&show_tag={{params['show_tag']}}{%end%}
                    {% if params['distribute_at_start'] %}&distribute_at_start={{params['distribute_at_start']}}{%end%}
                    {% if params['distribute_at_end'] %}&distribute_at_end={{params['distribute_at_end']}}{%end%}
                    {% if params['jd_at_start'] %}&jd_at_start={{params['jd_at_start']}}{%end%}
                    {% if params['jd_at_end'] %}&jd_at_end={{params['jd_at_end']}}{%end%}
                    {% if params['banjie_at_start'] %}&banjie_at_start={{params['banjie_at_start']}}{%end%}
                    {% if params['banjie_at_end'] %}&banjie_at_end={{params['banjie_at_end']}}{%end%}
                    {% if params['company'] %}&company={{params['company']}}{%end%}
                    {% if params['sale'] %}&sale={{params['sale']}}{%end%}
                    {% if params['genjin_at_start'] %}&genjin_at_start={{params['genjin_at_start']}}{%end%}
                    {% if params['genjin_at_end'] %}&genjin_at_end={{params['genjin_at_end']}}{%end%}
                    {%if params['way']%}&way={{params['way']}}{%end%}
                    &page={{page}}
                         
                    " aria-controls="dataTable" data-dt-idx="3" tabindex="0" class="page-link">{{ page }}</a></li>
                  {% else %}
                   <li class="paginate_button page-item active">
                     <a href="#" aria-controls="dataTable" data-dt-idx="1" tabindex="0" class="page-link">{{ page }}</a></li>
                   {% end %}
                   {% else %}
                   <li class="paginate_button page-item "><span class="active"><a href="#" aria-controls="dataTable" data-dt-idx="1" tabindex="0" class="page-link">....</a></span></li>
                   {% end %} 
                   
                   {%end %}
         
                  {% if pagination.has_next %}
                  <li class="paginate_button  page-item next" id="dataTable_next">
                    <a href="/statis?tag=receive_remind_count{%if params['show_tag']%}&show_tag={{params['show_tag']}}{%end%}
                    {% if params['distribute_at_start'] %}&distribute_at_start={{params['distribute_at_start']}}{%end%}
                    {% if params['distribute_at_end'] %}&distribute_at_end={{params['distribute_at_end']}}{%end%}
                    {% if params['jd_at_start'] %}&jd_at_start={{params['jd_at_start']}}{%end%}
                    {% if params['jd_at_end'] %}&jd_at_end={{params['jd_at_end']}}{%end%}
                    {% if params['banjie_at_start'] %}&banjie_at_start={{params['banjie_at_start']}}{%end%}
                    {% if params['banjie_at_end'] %}&banjie_at_end={{params['banjie_at_end']}}{%end%}
                    {% if params['company'] %}&company={{params['company']}}{%end%}
                    {% if params['sale'] %}&sale={{params['sale']}}{%end%}
                    {% if params['genjin_at_start'] %}&genjin_at_start={{params['genjin_at_start']}}{%end%}
                    {% if params['genjin_at_end'] %}&genjin_at_end={{params['genjin_at_end']}}{%end%}
                    {%if params['way']%}&way={{params['way']}}{%end%}
                    &page={{pagination.page+1}}
                       
                    " aria-controls="dataTable" data-dt-idx="7" tabindex="0" class="page-link">下页 &raquo;</a></li>
              {% end %} </ul>
            </div>
         </div>
    </div>
</div>
<div class="modal fade" id="modal_chengjiao" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document" >
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="projects_note">成交事项</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

  <div class="modal-body form-horizontal" id="site_mod">


        <div class="card-body py-2 " id='projects_note_confirm_content'>


      <div class="form-group" id='projects_note_content'>
      <label for="inputEmail3" class="col-sm-3 control-label" id="projects_lab">成交内容
        </label>
   
      <div class="col-sm-10">
        <textarea id='chengjiao_content' class="form-control" type="text" name="chengjiao_content"></textarea>
      </div>
    
    
    </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-danger" id="btn_del_modal_chengjiao">删除</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                   <button class="btn btn-primary modal_note_btn" target="_blank" id="btn_save_modal_chengjiao">保 存</button>

        </div>
      </div>
    </div>
  </div>
{%end%}
{%block js%}
<script>
$(function () { 
    _xsrf =  getCookie("_xsrf")
    $("#m_statis").click()
    $("#distribute_at_start").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 00:00:00',
    language: 'zh-CN',initialDate: new Date()});
    
    $("#distribute_at_end").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 23:59:59',
    language: 'zh-CN',initialDate: new Date()});
    $("#jd_at_start").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 00:00:00',
    language: 'zh-CN',initialDate: new Date()});
    $("#jd_at_end").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 23:59:59',
    language: 'zh-CN',initialDate: new Date()});
    
    $("#banjie_at_start").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 00:00:00',
    language: 'zh-CN',initialDate: new Date()});
    $("#banjie_at_end").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 23:59:59',
    language: 'zh-CN',initialDate: new Date()});

    $("#genjin_at_start").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 00:00:00',
    language: 'zh-CN',initialDate: new Date()});
    $("#genjin_at_end").datetimepicker({ minView: 2, pickTime: false,todayBtn: true,autoclose: true,format: 'yyyy-mm-dd 23:59:59',
    language: 'zh-CN',initialDate: new Date()});
    $('#jd_day').keyup(function () { 
      if(isNaN($(this).val())){
        $(this).css('background-color','#E60012')
        $("#search_btn").attr('disabled','true')
      }
      else{
        $(this).css('background-color','#fff')
        $("#search_btn").removeAttr('disabled')
      }
     })
 })
</script>
{%end%}